(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,67034,(e,t,n)=>{var r={675:function(e,t){"use strict";t.byteLength=function(e){var t=l(e),n=t[0],r=t[1];return(n+r)*3/4-r},t.toByteArray=function(e){var t,n,s=l(e),o=s[0],a=s[1],h=new i((o+a)*3/4-a),u=0,c=a>0?o-4:o;for(n=0;n<c;n+=4)t=r[e.charCodeAt(n)]<<18|r[e.charCodeAt(n+1)]<<12|r[e.charCodeAt(n+2)]<<6|r[e.charCodeAt(n+3)],h[u++]=t>>16&255,h[u++]=t>>8&255,h[u++]=255&t;return 2===a&&(t=r[e.charCodeAt(n)]<<2|r[e.charCodeAt(n+1)]>>4,h[u++]=255&t),1===a&&(t=r[e.charCodeAt(n)]<<10|r[e.charCodeAt(n+1)]<<4|r[e.charCodeAt(n+2)]>>2,h[u++]=t>>8&255,h[u++]=255&t),h},t.fromByteArray=function(e){for(var t,r=e.length,i=r%3,s=[],o=0,a=r-i;o<a;o+=16383)s.push(function(e,t,r){for(var i,s=[],o=t;o<r;o+=3)i=(e[o]<<16&0xff0000)+(e[o+1]<<8&65280)+(255&e[o+2]),s.push(n[i>>18&63]+n[i>>12&63]+n[i>>6&63]+n[63&i]);return s.join("")}(e,o,o+16383>a?a:o+16383));return 1===i?s.push(n[(t=e[r-1])>>2]+n[t<<4&63]+"=="):2===i&&s.push(n[(t=(e[r-2]<<8)+e[r-1])>>10]+n[t>>4&63]+n[t<<2&63]+"="),s.join("")};for(var n=[],r=[],i="undefined"!=typeof Uint8Array?Uint8Array:Array,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=0,a=s.length;o<a;++o)n[o]=s[o],r[s.charCodeAt(o)]=o;function l(e){var t=e.length;if(t%4>0)throw Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");-1===n&&(n=t);var r=n===t?0:4-n%4;return[n,r]}r[45]=62,r[95]=63},72:function(e,t,n){"use strict";var r=n(675),i=n(783),s="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;function o(e){if(e>0x7fffffff)throw RangeError('The value "'+e+'" is invalid for option "size"');var t=new Uint8Array(e);return Object.setPrototypeOf(t,a.prototype),t}function a(e,t,n){if("number"==typeof e){if("string"==typeof t)throw TypeError('The "string" argument must be of type string. Received type number');return u(e)}return l(e,t,n)}function l(e,t,n){if("string"==typeof e){var r=e,i=t;if(("string"!=typeof i||""===i)&&(i="utf8"),!a.isEncoding(i))throw TypeError("Unknown encoding: "+i);var s=0|f(r,i),l=o(s),h=l.write(r,i);return h!==s&&(l=l.slice(0,h)),l}if(ArrayBuffer.isView(e))return c(e);if(null==e)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(R(e,ArrayBuffer)||e&&R(e.buffer,ArrayBuffer)||"undefined"!=typeof SharedArrayBuffer&&(R(e,SharedArrayBuffer)||e&&R(e.buffer,SharedArrayBuffer)))return function(e,t,n){var r;if(t<0||e.byteLength<t)throw RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(n||0))throw RangeError('"length" is outside of buffer bounds');return Object.setPrototypeOf(r=void 0===t&&void 0===n?new Uint8Array(e):void 0===n?new Uint8Array(e,t):new Uint8Array(e,t,n),a.prototype),r}(e,t,n);if("number"==typeof e)throw TypeError('The "value" argument must not be of type number. Received type number');var u=e.valueOf&&e.valueOf();if(null!=u&&u!==e)return a.from(u,t,n);var p=function(e){if(a.isBuffer(e)){var t=0|d(e.length),n=o(t);return 0===n.length||e.copy(n,0,0,t),n}return void 0!==e.length?"number"!=typeof e.length||function(e){return e!=e}(e.length)?o(0):c(e):"Buffer"===e.type&&Array.isArray(e.data)?c(e.data):void 0}(e);if(p)return p;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return a.from(e[Symbol.toPrimitive]("string"),t,n);throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function h(e){if("number"!=typeof e)throw TypeError('"size" argument must be of type number');if(e<0)throw RangeError('The value "'+e+'" is invalid for option "size"')}function u(e){return h(e),o(e<0?0:0|d(e))}function c(e){for(var t=e.length<0?0:0|d(e.length),n=o(t),r=0;r<t;r+=1)n[r]=255&e[r];return n}t.Buffer=a,t.SlowBuffer=function(e){return+e!=e&&(e=0),a.alloc(+e)},t.INSPECT_MAX_BYTES=50,t.kMaxLength=0x7fffffff,a.TYPED_ARRAY_SUPPORT=function(){try{var e=new Uint8Array(1),t={foo:function(){return 42}};return Object.setPrototypeOf(t,Uint8Array.prototype),Object.setPrototypeOf(e,t),42===e.foo()}catch(e){return!1}}(),a.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(a.prototype,"parent",{enumerable:!0,get:function(){if(a.isBuffer(this))return this.buffer}}),Object.defineProperty(a.prototype,"offset",{enumerable:!0,get:function(){if(a.isBuffer(this))return this.byteOffset}}),a.poolSize=8192,a.from=function(e,t,n){return l(e,t,n)},Object.setPrototypeOf(a.prototype,Uint8Array.prototype),Object.setPrototypeOf(a,Uint8Array),a.alloc=function(e,t,n){return(h(e),e<=0)?o(e):void 0!==t?"string"==typeof n?o(e).fill(t,n):o(e).fill(t):o(e)},a.allocUnsafe=function(e){return u(e)},a.allocUnsafeSlow=function(e){return u(e)};function d(e){if(e>=0x7fffffff)throw RangeError("Attempt to allocate Buffer larger than maximum size: 0x7fffffff bytes");return 0|e}function f(e,t){if(a.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||R(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);var n=e.length,r=arguments.length>2&&!0===arguments[2];if(!r&&0===n)return 0;for(var i=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":return C(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return k(e).length;default:if(i)return r?-1:C(e).length;t=(""+t).toLowerCase(),i=!0}}function p(e,t,n){var i,s,o,a=!1;if((void 0===t||t<0)&&(t=0),t>this.length||((void 0===n||n>this.length)&&(n=this.length),n<=0||(n>>>=0)<=(t>>>=0)))return"";for(e||(e="utf8");;)switch(e){case"hex":return function(e,t,n){var r=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>r)&&(n=r);for(var i="",s=t;s<n;++s)i+=N[e[s]];return i}(this,t,n);case"utf8":case"utf-8":return _(this,t,n);case"ascii":return function(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(127&e[i]);return r}(this,t,n);case"latin1":case"binary":return function(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(e[i]);return r}(this,t,n);case"base64":return i=this,s=t,o=n,0===s&&o===i.length?r.fromByteArray(i):r.fromByteArray(i.slice(s,o));case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return function(e,t,n){for(var r=e.slice(t,n),i="",s=0;s<r.length;s+=2)i+=String.fromCharCode(r[s]+256*r[s+1]);return i}(this,t,n);default:if(a)throw TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),a=!0}}function g(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function m(e,t,n,r,i){var s;if(0===e.length)return -1;if("string"==typeof n?(r=n,n=0):n>0x7fffffff?n=0x7fffffff:n<-0x80000000&&(n=-0x80000000),(s=n*=1)!=s&&(n=i?0:e.length-1),n<0&&(n=e.length+n),n>=e.length)if(i)return -1;else n=e.length-1;else if(n<0)if(!i)return -1;else n=0;if("string"==typeof t&&(t=a.from(t,r)),a.isBuffer(t))return 0===t.length?-1:y(e,t,n,r,i);if("number"==typeof t){if(t&=255,"function"==typeof Uint8Array.prototype.indexOf)if(i)return Uint8Array.prototype.indexOf.call(e,t,n);else return Uint8Array.prototype.lastIndexOf.call(e,t,n);return y(e,[t],n,r,i)}throw TypeError("val must be string, number or Buffer")}function y(e,t,n,r,i){var s,o=1,a=e.length,l=t.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(e.length<2||t.length<2)return -1;o=2,a/=2,l/=2,n/=2}function h(e,t){return 1===o?e[t]:e.readUInt16BE(t*o)}if(i){var u=-1;for(s=n;s<a;s++)if(h(e,s)===h(t,-1===u?0:s-u)){if(-1===u&&(u=s),s-u+1===l)return u*o}else -1!==u&&(s-=s-u),u=-1}else for(n+l>a&&(n=a-l),s=n;s>=0;s--){for(var c=!0,d=0;d<l;d++)if(h(e,s+d)!==h(t,d)){c=!1;break}if(c)return s}return -1}a.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==a.prototype},a.compare=function(e,t){if(R(e,Uint8Array)&&(e=a.from(e,e.offset,e.byteLength)),R(t,Uint8Array)&&(t=a.from(t,t.offset,t.byteLength)),!a.isBuffer(e)||!a.isBuffer(t))throw TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;for(var n=e.length,r=t.length,i=0,s=Math.min(n,r);i<s;++i)if(e[i]!==t[i]){n=e[i],r=t[i];break}return n<r?-1:+(r<n)},a.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},a.concat=function(e,t){if(!Array.isArray(e))throw TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return a.alloc(0);if(void 0===t)for(n=0,t=0;n<e.length;++n)t+=e[n].length;var n,r=a.allocUnsafe(t),i=0;for(n=0;n<e.length;++n){var s=e[n];if(R(s,Uint8Array)&&(s=a.from(s)),!a.isBuffer(s))throw TypeError('"list" argument must be an Array of Buffers');s.copy(r,i),i+=s.length}return r},a.byteLength=f,a.prototype._isBuffer=!0,a.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)g(this,t,t+1);return this},a.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)g(this,t,t+3),g(this,t+1,t+2);return this},a.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)g(this,t,t+7),g(this,t+1,t+6),g(this,t+2,t+5),g(this,t+3,t+4);return this},a.prototype.toString=function(){var e=this.length;return 0===e?"":0==arguments.length?_(this,0,e):p.apply(this,arguments)},a.prototype.toLocaleString=a.prototype.toString,a.prototype.equals=function(e){if(!a.isBuffer(e))throw TypeError("Argument must be a Buffer");return this===e||0===a.compare(this,e)},a.prototype.inspect=function(){var e="",n=t.INSPECT_MAX_BYTES;return e=this.toString("hex",0,n).replace(/(.{2})/g,"$1 ").trim(),this.length>n&&(e+=" ... "),"<Buffer "+e+">"},s&&(a.prototype[s]=a.prototype.inspect),a.prototype.compare=function(e,t,n,r,i){if(R(e,Uint8Array)&&(e=a.from(e,e.offset,e.byteLength)),!a.isBuffer(e))throw TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===r&&(r=0),void 0===i&&(i=this.length),t<0||n>e.length||r<0||i>this.length)throw RangeError("out of range index");if(r>=i&&t>=n)return 0;if(r>=i)return -1;if(t>=n)return 1;if(t>>>=0,n>>>=0,r>>>=0,i>>>=0,this===e)return 0;for(var s=i-r,o=n-t,l=Math.min(s,o),h=this.slice(r,i),u=e.slice(t,n),c=0;c<l;++c)if(h[c]!==u[c]){s=h[c],o=u[c];break}return s<o?-1:+(o<s)},a.prototype.includes=function(e,t,n){return -1!==this.indexOf(e,t,n)},a.prototype.indexOf=function(e,t,n){return m(this,e,t,n,!0)},a.prototype.lastIndexOf=function(e,t,n){return m(this,e,t,n,!1)};function _(e,t,n){n=Math.min(e.length,n);for(var r=[],i=t;i<n;){var s,o,a,l,h=e[i],u=null,c=h>239?4:h>223?3:h>191?2:1;if(i+c<=n)switch(c){case 1:h<128&&(u=h);break;case 2:(192&(s=e[i+1]))==128&&(l=(31&h)<<6|63&s)>127&&(u=l);break;case 3:s=e[i+1],o=e[i+2],(192&s)==128&&(192&o)==128&&(l=(15&h)<<12|(63&s)<<6|63&o)>2047&&(l<55296||l>57343)&&(u=l);break;case 4:s=e[i+1],o=e[i+2],a=e[i+3],(192&s)==128&&(192&o)==128&&(192&a)==128&&(l=(15&h)<<18|(63&s)<<12|(63&o)<<6|63&a)>65535&&l<1114112&&(u=l)}null===u?(u=65533,c=1):u>65535&&(u-=65536,r.push(u>>>10&1023|55296),u=56320|1023&u),r.push(u),i+=c}var d=r,f=d.length;if(f<=4096)return String.fromCharCode.apply(String,d);for(var p="",g=0;g<f;)p+=String.fromCharCode.apply(String,d.slice(g,g+=4096));return p}function v(e,t,n){if(e%1!=0||e<0)throw RangeError("offset is not uint");if(e+t>n)throw RangeError("Trying to access beyond buffer length")}function w(e,t,n,r,i,s){if(!a.isBuffer(e))throw TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<s)throw RangeError('"value" argument is out of bounds');if(n+r>e.length)throw RangeError("Index out of range")}function b(e,t,n,r,i,s){if(n+r>e.length||n<0)throw RangeError("Index out of range")}function E(e,t,n,r,s){return t*=1,n>>>=0,s||b(e,t,n,4,34028234663852886e22,-34028234663852886e22),i.write(e,t,n,r,23,4),n+4}function T(e,t,n,r,s){return t*=1,n>>>=0,s||b(e,t,n,8,17976931348623157e292,-17976931348623157e292),i.write(e,t,n,r,52,8),n+8}a.prototype.write=function(e,t,n,r){if(void 0===t)r="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)r=t,n=this.length,t=0;else if(isFinite(t))t>>>=0,isFinite(n)?(n>>>=0,void 0===r&&(r="utf8")):(r=n,n=void 0);else throw Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");var i,s,o,a,l,h,u,c,d=this.length-t;if((void 0===n||n>d)&&(n=d),e.length>0&&(n<0||t<0)||t>this.length)throw RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var f=!1;;)switch(r){case"hex":return function(e,t,n,r){n=Number(n)||0;var i=e.length-n;r?(r=Number(r))>i&&(r=i):r=i;var s=t.length;r>s/2&&(r=s/2);for(var o=0;o<r;++o){var a,l=parseInt(t.substr(2*o,2),16);if((a=l)!=a)break;e[n+o]=l}return o}(this,e,t,n);case"utf8":case"utf-8":return i=t,s=n,A(C(e,this.length-i),this,i,s);case"ascii":return o=t,a=n,A(S(e),this,o,a);case"latin1":case"binary":return function(e,t,n,r){return A(S(t),e,n,r)}(this,e,t,n);case"base64":return l=t,h=n,A(k(e),this,l,h);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return u=t,c=n,A(function(e,t){for(var n,r,i=[],s=0;s<e.length&&!((t-=2)<0);++s)r=(n=e.charCodeAt(s))>>8,i.push(n%256),i.push(r);return i}(e,this.length-u),this,u,c);default:if(f)throw TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),f=!0}},a.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},a.prototype.slice=function(e,t){var n=this.length;e=~~e,t=void 0===t?n:~~t,e<0?(e+=n)<0&&(e=0):e>n&&(e=n),t<0?(t+=n)<0&&(t=0):t>n&&(t=n),t<e&&(t=e);var r=this.subarray(e,t);return Object.setPrototypeOf(r,a.prototype),r},a.prototype.readUIntLE=function(e,t,n){e>>>=0,t>>>=0,n||v(e,t,this.length);for(var r=this[e],i=1,s=0;++s<t&&(i*=256);)r+=this[e+s]*i;return r},a.prototype.readUIntBE=function(e,t,n){e>>>=0,t>>>=0,n||v(e,t,this.length);for(var r=this[e+--t],i=1;t>0&&(i*=256);)r+=this[e+--t]*i;return r},a.prototype.readUInt8=function(e,t){return e>>>=0,t||v(e,1,this.length),this[e]},a.prototype.readUInt16LE=function(e,t){return e>>>=0,t||v(e,2,this.length),this[e]|this[e+1]<<8},a.prototype.readUInt16BE=function(e,t){return e>>>=0,t||v(e,2,this.length),this[e]<<8|this[e+1]},a.prototype.readUInt32LE=function(e,t){return e>>>=0,t||v(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+0x1000000*this[e+3]},a.prototype.readUInt32BE=function(e,t){return e>>>=0,t||v(e,4,this.length),0x1000000*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},a.prototype.readIntLE=function(e,t,n){e>>>=0,t>>>=0,n||v(e,t,this.length);for(var r=this[e],i=1,s=0;++s<t&&(i*=256);)r+=this[e+s]*i;return r>=(i*=128)&&(r-=Math.pow(2,8*t)),r},a.prototype.readIntBE=function(e,t,n){e>>>=0,t>>>=0,n||v(e,t,this.length);for(var r=t,i=1,s=this[e+--r];r>0&&(i*=256);)s+=this[e+--r]*i;return s>=(i*=128)&&(s-=Math.pow(2,8*t)),s},a.prototype.readInt8=function(e,t){return(e>>>=0,t||v(e,1,this.length),128&this[e])?-((255-this[e]+1)*1):this[e]},a.prototype.readInt16LE=function(e,t){e>>>=0,t||v(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?0xffff0000|n:n},a.prototype.readInt16BE=function(e,t){e>>>=0,t||v(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?0xffff0000|n:n},a.prototype.readInt32LE=function(e,t){return e>>>=0,t||v(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},a.prototype.readInt32BE=function(e,t){return e>>>=0,t||v(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},a.prototype.readFloatLE=function(e,t){return e>>>=0,t||v(e,4,this.length),i.read(this,e,!0,23,4)},a.prototype.readFloatBE=function(e,t){return e>>>=0,t||v(e,4,this.length),i.read(this,e,!1,23,4)},a.prototype.readDoubleLE=function(e,t){return e>>>=0,t||v(e,8,this.length),i.read(this,e,!0,52,8)},a.prototype.readDoubleBE=function(e,t){return e>>>=0,t||v(e,8,this.length),i.read(this,e,!1,52,8)},a.prototype.writeUIntLE=function(e,t,n,r){if(e*=1,t>>>=0,n>>>=0,!r){var i=Math.pow(2,8*n)-1;w(this,e,t,n,i,0)}var s=1,o=0;for(this[t]=255&e;++o<n&&(s*=256);)this[t+o]=e/s&255;return t+n},a.prototype.writeUIntBE=function(e,t,n,r){if(e*=1,t>>>=0,n>>>=0,!r){var i=Math.pow(2,8*n)-1;w(this,e,t,n,i,0)}var s=n-1,o=1;for(this[t+s]=255&e;--s>=0&&(o*=256);)this[t+s]=e/o&255;return t+n},a.prototype.writeUInt8=function(e,t,n){return e*=1,t>>>=0,n||w(this,e,t,1,255,0),this[t]=255&e,t+1},a.prototype.writeUInt16LE=function(e,t,n){return e*=1,t>>>=0,n||w(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},a.prototype.writeUInt16BE=function(e,t,n){return e*=1,t>>>=0,n||w(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},a.prototype.writeUInt32LE=function(e,t,n){return e*=1,t>>>=0,n||w(this,e,t,4,0xffffffff,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},a.prototype.writeUInt32BE=function(e,t,n){return e*=1,t>>>=0,n||w(this,e,t,4,0xffffffff,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},a.prototype.writeIntLE=function(e,t,n,r){if(e*=1,t>>>=0,!r){var i=Math.pow(2,8*n-1);w(this,e,t,n,i-1,-i)}var s=0,o=1,a=0;for(this[t]=255&e;++s<n&&(o*=256);)e<0&&0===a&&0!==this[t+s-1]&&(a=1),this[t+s]=(e/o|0)-a&255;return t+n},a.prototype.writeIntBE=function(e,t,n,r){if(e*=1,t>>>=0,!r){var i=Math.pow(2,8*n-1);w(this,e,t,n,i-1,-i)}var s=n-1,o=1,a=0;for(this[t+s]=255&e;--s>=0&&(o*=256);)e<0&&0===a&&0!==this[t+s+1]&&(a=1),this[t+s]=(e/o|0)-a&255;return t+n},a.prototype.writeInt8=function(e,t,n){return e*=1,t>>>=0,n||w(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},a.prototype.writeInt16LE=function(e,t,n){return e*=1,t>>>=0,n||w(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},a.prototype.writeInt16BE=function(e,t,n){return e*=1,t>>>=0,n||w(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},a.prototype.writeInt32LE=function(e,t,n){return e*=1,t>>>=0,n||w(this,e,t,4,0x7fffffff,-0x80000000),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},a.prototype.writeInt32BE=function(e,t,n){return e*=1,t>>>=0,n||w(this,e,t,4,0x7fffffff,-0x80000000),e<0&&(e=0xffffffff+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},a.prototype.writeFloatLE=function(e,t,n){return E(this,e,t,!0,n)},a.prototype.writeFloatBE=function(e,t,n){return E(this,e,t,!1,n)},a.prototype.writeDoubleLE=function(e,t,n){return T(this,e,t,!0,n)},a.prototype.writeDoubleBE=function(e,t,n){return T(this,e,t,!1,n)},a.prototype.copy=function(e,t,n,r){if(!a.isBuffer(e))throw TypeError("argument should be a Buffer");if(n||(n=0),r||0===r||(r=this.length),t>=e.length&&(t=e.length),t||(t=0),r>0&&r<n&&(r=n),r===n||0===e.length||0===this.length)return 0;if(t<0)throw RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw RangeError("Index out of range");if(r<0)throw RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),e.length-t<r-n&&(r=e.length-t+n);var i=r-n;if(this===e&&"function"==typeof Uint8Array.prototype.copyWithin)this.copyWithin(t,n,r);else if(this===e&&n<t&&t<r)for(var s=i-1;s>=0;--s)e[s+t]=this[s+n];else Uint8Array.prototype.set.call(e,this.subarray(n,r),t);return i},a.prototype.fill=function(e,t,n,r){if("string"==typeof e){if("string"==typeof t?(r=t,t=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),void 0!==r&&"string"!=typeof r)throw TypeError("encoding must be a string");if("string"==typeof r&&!a.isEncoding(r))throw TypeError("Unknown encoding: "+r);if(1===e.length){var i,s=e.charCodeAt(0);("utf8"===r&&s<128||"latin1"===r)&&(e=s)}}else"number"==typeof e?e&=255:"boolean"==typeof e&&(e=Number(e));if(t<0||this.length<t||this.length<n)throw RangeError("Out of range index");if(n<=t)return this;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"==typeof e)for(i=t;i<n;++i)this[i]=e;else{var o=a.isBuffer(e)?e:a.from(e,r),l=o.length;if(0===l)throw TypeError('The value "'+e+'" is invalid for argument "value"');for(i=0;i<n-t;++i)this[i+t]=o[i%l]}return this};var I=/[^+/0-9A-Za-z-_]/g;function C(e,t){t=t||1/0;for(var n,r=e.length,i=null,s=[],o=0;o<r;++o){if((n=e.charCodeAt(o))>55295&&n<57344){if(!i){if(n>56319||o+1===r){(t-=3)>-1&&s.push(239,191,189);continue}i=n;continue}if(n<56320){(t-=3)>-1&&s.push(239,191,189),i=n;continue}n=(i-55296<<10|n-56320)+65536}else i&&(t-=3)>-1&&s.push(239,191,189);if(i=null,n<128){if((t-=1)<0)break;s.push(n)}else if(n<2048){if((t-=2)<0)break;s.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;s.push(n>>12|224,n>>6&63|128,63&n|128)}else if(n<1114112){if((t-=4)<0)break;s.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}else throw Error("Invalid code point")}return s}function S(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}function k(e){return r.toByteArray(function(e){if((e=(e=e.split("=")[0]).trim().replace(I,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function A(e,t,n,r){for(var i=0;i<r&&!(i+n>=t.length)&&!(i>=e.length);++i)t[i+n]=e[i];return i}function R(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}var N=function(){for(var e="0123456789abcdef",t=Array(256),n=0;n<16;++n)for(var r=16*n,i=0;i<16;++i)t[r+i]=e[n]+e[i];return t}()},783:function(e,t){t.read=function(e,t,n,r,i){var s,o,a=8*i-r-1,l=(1<<a)-1,h=l>>1,u=-7,c=n?i-1:0,d=n?-1:1,f=e[t+c];for(c+=d,s=f&(1<<-u)-1,f>>=-u,u+=a;u>0;s=256*s+e[t+c],c+=d,u-=8);for(o=s&(1<<-u)-1,s>>=-u,u+=r;u>0;o=256*o+e[t+c],c+=d,u-=8);if(0===s)s=1-h;else{if(s===l)return o?NaN:1/0*(f?-1:1);o+=Math.pow(2,r),s-=h}return(f?-1:1)*o*Math.pow(2,s-r)},t.write=function(e,t,n,r,i,s){var o,a,l,h=8*s-i-1,u=(1<<h)-1,c=u>>1,d=5960464477539062e-23*(23===i),f=r?0:s-1,p=r?1:-1,g=+(t<0||0===t&&1/t<0);for(isNaN(t=Math.abs(t))||t===1/0?(a=+!!isNaN(t),o=u):(o=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-o))<1&&(o--,l*=2),o+c>=1?t+=d/l:t+=d*Math.pow(2,1-c),t*l>=2&&(o++,l/=2),o+c>=u?(a=0,o=u):o+c>=1?(a=(t*l-1)*Math.pow(2,i),o+=c):(a=t*Math.pow(2,c-1)*Math.pow(2,i),o=0));i>=8;e[n+f]=255&a,f+=p,a/=256,i-=8);for(o=o<<i|a,h+=i;h>0;e[n+f]=255&o,f+=p,o/=256,h-=8);e[n+f-p]|=128*g}}},i={};function s(e){var t=i[e];if(void 0!==t)return t.exports;var n=i[e]={exports:{}},o=!0;try{r[e](n,n.exports,s),o=!1}finally{o&&delete i[e]}return n.exports}s.ab="/ROOT/node_modules/next/dist/compiled/buffer/",t.exports=s(72)},57951,98925,36180,27215,61086,59141,e=>{"use strict";let t,n,r,i,s,o,a,l,h,u,c,d,f,p;var g,m,y,_,v,w,b,E,T,I,C,S,k,A,R,N,P,D,O,x,L,M,U,F=e.i(47167),V=e.i(43476),B=e.i(71645);let j=function(e,t){if(!e)throw q(t)},q=function(e){return Error("Firebase Database (${JSCORE_VERSION}) INTERNAL ASSERT FAILED: "+e)},z=function(e){let t=[],n=0;for(let r=0;r<e.length;r++){let i=e.charCodeAt(r);i<128?t[n++]=i:(i<2048?t[n++]=i>>6|192:((64512&i)==55296&&r+1<e.length&&(64512&e.charCodeAt(r+1))==56320?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++r)),t[n++]=i>>18|240,t[n++]=i>>12&63|128):t[n++]=i>>12|224,t[n++]=i>>6&63|128),t[n++]=63&i|128)}return t},$=function(e){let t=[],n=0,r=0;for(;n<e.length;){let i=e[n++];if(i<128)t[r++]=String.fromCharCode(i);else if(i>191&&i<224){let s=e[n++];t[r++]=String.fromCharCode((31&i)<<6|63&s)}else if(i>239&&i<365){let s=((7&i)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536;t[r++]=String.fromCharCode(55296+(s>>10)),t[r++]=String.fromCharCode(56320+(1023&s))}else{let s=e[n++],o=e[n++];t[r++]=String.fromCharCode((15&i)<<12|(63&s)<<6|63&o)}}return t.join("")},H={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();let n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let t=0;t<e.length;t+=3){let i=e[t],s=t+1<e.length,o=s?e[t+1]:0,a=t+2<e.length,l=a?e[t+2]:0,h=i>>2,u=(3&i)<<4|o>>4,c=(15&o)<<2|l>>6,d=63&l;!a&&(d=64,s||(c=64)),r.push(n[h],n[u],n[c],n[d])}return r.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(z(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):$(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();let n=t?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let t=0;t<e.length;){let i=n[e.charAt(t++)],s=t<e.length?n[e.charAt(t)]:0,o=++t<e.length?n[e.charAt(t)]:64,a=++t<e.length?n[e.charAt(t)]:64;if(++t,null==i||null==s||null==o||null==a)throw new W;let l=i<<2|s>>4;if(r.push(l),64!==o){let e=s<<4&240|o>>2;if(r.push(e),64!==a){let e=o<<6&192|a;r.push(e)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class W extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}let K=function(e){let t=z(e);return H.encodeByteArray(t,!0)},G=function(e){return K(e).replace(/\./g,"")},Q=function(e){try{return H.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null},Y=()=>{try{return("undefined"!=typeof self?self:"undefined"!=typeof window?window:e.g).__FIREBASE_DEFAULTS__||(()=>{if(void 0===F.default||void 0===F.default.env)return;let e=F.default.env.__FIREBASE_DEFAULTS__;if(e)return JSON.parse(e)})()||(()=>{let e;if("undefined"==typeof document)return;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(e){return}let t=e&&Q(e[1]);return t&&JSON.parse(t)})()}catch(e){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`);return}},X=e=>Y()?.emulatorHosts?.[e],J=e=>{let t=X(e);if(!t)return;let n=t.lastIndexOf(":");if(n<=0||n+1===t.length)throw Error(`Invalid host ${t} with no separate hostname and port!`);let r=parseInt(t.substring(n+1),10);return"["===t[0]?[t.substring(1,n-1),r]:[t.substring(0,n),r]},Z=()=>Y()?.config,ee=e=>Y()?.[`_${e}`];class et{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),"function"==typeof e&&(this.promise.catch(()=>{}),1===e.length?e(t):e(t,n))}}}function en(e){try{return(e.startsWith("http://")||e.startsWith("https://")?new URL(e).hostname:e).endsWith(".cloudworkstations.dev")}catch{return!1}}async function er(e){return(await fetch(e,{credentials:"include"})).ok}function ei(e,t){if(e.uid)throw Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');let n=t||"demo-project",r=e.iat||0,i=e.sub||e.user_id;if(!i)throw Error("mockUserToken must contain 'sub' or 'user_id' field!");let s={iss:`https://securetoken.google.com/${n}`,aud:n,iat:r,exp:r+3600,auth_time:r,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}},...e};return[G(JSON.stringify({alg:"none",type:"JWT"})),G(JSON.stringify(s)),""].join(".")}let es={},eo=!1;function ea(e,t){if("undefined"==typeof window||"undefined"==typeof document||!en(window.location.host)||es[e]===t||es[e]||eo)return;function n(e){return`__firebase__banner__${e}`}es[e]=t;let r="__firebase__banner",i=function(){let e={prod:[],emulator:[]};for(let t of Object.keys(es))es[t]?e.emulator.push(t):e.prod.push(t);return e}().prod.length>0;function s(){let e,t,s=(e=document.getElementById(r),t=!1,e||((e=document.createElement("div")).setAttribute("id",r),t=!0),{created:t,element:e}),o=n("text"),a=document.getElementById(o)||document.createElement("span"),l=n("learnmore"),h=document.getElementById(l)||document.createElement("a"),u=n("preprendIcon"),c=document.getElementById(u)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(s.created){let e,t=s.element;t.style.display="flex",t.style.background="#7faaf0",t.style.position="fixed",t.style.bottom="5px",t.style.left="5px",t.style.padding=".5em",t.style.borderRadius="5px",t.style.alignItems="center",h.setAttribute("id",l),h.innerText="Learn more",h.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",h.setAttribute("target","__blank"),h.style.paddingLeft="5px",h.style.textDecoration="underline";let n=((e=document.createElement("span")).style.cursor="pointer",e.style.marginLeft="16px",e.style.fontSize="24px",e.innerHTML=" &times;",e.onclick=()=>{let e;eo=!0,(e=document.getElementById(r))&&e.remove()},e);c.setAttribute("width","24"),c.setAttribute("id",u),c.setAttribute("height","24"),c.setAttribute("viewBox","0 0 24 24"),c.setAttribute("fill","none"),c.style.marginLeft="-6px",t.append(c,a,h,n),document.body.appendChild(t)}i?(a.innerText="Preview backend disconnected.",c.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(c.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,a.innerText="Preview backend running in this workspace."),a.setAttribute("id",o)}"loading"===document.readyState?window.addEventListener("DOMContentLoaded",s):s()}function el(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function eh(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(el())}function eu(){return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}function ec(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function ed(){return false}class ef extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,ef.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,ep.prototype.create)}}class ep{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){var n,r;let i=t[0]||{},s=`${this.service}/${e}`,o=this.errors[e],a=o?(n=o,r=i,n.replace(eg,(e,t)=>{let n=r[t];return null!=n?String(n):`<${t}?>`})):"Error",l=`${this.serviceName}: ${a} (${s}).`;return new ef(s,l,i)}}let eg=/\{\$([^}]+)}/g;function em(e){return JSON.parse(e)}function ey(e){return JSON.stringify(e)}let e_=function(e){let t={},n={},r={},i="";try{let s=e.split(".");t=em(Q(s[0])||""),n=em(Q(s[1])||""),i=s[2],r=n.d||{},delete n.d}catch(e){}return{header:t,claims:n,data:r,signature:i}},ev=function(e){let t=e_(e).claims;return!!t&&"object"==typeof t&&t.hasOwnProperty("iat")},ew=function(e){let t=e_(e).claims;return"object"==typeof t&&!0===t.admin};function eb(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function eE(e,t){return Object.prototype.hasOwnProperty.call(e,t)?e[t]:void 0}function eT(e){for(let t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function eI(e,t,n){let r={};for(let i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=t.call(n,e[i],i,e));return r}function eC(e,t){if(e===t)return!0;let n=Object.keys(e),r=Object.keys(t);for(let i of n){if(!r.includes(i))return!1;let n=e[i],s=t[i];if(eS(n)&&eS(s)){if(!eC(n,s))return!1}else if(n!==s)return!1}for(let e of r)if(!n.includes(e))return!1;return!0}function eS(e){return null!==e&&"object"==typeof e}function ek(e){let t=[];for(let[n,r]of Object.entries(e))Array.isArray(r)?r.forEach(e=>{t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))}):t.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return t.length?"&"+t.join("&"):""}function eA(e){let t={};return e.replace(/^\?/,"").split("&").forEach(e=>{if(e){let[n,r]=e.split("=");t[decodeURIComponent(n)]=decodeURIComponent(r)}}),t}function eR(e){let t=e.indexOf("?");if(!t)return"";let n=e.indexOf("#",t);return e.substring(t,n>0?n:void 0)}class eN{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=0x67452301,this.chain_[1]=0xefcdab89,this.chain_[2]=0x98badcfe,this.chain_[3]=0x10325476,this.chain_[4]=0xc3d2e1f0,this.inbuf_=0,this.total_=0}compress_(e,t){let n,r;t||(t=0);let i=this.W_;if("string"==typeof e)for(let n=0;n<16;n++)i[n]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3),t+=4;else for(let n=0;n<16;n++)i[n]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4;for(let e=16;e<80;e++){let t=i[e-3]^i[e-8]^i[e-14]^i[e-16];i[e]=(t<<1|t>>>31)&0xffffffff}let s=this.chain_[0],o=this.chain_[1],a=this.chain_[2],l=this.chain_[3],h=this.chain_[4];for(let e=0;e<80;e++){e<40?e<20?(n=l^o&(a^l),r=0x5a827999):(n=o^a^l,r=0x6ed9eba1):e<60?(n=o&a|l&(o|a),r=0x8f1bbcdc):(n=o^a^l,r=0xca62c1d6);let t=(s<<5|s>>>27)+n+h+r+i[e]|0;h=l,l=a,a=(o<<30|o>>>2)&0xffffffff,o=s,s=t}this.chain_[0]=this.chain_[0]+s|0,this.chain_[1]=this.chain_[1]+o|0,this.chain_[2]=this.chain_[2]+a|0,this.chain_[3]=this.chain_[3]+l|0,this.chain_[4]=this.chain_[4]+h|0}update(e,t){if(null==e)return;void 0===t&&(t=e.length);let n=t-this.blockSize,r=0,i=this.buf_,s=this.inbuf_;for(;r<t;){if(0===s)for(;r<=n;)this.compress_(e,r),r+=this.blockSize;if("string"==typeof e){for(;r<t;)if(i[s]=e.charCodeAt(r),++s,++r,s===this.blockSize){this.compress_(i),s=0;break}}else for(;r<t;)if(i[s]=e[r],++s,++r,s===this.blockSize){this.compress_(i),s=0;break}}this.inbuf_=s,this.total_+=t}digest(){let e=[],t=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let e=this.blockSize-1;e>=56;e--)this.buf_[e]=255&t,t/=256;this.compress_(this.buf_);let n=0;for(let t=0;t<5;t++)for(let r=24;r>=0;r-=8)e[n]=this.chain_[t]>>r&255,++n;return e}}class eP{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(e=>{this.error(e)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,n){let r;if(void 0===e&&void 0===t&&void 0===n)throw Error("Missing Observer.");void 0===(r=!function(e,t){if("object"!=typeof e||null===e)return!1;for(let n of t)if(n in e&&"function"==typeof e[n])return!0;return!1}(e,["next","error","complete"])?{next:e,error:t,complete:n}:e).next&&(r.next=eD),void 0===r.error&&(r.error=eD),void 0===r.complete&&(r.complete=eD);let i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?r.error(this.finalError):r.complete()}catch(e){}}),this.observers.push(r),i}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(e){"undefined"!=typeof console&&console.error&&console.error(e)}})}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function eD(){}let eO=function(e){let t=[],n=0;for(let r=0;r<e.length;r++){let i=e.charCodeAt(r);if(i>=55296&&i<=56319){let t=i-55296;j(++r<e.length,"Surrogate pair missing trail surrogate."),i=65536+(t<<10)+(e.charCodeAt(r)-56320)}i<128?t[n++]=i:(i<2048?t[n++]=i>>6|192:(i<65536?t[n++]=i>>12|224:(t[n++]=i>>18|240,t[n++]=i>>12&63|128),t[n++]=i>>6&63|128),t[n++]=63&i|128)}return t},ex=function(e){let t=0;for(let n=0;n<e.length;n++){let r=e.charCodeAt(n);r<128?t++:r<2048?t+=2:r>=55296&&r<=56319?(t+=4,n++):t+=3}return t};function eL(e){return e&&e._delegate?e._delegate:e}class eM{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}let eU="[DEFAULT]";class eF{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){let t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){let e=new et;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{let n=this.getOrInitializeService({instanceIdentifier:t});n&&e.resolve(n)}catch(e){}}return this.instancesDeferred.get(t).promise}getImmediate(e){let t=this.normalizeInstanceIdentifier(e?.identifier),n=e?.optional??!1;if(this.isInitialized(t)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:t})}catch(e){if(n)return null;throw e}if(n)return null;throw Error(`Service ${this.name} is not available`)}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if("EAGER"===e.instantiationMode)try{this.getOrInitializeService({instanceIdentifier:eU})}catch(e){}for(let[e,t]of this.instancesDeferred.entries()){let n=this.normalizeInstanceIdentifier(e);try{let e=this.getOrInitializeService({instanceIdentifier:n});t.resolve(e)}catch(e){}}}}clearInstance(e=eU){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){let e=Array.from(this.instances.values());await Promise.all([...e.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...e.filter(e=>"_delete"in e).map(e=>e._delete())])}isComponentSet(){return null!=this.component}isInitialized(e=eU){return this.instances.has(e)}getOptions(e=eU){return this.instancesOptions.get(e)||{}}initialize(e={}){let{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);let r=this.getOrInitializeService({instanceIdentifier:n,options:t});for(let[e,t]of this.instancesDeferred.entries())n===this.normalizeInstanceIdentifier(e)&&t.resolve(r);return r}onInit(e,t){let n=this.normalizeInstanceIdentifier(t),r=this.onInitCallbacks.get(n)??new Set;r.add(e),this.onInitCallbacks.set(n,r);let i=this.instances.get(n);return i&&e(i,n),()=>{r.delete(e)}}invokeOnInitCallbacks(e,t){let n=this.onInitCallbacks.get(t);if(n)for(let r of n)try{r(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){var n;let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:(n=e)===eU?void 0:n,options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=eU){return this.component?this.component.multipleInstances?e:eU:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class eV{constructor(e){this.name=e,this.providers=new Map}addComponent(e){let t=this.getProvider(e.name);if(t.isComponentSet())throw Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);let t=new eF(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}let eB=[];(g=w||(w={}))[g.DEBUG=0]="DEBUG",g[g.VERBOSE=1]="VERBOSE",g[g.INFO=2]="INFO",g[g.WARN=3]="WARN",g[g.ERROR=4]="ERROR",g[g.SILENT=5]="SILENT";let ej={debug:w.DEBUG,verbose:w.VERBOSE,info:w.INFO,warn:w.WARN,error:w.ERROR,silent:w.SILENT},eq=w.INFO,ez={[w.DEBUG]:"log",[w.VERBOSE]:"log",[w.INFO]:"info",[w.WARN]:"warn",[w.ERROR]:"error"},e$=(e,t,...n)=>{if(t<e.logLevel)return;let r=new Date().toISOString(),i=ez[t];if(i)console[i](`[${r}]  ${e.name}:`,...n);else throw Error(`Attempted to log a message with an invalid logType (value: ${t})`)};class eH{constructor(e){this.name=e,this._logLevel=eq,this._logHandler=e$,this._userLogHandler=null,eB.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in w))throw TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?ej[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,w.DEBUG,...e),this._logHandler(this,w.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,w.VERBOSE,...e),this._logHandler(this,w.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,w.INFO,...e),this._logHandler(this,w.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,w.WARN,...e),this._logHandler(this,w.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,w.ERROR,...e),this._logHandler(this,w.ERROR,...e)}}let eW=new WeakMap,eK=new WeakMap,eG=new WeakMap,eQ=new WeakMap,eY=new WeakMap,eX={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return eK.get(e);if("objectStoreNames"===t)return e.objectStoreNames||eG.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return eJ(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function eJ(e){if(e instanceof IDBRequest){let t;return(t=new Promise((t,n)=>{let r=()=>{e.removeEventListener("success",i),e.removeEventListener("error",s)},i=()=>{t(eJ(e.result)),r()},s=()=>{n(e.error),r()};e.addEventListener("success",i),e.addEventListener("error",s)})).then(t=>{t instanceof IDBCursor&&eW.set(t,e)}).catch(()=>{}),eY.set(t,e),t}if(eQ.has(e))return eQ.get(e);let r=function(e){if("function"==typeof e)return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(n||(n=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(eZ(this),t),eJ(eW.get(this))}:function(...t){return eJ(e.apply(eZ(this),t))}:function(t,...n){let r=e.call(eZ(this),t,...n);return eG.set(r,t.sort?t.sort():[t]),eJ(r)};return e instanceof IDBTransaction&&function(e){if(eK.has(e))return;let t=new Promise((t,n)=>{let r=()=>{e.removeEventListener("complete",i),e.removeEventListener("error",s),e.removeEventListener("abort",s)},i=()=>{t(),r()},s=()=>{n(e.error||new DOMException("AbortError","AbortError")),r()};e.addEventListener("complete",i),e.addEventListener("error",s),e.addEventListener("abort",s)});eK.set(e,t)}(e),(t||(t=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some(t=>e instanceof t)?new Proxy(e,eX):e}(e);return r!==e&&(eQ.set(e,r),eY.set(r,e)),r}let eZ=e=>eY.get(e),e0=["get","getKey","getAll","getAllKeys","count"],e1=["put","add","delete","clear"],e2=new Map;function e6(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&"string"==typeof t))return;if(e2.get(t))return e2.get(t);let n=t.replace(/FromIndex$/,""),r=t!==n,i=e1.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!(i||e0.includes(n)))return;let s=async function(e,...t){let s=this.transaction(e,i?"readwrite":"readonly"),o=s.store;return r&&(o=o.index(t.shift())),(await Promise.all([o[n](...t),i&&s.done]))[0]};return e2.set(t,s),s}eX={...p=eX,get:(e,t,n)=>e6(e,t)||p.get(e,t,n),has:(e,t)=>!!e6(e,t)||p.has(e,t)};class e3{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(e=>{let t;if(t=e.getComponent(),t?.type!=="VERSION")return null;{let t=e.getImmediate();return`${t.library}/${t.version}`}}).filter(e=>e).join(" ")}}let e4="@firebase/app",e5="0.14.6",e8=new eH("@firebase/app"),e7="[DEFAULT]",e9={[e4]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/data-connect":"fire-data-connect","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","@firebase/ai":"fire-vertex","fire-js":"fire-js",firebase:"fire-js-all"},te=new Map,tt=new Map,tn=new Map;function tr(e,t){try{e.container.addComponent(t)}catch(n){e8.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,n)}}function ti(e,t){e.container.addOrOverwriteComponent(t)}function ts(e){let t=e.name;if(tn.has(t))return e8.debug(`There were multiple attempts to register component ${t}.`),!1;for(let n of(tn.set(t,e),te.values()))tr(n,e);for(let t of tt.values())tr(t,e);return!0}function to(e,t){let n=e.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)}function ta(e,t,n=e7){to(e,t).clearInstance(n)}function tl(e){return void 0!==e.options}function th(e){return!tl(e)&&("authIdToken"in e||"appCheckToken"in e||"releaseOnDeref"in e||"automaticDataCollectionEnabled"in e)}function tu(e){return null!=e&&void 0!==e.settings}function tc(){tn.clear()}let td=new ep("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});class tf{constructor(e,t,n){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new eM("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw td.create("app-deleted",{appName:this._name})}}function tp(e,t){let n=Q(e.split(".")[1]);null===n?console.error(`FirebaseServerApp ${t} is invalid: second part could not be parsed.`):void 0===JSON.parse(n).exp?console.error(`FirebaseServerApp ${t} is invalid: expiration claim could not be parsed`):1e3*JSON.parse(n).exp-new Date().getTime()<=0&&console.error(`FirebaseServerApp ${t} is invalid: the token has expired.`)}class tg extends tf{constructor(e,t,n,r){const i=void 0===t.automaticDataCollectionEnabled||t.automaticDataCollectionEnabled,s={name:n,automaticDataCollectionEnabled:i};void 0!==e.apiKey?super(e,s,r):super(e.options,s,r),this._serverConfig={automaticDataCollectionEnabled:i,...t},this._serverConfig.authIdToken&&tp(this._serverConfig.authIdToken,"authIdToken"),this._serverConfig.appCheckToken&&tp(this._serverConfig.appCheckToken,"appCheckToken"),this._finalizationRegistry=null,"undefined"!=typeof FinalizationRegistry&&(this._finalizationRegistry=new FinalizationRegistry(()=>{this.automaticCleanup()})),this._refCount=0,this.incRefCount(this._serverConfig.releaseOnDeref),this._serverConfig.releaseOnDeref=void 0,t.releaseOnDeref=void 0,tE(e4,e5,"serverapp")}toJSON(){}get refCount(){return this._refCount}incRefCount(e){this.isDeleted||(this._refCount++,void 0!==e&&null!==this._finalizationRegistry&&this._finalizationRegistry.register(e,this))}decRefCount(){return this.isDeleted?0:--this._refCount}automaticCleanup(){tb(this)}get settings(){return this.checkDestroyed(),this._serverConfig}checkDestroyed(){if(this.isDeleted)throw td.create("server-app-deleted")}}let tm="12.6.0";function ty(e,t={}){let n=e;"object"!=typeof t&&(t={name:t});let r={name:e7,automaticDataCollectionEnabled:!0,...t},i=r.name;if("string"!=typeof i||!i)throw td.create("bad-app-name",{appName:String(i)});if(n||(n=Z()),!n)throw td.create("no-options");let s=te.get(i);if(s)if(eC(n,s.options)&&eC(r,s.config))return s;else throw td.create("duplicate-app",{appName:i});let o=new eV(i);for(let e of tn.values())o.addComponent(e);let a=new tf(n,r,o);return te.set(i,a),a}function t_(e,t={}){let n;if(("undefined"!=typeof window||eu())&&!eu())throw td.create("invalid-server-app-environment");let r=t||{};if(e&&(tl(e)?n=e.options:th(e)?r=e:n=e),void 0===r.automaticDataCollectionEnabled&&(r.automaticDataCollectionEnabled=!0),n||(n=Z()),!n)throw td.create("no-options");let i={...r,...n};if(void 0!==i.releaseOnDeref&&delete i.releaseOnDeref,void 0!==r.releaseOnDeref&&"undefined"==typeof FinalizationRegistry)throw td.create("finalization-registry-not-supported",{});let s=""+[...JSON.stringify(i)].reduce((e,t)=>Math.imul(31,e)+t.charCodeAt(0)|0,0),o=tt.get(s);if(o)return o.incRefCount(r.releaseOnDeref),o;let a=new eV(s);for(let e of tn.values())a.addComponent(e);let l=new tg(n,r,s,a);return tt.set(s,l),l}function tv(e=e7){let t=te.get(e);if(!t&&e===e7&&Z())return ty();if(!t)throw td.create("no-app",{appName:e});return t}function tw(){return Array.from(te.values())}async function tb(e){let t=!1,n=e.name;te.has(n)?(t=!0,te.delete(n)):tt.has(n)&&0>=e.decRefCount()&&(tt.delete(n),t=!0),t&&(await Promise.all(e.container.getProviders().map(e=>e.delete())),e.isDeleted=!0)}function tE(e,t,n){let r=e9[e]??e;n&&(r+=`-${n}`);let i=r.match(/\s|\//),s=t.match(/\s|\//);if(i||s){let e=[`Unable to register library "${r}" with version "${t}":`];i&&e.push(`library name "${r}" contains illegal characters (whitespace or "/")`),i&&s&&e.push("and"),s&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),e8.warn(e.join(" "));return}ts(new eM(`${r}-version`,()=>({library:r,version:t}),"VERSION"))}function tT(e,t){if(null!==e&&"function"!=typeof e)throw td.create("invalid-log-argument");for(let n of eB){let r=null;t&&t.level&&(r=ej[t.level]),null===e?n.userLogHandler=null:n.userLogHandler=(t,n,...i)=>{let s=i.map(e=>{if(null==e)return null;if("string"==typeof e)return e;if("number"==typeof e||"boolean"==typeof e)return e.toString();if(e instanceof Error)return e.message;try{return JSON.stringify(e)}catch(e){return null}}).filter(e=>e).join(" ");n>=(r??t.logLevel)&&e({level:w[n].toLowerCase(),message:s,args:i,type:t.name})}}}function tI(e){eB.forEach(t=>{t.setLogLevel(e)})}let tC="firebase-heartbeat-store",tS=null;function tk(){return tS||(tS=(function(e,t,{blocked:n,upgrade:r,blocking:i,terminated:s}={}){let o=indexedDB.open(e,1),a=eJ(o);return r&&o.addEventListener("upgradeneeded",e=>{r(eJ(o.result),e.oldVersion,e.newVersion,eJ(o.transaction),e)}),n&&o.addEventListener("blocked",e=>n(e.oldVersion,e.newVersion,e)),a.then(e=>{s&&e.addEventListener("close",()=>s()),i&&e.addEventListener("versionchange",e=>i(e.oldVersion,e.newVersion,e))}).catch(()=>{}),a})("firebase-heartbeat-database",0,{upgrade:(e,t)=>{if(0===t)try{e.createObjectStore(tC)}catch(e){console.warn(e)}}}).catch(e=>{throw td.create("idb-open",{originalErrorMessage:e.message})})),tS}async function tA(e){try{let t=(await tk()).transaction(tC),n=await t.objectStore(tC).get(tN(e));return await t.done,n}catch(e){if(e instanceof ef)e8.warn(e.message);else{let t=td.create("idb-get",{originalErrorMessage:e?.message});e8.warn(t.message)}}}async function tR(e,t){try{let n=(await tk()).transaction(tC,"readwrite"),r=n.objectStore(tC);await r.put(t,tN(e)),await n.done}catch(e){if(e instanceof ef)e8.warn(e.message);else{let t=td.create("idb-set",{originalErrorMessage:e?.message});e8.warn(t.message)}}}function tN(e){return`${e.name}!${e.options.appId}`}class tP{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new tO(t),this._heartbeatsCachePromise=this._storage.read().then(e=>(this._heartbeatsCache=e,e))}async triggerHeartbeat(){try{let e=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),t=tD();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===t||this._heartbeatsCache.heartbeats.some(e=>e.date===t))return;if(this._heartbeatsCache.heartbeats.push({date:t,agent:e}),this._heartbeatsCache.heartbeats.length>30){let e=function(e){if(0===e.length)return -1;let t=0,n=e[0].date;for(let r=1;r<e.length;r++)e[r].date<n&&(n=e[r].date,t=r);return t}(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(e,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){e8.warn(e)}}async getHeartbeatsHeader(){try{if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||0===this._heartbeatsCache.heartbeats.length)return"";let e=tD(),{heartbeatsToSend:t,unsentEntries:n}=function(e,t=1024){let n=[],r=e.slice();for(let i of e){let e=n.find(e=>e.agent===i.agent);if(e){if(e.dates.push(i.date),tx(n)>t){e.dates.pop();break}}else if(n.push({agent:i.agent,dates:[i.date]}),tx(n)>t){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}(this._heartbeatsCache.heartbeats),r=G(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,n.length>0?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),r}catch(e){return e8.warn(e),""}}}function tD(){return new Date().toISOString().substring(0,10)}class tO{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!function(){try{return"object"==typeof indexedDB}catch(e){return!1}}()&&new Promise((e,t)=>{try{let n=!0,r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),n||self.indexedDB.deleteDatabase(r),e(!0)},i.onupgradeneeded=()=>{n=!1},i.onerror=()=>{t(i.error?.message||"")}}catch(e){t(e)}}).then(()=>!0).catch(()=>!1)}async read(){if(!await this._canUseIndexedDBPromise)return{heartbeats:[]};{let e=await tA(this.app);return e?.heartbeats?e:{heartbeats:[]}}}async overwrite(e){if(await this._canUseIndexedDBPromise){let t=await this.read();return tR(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??t.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){if(await this._canUseIndexedDBPromise){let t=await this.read();return tR(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??t.lastSentHeartbeatDate,heartbeats:[...t.heartbeats,...e.heartbeats]})}}}function tx(e){return G(JSON.stringify({version:2,heartbeats:e})).length}function tL(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}ts(new eM("platform-logger",e=>new e3(e),"PRIVATE")),ts(new eM("heartbeat",e=>new tP(e),"PRIVATE")),tE(e4,e5,""),tE(e4,e5,"esm2020"),tE("fire-js",""),e.s(["SDK_VERSION",()=>tm,"_DEFAULT_ENTRY_NAME",()=>e7,"_addComponent",()=>tr,"_addOrOverwriteComponent",()=>ti,"_apps",()=>te,"_clearComponents",()=>tc,"_components",()=>tn,"_getProvider",()=>to,"_isFirebaseApp",()=>tl,"_isFirebaseServerApp",()=>tu,"_isFirebaseServerAppSettings",()=>th,"_registerComponent",()=>ts,"_removeServiceInstance",()=>ta,"_serverApps",()=>tt,"deleteApp",()=>tb,"getApp",()=>tv,"getApps",()=>tw,"initializeApp",()=>ty,"initializeServerApp",()=>t_,"onLog",()=>tT,"registerVersion",()=>tE,"setLogLevel",()=>tI],92953);let tM=new ep("auth","Firebase",tL()),tU=new eH("@firebase/auth");function tF(e,...t){tU.logLevel<=w.ERROR&&tU.error(`Auth (${tm}): ${e}`,...t)}function tV(e,...t){throw tz(e,...t)}function tB(e,...t){return tz(e,...t)}function tj(e,t,n){return new ep("auth","Firebase",{...tL(),[t]:n}).create(t,{appName:e.name})}function tq(e){return tj(e,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function tz(e,...t){if("string"!=typeof e){let n=t[0],r=[...t.slice(1)];return r[0]&&(r[0].appName=e.name),e._errorFactory.create(n,...r)}return tM.create(e,...t)}function t$(e,t,...n){if(!e)throw tz(t,...n)}function tH(e){let t="INTERNAL ASSERTION FAILED: "+e;throw tF(t),Error(t)}function tW(){return"undefined"!=typeof self&&self.location?.href||""}function tK(){return"undefined"!=typeof self&&self.location?.protocol||null}class tG{constructor(e,t){var n;this.shortDelay=e,this.longDelay=t,n="Short delay should be less than long delay!",t>e||tH(n),this.isMobile=eh()||ec()}get(){let e;return!("undefined"!=typeof navigator&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&("http:"===tK()||"https:"===tK()||"object"==typeof(e="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0)&&void 0!==e.id||"connection"in navigator))||navigator.onLine?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function tQ(e,t){var n,r;n=e.emulator,r="Emulator should always be set here",n||tH(r);let{url:i}=e.emulator;return t?`${i}${t.startsWith("/")?t.slice(1):t}`:i}class tY{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!=typeof self&&"fetch"in self?self.fetch:"undefined"!=typeof globalThis&&globalThis.fetch?globalThis.fetch:"undefined"!=typeof fetch?fetch:void tH("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!=typeof self&&"Headers"in self?self.Headers:"undefined"!=typeof globalThis&&globalThis.Headers?globalThis.Headers:"undefined"!=typeof Headers?Headers:void tH("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!=typeof self&&"Response"in self?self.Response:"undefined"!=typeof globalThis&&globalThis.Response?globalThis.Response:"undefined"!=typeof Response?Response:void tH("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}let tX={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},tJ=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],tZ=new tG(3e4,6e4);function t0(e,t){return e.tenantId&&!t.tenantId?{...t,tenantId:e.tenantId}:t}async function t1(e,t,n,r,i={}){return t2(e,i,async()=>{let i={},s={};r&&("GET"===t?s=r:i={body:JSON.stringify(r)});let o=ek({key:e.config.apiKey,...s}).slice(1),a=await e._getAdditionalHeaders();a["Content-Type"]="application/json",e.languageCode&&(a["X-Firebase-Locale"]=e.languageCode);let l={method:t,headers:a,...i};return("undefined"==typeof navigator||"Cloudflare-Workers"!==navigator.userAgent)&&(l.referrerPolicy="no-referrer"),e.emulatorConfig&&en(e.emulatorConfig.host)&&(l.credentials="include"),tY.fetch()(await t3(e,e.config.apiHost,n,o),l)})}async function t2(e,t,n){e._canInitEmulator=!1;let r={...tX,...t};try{let t=new t4(e),i=await Promise.race([n(),t.promise]);t.clearNetworkTimeout();let s=await i.json();if("needConfirmation"in s)throw t5(e,"account-exists-with-different-credential",s);if(i.ok&&!("errorMessage"in s))return s;{let[t,n]=(i.ok?s.errorMessage:s.error.message).split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===t)throw t5(e,"credential-already-in-use",s);if("EMAIL_EXISTS"===t)throw t5(e,"email-already-in-use",s);if("USER_DISABLED"===t)throw t5(e,"user-disabled",s);let o=r[t]||t.toLowerCase().replace(/[_\s]+/g,"-");if(n)throw tj(e,o,n);tV(e,o)}}catch(t){if(t instanceof ef)throw t;tV(e,"network-request-failed",{message:String(t)})}}async function t6(e,t,n,r,i={}){let s=await t1(e,t,n,r,i);return"mfaPendingCredential"in s&&tV(e,"multi-factor-auth-required",{_serverResponse:s}),s}async function t3(e,t,n,r){let i=`${t}${n}?${r}`,s=e.config.emulator?tQ(e.config,i):`${e.config.apiScheme}://${i}`;return tJ.includes(n)&&(await e._persistenceManagerAvailable,"COOKIE"===e._getPersistenceType())?e._getPersistence()._getFinalTarget(s).toString():s}class t4{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((e,t)=>{this.timer=setTimeout(()=>t(tB(this.auth,"network-request-failed")),tZ.get())})}}function t5(e,t,n){let r={appName:e.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);let i=tB(e,t,r);return i.customData._tokenResponse=n,i}function t8(e){return void 0!==e&&void 0!==e.enterprise}class t7{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],void 0===e.recaptchaKey)throw Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||0===this.recaptchaEnforcementState.length)return null;for(let t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)switch(t.enforcementState){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}return null}isProviderEnabled(e){return"ENFORCE"===this.getProviderEnforcementState(e)||"AUDIT"===this.getProviderEnforcementState(e)}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function t9(e,t){return t1(e,"GET","/v2/recaptchaConfig",t0(e,t))}async function ne(e,t){return t1(e,"POST","/v1/accounts:delete",t)}async function nt(e,t){return t1(e,"POST","/v1/accounts:lookup",t)}function nn(e){if(e)try{let t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(e){}}async function nr(e,t=!1){let n=eL(e),r=await n.getIdToken(t),i=ns(r);t$(i&&i.exp&&i.auth_time&&i.iat,n.auth,"internal-error");let s="object"==typeof i.firebase?i.firebase:void 0,o=s?.sign_in_provider;return{claims:i,token:r,authTime:nn(ni(i.auth_time)),issuedAtTime:nn(ni(i.iat)),expirationTime:nn(ni(i.exp)),signInProvider:o||null,signInSecondFactor:s?.sign_in_second_factor||null}}function ni(e){return 1e3*Number(e)}function ns(e){let[t,n,r]=e.split(".");if(void 0===t||void 0===n||void 0===r)return tF("JWT malformed, contained fewer than 3 sections"),null;try{let e=Q(n);if(!e)return tF("Failed to decode base64 JWT payload"),null;return JSON.parse(e)}catch(e){return tF("Caught error parsing JWT payload as JSON",e?.toString()),null}}function no(e){let t=ns(e);return t$(t,"internal-error"),t$(void 0!==t.exp,"internal-error"),t$(void 0!==t.iat,"internal-error"),Number(t.exp)-Number(t.iat)}async function na(e,t,n=!1){if(n)return t;try{return await t}catch(t){throw t instanceof ef&&function({code:e}){return"auth/user-disabled"===e||"auth/user-token-expired"===e}(t)&&e.auth.currentUser===e&&await e.auth.signOut(),t}}class nl{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){if(!e)return this.errorBackoff=3e4,Math.max(0,(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5);{let e=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),e}}schedule(e=!1){if(!this.isRunning)return;let t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){e?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}class nh{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=nn(this.lastLoginAt),this.creationTime=nn(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function nu(e){var t,n;let r=e.auth,i=await e.getIdToken(),s=await na(e,nt(r,{idToken:i}));t$(s?.users.length,r,"internal-error");let o=s.users[0];e._notifyReloadListener(o);let a=o.providerUserInfo?.length?nd(o.providerUserInfo):[],l=(t=e.providerData,n=a,[...t.filter(e=>!n.some(t=>t.providerId===e.providerId)),...n]),h=e.isAnonymous,u=!(e.email&&o.passwordHash)&&!l?.length;Object.assign(e,{uid:o.localId,displayName:o.displayName||null,photoURL:o.photoUrl||null,email:o.email||null,emailVerified:o.emailVerified||!1,phoneNumber:o.phoneNumber||null,tenantId:o.tenantId||null,providerData:l,metadata:new nh(o.createdAt,o.lastLoginAt),isAnonymous:!!h&&u})}async function nc(e){let t=eL(e);await nu(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}function nd(e){return e.map(({providerId:e,...t})=>({providerId:e,uid:t.rawId||"",displayName:t.displayName||null,email:t.email||null,phoneNumber:t.phoneNumber||null,photoURL:t.photoUrl||null}))}async function nf(e,t){let n=await t2(e,{},async()=>{let n=ek({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:r,apiKey:i}=e.config,s=await t3(e,r,"/v1/token",`key=${i}`),o=await e._getAdditionalHeaders();o["Content-Type"]="application/x-www-form-urlencoded";let a={method:"POST",headers:o,body:n};return e.emulatorConfig&&en(e.emulatorConfig.host)&&(a.credentials="include"),tY.fetch()(s,a)});return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}async function np(e,t){return t1(e,"POST","/v2/accounts:revokeToken",t0(e,t))}class ng{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){t$(e.idToken,"internal-error"),t$(void 0!==e.idToken,"internal-error"),t$(void 0!==e.refreshToken,"internal-error");let t="expiresIn"in e&&void 0!==e.expiresIn?Number(e.expiresIn):no(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){t$(0!==e.length,"internal-error");let t=no(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return t||!this.accessToken||this.isExpired?(t$(this.refreshToken,e,"user-token-expired"),this.refreshToken)?(await this.refresh(e,this.refreshToken),this.accessToken):null:this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){let{accessToken:n,refreshToken:r,expiresIn:i}=await nf(e,t);this.updateTokensAndExpiration(n,r,Number(i))}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*n}static fromJSON(e,t){let{refreshToken:n,accessToken:r,expirationTime:i}=t,s=new ng;return n&&(t$("string"==typeof n,"internal-error",{appName:e}),s.refreshToken=n),r&&(t$("string"==typeof r,"internal-error",{appName:e}),s.accessToken=r),i&&(t$("number"==typeof i,"internal-error",{appName:e}),s.expirationTime=i),s}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new ng,this.toJSON())}_performRefresh(){return tH("not implemented")}}function nm(e,t){t$("string"==typeof e||void 0===e,"internal-error",{appName:t})}class ny{constructor({uid:e,auth:t,stsTokenManager:n,...r}){this.providerId="firebase",this.proactiveRefresh=new nl(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=t,this.stsTokenManager=n,this.accessToken=n.accessToken,this.displayName=r.displayName||null,this.email=r.email||null,this.emailVerified=r.emailVerified||!1,this.phoneNumber=r.phoneNumber||null,this.photoURL=r.photoURL||null,this.isAnonymous=r.isAnonymous||!1,this.tenantId=r.tenantId||null,this.providerData=r.providerData?[...r.providerData]:[],this.metadata=new nh(r.createdAt||void 0,r.lastLoginAt||void 0)}async getIdToken(e){let t=await na(this,this.stsTokenManager.getToken(this.auth,e));return t$(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return nr(this,e)}reload(){return nc(this)}_assign(e){this!==e&&(t$(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(e=>({...e})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){let t=new ny({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return t.metadata._copy(this.metadata),t}_onReload(e){t$(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),t&&await nu(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(tu(this.auth.app))return Promise.reject(tq(this.auth));let e=await this.getIdToken();return await na(this,ne(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){let n=t.displayName??void 0,r=t.email??void 0,i=t.phoneNumber??void 0,s=t.photoURL??void 0,o=t.tenantId??void 0,a=t._redirectEventId??void 0,l=t.createdAt??void 0,h=t.lastLoginAt??void 0,{uid:u,emailVerified:c,isAnonymous:d,providerData:f,stsTokenManager:p}=t;t$(u&&p,e,"internal-error");let g=ng.fromJSON(this.name,p);t$("string"==typeof u,e,"internal-error"),nm(n,e.name),nm(r,e.name),t$("boolean"==typeof c,e,"internal-error"),t$("boolean"==typeof d,e,"internal-error"),nm(i,e.name),nm(s,e.name),nm(o,e.name),nm(a,e.name),nm(l,e.name),nm(h,e.name);let m=new ny({uid:u,auth:e,email:r,emailVerified:c,displayName:n,isAnonymous:d,photoURL:s,phoneNumber:i,tenantId:o,stsTokenManager:g,createdAt:l,lastLoginAt:h});return f&&Array.isArray(f)&&(m.providerData=f.map(e=>({...e}))),a&&(m._redirectEventId=a),m}static async _fromIdTokenResponse(e,t,n=!1){let r=new ng;r.updateFromServerResponse(t);let i=new ny({uid:t.localId,auth:e,stsTokenManager:r,isAnonymous:n});return await nu(i),i}static async _fromGetAccountInfoResponse(e,t,n){let r=t.users[0];t$(void 0!==r.localId,"internal-error");let i=void 0!==r.providerUserInfo?nd(r.providerUserInfo):[],s=!(r.email&&r.passwordHash)&&!i?.length,o=new ng;o.updateFromIdToken(n);let a=new ny({uid:r.localId,auth:e,stsTokenManager:o,isAnonymous:s});return Object.assign(a,{uid:r.localId,displayName:r.displayName||null,photoURL:r.photoUrl||null,email:r.email||null,emailVerified:r.emailVerified||!1,phoneNumber:r.phoneNumber||null,tenantId:r.tenantId||null,providerData:i,metadata:new nh(r.createdAt,r.lastLoginAt),isAnonymous:!(r.email&&r.passwordHash)&&!i?.length}),a}}let n_=new Map;function nv(e){var t,n;t="Expected a class definition",e instanceof Function||tH(t);let r=n_.get(e);return r?(n="Instance stored in cache mismatched with class",r instanceof e||tH(n)):(r=new e,n_.set(e,r)),r}class nw{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){let t=this.storage[e];return void 0===t?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}function nb(e,t,n){return`firebase:${e}:${t}:${n}`}nw.type="NONE";class nE{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;const{config:r,name:i}=this.auth;this.fullUserKey=nb(this.userKey,r.apiKey,i),this.fullPersistenceKey=nb("persistence",r.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){let e=await this.persistence._get(this.fullUserKey);if(!e)return null;if("string"==typeof e){let t=await nt(this.auth,{idToken:e}).catch(()=>void 0);return t?ny._fromGetAccountInfoResponse(this.auth,t,e):null}return ny._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;let t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,n="authUser"){if(!t.length)return new nE(nv(nw),e,n);let r=(await Promise.all(t.map(async e=>{if(await e._isAvailable())return e}))).filter(e=>e),i=r[0]||nv(nw),s=nb(n,e.config.apiKey,e.name),o=null;for(let n of t)try{let t=await n._get(s);if(t){let r;if("string"==typeof t){let n=await nt(e,{idToken:t}).catch(()=>void 0);if(!n)break;r=await ny._fromGetAccountInfoResponse(e,n,t)}else r=ny._fromJSON(e,t);n!==i&&(o=r),i=n;break}}catch{}let a=r.filter(e=>e._shouldAllowMigration);return i._shouldAllowMigration&&a.length&&(i=a[0],o&&await i._set(s,o.toJSON()),await Promise.all(t.map(async e=>{if(e!==i)try{await e._remove(s)}catch{}}))),new nE(i,e,n)}}function nT(e){let t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";{if(nk(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(nI(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(nR(t))return"Blackberry";if(nN(t))return"Webos";if(nC(t))return"Safari";if((t.includes("chrome/")||nS(t))&&!t.includes("edge/"))return"Chrome";if(nA(t))return"Android";let n=e.match(/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/);if(n?.length===2)return n[1]}return"Other"}function nI(e=el()){return/firefox\//i.test(e)}function nC(e=el()){let t=e.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function nS(e=el()){return/crios\//i.test(e)}function nk(e=el()){return/iemobile/i.test(e)}function nA(e=el()){return/android/i.test(e)}function nR(e=el()){return/blackberry/i.test(e)}function nN(e=el()){return/webos/i.test(e)}function nP(e=el()){return/iphone|ipad|ipod/i.test(e)||/macintosh/i.test(e)&&/mobile/i.test(e)}function nD(e=el()){return nP(e)||nA(e)||nN(e)||nR(e)||/windows phone/i.test(e)||nk(e)}function nO(e,t=[]){let n;switch(e){case"Browser":n=nT(el());break;case"Worker":n=`${nT(el())}-${e}`;break;default:n=e}let r=t.length?t.join(","):"FirebaseCore-web";return`${n}/JsCore/${tm}/${r}`}class nx{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){let n=t=>new Promise((n,r)=>{try{let r=e(t);n(r)}catch(e){r(e)}});n.onAbort=t,this.queue.push(n);let r=this.queue.length-1;return()=>{this.queue[r]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;let t=[];try{for(let n of this.queue)await n(e),n.onAbort&&t.push(n.onAbort)}catch(e){for(let e of(t.reverse(),t))try{e()}catch(e){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:e?.message})}}}async function nL(e,t={}){return t1(e,"GET","/v2/passwordPolicy",t0(e,t))}class nM{constructor(e){const t=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=t.minPasswordLength??6,t.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=t.maxPasswordLength),void 0!==t.containsLowercaseCharacter&&(this.customStrengthOptions.containsLowercaseLetter=t.containsLowercaseCharacter),void 0!==t.containsUppercaseCharacter&&(this.customStrengthOptions.containsUppercaseLetter=t.containsUppercaseCharacter),void 0!==t.containsNumericCharacter&&(this.customStrengthOptions.containsNumericCharacter=t.containsNumericCharacter),void 0!==t.containsNonAlphanumericCharacter&&(this.customStrengthOptions.containsNonAlphanumericCharacter=t.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,"ENFORCEMENT_STATE_UNSPECIFIED"===this.enforcementState&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=e.allowedNonAlphanumericCharacters?.join("")??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){let t={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,t),this.validatePasswordCharacterOptions(e,t),t.isValid&&(t.isValid=t.meetsMinPasswordLength??!0),t.isValid&&(t.isValid=t.meetsMaxPasswordLength??!0),t.isValid&&(t.isValid=t.containsLowercaseLetter??!0),t.isValid&&(t.isValid=t.containsUppercaseLetter??!0),t.isValid&&(t.isValid=t.containsNumericCharacter??!0),t.isValid&&(t.isValid=t.containsNonAlphanumericCharacter??!0),t}validatePasswordLengthOptions(e,t){let n=this.customStrengthOptions.minPasswordLength,r=this.customStrengthOptions.maxPasswordLength;n&&(t.meetsMinPasswordLength=e.length>=n),r&&(t.meetsMaxPasswordLength=e.length<=r)}validatePasswordCharacterOptions(e,t){let n;this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);for(let r=0;r<e.length;r++)n=e.charAt(r),this.updatePasswordCharacterOptionsStatuses(t,n>="a"&&n<="z",n>="A"&&n<="Z",n>="0"&&n<="9",this.allowedNonAlphanumericCharacters.includes(n))}updatePasswordCharacterOptionsStatuses(e,t,n,r,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=n)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=r)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}class nU{constructor(e,t,n,r){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=n,this.config=r,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new nF(this),this.idTokenSubscription=new nF(this),this.beforeStateQueue=new nx(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=tM,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=r.sdkClientVersion,this._persistenceManagerAvailable=new Promise(e=>this._resolvePersistenceManagerAvailable=e)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=nv(t)),this._initializationPromise=this.queue(async()=>{if(!this._deleted){if(this.persistenceManager=await nE.create(this,e),this._resolvePersistenceManagerAvailable?.(),!this._deleted){if(this._popupRedirectResolver?._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(e){}await this.initializeCurrentUser(t),this.lastNotifiedUid=this.currentUser?.uid||null,this._deleted||(this._isInitialized=!0)}}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;let e=await this.assertedPersistence.getCurrentUser();if(this.currentUser||e){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{let t=await nt(this,{idToken:e}),n=await ny._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(n)}catch(e){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",e),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){if(tu(this.app)){let e=this.app.settings.authIdToken;return e?new Promise(t=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(e).then(t,t))}):this.directlySetCurrentUser(null)}let t=await this.assertedPersistence.getCurrentUser(),n=t,r=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();let t=this.redirectUser?._redirectEventId,i=n?._redirectEventId,s=await this.tryRedirectSignIn(e);(!t||t===i)&&s?.user&&(n=s.user,r=!0)}if(!n)return this.directlySetCurrentUser(null);if(!n._redirectEventId){if(r)try{await this.beforeStateQueue.runMiddleware(n)}catch(e){n=t,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(e))}return n?this.reloadAndSetCurrentUserOrClear(n):this.directlySetCurrentUser(null)}return(t$(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===n._redirectEventId)?this.directlySetCurrentUser(n):this.reloadAndSetCurrentUserOrClear(n)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(e){await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await nu(e)}catch(e){if(e?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=function(){if("undefined"==typeof navigator)return null;let e=navigator;return e.languages&&e.languages[0]||e.language||null}()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(tu(this.app))return Promise.reject(tq(this));let t=e?eL(e):null;return t&&t$(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&t$(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return tu(this.app)?Promise.reject(tq(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return tu(this.app)?Promise.reject(tq(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(nv(e))})}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();let t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return null===this.tenantId?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){let e=new nM(await nL(this));null===this.tenantId?this._projectPasswordPolicy=e:this._tenantPasswordPolicies[this.tenantId]=e}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new ep("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{let n=this.onAuthStateChanged(()=>{n(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){let t={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:await this.currentUser.getIdToken()};null!=this.tenantId&&(t.tenantId=this.tenantId),await np(this,t)}}toJSON(){return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:this._currentUser?.toJSON()}}async _setRedirectUser(e,t){let n=await this.getOrInitRedirectPersistenceManager(t);return null===e?n.removeCurrentUser():n.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){let t=e&&nv(e)||this._popupRedirectResolver;t$(t,this,"argument-error"),this.redirectPersistenceManager=await nE.create(this,[nv(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){return(this._isInitialized&&await this.queue(async()=>{}),this._currentUser?._redirectEventId===e)?this._currentUser:this.redirectUser?._redirectEventId===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);let e=this.currentUser?.uid??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,n,r){if(this._deleted)return()=>{};let i="function"==typeof t?t:t.next.bind(t),s=!1,o=this._isInitialized?Promise.resolve():this._initializationPromise;if(t$(o,this,"internal-error"),o.then(()=>{s||i(this.currentUser)}),"function"==typeof t){let i=e.addObserver(t,n,r);return()=>{s=!0,i()}}{let n=e.addObserver(t);return()=>{s=!0,n()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return t$(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=nO(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){let e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);let t=await this.heartbeatServiceProvider.getImmediate({optional:!0})?.getHeartbeatsHeader();t&&(e["X-Firebase-Client"]=t);let n=await this._getAppCheckToken();return n&&(e["X-Firebase-AppCheck"]=n),e}async _getAppCheckToken(){if(tu(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;let e=await this.appCheckServiceProvider.getImmediate({optional:!0})?.getToken();return e?.error&&function(e,...t){tU.logLevel<=w.WARN&&tU.warn(`Auth (${tm}): ${e}`,...t)}(`Error while retrieving App Check token: ${e.error}`),e?.token}}class nF{constructor(e){this.auth=e,this.observer=null,this.addObserver=function(e,t){let n=new eP(e,void 0);return n.subscribe.bind(n)}(e=>this.observer=e)}get next(){return t$(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let nV={async loadJS(){throw Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function nB(e){return`__${e}${Math.floor(1e6*Math.random())}`}class nj{constructor(){this.enterprise=new nq}ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class nq{ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}let nz="NO_RECAPTCHA";class n${constructor(e){this.type="recaptcha-enterprise",this.auth=eL(e)}async verify(e="verify",t=!1){async function n(e){if(!t){if(null==e.tenantId&&null!=e._agentRecaptchaConfig)return e._agentRecaptchaConfig.siteKey;if(null!=e.tenantId&&void 0!==e._tenantRecaptchaConfigs[e.tenantId])return e._tenantRecaptchaConfigs[e.tenantId].siteKey}return new Promise(async(t,n)=>{t9(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(r=>{if(void 0===r.recaptchaKey)n(Error("recaptcha Enterprise site key undefined"));else{let n=new t7(r);return null==e.tenantId?e._agentRecaptchaConfig=n:e._tenantRecaptchaConfigs[e.tenantId]=n,t(n.siteKey)}}).catch(e=>{n(e)})})}function r(t,n,r){let i=window.grecaptcha;t8(i)?i.enterprise.ready(()=>{i.enterprise.execute(t,{action:e}).then(e=>{n(e)}).catch(()=>{n(nz)})}):r(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new nj().execute("siteKey",{action:"verify"}):new Promise((e,i)=>{n(this.auth).then(n=>{if(!t&&t8(window.grecaptcha))r(n,e,i);else{var s;if("undefined"==typeof window)return void i(Error("RecaptchaVerifier is only supported in browser"));let t=nV.recaptchaEnterpriseScript;0!==t.length&&(t+=n),(s=t,nV.loadJS(s)).then(()=>{r(n,e,i)}).catch(e=>{i(e)})}}).catch(e=>{i(e)})})}}async function nH(e,t,n,r=!1,i=!1){let s,o=new n$(e);if(i)s=nz;else try{s=await o.verify(n)}catch(e){s=await o.verify(n,!0)}let a={...t};if("mfaSmsEnrollment"===n||"mfaSmsSignIn"===n){if("phoneEnrollmentInfo"in a){let e=a.phoneEnrollmentInfo.phoneNumber,t=a.phoneEnrollmentInfo.recaptchaToken;Object.assign(a,{phoneEnrollmentInfo:{phoneNumber:e,recaptchaToken:t,captchaResponse:s,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in a){let e=a.phoneSignInInfo.recaptchaToken;Object.assign(a,{phoneSignInInfo:{recaptchaToken:e,captchaResponse:s,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return a}return r?Object.assign(a,{captchaResp:s}):Object.assign(a,{captchaResponse:s}),Object.assign(a,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(a,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),a}async function nW(e,t,n,r,i){if("EMAIL_PASSWORD_PROVIDER"===i)if(!e._getRecaptchaConfig()?.isProviderEnabled("EMAIL_PASSWORD_PROVIDER"))return r(e,t).catch(async i=>{if("auth/missing-recaptcha-token"!==i.code)return Promise.reject(i);{console.log(`${n} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);let i=await nH(e,t,n,"getOobCode"===n);return r(e,i)}});else{let i=await nH(e,t,n,"getOobCode"===n);return r(e,i)}if("PHONE_PROVIDER"!==i)return Promise.reject(i+" provider is not supported.");if(e._getRecaptchaConfig()?.isProviderEnabled("PHONE_PROVIDER")){let i=await nH(e,t,n);return r(e,i).catch(async i=>{if(e._getRecaptchaConfig()?.getProviderEnforcementState("PHONE_PROVIDER")==="AUDIT"&&("auth/missing-recaptcha-token"===i.code||"auth/invalid-app-credential"===i.code)){console.log(`Failed to verify with reCAPTCHA Enterprise. Automatically triggering the reCAPTCHA v2 flow to complete the ${n} flow.`);let i=await nH(e,t,n,!1,!0);return r(e,i)}return Promise.reject(i)})}{let i=await nH(e,t,n,!1,!0);return r(e,i)}}async function nK(e){let t=eL(e),n=new t7(await t9(t,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}));null==t.tenantId?t._agentRecaptchaConfig=n:t._tenantRecaptchaConfigs[t.tenantId]=n,n.isAnyProviderEnabled()&&new n$(t).verify()}function nG(e){let t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function nQ(e){if(!e)return null;let t=Number(e);return isNaN(t)?null:t}class nY{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return tH("not implemented")}_getIdTokenResponse(e){return tH("not implemented")}_linkToIdToken(e,t){return tH("not implemented")}_getReauthenticationResolver(e){return tH("not implemented")}}async function nX(e,t){return t1(e,"POST","/v1/accounts:signUp",t)}async function nJ(e,t){return t6(e,"POST","/v1/accounts:signInWithPassword",t0(e,t))}async function nZ(e,t){return t6(e,"POST","/v1/accounts:signInWithEmailLink",t0(e,t))}async function n0(e,t){return t6(e,"POST","/v1/accounts:signInWithEmailLink",t0(e,t))}class n1 extends nY{constructor(e,t,n,r=null){super("password",n),this._email=e,this._password=t,this._tenantId=r}static _fromEmailAndPassword(e,t){return new n1(e,t,"password")}static _fromEmailAndCode(e,t,n=null){return new n1(e,t,"emailLink",n)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){let t="string"==typeof e?JSON.parse(e):e;if(t?.email&&t?.password){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);else if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":return nW(e,{returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signInWithPassword",nJ,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return nZ(e,{email:this._email,oobCode:this._password});default:tV(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":return nW(e,{idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",nX,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return n0(e,{idToken:t,email:this._email,oobCode:this._password});default:tV(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function n2(e,t){return t6(e,"POST","/v1/accounts:signInWithIdp",t0(e,t))}class n6 extends nY{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){let t=new n6(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):tV("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){let{providerId:t,signInMethod:n,...r}="string"==typeof e?JSON.parse(e):e;if(!t||!n)return null;let i=new n6(t,n);return i.idToken=r.idToken||void 0,i.accessToken=r.accessToken||void 0,i.secret=r.secret,i.nonce=r.nonce,i.pendingToken=r.pendingToken||null,i}_getIdTokenResponse(e){return n2(e,this.buildRequest())}_linkToIdToken(e,t){let n=this.buildRequest();return n.idToken=t,n2(e,n)}_getReauthenticationResolver(e){let t=this.buildRequest();return t.autoCreate=!1,n2(e,t)}buildRequest(){let e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{let t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=ek(t)}return e}}async function n3(e,t){return t1(e,"POST","/v1/accounts:sendVerificationCode",t0(e,t))}async function n4(e,t){return t6(e,"POST","/v1/accounts:signInWithPhoneNumber",t0(e,t))}async function n5(e,t){let n=await t6(e,"POST","/v1/accounts:signInWithPhoneNumber",t0(e,t));if(n.temporaryProof)throw t5(e,"account-exists-with-different-credential",n);return n}let n8={USER_NOT_FOUND:"user-not-found"};async function n7(e,t){return t6(e,"POST","/v1/accounts:signInWithPhoneNumber",t0(e,{...t,operation:"REAUTH"}),n8)}class n9 extends nY{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new n9({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new n9({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return n4(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return n5(e,{idToken:t,...this._makeVerificationRequest()})}_getReauthenticationResolver(e){return n7(e,this._makeVerificationRequest())}_makeVerificationRequest(){let{temporaryProof:e,phoneNumber:t,verificationId:n,verificationCode:r}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:n,code:r}}toJSON(){let e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){"string"==typeof e&&(e=JSON.parse(e));let{verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:i}=e;return n||t||r||i?new n9({verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:i}):null}}class re{constructor(e){const t=eA(eR(e)),n=t.apiKey??null,r=t.oobCode??null,i=function(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(t.mode??null);t$(n&&r&&i,"argument-error"),this.apiKey=n,this.operation=i,this.code=r,this.continueUrl=t.continueUrl??null,this.languageCode=t.lang??null,this.tenantId=t.tenantId??null}static parseLink(e){let t,n,r,i=(n=(t=eA(eR(e)).link)?eA(eR(t)).deep_link_id:null,((r=eA(eR(e)).deep_link_id)?eA(eR(r)).link:null)||r||n||t||e);try{return new re(i)}catch{return null}}}class rt{constructor(){this.providerId=rt.PROVIDER_ID}static credential(e,t){return n1._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){let n=re.parseLink(t);return t$(n,"argument-error"),n1._fromEmailAndCode(e,n.code,n.tenantId)}}rt.PROVIDER_ID="password",rt.EMAIL_PASSWORD_SIGN_IN_METHOD="password",rt.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class rn{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class rr extends rn{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class ri extends rr{constructor(){super("facebook.com")}static credential(e){return n6._fromParams({providerId:ri.PROVIDER_ID,signInMethod:ri.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return ri.credentialFromTaggedObject(e)}static credentialFromError(e){return ri.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return ri.credential(e.oauthAccessToken)}catch{return null}}}ri.FACEBOOK_SIGN_IN_METHOD="facebook.com",ri.PROVIDER_ID="facebook.com";class rs extends rr{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return n6._fromParams({providerId:rs.PROVIDER_ID,signInMethod:rs.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return rs.credentialFromTaggedObject(e)}static credentialFromError(e){return rs.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;let{oauthIdToken:t,oauthAccessToken:n}=e;if(!t&&!n)return null;try{return rs.credential(t,n)}catch{return null}}}rs.GOOGLE_SIGN_IN_METHOD="google.com",rs.PROVIDER_ID="google.com";class ro extends rr{constructor(){super("github.com")}static credential(e){return n6._fromParams({providerId:ro.PROVIDER_ID,signInMethod:ro.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return ro.credentialFromTaggedObject(e)}static credentialFromError(e){return ro.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return ro.credential(e.oauthAccessToken)}catch{return null}}}ro.GITHUB_SIGN_IN_METHOD="github.com",ro.PROVIDER_ID="github.com";class ra extends rr{constructor(){super("twitter.com")}static credential(e,t){return n6._fromParams({providerId:ra.PROVIDER_ID,signInMethod:ra.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return ra.credentialFromTaggedObject(e)}static credentialFromError(e){return ra.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;let{oauthAccessToken:t,oauthTokenSecret:n}=e;if(!t||!n)return null;try{return ra.credential(t,n)}catch{return null}}}async function rl(e,t){return t6(e,"POST","/v1/accounts:signUp",t0(e,t))}ra.TWITTER_SIGN_IN_METHOD="twitter.com",ra.PROVIDER_ID="twitter.com";class rh{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,n,r=!1){return new rh({user:await ny._fromIdTokenResponse(e,n,r),providerId:ru(n),_tokenResponse:n,operationType:t})}static async _forOperation(e,t,n){return await e._updateTokensIfNecessary(n,!0),new rh({user:e,providerId:ru(n),_tokenResponse:n,operationType:t})}}function ru(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}class rc extends ef{constructor(e,t,n,r){super(t.code,t.message),this.operationType=n,this.user=r,Object.setPrototypeOf(this,rc.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:t.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,t,n,r){return new rc(e,t,n,r)}}function rd(e,t,n,r){return("reauthenticate"===t?n._getReauthenticationResolver(e):n._getIdTokenResponse(e)).catch(n=>{if("auth/multi-factor-auth-required"===n.code)throw rc._fromErrorAndOperation(e,n,t,r);throw n})}async function rf(e,t,n=!1){let r=await na(e,t._linkToIdToken(e.auth,await e.getIdToken()),n);return rh._forOperation(e,"link",r)}async function rp(e,t,n=!1){let{auth:r}=e;if(tu(r.app))return Promise.reject(tq(r));let i="reauthenticate";try{let s=await na(e,rd(r,i,t,e),n);t$(s.idToken,r,"internal-error");let o=ns(s.idToken);t$(o,r,"internal-error");let{sub:a}=o;return t$(e.uid===a,r,"user-mismatch"),rh._forOperation(e,i,s)}catch(e){throw e?.code==="auth/user-not-found"&&tV(r,"user-mismatch"),e}}async function rg(e,t,n=!1){if(tu(e.app))return Promise.reject(tq(e));let r="signIn",i=await rd(e,r,t),s=await rh._fromIdTokenResponse(e,r,i);return n||await e._updateCurrentUser(s.user),s}async function rm(e,t){return rg(eL(e),t)}class ry{constructor(e,t){this.factorId=e,this.uid=t.mfaEnrollmentId,this.enrollmentTime=new Date(t.enrolledAt).toUTCString(),this.displayName=t.displayName}static _fromServerResponse(e,t){return"phoneInfo"in t?r_._fromServerResponse(e,t):"totpInfo"in t?rv._fromServerResponse(e,t):tV(e,"internal-error")}}class r_ extends ry{constructor(e){super("phone",e),this.phoneNumber=e.phoneInfo}static _fromServerResponse(e,t){return new r_(t)}}class rv extends ry{constructor(e){super("totp",e)}static _fromServerResponse(e,t){return new rv(t)}}async function rw(e){let t=eL(e);t._getPasswordPolicyInternal()&&await t._updatePasswordPolicy()}async function rb(e,t,n){if(tu(e.app))return Promise.reject(tq(e));let r=eL(e),i=nW(r,{returnSecureToken:!0,email:t,password:n,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",rl,"EMAIL_PASSWORD_PROVIDER"),s=await i.catch(t=>{throw"auth/password-does-not-meet-requirements"===t.code&&rw(e),t}),o=await rh._fromIdTokenResponse(r,"signIn",s);return await r._updateCurrentUser(o.user),o}function rE(e,t){return t1(e,"POST","/v2/accounts/mfaEnrollment:start",t0(e,t))}new WeakMap;let rT="__sak";class rI{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{if(!this.storage)return Promise.resolve(!1);return this.storage.setItem(rT,"1"),this.storage.removeItem(rT),Promise.resolve(!0)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){let t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}class rC extends rI{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=nD(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(let t of Object.keys(this.listeners)){let n=this.storage.getItem(t),r=this.localCache[t];n!==r&&e(t,r,n)}}onStorageEvent(e,t=!1){let n;if(!e.key)return void this.forAllChangedKeys((e,t,n)=>{this.notifyListeners(e,n)});let r=e.key;t?this.detachListener():this.stopPolling();let i=()=>{let e=this.storage.getItem(r);(t||this.localCache[r]!==e)&&this.notifyListeners(r,e)},s=this.storage.getItem(r);((n=el()).indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0)&&10===document.documentMode&&s!==e.newValue&&e.newValue!==e.oldValue?setTimeout(i,10):i()}notifyListeners(e,t){this.localCache[e]=t;let n=this.listeners[e];if(n)for(let e of Array.from(n))e(t?JSON.parse(t):t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:n}),!0)})},1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){let t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}rC.type="LOCAL";class rS extends rI{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}rS.type="SESSION";class rk{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){let t=this.receivers.find(t=>t.isListeningto(e));if(t)return t;let n=new rk(e);return this.receivers.push(n),n}isListeningto(e){return this.eventTarget===e}async handleEvent(e){let{eventId:t,eventType:n,data:r}=e.data,i=this.handlersMap[n];if(!i?.size)return;e.ports[0].postMessage({status:"ack",eventId:t,eventType:n});let s=Array.from(i).map(async t=>t(e.origin,r)),o=await Promise.all(s.map(async e=>{try{let t=await e;return{fulfilled:!0,value:t}}catch(e){return{fulfilled:!1,reason:e}}}));e.ports[0].postMessage({status:"done",eventId:t,eventType:n,response:o})}_subscribe(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),t&&0!==this.handlersMap[e].size||delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}function rA(e="",t=10){let n="";for(let e=0;e<t;e++)n+=Math.floor(10*Math.random());return e+n}rk.receivers=[];class rR{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,n=50){let r,i,s="undefined"!=typeof MessageChannel?new MessageChannel:null;if(!s)throw Error("connection_unavailable");return new Promise((o,a)=>{let l=rA("",20);s.port1.start();let h=setTimeout(()=>{a(Error("unsupported_event"))},n);i={messageChannel:s,onMessage(e){if(e.data.eventId===l)switch(e.data.status){case"ack":clearTimeout(h),r=setTimeout(()=>{a(Error("timeout"))},3e3);break;case"done":clearTimeout(r),o(e.data.response);break;default:clearTimeout(h),clearTimeout(r),a(Error("invalid_response"))}}},this.handlers.add(i),s.port1.addEventListener("message",i.onMessage),this.target.postMessage({eventType:e,eventId:l,data:t},[s.port2])}).finally(()=>{i&&this.removeMessageHandler(i)})}}function rN(){return window}function rP(){return void 0!==rN().WorkerGlobalScope&&"function"==typeof rN().importScripts}async function rD(){if(!navigator?.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}let rO="firebaseLocalStorageDb",rx="firebaseLocalStorage",rL="fbase_key";class rM{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function rU(e,t){return e.transaction([rx],t?"readwrite":"readonly").objectStore(rx)}function rF(){let e=indexedDB.open(rO,1);return new Promise((t,n)=>{e.addEventListener("error",()=>{n(e.error)}),e.addEventListener("upgradeneeded",()=>{let t=e.result;try{t.createObjectStore(rx,{keyPath:rL})}catch(e){n(e)}}),e.addEventListener("success",async()=>{let n=e.result;n.objectStoreNames.contains(rx)?t(n):(n.close(),await new rM(indexedDB.deleteDatabase(rO)).toPromise(),t(await rF()))})})}async function rV(e,t,n){return new rM(rU(e,!0).put({[rL]:t,value:n})).toPromise()}async function rB(e,t){let n=rU(e,!1).get(t),r=await new rM(n).toPromise();return void 0===r?null:r.value}function rj(e,t){return new rM(rU(e,!0).delete(t)).toPromise()}class rq{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db||(this.db=await rF()),this.db}async _withRetries(e){let t=0;for(;;)try{let t=await this._openDb();return await e(t)}catch(e){if(t++>3)throw e;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return rP()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=rk._getInstance(rP()?self:null),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){if(this.activeServiceWorker=await rD(),!this.activeServiceWorker)return;this.sender=new rR(this.activeServiceWorker);let e=await this.sender._send("ping",{},800);e&&e[0]?.fulfilled&&e[0]?.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(this.sender&&this.activeServiceWorker&&(navigator?.serviceWorker?.controller||null)===this.activeServiceWorker)try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;let e=await rF();return await rV(e,rT,"1"),await rj(e,rT),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(n=>rV(n,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){let t=await this._withRetries(t=>rB(t,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>rj(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){let e=await this._withRetries(e=>new rM(rU(e,!1).getAll()).toPromise());if(!e||0!==this.pendingWrites)return[];let t=[],n=new Set;if(0!==e.length)for(let{fbase_key:r,value:i}of e)n.add(r),JSON.stringify(this.localCache[r])!==JSON.stringify(i)&&(this.notifyListeners(r,i),t.push(r));for(let e of Object.keys(this.localCache))this.localCache[e]&&!n.has(e)&&(this.notifyListeners(e,null),t.push(e));return t}notifyListeners(e,t){this.localCache[e]=t;let n=this.listeners[e];if(n)for(let e of Array.from(n))e(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&this.stopPolling()}}function rz(e,t){return t1(e,"POST","/v2/accounts/mfaSignIn:start",t0(e,t))}rq.type="LOCAL",nB("rcb"),new tG(3e4,6e4);let r$="recaptcha";async function rH(e,t,n){if(!e._getRecaptchaConfig())try{await nK(e)}catch(e){console.log("Failed to initialize reCAPTCHA Enterprise config. Triggering the reCAPTCHA v2 verification.")}try{let r;if(r="string"==typeof t?{phoneNumber:t}:t,"session"in r){let t=r.session;if("phoneNumber"in r){t$("enroll"===t.type,e,"internal-error");let i={idToken:t.credential,phoneEnrollmentInfo:{phoneNumber:r.phoneNumber,clientType:"CLIENT_TYPE_WEB"}},s=async(e,t)=>{if(t.phoneEnrollmentInfo.captchaResponse===nz){t$(n?.type===r$,e,"argument-error");let r=await rW(e,t,n);return rE(e,r)}return rE(e,t)},o=nW(e,i,"mfaSmsEnrollment",s,"PHONE_PROVIDER");return(await o.catch(e=>Promise.reject(e))).phoneSessionInfo.sessionInfo}{t$("signin"===t.type,e,"internal-error");let i=r.multiFactorHint?.uid||r.multiFactorUid;t$(i,e,"missing-multi-factor-info");let s={mfaPendingCredential:t.credential,mfaEnrollmentId:i,phoneSignInInfo:{clientType:"CLIENT_TYPE_WEB"}},o=async(e,t)=>{if(t.phoneSignInInfo.captchaResponse===nz){t$(n?.type===r$,e,"argument-error");let r=await rW(e,t,n);return rz(e,r)}return rz(e,t)},a=nW(e,s,"mfaSmsSignIn",o,"PHONE_PROVIDER");return(await a.catch(e=>Promise.reject(e))).phoneResponseInfo.sessionInfo}}{let t={phoneNumber:r.phoneNumber,clientType:"CLIENT_TYPE_WEB"},i=async(e,t)=>{if(t.captchaResponse===nz){t$(n?.type===r$,e,"argument-error");let r=await rW(e,t,n);return n3(e,r)}return n3(e,t)},s=nW(e,t,"sendVerificationCode",i,"PHONE_PROVIDER");return(await s.catch(e=>Promise.reject(e))).sessionInfo}}finally{n?._reset()}}async function rW(e,t,n){t$(n.type===r$,e,"argument-error");let r=await n.verify();t$("string"==typeof r,e,"argument-error");let i={...t};if("phoneEnrollmentInfo"in i){let e=i.phoneEnrollmentInfo.phoneNumber,t=i.phoneEnrollmentInfo.captchaResponse,n=i.phoneEnrollmentInfo.clientType,s=i.phoneEnrollmentInfo.recaptchaVersion;return Object.assign(i,{phoneEnrollmentInfo:{phoneNumber:e,recaptchaToken:r,captchaResponse:t,clientType:n,recaptchaVersion:s}}),i}if(!("phoneSignInInfo"in i))return Object.assign(i,{recaptchaToken:r}),i;{let e=i.phoneSignInInfo.captchaResponse,t=i.phoneSignInInfo.clientType,n=i.phoneSignInInfo.recaptchaVersion;return Object.assign(i,{phoneSignInInfo:{recaptchaToken:r,captchaResponse:e,clientType:t,recaptchaVersion:n}}),i}}class rK{constructor(e){this.providerId=rK.PROVIDER_ID,this.auth=eL(e)}verifyPhoneNumber(e,t){return rH(this.auth,e,eL(t))}static credential(e,t){return n9._fromVerification(e,t)}static credentialFromResult(e){return rK.credentialFromTaggedObject(e)}static credentialFromError(e){return rK.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;let{phoneNumber:t,temporaryProof:n}=e;return t&&n?n9._fromTokenResponse(t,n):null}}function rG(e,t){return t?nv(t):(t$(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}rK.PROVIDER_ID="phone",rK.PHONE_SIGN_IN_METHOD="phone";class rQ extends nY{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return n2(e,this._buildIdpRequest())}_linkToIdToken(e,t){return n2(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return n2(e,this._buildIdpRequest())}_buildIdpRequest(e){let t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function rY(e){return rg(e.auth,new rQ(e),e.bypassAuthState)}function rX(e){let{auth:t,user:n}=e;return t$(n,t,"internal-error"),rp(n,new rQ(e),e.bypassAuthState)}async function rJ(e){let{auth:t,user:n}=e;return t$(n,t,"internal-error"),rf(n,new rQ(e),e.bypassAuthState)}class rZ{constructor(e,t,n,r,i=!1){this.auth=e,this.resolver=n,this.user=r,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(e){this.reject(e)}})}async onAuthEvent(e){let{urlResponse:t,sessionId:n,postBody:r,tenantId:i,error:s,type:o}=e;if(s)return void this.reject(s);let a={auth:this.auth,requestUri:t,sessionId:n,tenantId:i||void 0,postBody:r||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(o)(a))}catch(e){this.reject(e)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return rY;case"linkViaPopup":case"linkViaRedirect":return rJ;case"reauthViaPopup":case"reauthViaRedirect":return rX;default:tV(this.auth,"internal-error")}}resolve(e){var t,n;t=this.pendingPromise,n="Pending promise was never set",t||tH(n),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){var t,n;t=this.pendingPromise,n="Pending promise was never set",t||tH(n),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}let r0=new tG(2e3,1e4);async function r1(e,t,n){if(tu(e.app))return Promise.reject(tB(e,"operation-not-supported-in-this-environment"));let r=eL(e);if(!(t instanceof rn))throw rn.name!==t.constructor.name&&tV(e,"argument-error"),tj(e,"argument-error",`Type of ${t.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`);let i=rG(r,n);return new r2(r,"signInViaPopup",t,i).executeNotNull()}class r2 extends rZ{constructor(e,t,n,r,i){super(e,t,r,i),this.provider=n,this.authWindow=null,this.pollId=null,r2.currentPopupAction&&r2.currentPopupAction.cancel(),r2.currentPopupAction=this}async executeNotNull(){let e=await this.execute();return t$(e,this.auth,"internal-error"),e}async onExecution(){var e,t;e=1===this.filter.length,t="Popup operations only handle one event",e||tH(t);let n=rA();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],n),this.authWindow.associatedEvent=n,this.resolver._originValidation(this.auth).catch(e=>{this.reject(e)}),this.resolver._isIframeWebStorageSupported(this.auth,e=>{e||this.reject(tB(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){return this.authWindow?.associatedEvent||null}cancel(){this.reject(tB(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,r2.currentPopupAction=null}pollUserCancellation(){let e=()=>{if(this.authWindow?.window?.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(tB(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,r0.get())};e()}}r2.currentPopupAction=null;let r6=new Map;class r3 extends rZ{constructor(e,t,n=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,n),this.eventId=null}async execute(){let e=r6.get(this.auth._key());if(!e){try{let t=await r4(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(t)}catch(t){e=()=>Promise.reject(t)}r6.set(this.auth._key(),e)}return this.bypassAuthState||r6.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if("signInViaRedirect"===e.type)return super.onAuthEvent(e);if("unknown"===e.type)return void this.resolve(null);if(e.eventId){let t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function r4(e,t){var n;let r=nb("pendingRedirect",(n=t).config.apiKey,n.name),i=nv(e._redirectPersistence);if(!await i._isAvailable())return!1;let s=await i._get(r)==="true";return await i._remove(r),s}function r5(e,t){r6.set(e._key(),t)}async function r8(e,t,n=!1){if(tu(e.app))return Promise.reject(tq(e));let r=eL(e),i=rG(r,t),s=new r3(r,i,n),o=await s.execute();return o&&!n&&(delete o.user._redirectEventId,await r._persistUserIfCurrent(o.user),await r._setRedirectUser(null,t)),o}class r7{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(n=>{this.isEventForConsumer(e,n)&&(t=!0,this.sendToConsumer(e,n),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!function(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return ie(e);default:return!1}}(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){if(e.error&&!ie(e)){let n=e.error.code?.split("auth/")[1]||"internal-error";t.onError(tB(this.auth,n))}else t.onAuthEvent(e)}isEventForConsumer(e,t){let n=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(r9(e))}saveEventToCache(e){this.cachedEventUids.add(r9(e)),this.lastProcessedEventTime=Date.now()}}function r9(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter(e=>e).join("-")}function ie({type:e,error:t}){return"unknown"===e&&t?.code==="auth/no-auth-event"}async function it(e,t={}){return t1(e,"GET","/v1/projects",t)}let ir=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,ii=/^https?/;async function is(e){if(e.config.emulator)return;let{authorizedDomains:t}=await it(e);for(let e of t)try{if(function(e){let t=tW(),{protocol:n,hostname:r}=new URL(t);if(e.startsWith("chrome-extension://")){let i=new URL(e);return""===i.hostname&&""===r?"chrome-extension:"===n&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):"chrome-extension:"===n&&i.hostname===r}if(!ii.test(n))return!1;if(ir.test(e))return r===e;let i=e.replace(/\./g,"\\.");return RegExp("^(.+\\."+i+"|"+i+")$","i").test(r)}(e))return}catch{}tV(e,"unauthorized-domain")}let io=new tG(3e4,6e4);function ia(){let e=rN().___jsl;if(e?.H){for(let t of Object.keys(e.H))if(e.H[t].r=e.H[t].r||[],e.H[t].L=e.H[t].L||[],e.H[t].r=[...e.H[t].L],e.CP)for(let t=0;t<e.CP.length;t++)e.CP[t]=null}}let il=null,ih=new tG(5e3,15e3),iu={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},ic=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);async function id(e){let t,n,r,i,s,o=await (il=il||new Promise((t,n)=>{function r(){ia(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{ia(),n(tB(e,"network-request-failed"))},timeout:io.get()})}if(rN().gapi?.iframes?.Iframe)t(gapi.iframes.getContext());else if(rN().gapi?.load)r();else{var i;let t=nB("iframefcb");return rN()[t]=()=>{gapi.load?r():n(tB(e,"network-request-failed"))},(i=`${nV.gapiScript}?onload=${t}`,nV.loadJS(i)).catch(e=>n(e))}}).catch(e=>{throw il=null,e})),a=rN().gapi;return t$(a,e,"internal-error"),o.open({where:document.body,url:(t$((t=e.config).authDomain,e,"auth-domain-config-required"),n=t.emulator?tQ(t,"emulator/auth/iframe"):`https://${e.config.authDomain}/__/auth/iframe`,r={apiKey:t.apiKey,appName:e.name,v:tm},(i=ic.get(e.config.apiHost))&&(r.eid=i),(s=e._getFrameworks()).length&&(r.fw=s.join(",")),`${n}?${ek(r).slice(1)}`),messageHandlersFilter:a.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:iu,dontclear:!0},t=>new Promise(async(n,r)=>{await t.restyle({setHideOnLeave:!1});let i=tB(e,"network-request-failed"),s=rN().setTimeout(()=>{r(i)},ih.get());function o(){rN().clearTimeout(s),n(t)}t.ping(o).then(o,()=>{r(i)})}))}let ip={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class ig{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(e){}}}let im=encodeURIComponent("fac");async function iy(e,t,n,r,i,s){t$(e.config.authDomain,e,"auth-domain-config-required"),t$(e.config.apiKey,e,"invalid-api-key");let o={apiKey:e.config.apiKey,appName:e.name,authType:n,redirectUrl:r,v:tm,eventId:i};if(t instanceof rn)for(let[n,r]of(t.setDefaultLanguage(e.languageCode),o.providerId=t.providerId||"",eT(t.getCustomParameters())||(o.customParameters=JSON.stringify(t.getCustomParameters())),Object.entries(s||{})))o[n]=r;if(t instanceof rr){let e=t.getScopes().filter(e=>""!==e);e.length>0&&(o.scopes=e.join(","))}for(let t of(e.tenantId&&(o.tid=e.tenantId),Object.keys(o)))void 0===o[t]&&delete o[t];let a=await e._getAppCheckToken(),l=a?`#${im}=${encodeURIComponent(a)}`:"";return`${function({config:e}){return e.emulator?tQ(e,"emulator/auth/handler"):`https://${e.authDomain}/__/auth/handler`}(e)}?${ek(o).slice(1)}${l}`}let i_="webStorageSupport",iv=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=rS,this._completeRedirectFn=r8,this._overrideRedirectResult=r5}async _openPopup(e,t,n,r){var i,s;i=this.eventManagers[e._key()]?.manager,s="_initialize() not called before _openPopup()",i||tH(s);let o=await iy(e,t,n,tW(),r);return function(e,t,n,r=500,i=600){let s=Math.max((window.screen.availHeight-i)/2,0).toString(),o=Math.max((window.screen.availWidth-r)/2,0).toString(),a="",l={...ip,width:r.toString(),height:i.toString(),top:s,left:o},h=el().toLowerCase();n&&(a=nS(h)?"_blank":n),nI(h)&&(t=t||"http://localhost",l.scrollbars="yes");let u=Object.entries(l).reduce((e,[t,n])=>`${e}${t}=${n},`,"");if(function(e=el()){return nP(e)&&!!window.navigator?.standalone}(h)&&"_self"!==a){var c,d;let e,n;return c=t||"",d=a,(e=document.createElement("a")).href=c,e.target=d,(n=document.createEvent("MouseEvent")).initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),e.dispatchEvent(n),new ig(null)}let f=window.open(t||"",a,u);t$(f,e,"popup-blocked");try{f.focus()}catch(e){}return new ig(f)}(e,o,rA())}async _openRedirect(e,t,n,r){var i;return await this._originValidation(e),i=await iy(e,t,n,tW(),r),rN().location.href=i,new Promise(()=>{})}_initialize(e){let t=e._key();if(this.eventManagers[t]){var n;let{manager:e,promise:r}=this.eventManagers[t];return e?Promise.resolve(e):(n="If manager is not set, promise should be",r||tH(n),r)}let r=this.initAndGetManager(e);return this.eventManagers[t]={promise:r},r.catch(()=>{delete this.eventManagers[t]}),r}async initAndGetManager(e){let t=await id(e),n=new r7(e);return t.register("authEvent",t=>(t$(t?.authEvent,e,"invalid-auth-event"),{status:n.onEvent(t.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:n},this.iframes[e._key()]=t,n}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(i_,{type:i_},n=>{let r=n?.[0]?.[i_];void 0!==r&&t(!!r),tV(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){let t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=is(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return nD()||nC()||nP()}};var iw="@firebase/auth",ib="1.12.0";class iE{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){return this.assertAuthConfigured(),this.auth.currentUser?.uid||null}async getToken(e){return(this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser)?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;let t=this.auth.onIdTokenChanged(t=>{e(t?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();let t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){t$(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}let iT=ee("authIdTokenMaxAge")||300,iI=null;nV={loadJS:e=>new Promise((t,n)=>{let r=document.createElement("script");r.setAttribute("src",e),r.onload=t,r.onerror=e=>{let t=tB("internal-error");t.customData=e,n(t)},r.type="text/javascript",r.charset="UTF-8",(document.getElementsByTagName("head")?.[0]??document).appendChild(r)}),gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="},m="Browser",ts(new eM("auth",(e,{options:t})=>{let n,r,i=e.getProvider("app").getImmediate(),s=e.getProvider("heartbeat"),o=e.getProvider("app-check-internal"),{apiKey:a,authDomain:l}=i.options;t$(a&&!a.includes(":"),"invalid-api-key",{appName:i.name});let h=new nU(i,s,o,{apiKey:a,authDomain:l,clientPlatform:m,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:nO(m)});return r=(Array.isArray(n=t?.persistence||[])?n:[n]).map(nv),t?.errorMap&&h._updateErrorMap(t.errorMap),h._initializeWithPersistence(r,t?.popupRedirectResolver),h},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,n)=>{e.getProvider("auth-internal").initialize()})),ts(new eM("auth-internal",e=>new iE(eL(e.getProvider("auth").getImmediate())),"PRIVATE").setInstantiationMode("EXPLICIT")),tE(iw,ib,function(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}(m)),tE(iw,ib,"esm2020"),e.s([],58556),e.i(58556);var iC=e.i(67034),iS="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:e.g,ik={};(function(){function e(){this.blockSize=-1,this.blockSize=64,this.g=[,,,,],this.C=Array(this.blockSize),this.o=this.h=0,this.u()}var t=function(){this.blockSize=-1};function n(){}function r(e,t,n){n||(n=0);let r=Array(16);if("string"==typeof t)for(var i=0;i<16;++i)r[i]=t.charCodeAt(n++)|t.charCodeAt(n++)<<8|t.charCodeAt(n++)<<16|t.charCodeAt(n++)<<24;else for(i=0;i<16;++i)r[i]=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24;t=e.g[0],n=e.g[1],i=e.g[2];let s=e.g[3],o;o=t+(s^n&(i^s))+r[0]+0xd76aa478|0,o=s+(i^(t=n+(o<<7|o>>>25))&(n^i))+r[1]+0xe8c7b756|0,o=i+(n^(s=t+(o<<12|o>>>20))&(t^n))+r[2]+0x242070db|0,o=n+(t^(i=s+(o<<17|o>>>15))&(s^t))+r[3]+0xc1bdceee|0,o=t+(s^(n=i+(o<<22|o>>>10))&(i^s))+r[4]+0xf57c0faf|0,o=s+(i^(t=n+(o<<7|o>>>25))&(n^i))+r[5]+0x4787c62a|0,o=i+(n^(s=t+(o<<12|o>>>20))&(t^n))+r[6]+0xa8304613|0,o=n+(t^(i=s+(o<<17|o>>>15))&(s^t))+r[7]+0xfd469501|0,o=t+(s^(n=i+(o<<22|o>>>10))&(i^s))+r[8]+0x698098d8|0,o=s+(i^(t=n+(o<<7|o>>>25))&(n^i))+r[9]+0x8b44f7af|0,o=i+(n^(s=t+(o<<12|o>>>20))&(t^n))+r[10]+0xffff5bb1|0,o=n+(t^(i=s+(o<<17|o>>>15))&(s^t))+r[11]+0x895cd7be|0,o=t+(s^(n=i+(o<<22|o>>>10))&(i^s))+r[12]+0x6b901122|0,o=s+(i^(t=n+(o<<7|o>>>25))&(n^i))+r[13]+0xfd987193|0,o=i+(n^(s=t+(o<<12|o>>>20))&(t^n))+r[14]+0xa679438e|0,o=n+(t^(i=s+(o<<17|o>>>15))&(s^t))+r[15]+0x49b40821|0,n=i+(o<<22|o>>>10),o=t+(i^s&(n^i))+r[1]+0xf61e2562|0,t=n+(o<<5|o>>>27),o=s+(n^i&(t^n))+r[6]+0xc040b340|0,s=t+(o<<9|o>>>23),o=i+(t^n&(s^t))+r[11]+0x265e5a51|0,i=s+(o<<14|o>>>18),o=n+(s^t&(i^s))+r[0]+0xe9b6c7aa|0,n=i+(o<<20|o>>>12),o=t+(i^s&(n^i))+r[5]+0xd62f105d|0,t=n+(o<<5|o>>>27),o=s+(n^i&(t^n))+r[10]+0x2441453|0,s=t+(o<<9|o>>>23),o=i+(t^n&(s^t))+r[15]+0xd8a1e681|0,i=s+(o<<14|o>>>18),o=n+(s^t&(i^s))+r[4]+0xe7d3fbc8|0,n=i+(o<<20|o>>>12),o=t+(i^s&(n^i))+r[9]+0x21e1cde6|0,t=n+(o<<5|o>>>27),o=s+(n^i&(t^n))+r[14]+0xc33707d6|0,s=t+(o<<9|o>>>23),o=i+(t^n&(s^t))+r[3]+0xf4d50d87|0,i=s+(o<<14|o>>>18),o=n+(s^t&(i^s))+r[8]+0x455a14ed|0,n=i+(o<<20|o>>>12),o=t+(i^s&(n^i))+r[13]+0xa9e3e905|0,t=n+(o<<5|o>>>27),o=s+(n^i&(t^n))+r[2]+0xfcefa3f8|0,s=t+(o<<9|o>>>23),o=i+(t^n&(s^t))+r[7]+0x676f02d9|0,i=s+(o<<14|o>>>18),o=n+(s^t&(i^s))+r[12]+0x8d2a4c8a|0,o=t+((n=i+(o<<20|o>>>12))^i^s)+r[5]+0xfffa3942|0,o=s+((t=n+(o<<4|o>>>28))^n^i)+r[8]+0x8771f681|0,o=i+((s=t+(o<<11|o>>>21))^t^n)+r[11]+0x6d9d6122|0,o=n+((i=s+(o<<16|o>>>16))^s^t)+r[14]+0xfde5380c|0,o=t+((n=i+(o<<23|o>>>9))^i^s)+r[1]+0xa4beea44|0,o=s+((t=n+(o<<4|o>>>28))^n^i)+r[4]+0x4bdecfa9|0,o=i+((s=t+(o<<11|o>>>21))^t^n)+r[7]+0xf6bb4b60|0,o=n+((i=s+(o<<16|o>>>16))^s^t)+r[10]+0xbebfbc70|0,o=t+((n=i+(o<<23|o>>>9))^i^s)+r[13]+0x289b7ec6|0,o=s+((t=n+(o<<4|o>>>28))^n^i)+r[0]+0xeaa127fa|0,o=i+((s=t+(o<<11|o>>>21))^t^n)+r[3]+0xd4ef3085|0,o=n+((i=s+(o<<16|o>>>16))^s^t)+r[6]+0x4881d05|0,o=t+((n=i+(o<<23|o>>>9))^i^s)+r[9]+0xd9d4d039|0,o=s+((t=n+(o<<4|o>>>28))^n^i)+r[12]+0xe6db99e5|0,o=i+((s=t+(o<<11|o>>>21))^t^n)+r[15]+0x1fa27cf8|0,o=n+((i=s+(o<<16|o>>>16))^s^t)+r[2]+0xc4ac5665|0,n=i+(o<<23|o>>>9),o=t+(i^(n|~s))+r[0]+0xf4292244|0,t=n+(o<<6|o>>>26),o=s+(n^(t|~i))+r[7]+0x432aff97|0,s=t+(o<<10|o>>>22),o=i+(t^(s|~n))+r[14]+0xab9423a7|0,i=s+(o<<15|o>>>17),o=n+(s^(i|~t))+r[5]+0xfc93a039|0,n=i+(o<<21|o>>>11),o=t+(i^(n|~s))+r[12]+0x655b59c3|0,t=n+(o<<6|o>>>26),o=s+(n^(t|~i))+r[3]+0x8f0ccc92|0,s=t+(o<<10|o>>>22),o=i+(t^(s|~n))+r[10]+0xffeff47d|0,i=s+(o<<15|o>>>17),o=n+(s^(i|~t))+r[1]+0x85845dd1|0,n=i+(o<<21|o>>>11),o=t+(i^(n|~s))+r[8]+0x6fa87e4f|0,t=n+(o<<6|o>>>26),o=s+(n^(t|~i))+r[15]+0xfe2ce6e0|0,s=t+(o<<10|o>>>22),o=i+(t^(s|~n))+r[6]+0xa3014314|0,i=s+(o<<15|o>>>17),o=n+(s^(i|~t))+r[13]+0x4e0811a1|0,n=i+(o<<21|o>>>11),o=t+(i^(n|~s))+r[4]+0xf7537e82|0,t=n+(o<<6|o>>>26),o=s+(n^(t|~i))+r[11]+0xbd3af235|0,s=t+(o<<10|o>>>22),o=i+(t^(s|~n))+r[2]+0x2ad7d2bb|0,i=s+(o<<15|o>>>17),o=n+(s^(i|~t))+r[9]+0xeb86d391|0,e.g[0]=e.g[0]+t|0,e.g[1]=e.g[1]+(i+(o<<21|o>>>11))|0,e.g[2]=e.g[2]+i|0,e.g[3]=e.g[3]+s|0}function i(e,t){this.h=t;let n=[],r=!0;for(let i=e.length-1;i>=0;i--){let s=0|e[i];r&&s==t||(n[i]=s,r=!1)}this.g=n}n.prototype=t.prototype,e.F=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.D=function(e,n,r){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return t.prototype[n].apply(e,i)},e.prototype.u=function(){this.g[0]=0x67452301,this.g[1]=0xefcdab89,this.g[2]=0x98badcfe,this.g[3]=0x10325476,this.o=this.h=0},e.prototype.v=function(e,t){void 0===t&&(t=e.length);let n=t-this.blockSize,i=this.C,s=this.h,o=0;for(;o<t;){if(0==s)for(;o<=n;)r(this,e,o),o+=this.blockSize;if("string"==typeof e){for(;o<t;)if(i[s++]=e.charCodeAt(o++),s==this.blockSize){r(this,i),s=0;break}}else for(;o<t;)if(i[s++]=e[o++],s==this.blockSize){r(this,i),s=0;break}}this.h=s,this.o+=t},e.prototype.A=function(){var e=Array((this.h<56?this.blockSize:2*this.blockSize)-this.h);e[0]=128;for(var t=1;t<e.length-8;++t)e[t]=0;t=8*this.o;for(var n=e.length-8;n<e.length;++n)e[n]=255&t,t/=256;for(this.v(e),e=Array(16),t=0,n=0;n<4;++n)for(let r=0;r<32;r+=8)e[t++]=this.g[n]>>>r&255;return e};var s,o={};function a(e){var t;return -128<=e&&e<128?(t=function(e){return new i([0|e],e<0?-1:0)},Object.prototype.hasOwnProperty.call(o,e)?o[e]:o[e]=t(e)):new i([0|e],e<0?-1:0)}function l(e){if(isNaN(e)||!isFinite(e))return h;if(e<0)return p(l(-e));let t=[],n=1;for(let r=0;e>=n;r++)t[r]=e/n|0,n*=0x100000000;return new i(t,0)}var h=a(0),u=a(1),c=a(0x1000000);function d(e){if(0!=e.h)return!1;for(let t=0;t<e.g.length;t++)if(0!=e.g[t])return!1;return!0}function f(e){return -1==e.h}function p(e){let t=e.g.length,n=[];for(let r=0;r<t;r++)n[r]=~e.g[r];return new i(n,~e.h).add(u)}function g(e,t){return e.add(p(t))}function m(e,t){for(;(65535&e[t])!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function y(e,t){this.g=e,this.h=t}function _(e,t){if(d(t))throw Error("division by zero");if(d(e))return new y(h,h);if(f(e))return t=_(p(e),t),new y(p(t.g),p(t.h));if(f(t))return t=_(e,p(t)),new y(p(t.g),t.h);if(e.g.length>30){if(f(e)||f(t))throw Error("slowDivide_ only works with positive integers.");for(var n=u,r=t;0>=r.l(e);)n=v(n),r=v(r);var i=w(n,1),s=w(r,1);for(r=w(r,2),n=w(n,2);!d(r);){var o=s.add(r);0>=o.l(e)&&(i=i.add(n),s=o),r=w(r,1),n=w(n,1)}return t=g(e,i.j(t)),new y(i,t)}for(i=h;e.l(t)>=0;){for(r=(r=Math.ceil(Math.log(n=Math.max(1,Math.floor(e.m()/t.m())))/Math.LN2))<=48?1:Math.pow(2,r-48),o=(s=l(n)).j(t);f(o)||o.l(e)>0;)n-=r,o=(s=l(n)).j(t);d(s)&&(s=u),i=i.add(s),e=g(e,o)}return new y(i,e)}function v(e){let t=e.g.length+1,n=[];for(let r=0;r<t;r++)n[r]=e.i(r)<<1|e.i(r-1)>>>31;return new i(n,e.h)}function w(e,t){let n=t>>5;t%=32;let r=e.g.length-n,s=[];for(let i=0;i<r;i++)s[i]=t>0?e.i(i+n)>>>t|e.i(i+n+1)<<32-t:e.i(i+n);return new i(s,e.h)}(s=i.prototype).m=function(){if(f(this))return-p(this).m();let e=0,t=1;for(let n=0;n<this.g.length;n++){let r=this.i(n);e+=(r>=0?r:0x100000000+r)*t,t*=0x100000000}return e},s.toString=function(e){if((e=e||10)<2||36<e)throw Error("radix out of range: "+e);if(d(this))return"0";if(f(this))return"-"+p(this).toString(e);let t=l(Math.pow(e,6));var n=this;let r="";for(;;){let i=_(n,t).g,s=(((n=g(n,i.j(t))).g.length>0?n.g[0]:n.h)>>>0).toString(e);if(d(n=i))return s+r;for(;s.length<6;)s="0"+s;r=s+r}},s.i=function(e){return e<0?0:e<this.g.length?this.g[e]:this.h},s.l=function(e){return f(e=g(this,e))?-1:+!d(e)},s.abs=function(){return f(this)?p(this):this},s.add=function(e){let t=Math.max(this.g.length,e.g.length),n=[],r=0;for(let i=0;i<=t;i++){let t=r+(65535&this.i(i))+(65535&e.i(i)),s=(t>>>16)+(this.i(i)>>>16)+(e.i(i)>>>16);r=s>>>16,t&=65535,s&=65535,n[i]=s<<16|t}return new i(n,-0x80000000&n[n.length-1]?-1:0)},s.j=function(e){if(d(this)||d(e))return h;if(f(this))return f(e)?p(this).j(p(e)):p(p(this).j(e));if(f(e))return p(this.j(p(e)));if(0>this.l(c)&&0>e.l(c))return l(this.m()*e.m());let t=this.g.length+e.g.length,n=[];for(var r=0;r<2*t;r++)n[r]=0;for(r=0;r<this.g.length;r++)for(let t=0;t<e.g.length;t++){let i=this.i(r)>>>16,s=65535&this.i(r),o=e.i(t)>>>16,a=65535&e.i(t);n[2*r+2*t]+=s*a,m(n,2*r+2*t),n[2*r+2*t+1]+=i*a,m(n,2*r+2*t+1),n[2*r+2*t+1]+=s*o,m(n,2*r+2*t+1),n[2*r+2*t+2]+=i*o,m(n,2*r+2*t+2)}for(e=0;e<t;e++)n[e]=n[2*e+1]<<16|n[2*e];for(e=t;e<2*t;e++)n[e]=0;return new i(n,0)},s.B=function(e){return _(this,e).h},s.and=function(e){let t=Math.max(this.g.length,e.g.length),n=[];for(let r=0;r<t;r++)n[r]=this.i(r)&e.i(r);return new i(n,this.h&e.h)},s.or=function(e){let t=Math.max(this.g.length,e.g.length),n=[];for(let r=0;r<t;r++)n[r]=this.i(r)|e.i(r);return new i(n,this.h|e.h)},s.xor=function(e){let t=Math.max(this.g.length,e.g.length),n=[];for(let r=0;r<t;r++)n[r]=this.i(r)^e.i(r);return new i(n,this.h^e.h)},e.prototype.digest=e.prototype.A,e.prototype.reset=e.prototype.u,e.prototype.update=e.prototype.v,E=ik.Md5=e,i.prototype.add=i.prototype.add,i.prototype.multiply=i.prototype.j,i.prototype.modulo=i.prototype.B,i.prototype.compare=i.prototype.l,i.prototype.toNumber=i.prototype.m,i.prototype.toString=i.prototype.toString,i.prototype.getBits=i.prototype.i,i.fromNumber=l,i.fromString=function e(t,n){if(0==t.length)throw Error("number format error: empty string");if((n=n||10)<2||36<n)throw Error("radix out of range: "+n);if("-"==t.charAt(0))return p(e(t.substring(1),n));if(t.indexOf("-")>=0)throw Error('number format error: interior "-" character');let r=l(Math.pow(n,8)),i=h;for(let e=0;e<t.length;e+=8){var s=Math.min(8,t.length-e);let o=parseInt(t.substring(e,e+s),n);s<8?(s=l(Math.pow(n,s)),i=i.j(s).add(l(o))):i=(i=i.j(r)).add(l(o))}return i},b=ik.Integer=i}).apply(void 0!==iS?iS:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});var iA="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:e.g,iR={};(function(){var e,t,n=Object.defineProperty,r=function(e){e=["object"==typeof globalThis&&globalThis,e,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof iA&&iA];for(var t=0;t<e.length;++t){var n=e[t];if(n&&n.Math==Math)return n}throw Error("Cannot find global object")}(this);function i(e,t){if(t)e:{var i=r;e=e.split(".");for(var s=0;s<e.length-1;s++){var o=e[s];if(!(o in i))break e;i=i[o]}(t=t(s=i[e=e[e.length-1]]))!=s&&null!=t&&n(i,e,{configurable:!0,writable:!0,value:t})}}i("Symbol.dispose",function(e){return e||Symbol("Symbol.dispose")}),i("Array.prototype.values",function(e){return e||function(){return this[Symbol.iterator]()}}),i("Object.entries",function(e){return e||function(e){var t,n=[];for(t in e)Object.prototype.hasOwnProperty.call(e,t)&&n.push([t,e[t]]);return n}});var s=s||{},o=this||self;function a(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}function l(e,t,n){return e.call.apply(e.bind,arguments)}function h(e,t,n){return(h=l).apply(null,arguments)}function u(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function c(e,t){function n(){}n.prototype=t.prototype,e.Z=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.Ob=function(e,n,r){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return t.prototype[n].apply(e,i)}}var d="undefined"!=typeof AsyncContext&&"function"==typeof AsyncContext.Snapshot?e=>e&&AsyncContext.Snapshot.wrap(e):e=>e;function f(e){let t=e.length;if(t>0){let n=Array(t);for(let r=0;r<t;r++)n[r]=e[r];return n}return[]}function p(e,t){for(let t=1;t<arguments.length;t++){let r=arguments[t];var n=typeof r;if("array"==(n="object"!=n?n:r?Array.isArray(r)?"array":n:"null")||"object"==n&&"number"==typeof r.length){n=e.length||0;let t=r.length||0;e.length=n+t;for(let i=0;i<t;i++)e[n+i]=r[i]}else e.push(r)}}var g=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return this.h>0?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}(()=>new m,e=>e.reset());class m{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}let y,_=!1,v=new class{constructor(){this.h=this.g=null}add(e,t){let n=g.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}},w=()=>{let e=Promise.resolve(void 0);y=()=>{e.then(b)}};function b(){let e;for(var t;e=null,v.g&&(e=v.g,v.g=v.g.next,v.g||(v.h=null),e.next=null),t=e;){try{t.h.call(t.g)}catch(e){!function(e){o.setTimeout(()=>{throw e},0)}(e)}g.j(t),g.h<100&&(g.h++,t.next=g.g,g.g=t)}_=!1}function E(){this.u=this.u,this.C=this.C}function P(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}E.prototype.u=!1,E.prototype.dispose=function(){this.u||(this.u=!0,this.N())},E.prototype[Symbol.dispose]=function(){this.dispose()},E.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()},P.prototype.h=function(){this.defaultPrevented=!0};var D=function(){if(!o.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{let e=()=>{};o.addEventListener("test",e,t),o.removeEventListener("test",e,t)}catch(e){}return e}();function O(e){return/^[\s\xa0]*$/.test(e)}function x(e,t){P.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e&&this.init(e,t)}c(x,P),x.prototype.init=function(e,t){let n=this.type=e.type,r=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;this.target=e.target||e.srcElement,this.g=t,(t=e.relatedTarget)||("mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement)),this.relatedTarget=t,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType=e.pointerType,this.state=e.state,this.i=e,e.defaultPrevented&&x.Z.h.call(this)},x.prototype.h=function(){x.Z.h.call(this);let e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var L="closure_listenable_"+(1e6*Math.random()|0),M=0;function U(e,t,n,r,i){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!r,this.ha=i,this.key=++M,this.da=this.fa=!1}function F(e){e.da=!0,e.listener=null,e.proxy=null,e.src=null,e.ha=null}function V(e,t,n){for(let r in e)t.call(n,e[r],r,e)}function B(e){let t={};for(let n in e)t[n]=e[n];return t}let j="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function q(e,t){let n,r;for(let t=1;t<arguments.length;t++){for(n in r=arguments[t])e[n]=r[n];for(let t=0;t<j.length;t++)n=j[t],Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}}function z(e){this.src=e,this.g={},this.h=0}function $(e,t){let n=t.type;if(n in e.g){var r,i=e.g[n],s=Array.prototype.indexOf.call(i,t,void 0);(r=s>=0)&&Array.prototype.splice.call(i,s,1),r&&(F(t),0==e.g[n].length&&(delete e.g[n],e.h--))}}function H(e,t,n,r){for(let i=0;i<e.length;++i){let s=e[i];if(!s.da&&s.listener==t&&!!n==s.capture&&s.ha==r)return i}return -1}z.prototype.add=function(e,t,n,r,i){let s=e.toString();(e=this.g[s])||(e=this.g[s]=[],this.h++);let o=H(e,t,r,i);return o>-1?(t=e[o],n||(t.fa=!1)):((t=new U(t,this.src,s,!!r,i)).fa=n,e.push(t)),t};var W="closure_lm_"+(1e6*Math.random()|0),K={};function G(e,t,n,r,i,s){if(!t)throw Error("Invalid event type");let o=a(i)?!!i.capture:!!i,l=J(e);if(l||(e[W]=l=new z(e)),(n=l.add(t,n,r,o,s)).proxy)return n;if(r=function e(t){return X.call(e.src,e.listener,t)},n.proxy=r,r.src=e,r.listener=n,e.addEventListener)D||(i=o),void 0===i&&(i=!1),e.addEventListener(t.toString(),r,i);else if(e.attachEvent)e.attachEvent(Y(t.toString()),r);else if(e.addListener&&e.removeListener)e.addListener(r);else throw Error("addEventListener and attachEvent are unavailable.");return n}function Q(e){if("number"!=typeof e&&e&&!e.da){var t=e.src;if(t&&t[L])$(t.i,e);else{var n=e.type,r=e.proxy;t.removeEventListener?t.removeEventListener(n,r,e.capture):t.detachEvent?t.detachEvent(Y(n),r):t.addListener&&t.removeListener&&t.removeListener(r),(n=J(t))?($(n,e),0==n.h&&(n.src=null,t[W]=null)):F(e)}}}function Y(e){return e in K?K[e]:K[e]="on"+e}function X(e,t){if(e.da)e=!0;else{t=new x(t,this);let n=e.listener,r=e.ha||e.src;e.fa&&Q(e),e=n.call(r,t)}return e}function J(e){return(e=e[W])instanceof z?e:null}var Z="__closure_events_fn_"+(1e9*Math.random()>>>0);function ee(e){return"function"==typeof e?e:(e[Z]||(e[Z]=function(t){return e.handleEvent(t)}),e[Z])}function et(){E.call(this),this.i=new z(this),this.M=this,this.G=null}function en(e,t){let n,r;var i,s=e.G;if(s)for(i=[];s;s=s.G)i.push(s);if(e=e.M,s=t.type||t,"string"==typeof t)t=new P(t,e);else if(t instanceof P)t.target=t.target||e;else{var o=t;q(t=new P(s,e),o)}if(o=!0,i)for(r=i.length-1;r>=0;r--)o=er(n=t.g=i[r],s,!0,t)&&o;if(o=er(n=t.g=e,s,!0,t)&&o,o=er(n,s,!1,t)&&o,i)for(r=0;r<i.length;r++)o=er(n=t.g=i[r],s,!1,t)&&o}function er(e,t,n,r){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();let i=!0;for(let s=0;s<t.length;++s){let o=t[s];if(o&&!o.da&&o.capture==n){let t=o.listener,n=o.ha||o.src;o.fa&&$(e.i,o),i=!1!==t.call(n,r)&&i}}return i&&!r.defaultPrevented}c(et,E),et.prototype[L]=!0,et.prototype.removeEventListener=function(e,t,n,r){!function e(t,n,r,i,s){if(Array.isArray(n))for(var o=0;o<n.length;o++)e(t,n[o],r,i,s);else(i=a(i)?!!i.capture:!!i,r=ee(r),t&&t[L])?(t=t.i,(o=String(n).toString())in t.g&&(r=H(n=t.g[o],r,i,s))>-1&&(F(n[r]),Array.prototype.splice.call(n,r,1),0==n.length&&(delete t.g[o],t.h--))):t&&(t=J(t))&&(n=t.g[n.toString()],t=-1,n&&(t=H(n,r,i,s)),(r=t>-1?n[t]:null)&&Q(r))}(this,e,t,n,r)},et.prototype.N=function(){if(et.Z.N.call(this),this.i){var e=this.i;for(let t in e.g){let n=e.g[t];for(let e=0;e<n.length;e++)F(n[e]);delete e.g[t],e.h--}}this.G=null},et.prototype.J=function(e,t,n,r){return this.i.add(String(e),t,!1,n,r)},et.prototype.K=function(e,t,n,r){return this.i.add(String(e),t,!0,n,r)};class ei extends E{constructor(e,t){super(),this.m=e,this.l=t,this.h=null,this.i=!1,this.g=null}j(e){this.h=arguments,this.g?this.i=!0:function e(t){t.g=function(e,t){if("function"!=typeof e)if(e&&"function"==typeof e.handleEvent)e=h(e.handleEvent,e);else throw Error("Invalid listener argument");return Number(t)>0x7fffffff?-1:o.setTimeout(e,t||0)}(()=>{t.g=null,t.i&&(t.i=!1,e(t))},t.l);let n=t.h;t.h=null,t.m.apply(null,n)}(this)}N(){super.N(),this.g&&(o.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function es(e){E.call(this),this.h=e,this.g={}}c(es,E);var eo=[];function ea(e){V(e.g,function(e,t){this.g.hasOwnProperty(t)&&Q(e)},e),e.g={}}es.prototype.N=function(){es.Z.N.call(this),ea(this)},es.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var el=o.JSON.stringify,eh=o.JSON.parse,eu=class{stringify(e){return o.JSON.stringify(e,void 0)}parse(e){return o.JSON.parse(e,void 0)}};function ec(){}function ed(){}var ef={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function ep(){P.call(this,"d")}function eg(){P.call(this,"c")}c(ep,P),c(eg,P);var em={},ey=null;function e_(){return ey=ey||new et}function ev(e){P.call(this,em.Ia,e)}function ew(e){let t=e_();en(t,new ev(t))}function eb(e,t){P.call(this,em.STAT_EVENT,e),this.stat=t}function eE(e){let t=e_();en(t,new eb(t,e))}function eT(e,t){P.call(this,em.Ja,e),this.size=t}function eI(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return o.setTimeout(function(){e()},t)}function eC(){this.g=!0}function eS(e,t,n,r){e.info(function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{let s=JSON.parse(t);if(s){for(e=0;e<s.length;e++)if(Array.isArray(s[e])){var n=s[e];if(!(n.length<2)){var r=n[1];if(Array.isArray(r)&&!(r.length<1)){var i=r[0];if("noop"!=i&&"stop"!=i&&"close"!=i)for(let e=1;e<r.length;e++)r[e]=""}}}}return el(s)}catch(e){return t}}(e,n)+(r?" "+r:"")})}em.Ia="serverreachability",c(ev,P),em.STAT_EVENT="statevent",c(eb,P),em.Ja="timingevent",c(eT,P),eC.prototype.ua=function(){this.g=!1},eC.prototype.info=function(){};var ek={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},eA={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"};function eR(){}function eN(e){return encodeURIComponent(String(e))}function eP(e,t,n,r){this.j=e,this.i=t,this.l=n,this.S=r||1,this.V=new es(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new eD}function eD(){this.i=null,this.g="",this.h=!1}c(eR,ec),eR.prototype.g=function(){return new XMLHttpRequest},e=new eR;var eO={},ex={};function eL(e,t,n){e.M=1,e.A=e4(e0(t)),e.u=n,e.R=!0,eM(e,null)}function eM(e,t){e.F=Date.now(),eF(e),e.B=e0(e.A);var n,r,i,s,o,l,u=e.B,c=e.S;Array.isArray(c)||(c=[String(c)]),th(u.i,"t",c),e.C=0,u=e.j.L,e.h=new eD,e.g=tQ(e.j,u?t:null,!e.u),e.P>0&&(e.O=new ei(h(e.Y,e,e.g),e.P)),t=e.V,u=e.g,c=e.ba;var d="readystatechange";Array.isArray(d)||(d&&(eo[0]=d.toString()),d=eo);for(let e=0;e<d.length;e++){let n=function e(t,n,r,i,s){if(i&&i.once)return function e(t,n,r,i,s){if(Array.isArray(n)){for(let o=0;o<n.length;o++)e(t,n[o],r,i,s);return null}return r=ee(r),t&&t[L]?t.K(n,r,a(i)?!!i.capture:!!i,s):G(t,n,r,!0,i,s)}(t,n,r,i,s);if(Array.isArray(n)){for(let o=0;o<n.length;o++)e(t,n[o],r,i,s);return null}return r=ee(r),t&&t[L]?t.J(n,r,a(i)?!!i.capture:!!i,s):G(t,n,r,!1,i,s)}(u,d[e],c||t.handleEvent,!1,t.h||t);if(!n)break;t.g[n.key]=n}t=e.J?B(e.J):{},e.u?(e.v||(e.v="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ea(e.B,e.v,e.u,t)):(e.v="GET",e.g.ea(e.B,e.v,null,t)),ew(),n=e.i,r=e.v,i=e.B,s=e.l,o=e.S,l=e.u,n.info(function(){if(n.g)if(l){var e="",t=l.split("&");for(let n=0;n<t.length;n++){var a=t[n].split("=");if(a.length>1){let t=a[0];a=a[1];let n=t.split("_");e=n.length>=2&&"type"==n[1]?e+(t+"=")+a+"&":e+(t+"=redacted&")}}}else e=null;else e=l;return"XMLHTTP REQ ("+s+") [attempt "+o+"]: "+r+"\n"+i+"\n"+e})}function eU(e){return!!e.g&&"GET"==e.v&&2!=e.M&&e.j.Aa}function eF(e){e.T=Date.now()+e.H,eV(e,e.H)}function eV(e,t){if(null!=e.D)throw Error("WatchDog timer not null");e.D=eI(h(e.aa,e),t)}function eB(e){e.D&&(o.clearTimeout(e.D),e.D=null)}function ej(e){0==e.j.I||e.K||t$(e.j,e)}function eq(e){eB(e);var t=e.O;t&&"function"==typeof t.dispose&&t.dispose(),e.O=null,ea(e.V),e.g&&(t=e.g,e.g=null,t.abort(),t.dispose())}function ez(e,t){try{var n=e.j;if(0!=n.I&&(n.g==e||eG(n.h,e))){if(!e.L&&eG(n.h,e)&&3==n.I){try{var r=n.Ba.g.parse(t)}catch(e){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){e:if(!n.v){if(n.g)if(n.g.F+3e3<e.F)tz(n),tO(n);else break e;tB(n),eE(18)}}else n.xa=i[1],0<n.xa-n.K&&i[2]<37500&&n.F&&0==n.A&&!n.C&&(n.C=eI(h(n.Va,n),6e3));1>=eK(n.h)&&n.ta&&(n.ta=void 0)}else tW(n,11)}else if((e.L||n.g==e)&&tz(n),!O(t))for(i=n.Ba.g.parse(t),t=0;t<i.length;t++){let a=i[t],l=a[0];if(!(l<=n.K))if(n.K=l,a=a[1],2==n.I)if("c"==a[0]){n.M=a[1],n.ba=a[2];let t=a[3];null!=t&&(n.ka=t,n.j.info("VER="+n.ka));let i=a[4];null!=i&&(n.za=i,n.j.info("SVER="+n.za));let l=a[5];null!=l&&"number"==typeof l&&l>0&&(n.O=r=1.5*l,n.j.info("backChannelRequestTimeoutMs_="+r)),r=n;let h=e.g;if(h){let e=h.g?h.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var s=r.h;s.g||-1==e.indexOf("spdy")&&-1==e.indexOf("quic")&&-1==e.indexOf("h2")||(s.j=s.l,s.g=new Set,s.h&&(eQ(s,s.h),s.h=null))}if(r.G){let e=h.g?h.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(r.wa=e,e3(r.J,r.G,e))}}if(n.I=3,n.l&&n.l.ra(),n.aa&&(n.T=Date.now()-e.F,n.j.info("Handshake RTT: "+n.T+"ms")),(r=n).na=tG(r,r.L?r.ba:null,r.W),e.L){eY(r.h,e);var o=r.O;o&&(e.H=o),e.D&&(eB(e),eF(e)),r.g=e}else tV(r);n.i.length>0&&tL(n)}else"stop"!=a[0]&&"close"!=a[0]||tW(n,7);else 3==n.I&&("stop"==a[0]||"close"==a[0]?"stop"==a[0]?tW(n,7):tD(n):"noop"!=a[0]&&n.l&&n.l.qa(a),n.A=0)}}ew(4)}catch(e){}}eP.prototype.ba=function(e){e=e.target;let t=this.O;t&&3==tA(e)?t.j():this.Y(e)},eP.prototype.Y=function(e){try{if(e==this.g)e:{let f=tA(this.g),p=this.g.ya(),g=this.g.ca();if(!(f<3)&&(3!=f||this.g&&(this.h.h||this.g.la()||tR(this.g)))){this.K||4!=f||7==p||(8==p||g<=0?ew(3):ew(2)),eB(this);var t=this.g.ca();this.X=t;var n=function(e){if(!eU(e))return e.g.la();let t=tR(e.g);if(""===t)return"";let n="",r=t.length,i=4==tA(e.g);if(!e.h.i){if("undefined"==typeof TextDecoder)return eq(e),ej(e),"";e.h.i=new o.TextDecoder}for(let s=0;s<r;s++)e.h.h=!0,n+=e.h.i.decode(t[s],{stream:!(i&&s==r-1)});return t.length=0,e.h.g+=n,e.C=0,e.h.g}(this);if(this.o=200==t,r=this.i,i=this.v,s=this.B,a=this.l,l=this.S,r.info(function(){return"XMLHTTP RESP ("+a+") [ attempt "+l+"]: "+i+"\n"+s+"\n"+f+" "+t}),this.o){if(this.U&&!this.L){t:{if(this.g){var r,i,s,a,l,h,u=this.g;if((h=u.g?u.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!O(h)){var c=h;break t}}c=null}if(e=c)eS(this.i,this.l,e,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,ez(this,e);else{this.o=!1,this.m=3,eE(12),eq(this),ej(this);break e}}if(this.R){let t;for(e=!0;!this.K&&this.C<n.length;)if((t=function(e,t){var n=e.C,r=t.indexOf("\n",n);return -1==r?ex:isNaN(n=Number(t.substring(n,r)))?eO:(r+=1)+n>t.length?ex:(t=t.slice(r,r+n),e.C=r+n,t)}(this,n))==ex){4==f&&(this.m=4,eE(14),e=!1),eS(this.i,this.l,null,"[Incomplete Response]");break}else if(t==eO){this.m=4,eE(15),eS(this.i,this.l,n,"[Invalid Chunk]"),e=!1;break}else eS(this.i,this.l,t,null),ez(this,t);if(eU(this)&&0!=this.C&&(this.h.g=this.h.g.slice(this.C),this.C=0),4!=f||0!=n.length||this.h.h||(this.m=1,eE(16),e=!1),this.o=this.o&&e,e){if(n.length>0&&!this.W){this.W=!0;var d=this.j;d.g==this&&d.aa&&!d.P&&(d.j.info("Great, no buffering proxy detected. Bytes received: "+n.length),tj(d),d.P=!0,eE(11))}}else eS(this.i,this.l,n,"[Invalid Chunked Response]"),eq(this),ej(this)}else eS(this.i,this.l,n,null),ez(this,n);4==f&&eq(this),this.o&&!this.K&&(4==f?t$(this.j,this):(this.o=!1,eF(this)))}else(function(e){let t={};e=(e.g&&tA(e)>=2&&e.g.getAllResponseHeaders()||"").split("\r\n");for(let r=0;r<e.length;r++){if(O(e[r]))continue;var n=function(e){var t=1;e=e.split(":");let n=[];for(;t>0&&e.length;)n.push(e.shift()),t--;return e.length&&n.push(e.join(":")),n}(e[r]);let i=n[0];if("string"!=typeof(n=n[1]))continue;n=n.trim();let s=t[i]||[];t[i]=s,s.push(n)}var r=function(e){return e.join(", ")};for(let e in t)r.call(void 0,t[e],e,t)})(this.g),400==t&&n.indexOf("Unknown SID")>0?(this.m=3,eE(12)):(this.m=0,eE(13)),eq(this),ej(this)}}}catch(e){}finally{}},eP.prototype.cancel=function(){this.K=!0,eq(this)},eP.prototype.aa=function(){var e,t;this.D=null;let n=Date.now();n-this.T>=0?(e=this.i,t=this.B,e.info(function(){return"TIMEOUT: "+t}),2!=this.M&&(ew(),eE(17)),eq(this),this.m=2,ej(this)):eV(this,this.T-n)};var e$=class{constructor(e,t){this.g=e,this.map=t}};function eH(e){this.l=e||10,e=o.PerformanceNavigationTiming?(e=o.performance.getEntriesByType("navigation")).length>0&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):!!(o.chrome&&o.chrome.loadTimes&&o.chrome.loadTimes()&&o.chrome.loadTimes().wasFetchedViaSpdy),this.j=e?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function eW(e){return!!e.h||!!e.g&&e.g.size>=e.j}function eK(e){return e.h?1:e.g?e.g.size:0}function eG(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function eQ(e,t){e.g?e.g.add(t):e.h=t}function eY(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function eX(e){if(null!=e.h)return e.i.concat(e.h.G);if(null!=e.g&&0!==e.g.size){let t=e.i;for(let n of e.g.values())t=t.concat(n.G);return t}return f(e.i)}eH.prototype.cancel=function(){if(this.i=eX(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(let e of this.g.values())e.cancel();this.g.clear()}};var eJ=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function eZ(e){let t;this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1,e instanceof eZ?(this.l=e.l,e1(this,e.j),this.o=e.o,this.g=e.g,e2(this,e.u),this.h=e.h,e6(this,tu(e.i)),this.m=e.m):e&&(t=String(e).match(eJ))?(this.l=!1,e1(this,t[1]||"",!0),this.o=e5(t[2]||""),this.g=e5(t[3]||"",!0),e2(this,t[4]),this.h=e5(t[5]||"",!0),e6(this,t[6]||"",!0),this.m=e5(t[7]||"")):(this.l=!1,this.i=new ti(null,this.l))}function e0(e){return new eZ(e)}function e1(e,t,n){e.j=n?e5(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function e2(e,t){if(t){if(isNaN(t=Number(t))||t<0)throw Error("Bad port number "+t);e.u=t}else e.u=null}function e6(e,t,n){var r,i;t instanceof ti?(e.i=t,r=e.i,(i=e.l)&&!r.j&&(ts(r),r.i=null,r.g.forEach(function(e,t){let n=t.toLowerCase();t!=n&&(to(this,t),th(this,n,e))},r)),r.j=i):(n||(t=e8(t,tn)),e.i=new ti(t,e.l))}function e3(e,t,n){e.i.set(t,n)}function e4(e){return e3(e,"zx",Math.floor(0x80000000*Math.random()).toString(36)+Math.abs(Math.floor(0x80000000*Math.random())^Date.now()).toString(36)),e}function e5(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function e8(e,t,n){return"string"==typeof e?(e=encodeURI(e).replace(t,e7),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function e7(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}eZ.prototype.toString=function(){let e=[];var t=this.j;t&&e.push(e8(t,e9,!0),":");var n=this.g;return(n||"file"==t)&&(e.push("//"),(t=this.o)&&e.push(e8(t,e9,!0),"@"),e.push(eN(n).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.u)&&e.push(":",String(n))),(n=this.h)&&(this.g&&"/"!=n.charAt(0)&&e.push("/"),e.push(e8(n,"/"==n.charAt(0)?tt:te,!0))),(n=this.i.toString())&&e.push("?",n),(n=this.m)&&e.push("#",e8(n,tr)),e.join("")},eZ.prototype.resolve=function(e){let t=e0(this),n=!!e.j;n?e1(t,e.j):n=!!e.o,n?t.o=e.o:n=!!e.g,n?t.g=e.g:n=null!=e.u;var r=e.h;if(n)e2(t,e.u);else if(n=!!e.h){if("/"!=r.charAt(0))if(this.g&&!this.h)r="/"+r;else{var i=t.h.lastIndexOf("/");-1!=i&&(r=t.h.slice(0,i+1)+r)}if(".."==(i=r)||"."==i)r="";else if(-1!=i.indexOf("./")||-1!=i.indexOf("/.")){r=0==i.lastIndexOf("/",0),i=i.split("/");let e=[];for(let t=0;t<i.length;){let n=i[t++];"."==n?r&&t==i.length&&e.push(""):".."==n?((e.length>1||1==e.length&&""!=e[0])&&e.pop(),r&&t==i.length&&e.push("")):(e.push(n),r=!0)}r=e.join("/")}else r=i}return n?t.h=r:n=""!==e.i.toString(),n?e6(t,tu(e.i)):n=!!e.m,n&&(t.m=e.m),t};var e9=/[#\/\?@]/g,te=/[#\?:]/g,tt=/[#\?]/g,tn=/[#\?@]/g,tr=/#/g;function ti(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function ts(e){e.g||(e.g=new Map,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(let n=0;n<e.length;n++){let r=e[n].indexOf("="),i,s=null;r>=0?(i=e[n].substring(0,r),s=e[n].substring(r+1)):i=e[n],t(i,s?decodeURIComponent(s.replace(/\+/g," ")):"")}}}(e.i,function(t,n){e.add(decodeURIComponent(t.replace(/\+/g," ")),n)}))}function to(e,t){ts(e),t=tc(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function ta(e,t){return ts(e),t=tc(e,t),e.g.has(t)}function tl(e,t){ts(e);let n=[];if("string"==typeof t)ta(e,t)&&(n=n.concat(e.g.get(tc(e,t))));else for(e=Array.from(e.g.values()),t=0;t<e.length;t++)n=n.concat(e[t]);return n}function th(e,t,n){to(e,t),n.length>0&&(e.i=null,e.g.set(tc(e,t),f(n)),e.h+=n.length)}function tu(e){let t=new ti;return t.i=e.i,e.g&&(t.g=new Map(e.g),t.h=e.h),t}function tc(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}function td(e,t,n,r,i){try{i&&(i.onload=null,i.onerror=null,i.onabort=null,i.ontimeout=null),r(n)}catch(e){}}function tf(){this.g=new eu}function tp(e){this.i=e.Sb||null,this.h=e.ab||!1}function tg(e,t){et.call(this),this.H=e,this.o=t,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}function tm(e){e.j.read().then(e.Ma.bind(e)).catch(e.ga.bind(e))}function ty(e){e.readyState=4,e.l=null,e.j=null,e.B=null,t_(e)}function t_(e){e.onreadystatechange&&e.onreadystatechange.call(e)}function tv(e){let t="";return V(e,function(e,n){t+=n,t+=":",t+=e,t+="\r\n"}),t}function tw(e,t,n){e:{for(r in n){var r=!1;break e}r=!0}r||(n=tv(n),"string"==typeof e?null!=n&&eN(n):e3(e,t,n))}function tb(e){et.call(this),this.headers=new Map,this.L=e||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}(t=ti.prototype).add=function(e,t){ts(this),this.i=null,e=tc(this,e);let n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},t.forEach=function(e,t){ts(this),this.g.forEach(function(n,r){n.forEach(function(n){e.call(t,n,r,this)},this)},this)},t.set=function(e,t){return ts(this),this.i=null,ta(this,e=tc(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},t.get=function(e,t){return e&&(e=tl(this,e)).length>0?String(e[0]):t},t.toString=function(){if(this.i)return this.i;if(!this.g)return"";let e=[],t=Array.from(this.g.keys());for(let r=0;r<t.length;r++){var n=t[r];let i=eN(n);n=tl(this,n);for(let t=0;t<n.length;t++){let r=i;""!==n[t]&&(r+="="+eN(n[t])),e.push(r)}}return this.i=e.join("&")},c(tp,ec),tp.prototype.g=function(){return new tg(this.i,this.h)},c(tg,et),(t=tg.prototype).open=function(e,t){if(0!=this.readyState)throw this.abort(),Error("Error reopening a connection");this.F=e,this.D=t,this.readyState=1,t_(this)},t.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;let t={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};e&&(t.body=e),(this.H||o).fetch(new Request(this.D,t)).then(this.Pa.bind(this),this.ga.bind(this))},t.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&4!=this.readyState&&(this.g=!1,ty(this)),this.readyState=0},t.Pa=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,t_(this)),this.g&&(this.readyState=3,t_(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(void 0!==o.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;tm(this)}else e.text().then(this.Oa.bind(this),this.ga.bind(this))},t.Ma=function(e){if(this.g){if(this.o&&e.value)this.response.push(e.value);else if(!this.o){var t=e.value?e.value:new Uint8Array(0);(t=this.B.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?ty(this):t_(this),3==this.readyState&&tm(this)}},t.Oa=function(e){this.g&&(this.response=this.responseText=e,ty(this))},t.Na=function(e){this.g&&(this.response=e,ty(this))},t.ga=function(){this.g&&ty(this)},t.setRequestHeader=function(e,t){this.A.append(e,t)},t.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},t.getAllResponseHeaders=function(){if(!this.h)return"";let e=[],t=this.h.entries();for(var n=t.next();!n.done;)e.push((n=n.value)[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(tg.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}}),c(tb,et);var tE=/^https?$/i,tT=["POST","PUT"];function tI(e,t){e.h=!1,e.g&&(e.j=!0,e.g.abort(),e.j=!1),e.l=t,e.o=5,tC(e),tk(e)}function tC(e){e.A||(e.A=!0,en(e,"complete"),en(e,"error"))}function tS(e){if(e.h&&void 0!==s){if(e.v&&4==tA(e))setTimeout(e.Ca.bind(e),0);else if(en(e,"readystatechange"),4==tA(e)){e.h=!1;try{let s=e.ca();switch(s){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t,n,r=!0;break;default:r=!1}if(!(t=r)){if(n=0===s){let t=String(e.D).match(eJ)[1]||null;!t&&o.self&&o.self.location&&(t=o.self.location.protocol.slice(0,-1)),n=!tE.test(t?t.toLowerCase():"")}t=n}if(t)en(e,"complete"),en(e,"success");else{e.o=6;try{var i=tA(e)>2?e.g.statusText:""}catch(e){i=""}e.l=i+" ["+e.ca()+"]",tC(e)}}finally{tk(e)}}}}function tk(e,t){if(e.g){e.m&&(clearTimeout(e.m),e.m=null);let n=e.g;e.g=null,t||en(e,"ready");try{n.onreadystatechange=null}catch(e){}}}function tA(e){return e.g?e.g.readyState:0}function tR(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.F){case"":case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(e){return null}}function tN(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function tP(e){this.za=0,this.i=[],this.j=new eC,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=tN("failFast",!1,e),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=tN("baseRetryDelayMs",5e3,e),this.Za=tN("retryDelaySeedMs",1e4,e),this.Ta=tN("forwardChannelMaxRetries",2,e),this.va=tN("forwardChannelRequestTimeoutMs",2e4,e),this.ma=e&&e.xmlHttpFactory||void 0,this.Ua=e&&e.Rb||void 0,this.Aa=e&&e.useFetchStreams||!1,this.O=void 0,this.L=e&&e.supportsCrossDomainXhr||!1,this.M="",this.h=new eH(e&&e.concurrentRequestLimit),this.Ba=new tf,this.S=e&&e.fastHandshake||!1,this.R=e&&e.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=e&&e.Pb||!1,e&&e.ua&&this.j.ua(),e&&e.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&e&&e.detectBufferingProxy||!1,this.ia=void 0,e&&e.longPollingTimeout&&e.longPollingTimeout>0&&(this.ia=e.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}function tD(e){if(tx(e),3==e.I){var t=e.V++,n=e0(e.J);if(e3(n,"SID",e.M),e3(n,"RID",t),e3(n,"TYPE","terminate"),tU(e,n),(t=new eP(e,e.j,t)).M=2,t.A=e4(e0(n)),n=!1,o.navigator&&o.navigator.sendBeacon)try{n=o.navigator.sendBeacon(t.A.toString(),"")}catch(e){}!n&&o.Image&&((new Image).src=t.A,n=!0),n||(t.g=tQ(t.j,null),t.g.ea(t.A)),t.F=Date.now(),eF(t)}tK(e)}function tO(e){e.g&&(tj(e),e.g.cancel(),e.g=null)}function tx(e){tO(e),e.v&&(o.clearTimeout(e.v),e.v=null),tz(e),e.h.cancel(),e.m&&("number"==typeof e.m&&o.clearTimeout(e.m),e.m=null)}function tL(e){if(!eW(e.h)&&!e.m){e.m=!0;var t=e.Ea;y||w(),_||(y(),_=!0),v.add(t,e),e.D=0}}function tM(e,t){var n;n=t?t.l:e.V++;let r=e0(e.J);e3(r,"SID",e.M),e3(r,"RID",n),e3(r,"AID",e.K),tU(e,r),e.u&&e.o&&tw(r,e.u,e.o),n=new eP(e,e.j,n,e.D+1),null===e.u&&(n.J=e.o),t&&(e.i=t.G.concat(e.i)),t=tF(e,n,1e3),n.H=Math.round(.5*e.va)+Math.round(.5*e.va*Math.random()),eQ(e.h,n),eL(n,r,t)}function tU(e,t){e.H&&V(e.H,function(e,n){e3(t,n,e)}),e.l&&V({},function(e,n){e3(t,n,e)})}function tF(e,t,n){n=Math.min(e.i.length,n);let r=e.l?h(e.l.Ka,e.l,e):null;e:{var i=e.i;let t=-1;for(;;){let e=["count="+n];-1==t?n>0?(t=i[0].g,e.push("ofs="+t)):t=0:e.push("ofs="+t);let l=!0;for(let h=0;h<n;h++){var s=i[h].g;let n=i[h].map;if((s-=t)<0)t=Math.max(0,i[h].g-100),l=!1;else try{s="req"+s+"_";try{var o=n instanceof Map?n:Object.entries(n);for(let[t,n]of o){let r=n;a(n)&&(r=el(n)),e.push(s+t+"="+encodeURIComponent(r))}}catch(t){throw e.push(s+"type="+encodeURIComponent("_badmap")),t}}catch(e){r&&r(n)}}if(l){o=e.join("&");break e}}o=void 0}return t.G=e=e.i.splice(0,n),o}function tV(e){if(!e.g&&!e.v){e.Y=1;var t=e.Da;y||w(),_||(y(),_=!0),v.add(t,e),e.A=0}}function tB(e){return!e.g&&!e.v&&!(e.A>=3)&&(e.Y++,e.v=eI(h(e.Da,e),tH(e,e.A)),e.A++,!0)}function tj(e){null!=e.B&&(o.clearTimeout(e.B),e.B=null)}function tq(e){e.g=new eP(e,e.j,"rpc",e.Y),null===e.u&&(e.g.J=e.o),e.g.P=0;var t=e0(e.na);e3(t,"RID","rpc"),e3(t,"SID",e.M),e3(t,"AID",e.K),e3(t,"CI",e.F?"0":"1"),!e.F&&e.ia&&e3(t,"TO",e.ia),e3(t,"TYPE","xmlhttp"),tU(e,t),e.u&&e.o&&tw(t,e.u,e.o),e.O&&(e.g.H=e.O);var n=e.g;e=e.ba,n.M=1,n.A=e4(e0(t)),n.u=null,n.R=!0,eM(n,e)}function tz(e){null!=e.C&&(o.clearTimeout(e.C),e.C=null)}function t$(e,t){var n,r=null;if(e.g==t){tz(e),tj(e),e.g=null;var i=2}else{if(!eG(e.h,t))return;r=t.G,eY(e.h,t),i=1}if(0!=e.I){if(t.o)if(1==i){r=t.u?t.u.length:0,t=Date.now()-t.F;var s=e.D;en(i=e_(),new eT(i,r)),tL(e)}else tV(e);else if(3==(s=t.m)||0==s&&t.X>0||!(1==i&&(n=t,!(eK(e.h)>=e.h.j-!!e.m)&&(e.m?(e.i=n.G.concat(e.i),!0):1!=e.I&&2!=e.I&&!(e.D>=(e.Sa?0:e.Ta))&&(e.m=eI(h(e.Ea,e,n),tH(e,e.D)),e.D++,!0)))||2==i&&tB(e)))switch(r&&r.length>0&&((t=e.h).i=t.i.concat(r)),s){case 1:tW(e,5);break;case 4:tW(e,10);break;case 3:tW(e,6);break;default:tW(e,2)}}}function tH(e,t){let n=e.Qa+Math.floor(Math.random()*e.Za);return e.isActive()||(n*=2),n*t}function tW(e,t){if(e.j.info("Error code "+t),2==t){let t,s,a;var n,r=h(e.bb,e),i=e.Ua;let l=!i;i=new eZ(i||"//www.google.com/images/cleardot.gif"),o.location&&"http"==o.location.protocol||e1(i,"https"),e4(i),l?function(e,t){let n=new eC;if(o.Image){let r=new Image;r.onload=u(td,n,"TestLoadImage: loaded",!0,t,r),r.onerror=u(td,n,"TestLoadImage: error",!1,t,r),r.onabort=u(td,n,"TestLoadImage: abort",!1,t,r),r.ontimeout=u(td,n,"TestLoadImage: timeout",!1,t,r),o.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=e}else t(!1)}(i.toString(),r):(n=i.toString(),t=new eC,s=new AbortController,a=setTimeout(()=>{s.abort(),td(t,"TestPingServer: timeout",!1,r)},1e4),fetch(n,{signal:s.signal}).then(e=>{clearTimeout(a),e.ok?td(t,"TestPingServer: ok",!0,r):td(t,"TestPingServer: server error",!1,r)}).catch(()=>{clearTimeout(a),td(t,"TestPingServer: error",!1,r)}))}else eE(2);e.I=0,e.l&&e.l.pa(t),tK(e),tx(e)}function tK(e){if(e.I=0,e.ja=[],e.l){let t=eX(e.h);(0!=t.length||0!=e.i.length)&&(p(e.ja,t),p(e.ja,e.i),e.h.i.length=0,f(e.i),e.i.length=0),e.l.oa()}}function tG(e,t,n){var r=n instanceof eZ?e0(n):new eZ(n);if(""!=r.g)t&&(r.g=t+"."+r.g),e2(r,r.u);else{var i=o.location;r=i.protocol,t=t?t+"."+i.hostname:i.hostname,i=+i.port;let e=new eZ(null);r&&e1(e,r),t&&(e.g=t),i&&e2(e,i),n&&(e.h=n),r=e}return n=e.G,t=e.wa,n&&t&&e3(r,n,t),e3(r,"VER",e.ka),tU(e,r),r}function tQ(e,t,n){if(t&&!e.L)throw Error("Can't create secondary domain capable XhrIo object.");return(t=new tb(e.Aa&&!e.ma?new tp({ab:n}):e.ma)).Fa(e.L),t}function tY(){}function tX(){}function tJ(e,t){et.call(this),this.g=new tP(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.o=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.sa&&(e?e["X-WebChannel-Client-Profile"]=t.sa:e={"X-WebChannel-Client-Profile":t.sa}),this.g.U=e,(e=t&&t.Qb)&&!O(e)&&(this.g.u=e),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!O(t)&&(this.g.G=t,null!==(e=this.h)&&t in e&&t in(e=this.h)&&delete e[t]),this.j=new t1(this)}function tZ(e){ep.call(this),e.__headers__&&(this.headers=e.__headers__,this.statusCode=e.__status__,delete e.__headers__,delete e.__status__);var t=e.__sm__;if(t){e:{for(let n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function t0(){eg.call(this),this.status=1}function t1(e){this.g=e}(t=tb.prototype).Fa=function(e){this.H=e},t.ea=function(t,n,r,i){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+t);n=n?n.toUpperCase():"GET",this.D=t,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():e.g(),this.g.onreadystatechange=d(h(this.Ca,this));try{this.B=!0,this.g.open(n,String(t),!0),this.B=!1}catch(e){tI(this,e);return}if(t=r||"",r=new Map(this.headers),i)if(Object.getPrototypeOf(i)===Object.prototype)for(var s in i)r.set(s,i[s]);else if("function"==typeof i.keys&&"function"==typeof i.get)for(let e of i.keys())r.set(e,i.get(e));else throw Error("Unknown input type for opt_headers: "+String(i));for(let[e,a]of(i=Array.from(r.keys()).find(e=>"content-type"==e.toLowerCase()),s=o.FormData&&t instanceof o.FormData,!(Array.prototype.indexOf.call(tT,n,void 0)>=0)||i||s||r.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),r))this.g.setRequestHeader(e,a);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(t),this.v=!1}catch(e){tI(this,e)}},t.abort=function(e){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=e||7,en(this,"complete"),en(this,"abort"),tk(this))},t.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),tk(this,!0)),tb.Z.N.call(this)},t.Ca=function(){this.u||(this.B||this.v||this.j?tS(this):this.Xa())},t.Xa=function(){tS(this)},t.isActive=function(){return!!this.g},t.ca=function(){try{return tA(this)>2?this.g.status:-1}catch(e){return -1}},t.la=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},t.La=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),eh(t)}},t.ya=function(){return this.o},t.Ha=function(){return"string"==typeof this.l?this.l:String(this.l)},(t=tP.prototype).ka=8,t.I=1,t.connect=function(e,t,n,r){eE(0),this.W=e,this.H=t||{},n&&void 0!==r&&(this.H.OSID=n,this.H.OAID=r),this.F=this.X,this.J=tG(this,null,this.W),tL(this)},t.Ea=function(e){if(this.m)if(this.m=null,1==this.I){if(!e){this.V=Math.floor(1e5*Math.random()),e=this.V++;let i=new eP(this,this.j,e),s=this.o;if(this.U&&(s?q(s=B(s),this.U):s=this.U),null!==this.u||this.R||(i.J=s,s=null),this.S)e:{for(var t=0,n=0;n<this.i.length;n++){t:{var r=this.i[n];if("__data__"in r.map&&"string"==typeof(r=r.map.__data__)){r=r.length;break t}r=void 0}if(void 0===r)break;if((t+=r)>4096){t=n;break e}if(4096===t||n===this.i.length-1){t=n+1;break e}}t=1e3}else t=1e3;t=tF(this,i,t),e3(n=e0(this.J),"RID",e),e3(n,"CVER",22),this.G&&e3(n,"X-HTTP-Session-Id",this.G),tU(this,n),s&&(this.R?t="headers="+eN(tv(s))+"&"+t:this.u&&tw(n,this.u,s)),eQ(this.h,i),this.Ra&&e3(n,"TYPE","init"),this.S?(e3(n,"$req",t),e3(n,"SID","null"),i.U=!0,eL(i,n,null)):eL(i,n,t),this.I=2}}else 3==this.I&&(e?tM(this,e):0==this.i.length||eW(this.h)||tM(this))},t.Da=function(){if(this.v=null,tq(this),this.aa&&!(this.P||null==this.g||this.T<=0)){var e=4*this.T;this.j.info("BP detection timer enabled: "+e),this.B=eI(h(this.Wa,this),e)}},t.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,eE(10),tO(this),tq(this))},t.Va=function(){null!=this.C&&(this.C=null,tO(this),tB(this),eE(19))},t.bb=function(e){e?(this.j.info("Successfully pinged google.com"),eE(2)):(this.j.info("Failed to ping google.com"),eE(1))},t.isActive=function(){return!!this.l&&this.l.isActive(this)},(t=tY.prototype).ra=function(){},t.qa=function(){},t.pa=function(){},t.oa=function(){},t.isActive=function(){return!0},t.Ka=function(){},tX.prototype.g=function(e,t){return new tJ(e,t)},c(tJ,et),tJ.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},tJ.prototype.close=function(){tD(this.g)},tJ.prototype.o=function(e){var t=this.g;if("string"==typeof e){var n={};n.__data__=e,e=n}else this.v&&((n={}).__data__=el(e),e=n);t.i.push(new e$(t.Ya++,e)),3==t.I&&tL(t)},tJ.prototype.N=function(){this.g.l=null,delete this.j,tD(this.g),delete this.g,tJ.Z.N.call(this)},c(tZ,ep),c(t0,eg),c(t1,tY),t1.prototype.ra=function(){en(this.g,"a")},t1.prototype.qa=function(e){en(this.g,new tZ(e))},t1.prototype.pa=function(e){en(this.g,new t0)},t1.prototype.oa=function(){en(this.g,"b")},tX.prototype.createWebChannel=tX.prototype.g,tJ.prototype.send=tJ.prototype.o,tJ.prototype.open=tJ.prototype.m,tJ.prototype.close=tJ.prototype.close,N=iR.createWebChannelTransport=function(){return new tX},R=iR.getStatEventTarget=function(){return e_()},A=iR.Event=em,k=iR.Stat={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},ek.NO_ERROR=0,ek.TIMEOUT=8,ek.HTTP_ERROR=6,S=iR.ErrorCode=ek,eA.COMPLETE="complete",C=iR.EventType=eA,ed.EventType=ef,ef.OPEN="a",ef.CLOSE="b",ef.ERROR="c",ef.MESSAGE="d",et.prototype.listen=et.prototype.J,I=iR.WebChannel=ed,iR.FetchXmlHttpFactory=tp,tb.prototype.listenOnce=tb.prototype.K,tb.prototype.getLastError=tb.prototype.Ha,tb.prototype.getLastErrorCode=tb.prototype.ya,tb.prototype.getStatus=tb.prototype.ca,tb.prototype.getResponseJson=tb.prototype.La,tb.prototype.getResponseText=tb.prototype.la,tb.prototype.send=tb.prototype.ea,tb.prototype.setWithCredentials=tb.prototype.Fa,T=iR.XhrIo=tb}).apply(void 0!==iA?iA:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});let iN="@firebase/firestore",iP="4.9.3";class iD{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}iD.UNAUTHENTICATED=new iD(null),iD.GOOGLE_CREDENTIALS=new iD("google-credentials-uid"),iD.FIRST_PARTY=new iD("first-party-uid"),iD.MOCK_USER=new iD("mock-user");let iO="12.7.0",ix=new eH("@firebase/firestore");function iL(){return ix.logLevel}function iM(e,...t){if(ix.logLevel<=w.DEBUG){let n=t.map(iV);ix.debug(`Firestore (${iO}): ${e}`,...n)}}function iU(e,...t){if(ix.logLevel<=w.ERROR){let n=t.map(iV);ix.error(`Firestore (${iO}): ${e}`,...n)}}function iF(e,...t){if(ix.logLevel<=w.WARN){let n=t.map(iV);ix.warn(`Firestore (${iO}): ${e}`,...n)}}function iV(e){if("string"==typeof e)return e;try{return JSON.stringify(e)}catch(t){return e}}function iB(e,t,n){let r="Unexpected state";"string"==typeof t?r=t:n=t,ij(e,r,n)}function ij(e,t,n){let r=`FIRESTORE (${iO}) INTERNAL ASSERTION FAILED: ${t} (ID: ${e.toString(16)})`;if(void 0!==n)try{r+=" CONTEXT: "+JSON.stringify(n)}catch(e){r+=" CONTEXT: "+n}throw iU(r),Error(r)}function iq(e,t,n,r){let i="Unexpected state";"string"==typeof n?i=n:r=n,e||ij(t,i,r)}let iz={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class i$ extends ef{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class iH{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class iW{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class iK{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(iD.UNAUTHENTICATED))}shutdown(){}}class iG{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class iQ{constructor(e){this.t=e,this.currentUser=iD.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){iq(void 0===this.o,42304);let n=this.i,r=e=>this.i!==n?(n=this.i,t(e)):Promise.resolve(),i=new iH;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new iH,e.enqueueRetryable(()=>r(this.currentUser))};let s=()=>{let t=i;e.enqueueRetryable(async()=>{await t.promise,await r(this.currentUser)})},o=e=>{iM("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.o&&(this.auth.addAuthTokenListener(this.o),s())};this.t.onInit(e=>o(e)),setTimeout(()=>{if(!this.auth){let e=this.t.getImmediate({optional:!0});e?o(e):(iM("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new iH)}},0),s()}getToken(){let e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(t=>this.i!==e?(iM("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(iq("string"==typeof t.accessToken,31837,{l:t}),new iW(t.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){let e=this.auth&&this.auth.getUid();return iq(null===e||"string"==typeof e,2055,{h:e}),new iD(e)}}class iY{constructor(e,t,n){this.P=e,this.T=t,this.I=n,this.type="FirstParty",this.user=iD.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);let e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class iX{constructor(e,t,n){this.P=e,this.T=t,this.I=n}getToken(){return Promise.resolve(new iY(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable(()=>t(iD.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class iJ{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class iZ{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,tu(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){iq(void 0===this.o,3512);let n=e=>{null!=e.error&&iM("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`);let n=e.token!==this.m;return this.m=e.token,iM("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?t(e.token):Promise.resolve()};this.o=t=>{e.enqueueRetryable(()=>n(t))};let r=e=>{iM("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(e=>r(e)),setTimeout(()=>{if(!this.appCheck){let e=this.V.getImmediate({optional:!0});e?r(e):iM("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new iJ(this.p));let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(e=>e?(iq("string"==typeof e.token,44558,{tokenResult:e}),this.m=e.token,new iJ(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}class i0{static newId(){let e=62*Math.floor(256/62),t="";for(;t.length<20;){let n=function(e){let t="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(40);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(n);else for(let e=0;e<40;e++)n[e]=Math.floor(256*Math.random());return n}(0);for(let r=0;r<n.length;++r)t.length<20&&n[r]<e&&(t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(n[r]%62))}return t}}function i1(e,t){return e<t?-1:+(e>t)}function i2(e,t){let n=Math.min(e.length,t.length);for(let r=0;r<n;r++){let n=e.charAt(r),i=t.charAt(r);if(n!==i)return i6(n)===i6(i)?i1(n,i):i6(n)?1:-1}return i1(e.length,t.length)}function i6(e){let t=e.charCodeAt(0);return t>=55296&&t<=57343}function i3(e,t,n){return e.length===t.length&&e.every((e,r)=>n(e,t[r]))}let i4="__name__";class i5{constructor(e,t,n){void 0===t?t=0:t>e.length&&iB(637,{offset:t,range:e.length}),void 0===n?n=e.length-t:n>e.length-t&&iB(1746,{length:n,range:e.length-t}),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===i5.comparator(this,e)}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof i5?e.forEach(e=>{t.push(e)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let n=Math.min(e.length,t.length);for(let r=0;r<n;r++){let n=i5.compareSegments(e.get(r),t.get(r));if(0!==n)return n}return i1(e.length,t.length)}static compareSegments(e,t){let n=i5.isNumericId(e),r=i5.isNumericId(t);return n&&!r?-1:!n&&r?1:n&&r?i5.extractNumericId(e).compare(i5.extractNumericId(t)):i2(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return b.fromString(e.substring(4,e.length-2))}}class i8 extends i5{construct(e,t,n){return new i8(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let n of e){if(n.indexOf("//")>=0)throw new i$(iz.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter(e=>e.length>0))}return new i8(t)}static emptyPath(){return new i8([])}}let i7=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class i9 extends i5{construct(e,t,n){return new i9(e,t,n)}static isValidIdentifier(e){return i7.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),i9.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&this.get(0)===i4}static keyField(){return new i9([i4])}static fromServerFormat(e){let t=[],n="",r=0,i=()=>{if(0===n.length)throw new i$(iz.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""},s=!1;for(;r<e.length;){let t=e[r];if("\\"===t){if(r+1===e.length)throw new i$(iz.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let t=e[r+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new i$(iz.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=t,r+=2}else"`"===t?s=!s:"."!==t||s?n+=t:i(),r++}if(i(),s)throw new i$(iz.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new i9(t)}static emptyPath(){return new i9([])}}class se{constructor(e){this.path=e}static fromPath(e){return new se(i8.fromString(e))}static fromName(e){return new se(i8.fromString(e).popFirst(5))}static empty(){return new se(i8.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===i8.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return i8.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new se(new i8(e.slice()))}}function st(e,t,n){if(!n)throw new i$(iz.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function sn(e){if(!se.isDocumentKey(e))throw new i$(iz.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function sr(e){if(se.isDocumentKey(e))throw new i$(iz.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function si(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}function ss(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{var t;let n=(t=e).constructor?t.constructor.name:null;return n?`a custom ${n} object`:"an object"}}return"function"==typeof e?"a function":iB(12329,{type:typeof e})}function so(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new i$(iz.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let n=ss(e);throw new i$(iz.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${n}`)}}return e}function sa(e,t){let n={typeString:e};return t&&(n.value=t),n}function sl(e,t){let n;if(!si(e))throw new i$(iz.INVALID_ARGUMENT,"JSON must be an object");for(let r in t)if(t[r]){let i=t[r].typeString,s="value"in t[r]?{value:t[r].value}:void 0;if(!(r in e)){n=`JSON missing required field: '${r}'`;break}let o=e[r];if(i&&typeof o!==i){n=`JSON field '${r}' must be a ${i}.`;break}if(void 0!==s&&o!==s.value){n=`Expected '${r}' field to equal '${s.value}'`;break}}if(n)throw new i$(iz.INVALID_ARGUMENT,n);return!0}class sh{static now(){return sh.fromMillis(Date.now())}static fromDate(e){return sh.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),n=Math.floor((e-1e3*t)*1e6);return new sh(t,n)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0||t>=1e9)throw new i$(iz.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-0xe7791f700||e>=0x3afff44180)throw new i$(iz.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?i1(this.nanoseconds,e.nanoseconds):i1(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:sh._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(sl(e,sh._jsonSchema))return new sh(e.seconds,e.nanoseconds)}valueOf(){return String(this.seconds- -0xe7791f700).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}sh._jsonSchemaVersion="firestore/timestamp/1.0",sh._jsonSchema={type:sa("string",sh._jsonSchemaVersion),seconds:sa("number"),nanoseconds:sa("number")};class su{static fromTimestamp(e){return new su(e)}static min(){return new su(new sh(0,0))}static max(){return new su(new sh(0x3afff4417f,0x3b9ac9ff))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class sc{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new sc(su.min(),se.empty(),-1)}static max(){return new sc(su.max(),se.empty(),-1)}}class sd{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}async function sf(e){if(e.code!==iz.FAILED_PRECONDITION||"The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab."!==e.message)throw e;iM("LocalStore","Unexpectedly lost primary lease")}class sp{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&iB(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new sp((n,r)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(n,r)},this.catchCallback=e=>{this.wrapFailure(t,e).next(n,r)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof sp?t:sp.resolve(t)}catch(e){return sp.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):sp.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):sp.reject(t)}static resolve(e){return new sp((t,n)=>{t(e)})}static reject(e){return new sp((t,n)=>{n(e)})}static waitFor(e){return new sp((t,n)=>{let r=0,i=0,s=!1;e.forEach(e=>{++r,e.next(()=>{++i,s&&i===r&&t()},e=>n(e))}),s=!0,i===r&&t()})}static or(e){let t=sp.resolve(!1);for(let n of e)t=t.next(e=>e?sp.resolve(e):n());return t}static forEach(e,t){let n=[];return e.forEach((e,r)=>{n.push(t.call(this,e,r))}),this.waitFor(n)}static mapArray(e,t){return new sp((n,r)=>{let i=e.length,s=Array(i),o=0;for(let a=0;a<i;a++){let l=a;t(e[l]).next(e=>{s[l]=e,++o===i&&n(s)},e=>r(e))}})}static doWhile(e,t){return new sp((n,r)=>{let i=()=>{!0===e()?t().next(()=>{i()},r):n()};i()})}}function sg(e){return"IndexedDbTransactionError"===e.name}class sm{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.ae(e),this.ue=e=>t.writeSequenceNumber(e))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){let e=++this.previousValue;return this.ue&&this.ue(e),e}}sm.ce=-1;function sy(e){return 0===e&&1/e==-1/0}function s_(e){let t=0;for(let n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function sv(e,t){for(let n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function sw(e){for(let t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}class sb{constructor(e,t){this.comparator=e,this.root=t||sT.EMPTY}insert(e,t){return new sb(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,sT.BLACK,null,null))}remove(e){return new sb(this.comparator,this.root.remove(e,this.comparator).copy(null,null,sT.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){let r=this.comparator(e,n.key);if(0===r)return t+n.left.size;r<0?n=n.left:(t+=n.left.size+1,n=n.right)}return -1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,n)=>(e(t,n),!1))}toString(){let e=[];return this.inorderTraversal((t,n)=>(e.push(`${t}:${n}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new sE(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new sE(this.root,e,this.comparator,!1)}getReverseIterator(){return new sE(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new sE(this.root,e,this.comparator,!0)}}class sE{constructor(e,t,n,r){this.isReverse=r,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?n(e.key,t):1,t&&r&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(0===i){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class sT{constructor(e,t,n,r,i){this.key=e,this.value=t,this.color=null!=n?n:sT.RED,this.left=null!=r?r:sT.EMPTY,this.right=null!=i?i:sT.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,r,i){return new sT(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this,i=n(e,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n))).fixUp()}removeMin(){if(this.left.isEmpty())return sT.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),(e=e.copy(null,null,null,e.left.removeMin(),null)).fixUp()}remove(e,t){let n,r=this;if(0>t(e,r.key))r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===t(e,r.key)){if(r.right.isEmpty())return sT.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=(e=(e=e.copy(null,null,null,null,e.right.rotateRight())).rotateLeft()).colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=(e=e.rotateRight()).colorFlip()),e}rotateLeft(){let e=this.copy(null,null,sT.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){let e=this.copy(null,null,sT.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){return Math.pow(2,this.check())<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw iB(43730,{key:this.key,value:this.value});if(this.right.isRed())throw iB(14113,{key:this.key,value:this.value});let e=this.left.check();if(e!==this.right.check())throw iB(27949);return e+ +!this.isRed()}}sT.EMPTY=null,sT.RED=!0,sT.BLACK=!1,sT.EMPTY=new class{constructor(){this.size=0}get key(){throw iB(57766)}get value(){throw iB(16141)}get color(){throw iB(16727)}get left(){throw iB(29726)}get right(){throw iB(36894)}copy(e,t,n,r,i){return this}insert(e,t,n){return new sT(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class sI{constructor(e){this.comparator=e,this.data=new sb(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,n)=>(e(t),!1))}forEachInRange(e,t){let n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){let r=n.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new sC(this.data.getIterator())}getIteratorFrom(e){return new sC(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(e=>{t=t.add(e)}),t}isEqual(e){if(!(e instanceof sI)||this.size!==e.size)return!1;let t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){let e=t.getNext().key,r=n.getNext().key;if(0!==this.comparator(e,r))return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new sI(this.comparator);return t.data=e,t}}class sC{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class sS{constructor(e){this.fields=e,e.sort(i9.comparator)}static empty(){return new sS([])}unionWith(e){let t=new sI(i9.comparator);for(let e of this.fields)t=t.add(e);for(let n of e)t=t.add(n);return new sS(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return i3(this.fields,e.fields,(e,t)=>e.isEqual(t))}}class sk extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class sA{constructor(e){this.binaryString=e}static fromBase64String(e){return new sA(function(e){try{return atob(e)}catch(e){throw"undefined"!=typeof DOMException&&e instanceof DOMException?new sk("Invalid base64 string: "+e):e}}(e))}static fromUint8Array(e){return new sA(function(e){let t="";for(let n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e))}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return btoa(this.binaryString)}toUint8Array(){var e=this.binaryString;let t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return i1(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}sA.EMPTY_BYTE_STRING=new sA("");let sR=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function sN(e){if(iq(!!e,39018),"string"==typeof e){let t=0,n=sR.exec(e);if(iq(!!n,46558,{timestamp:e}),n[1]){let e=n[1];t=Number(e=(e+"000000000").substr(0,9))}return{seconds:Math.floor(new Date(e).getTime()/1e3),nanos:t}}return{seconds:sP(e.seconds),nanos:sP(e.nanos)}}function sP(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function sD(e){return"string"==typeof e?sA.fromBase64String(e):sA.fromUint8Array(e)}let sO="server_timestamp",sx="__type__",sL="__previous_value__",sM="__local_write_time__";function sU(e){return(e?.mapValue?.fields||{})[sx]?.stringValue===sO}function sF(e){let t=e.mapValue.fields[sL];return sU(t)?sF(t):t}function sV(e){let t=sN(e.mapValue.fields[sM].timestampValue);return new sh(t.seconds,t.nanos)}class sB{constructor(e,t,n,r,i,s,o,a,l,h){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=s,this.autoDetectLongPolling=o,this.longPollingOptions=a,this.useFetchStreams=l,this.isUsingEmulator=h}}let sj="(default)";class sq{constructor(e,t){this.projectId=e,this.database=t||sj}static empty(){return new sq("","")}get isDefaultDatabase(){return this.database===sj}isEqual(e){return e instanceof sq&&e.projectId===this.projectId&&e.database===this.database}}let sz="__type__",s$="__max__",sH={},sW="__vector__",sK="value";function sG(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?sU(e)?4:s9(e)?0x1fffffffffffff:s8(e)?10:11:iB(28295,{value:e})}function sQ(e,t){if(e===t)return!0;let n=sG(e);if(n!==sG(t))return!1;switch(n){case 0:case 0x1fffffffffffff:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return sV(e).isEqual(sV(t));case 3:if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;let r=sN(e.timestampValue),i=sN(t.timestampValue);return r.seconds===i.seconds&&r.nanos===i.nanos;case 5:return e.stringValue===t.stringValue;case 6:return sD(e.bytesValue).isEqual(sD(t.bytesValue));case 7:return e.referenceValue===t.referenceValue;case 8:return sP(e.geoPointValue.latitude)===sP(t.geoPointValue.latitude)&&sP(e.geoPointValue.longitude)===sP(t.geoPointValue.longitude);case 2:if("integerValue"in e&&"integerValue"in t)return sP(e.integerValue)===sP(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){let n=sP(e.doubleValue),r=sP(t.doubleValue);return n===r?sy(n)===sy(r):isNaN(n)&&isNaN(r)}return!1;case 9:return i3(e.arrayValue.values||[],t.arrayValue.values||[],sQ);case 10:case 11:let s=e.mapValue.fields||{},o=t.mapValue.fields||{};if(s_(s)!==s_(o))return!1;for(let e in s)if(s.hasOwnProperty(e)&&(void 0===o[e]||!sQ(s[e],o[e])))return!1;return!0;default:return iB(52216,{left:e})}}function sY(e,t){return void 0!==(e.values||[]).find(e=>sQ(e,t))}function sX(e,t){var n,r,i,s,o,a;if(e===t)return 0;let l=sG(e),h=sG(t);if(l!==h)return i1(l,h);switch(l){case 0:case 0x1fffffffffffff:return 0;case 1:return i1(e.booleanValue,t.booleanValue);case 2:let u,c;return u=sP(e.integerValue||e.doubleValue),u<(c=sP(t.integerValue||t.doubleValue))?-1:u>c?1:u===c?0:isNaN(u)?isNaN(c)?0:-1:1;case 3:return sJ(e.timestampValue,t.timestampValue);case 4:return sJ(sV(e),sV(t));case 5:return i2(e.stringValue,t.stringValue);case 6:let d,f;return n=e.bytesValue,r=t.bytesValue,d=sD(n),f=sD(r),d.compareTo(f);case 7:return function(e,t){let n=e.split("/"),r=t.split("/");for(let e=0;e<n.length&&e<r.length;e++){let t=i1(n[e],r[e]);if(0!==t)return t}return i1(n.length,r.length)}(e.referenceValue,t.referenceValue);case 8:let p;return i=e.geoPointValue,s=t.geoPointValue,0!==(p=i1(sP(i.latitude),sP(s.latitude)))?p:i1(sP(i.longitude),sP(s.longitude));case 9:return sZ(e.arrayValue,t.arrayValue);case 10:let g,m,y,_,v;return o=e.mapValue,a=t.mapValue,g=o.fields||{},m=a.fields||{},y=g[sK]?.arrayValue,_=m[sK]?.arrayValue,0!==(v=i1(y?.values?.length||0,_?.values?.length||0))?v:sZ(y,_);case 11:return function(e,t){if(e===sH&&t===sH)return 0;if(e===sH)return 1;if(t===sH)return -1;let n=e.fields||{},r=Object.keys(n),i=t.fields||{},s=Object.keys(i);r.sort(),s.sort();for(let e=0;e<r.length&&e<s.length;++e){let t=i2(r[e],s[e]);if(0!==t)return t;let o=sX(n[r[e]],i[s[e]]);if(0!==o)return o}return i1(r.length,s.length)}(e.mapValue,t.mapValue);default:throw iB(23264,{he:l})}}function sJ(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return i1(e,t);let n=sN(e),r=sN(t),i=i1(n.seconds,r.seconds);return 0!==i?i:i1(n.nanos,r.nanos)}function sZ(e,t){let n=e.values||[],r=t.values||[];for(let e=0;e<n.length&&e<r.length;++e){let t=sX(n[e],r[e]);if(t)return t}return i1(n.length,r.length)}function s0(e){var t,n;let r;return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?(r=sN(e.timestampValue),`time(${r.seconds},${r.nanos})`):"stringValue"in e?e.stringValue:"bytesValue"in e?sD(e.bytesValue).toBase64():"referenceValue"in e?(t=e.referenceValue,se.fromName(t).toString()):"geoPointValue"in e?(n=e.geoPointValue,`geo(${n.latitude},${n.longitude})`):"arrayValue"in e?function(e){let t="[",n=!0;for(let r of e.values||[])n?n=!1:t+=",",t+=s0(r);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){let t=Object.keys(e.fields||{}).sort(),n="{",r=!0;for(let i of t)r?r=!1:n+=",",n+=`${i}:${s0(e.fields[i])}`;return n+"}"}(e.mapValue):iB(61005,{value:e})}function s1(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/${t.path.canonicalString()}`}}function s2(e){return!!e&&"integerValue"in e}function s6(e){return!!e&&"arrayValue"in e}function s3(e){return!!e&&"nullValue"in e}function s4(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function s5(e){return!!e&&"mapValue"in e}function s8(e){return(e?.mapValue?.fields||{})[sz]?.stringValue===sW}function s7(e){if(e.geoPointValue)return{geoPointValue:{...e.geoPointValue}};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:{...e.timestampValue}};if(e.mapValue){let t={mapValue:{fields:{}}};return sv(e.mapValue.fields,(e,n)=>t.mapValue.fields[e]=s7(n)),t}if(e.arrayValue){let t={arrayValue:{values:[]}};for(let n=0;n<(e.arrayValue.values||[]).length;++n)t.arrayValue.values[n]=s7(e.arrayValue.values[n]);return t}return{...e}}function s9(e){return(((e.mapValue||{}).fields||{}).__type__||{}).stringValue===s$}class oe{constructor(e){this.value=e}static empty(){return new oe({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(!s5(t=(t.mapValue.fields||{})[e.get(n)]))return null;return(t=(t.mapValue.fields||{})[e.lastSegment()])||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=s7(t)}setAll(e){let t=i9.emptyPath(),n={},r=[];e.forEach((e,i)=>{if(!t.isImmediateParentOf(i)){let e=this.getFieldsMap(t);this.applyChanges(e,n,r),n={},r=[],t=i.popLast()}e?n[i.lastSegment()]=s7(e):r.push(i.lastSegment())});let i=this.getFieldsMap(t);this.applyChanges(i,n,r)}delete(e){let t=this.field(e.popLast());s5(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return sQ(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let r=t.mapValue.fields[e.get(n)];s5(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,n){for(let r of(sv(t,(t,n)=>e[t]=n),n))delete e[r]}clone(){return new oe(s7(this.value))}}class ot{constructor(e,t,n,r,i,s,o){this.key=e,this.documentType=t,this.version=n,this.readTime=r,this.createTime=i,this.data=s,this.documentState=o}static newInvalidDocument(e){return new ot(e,0,su.min(),su.min(),su.min(),oe.empty(),0)}static newFoundDocument(e,t,n,r){return new ot(e,1,t,su.min(),n,r,0)}static newNoDocument(e,t){return new ot(e,2,t,su.min(),su.min(),oe.empty(),0)}static newUnknownDocument(e,t){return new ot(e,3,t,su.min(),su.min(),oe.empty(),2)}convertToFoundDocument(e,t){return this.createTime.isEqual(su.min())&&(2===this.documentType||0===this.documentType)&&(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=oe.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=oe.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=su.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof ot&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new ot(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class on{constructor(e,t){this.position=e,this.inclusive=t}}function or(e,t,n){let r=0;for(let i=0;i<e.position.length;i++){let s=t[i],o=e.position[i];if(r=s.field.isKeyField()?se.comparator(se.fromName(o.referenceValue),n.key):sX(o,n.data.field(s.field)),"desc"===s.dir&&(r*=-1),0!==r)break}return r}function oi(e,t){if(null===e)return null===t;if(null===t||e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let n=0;n<e.position.length;n++)if(!sQ(e.position[n],t.position[n]))return!1;return!0}class os{constructor(e,t="asc"){this.field=e,this.dir=t}}class oo{}class oa extends oo{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,n):new oc(e,t,n):"array-contains"===t?new og(e,n):"in"===t?new om(e,n):"not-in"===t?new oy(e,n):"array-contains-any"===t?new o_(e,n):new oa(e,t,n)}static createKeyFieldInFilter(e,t,n){return"in"===t?new od(e,n):new of(e,n)}matches(e){let t=e.data.field(this.field);return"!="===this.op?null!==t&&void 0===t.nullValue&&this.matchesComparison(sX(t,this.value)):null!==t&&sG(this.value)===sG(t)&&this.matchesComparison(sX(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return iB(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class ol extends oo{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new ol(e,t)}matches(e){return oh(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.Pe||(this.Pe=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function oh(e){return"and"===e.op}function ou(e){for(let t of e.filters)if(t instanceof ol)return!1;return!0}class oc extends oa{constructor(e,t,n){super(e,t,n),this.key=se.fromName(n.referenceValue)}matches(e){let t=se.comparator(e.key,this.key);return this.matchesComparison(t)}}class od extends oa{constructor(e,t){super(e,"in",t),this.keys=op("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class of extends oa{constructor(e,t){super(e,"not-in",t),this.keys=op("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function op(e,t){return(t.arrayValue?.values||[]).map(e=>se.fromName(e.referenceValue))}class og extends oa{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return s6(t)&&sY(t.arrayValue,this.value)}}class om extends oa{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return null!==t&&sY(this.value.arrayValue,t)}}class oy extends oa{constructor(e,t){super(e,"not-in",t)}matches(e){if(sY(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return null!==t&&void 0===t.nullValue&&!sY(this.value.arrayValue,t)}}class o_ extends oa{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!(!s6(t)||!t.arrayValue.values)&&t.arrayValue.values.some(e=>sY(this.value.arrayValue,e))}}class ov{constructor(e,t=null,n=[],r=[],i=null,s=null,o=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=s,this.endAt=o,this.Te=null}}function ow(e,t=null,n=[],r=[],i=null,s=null,o=null){return new ov(e,t,n,r,i,s,o)}function ob(e){if(null===e.Te){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(e=>(function e(t){if(t instanceof oa)return t.field.canonicalString()+t.op.toString()+s0(t.value);if(ou(t)&&oh(t))return t.filters.map(t=>e(t)).join(",");{let n=t.filters.map(t=>e(t)).join(",");return`${t.op}(${n})`}})(e)).join(","),t+="|ob:",t+=e.orderBy.map(e=>e.field.canonicalString()+e.dir).join(","),null==e.limit||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(e=>s0(e)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(e=>s0(e)).join(",")),e.Te=t}return e.Te}function oE(e,t){if(e.limit!==t.limit||e.orderBy.length!==t.orderBy.length)return!1;for(let i=0;i<e.orderBy.length;i++){var n,r;if(n=e.orderBy[i],r=t.orderBy[i],!(n.dir===r.dir&&n.field.isEqual(r.field)))return!1}if(e.filters.length!==t.filters.length)return!1;for(let n=0;n<e.filters.length;n++)if(!function e(t,n){return t instanceof oa?n instanceof oa&&t.op===n.op&&t.field.isEqual(n.field)&&sQ(t.value,n.value):t instanceof ol?n instanceof ol&&t.op===n.op&&t.filters.length===n.filters.length&&t.filters.reduce((t,r,i)=>t&&e(r,n.filters[i]),!0):void iB(19439)}(e.filters[n],t.filters[n]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!oi(e.startAt,t.startAt)&&oi(e.endAt,t.endAt)}function oT(e){return se.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}class oI{constructor(e,t=null,n=[],r=[],i=null,s="F",o=null,a=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=s,this.startAt=o,this.endAt=a,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function oC(e){return new oI(e)}function oS(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function ok(e){return null!==e.collectionGroup}function oA(e){if(null===e.Ie){let t;e.Ie=[];let n=new Set;for(let t of e.explicitOrderBy)e.Ie.push(t),n.add(t.field.canonicalString());let r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(t=new sI(i9.comparator),e.filters.forEach(e=>{e.getFlattenedFilters().forEach(e=>{e.isInequality()&&(t=t.add(e.field))})}),t).forEach(t=>{n.has(t.canonicalString())||t.isKeyField()||e.Ie.push(new os(t,r))}),n.has(i9.keyField().canonicalString())||e.Ie.push(new os(i9.keyField(),r))}return e.Ie}function oR(e){return e.Ee||(e.Ee=function(e,t){if("F"===e.limitType)return ow(e.path,e.collectionGroup,t,e.filters,e.limit,e.startAt,e.endAt);{t=t.map(e=>{let t="desc"===e.dir?"asc":"desc";return new os(e.field,t)});let n=e.endAt?new on(e.endAt.position,e.endAt.inclusive):null,r=e.startAt?new on(e.startAt.position,e.startAt.inclusive):null;return ow(e.path,e.collectionGroup,t,e.filters,e.limit,n,r)}}(e,oA(e))),e.Ee}function oN(e,t){let n=e.filters.concat([t]);return new oI(e.path,e.collectionGroup,e.explicitOrderBy.slice(),n,e.limit,e.limitType,e.startAt,e.endAt)}function oP(e,t,n){return new oI(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function oD(e,t){return oE(oR(e),oR(t))&&e.limitType===t.limitType}function oO(e){return`${ob(oR(e))}|lt:${e.limitType}`}function ox(e){var t;let n;return`Query(target=${n=(t=oR(e)).path.canonicalString(),null!==t.collectionGroup&&(n+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(n+=`, filters: [${t.filters.map(e=>(function e(t){return t instanceof oa?`${t.field.canonicalString()} ${t.op} ${s0(t.value)}`:t instanceof ol?t.op.toString()+" {"+t.getFilters().map(e).join(" ,")+"}":"Filter"})(e)).join(", ")}]`),null==t.limit||(n+=", limit: "+t.limit),t.orderBy.length>0&&(n+=`, orderBy: [${t.orderBy.map(e=>`${e.field.canonicalString()} (${e.dir})`).join(", ")}]`),t.startAt&&(n+=", startAt: ",n+=t.startAt.inclusive?"b:":"a:",n+=t.startAt.position.map(e=>s0(e)).join(",")),t.endAt&&(n+=", endAt: ",n+=t.endAt.inclusive?"a:":"b:",n+=t.endAt.position.map(e=>s0(e)).join(",")),`Target(${n})`}; limitType=${e.limitType})`}function oL(e,t){var n,r,i,s;let o,a,l;return t.isFoundDocument()&&(o=t.key.path,null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(o):se.isDocumentKey(e.path)?e.path.isEqual(o):e.path.isImmediateParentOf(o))&&function(e,t){for(let n of oA(e))if(!n.field.isKeyField()&&null===t.data.field(n.field))return!1;return!0}(e,t)&&function(e,t){for(let n of e.filters)if(!n.matches(t))return!1;return!0}(e,t)&&(n=e,r=t,(!n.startAt||(i=n.startAt,a=or(i,oA(n),r),i.inclusive?!!(a<=0):!!(a<0)))&&(!n.endAt||(s=n.endAt,l=or(s,oA(n),r),s.inclusive?!!(l>=0):!!(l>0))))}function oM(e){return(t,n)=>{let r=!1;for(let i of oA(e)){let e=function(e,t,n){var r;let i,s,o=e.field.isKeyField()?se.comparator(t.key,n.key):(r=e.field,i=t.data.field(r),s=n.data.field(r),null!==i&&null!==s?sX(i,s):iB(42886));switch(e.dir){case"asc":return o;case"desc":return -1*o;default:return iB(19790,{direction:e.dir})}}(i,t,n);if(0!==e)return e;r=r||i.field.isKeyField()}return 0}}class oU{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n){for(let[t,r]of n)if(this.equalsFn(t,e))return r}}has(e){return void 0!==this.get(e)}set(e,t){let n=this.mapKeyFn(e),r=this.inner[n];if(void 0===r)return this.inner[n]=[[e,t]],void this.innerSize++;for(let n=0;n<r.length;n++)if(this.equalsFn(r[n][0],e))return void(r[n]=[e,t]);r.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return 1===n.length?delete this.inner[t]:n.splice(r,1),this.innerSize--,!0;return!1}forEach(e){sv(this.inner,(t,n)=>{for(let[t,r]of n)e(t,r)})}isEmpty(){return sw(this.inner)}size(){return this.innerSize}}let oF=new sb(se.comparator),oV=new sb(se.comparator);function oB(...e){let t=oV;for(let n of e)t=t.insert(n.key,n);return t}function oj(e){let t=oV;return e.forEach((e,n)=>t=t.insert(e,n.overlayedDocument)),t}function oq(){return new oU(e=>e.toString(),(e,t)=>e.isEqual(t))}let oz=new sb(se.comparator),o$=new sI(se.comparator);function oH(...e){let t=o$;for(let n of e)t=t.add(n);return t}let oW=new sI(i1);function oK(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:sy(t)?"-0":t}}function oG(e){return{integerValue:""+e}}class oQ{constructor(){this._=void 0}}function oY(e,t){return e instanceof o2?s2(t)||t&&"doubleValue"in t?t:{integerValue:0}:null}class oX extends oQ{}class oJ extends oQ{constructor(e){super(),this.elements=e}}function oZ(e,t){let n=o3(t);for(let t of e.elements)n.some(e=>sQ(e,t))||n.push(t);return{arrayValue:{values:n}}}class o0 extends oQ{constructor(e){super(),this.elements=e}}function o1(e,t){let n=o3(t);for(let t of e.elements)n=n.filter(e=>!sQ(e,t));return{arrayValue:{values:n}}}class o2 extends oQ{constructor(e,t){super(),this.serializer=e,this.Ae=t}}function o6(e){return sP(e.integerValue||e.doubleValue)}function o3(e){return s6(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class o4{constructor(e,t){this.version=e,this.transformResults=t}}class o5{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new o5}static exists(e){return new o5(void 0,e)}static updateTime(e){return new o5(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function o8(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class o7{}function o9(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new aa(e.key,o5.none()):new an(e.key,e.data,o5.none());{let n=e.data,r=oe.empty(),i=new sI(i9.comparator);for(let e of t.fields)if(!i.has(e)){let t=n.field(e);null===t&&e.length>1&&(e=e.popLast(),t=n.field(e)),null===t?r.delete(e):r.set(e,t),i=i.add(e)}return new ar(e.key,r,new sS(i.toArray()),o5.none())}}function ae(e,t,n,r){return e instanceof an?function(e,t,n,r){if(!o8(e.precondition,t))return n;let i=e.value.clone(),s=ao(e.fieldTransforms,r,t);return i.setAll(s),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null}(e,t,n,r):e instanceof ar?function(e,t,n,r){if(!o8(e.precondition,t))return n;let i=ao(e.fieldTransforms,r,t),s=t.data;return(s.setAll(ai(e)),s.setAll(i),t.convertToFoundDocument(t.version,s).setHasLocalMutations(),null===n)?null:n.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map(e=>e.field))}(e,t,n,r):o8(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):n}function at(e,t){var n,r;return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&(n=e.fieldTransforms,r=t.fieldTransforms,!!(void 0===n&&void 0===r||!(!n||!r)&&i3(n,r,(e,t)=>{var n,r;return e.field.isEqual(t.field)&&(n=e.transform,r=t.transform,n instanceof oJ&&r instanceof oJ||n instanceof o0&&r instanceof o0?i3(n.elements,r.elements,sQ):n instanceof o2&&r instanceof o2?sQ(n.Ae,r.Ae):n instanceof oX&&r instanceof oX)})))&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}class an extends o7{constructor(e,t,n,r=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class ar extends o7{constructor(e,t,n,r,i=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=r,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function ai(e){let t=new Map;return e.fieldMask.fields.forEach(n=>{if(!n.isEmpty()){let r=e.data.field(n);t.set(n,r)}}),t}function as(e,t,n){let r=new Map;iq(e.length===n.length,32656,{Re:n.length,Ve:e.length});for(let s=0;s<n.length;s++){var i;let o=e[s],a=o.transform,l=t.data.field(o.field);r.set(o.field,(i=n[s],a instanceof oJ?oZ(a,l):a instanceof o0?o1(a,l):i))}return r}function ao(e,t,n){let r=new Map;for(let i of e){let e=i.transform,s=n.data.field(i.field);r.set(i.field,function(e,t,n){var r;let i,s,o;return e instanceof oX?(r=t,i={fields:{[sx]:{stringValue:sO},[sM]:{timestampValue:{seconds:n.seconds,nanos:n.nanoseconds}}}},r&&sU(r)&&(r=sF(r)),r&&(i.fields[sL]=r),{mapValue:i}):e instanceof oJ?oZ(e,t):e instanceof o0?o1(e,t):(o=o6(s=oY(e,t))+o6(e.Ae),s2(s)&&s2(e.Ae)?oG(o):oK(e.serializer,o))}(e,s,t))}return r}class aa extends o7{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class al extends o7{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class ah{constructor(e,t,n,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(e,t){let n=t.mutationResults;for(let t=0;t<this.mutations.length;t++){let r=this.mutations[t];r.key.isEqual(e.key)&&function(e,t,n){let r,i;e instanceof an?(r=e.value.clone(),i=as(e.fieldTransforms,t,n.transformResults),r.setAll(i),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()):e instanceof ar?function(e,t,n){if(!o8(e.precondition,t))return t.convertToUnknownDocument(n.version);let r=as(e.fieldTransforms,t,n.transformResults),i=t.data;i.setAll(ai(e)),i.setAll(r),t.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(e,t,n):t.convertToNoDocument(n.version).setHasCommittedMutations()}(r,e,n[t])}}applyToLocalView(e,t){for(let n of this.baseMutations)n.key.isEqual(e.key)&&(t=ae(n,e,t,this.localWriteTime));for(let n of this.mutations)n.key.isEqual(e.key)&&(t=ae(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let n=oq();return this.mutations.forEach(r=>{let i=e.get(r.key),s=i.overlayedDocument,o=this.applyToLocalView(s,i.mutatedFields),a=o9(s,o=t.has(r.key)?null:o);null!==a&&n.set(r.key,a),s.isValidDocument()||s.convertToNoDocument(su.min())}),n}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),oH())}isEqual(e){return this.batchId===e.batchId&&i3(this.mutations,e.mutations,(e,t)=>at(e,t))&&i3(this.baseMutations,e.baseMutations,(e,t)=>at(e,t))}}class au{constructor(e,t,n,r){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=r}static from(e,t,n){iq(e.mutations.length===n.length,58842,{me:e.mutations.length,fe:n.length});let r=oz,i=e.mutations;for(let e=0;e<i.length;e++)r=r.insert(i[e].key,n[e].version);return new au(e,t,n,r)}}class ac{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class ad{constructor(e,t){this.count=e,this.unchangedNames=t}}function af(e){if(void 0===e)return iU("GRPC error has no .code"),iz.UNKNOWN;switch(e){case P.OK:return iz.OK;case P.CANCELLED:return iz.CANCELLED;case P.UNKNOWN:return iz.UNKNOWN;case P.DEADLINE_EXCEEDED:return iz.DEADLINE_EXCEEDED;case P.RESOURCE_EXHAUSTED:return iz.RESOURCE_EXHAUSTED;case P.INTERNAL:return iz.INTERNAL;case P.UNAVAILABLE:return iz.UNAVAILABLE;case P.UNAUTHENTICATED:return iz.UNAUTHENTICATED;case P.INVALID_ARGUMENT:return iz.INVALID_ARGUMENT;case P.NOT_FOUND:return iz.NOT_FOUND;case P.ALREADY_EXISTS:return iz.ALREADY_EXISTS;case P.PERMISSION_DENIED:return iz.PERMISSION_DENIED;case P.FAILED_PRECONDITION:return iz.FAILED_PRECONDITION;case P.ABORTED:return iz.ABORTED;case P.OUT_OF_RANGE:return iz.OUT_OF_RANGE;case P.UNIMPLEMENTED:return iz.UNIMPLEMENTED;case P.DATA_LOSS:return iz.DATA_LOSS;default:return iB(39323,{code:e})}}(D=P||(P={}))[D.OK=0]="OK",D[D.CANCELLED=1]="CANCELLED",D[D.UNKNOWN=2]="UNKNOWN",D[D.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",D[D.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",D[D.NOT_FOUND=5]="NOT_FOUND",D[D.ALREADY_EXISTS=6]="ALREADY_EXISTS",D[D.PERMISSION_DENIED=7]="PERMISSION_DENIED",D[D.UNAUTHENTICATED=16]="UNAUTHENTICATED",D[D.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",D[D.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",D[D.ABORTED=10]="ABORTED",D[D.OUT_OF_RANGE=11]="OUT_OF_RANGE",D[D.UNIMPLEMENTED=12]="UNIMPLEMENTED",D[D.INTERNAL=13]="INTERNAL",D[D.UNAVAILABLE=14]="UNAVAILABLE",D[D.DATA_LOSS=15]="DATA_LOSS";let ap=new b([0xffffffff,0xffffffff],0);function ag(e){let t=(new TextEncoder).encode(e),n=new E;return n.update(t),new Uint8Array(n.digest())}function am(e){let t=new DataView(e.buffer),n=t.getUint32(0,!0),r=t.getUint32(4,!0),i=t.getUint32(8,!0),s=t.getUint32(12,!0);return[new b([n,r],0),new b([i,s],0)]}class ay{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new a_(`Invalid padding: ${t}`);if(n<0||e.length>0&&0===this.hashCount)throw new a_(`Invalid hash count: ${n}`);if(0===e.length&&0!==t)throw new a_(`Invalid padding when bitmap length is 0: ${t}`);this.ge=8*e.length-t,this.pe=b.fromNumber(this.ge)}ye(e,t,n){let r=e.add(t.multiply(b.fromNumber(n)));return 1===r.compare(ap)&&(r=new b([r.getBits(0),r.getBits(1)],0)),r.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(0===this.ge)return!1;let[t,n]=am(ag(e));for(let e=0;e<this.hashCount;e++){let r=this.ye(t,n,e);if(!this.we(r))return!1}return!0}static create(e,t,n){let r=new ay(new Uint8Array(Math.ceil(e/8)),e%8==0?0:8-e%8,t);return n.forEach(e=>r.insert(e)),r}insert(e){if(0===this.ge)return;let[t,n]=am(ag(e));for(let e=0;e<this.hashCount;e++){let r=this.ye(t,n,e);this.Se(r)}}Se(e){let t=Math.floor(e/8);this.bitmap[t]|=1<<e%8}}class a_ extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class av{constructor(e,t,n,r,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,n){let r=new Map;return r.set(e,aw.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new av(su.min(),r,new sb(i1),oF,oH())}}class aw{constructor(e,t,n,r,i){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new aw(n,t,oH(),oH(),oH())}}class ab{constructor(e,t,n,r){this.be=e,this.removedTargetIds=t,this.key=n,this.De=r}}class aE{constructor(e,t){this.targetId=e,this.Ce=t}}class aT{constructor(e,t,n=sA.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=r}}class aI{constructor(){this.ve=0,this.Fe=ak(),this.Me=sA.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return 0!==this.ve}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=oH(),t=oH(),n=oH();return this.Fe.forEach((r,i)=>{switch(i){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:n=n.add(r);break;default:iB(38017,{changeType:i})}}),new aw(this.Me,this.xe,e,t,n)}qe(){this.Oe=!1,this.Fe=ak()}Qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}$e(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}Ue(){this.ve+=1}Ke(){this.ve-=1,iq(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class aC{constructor(e){this.Ge=e,this.ze=new Map,this.je=oF,this.Je=aS(),this.He=aS(),this.Ye=new sb(i1)}Ze(e){for(let t of e.be)e.De&&e.De.isFoundDocument()?this.Xe(t,e.De):this.et(t,e.key,e.De);for(let t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,t=>{let n=this.nt(t);switch(e.state){case 0:this.rt(t)&&n.Le(e.resumeToken);break;case 1:n.Ke(),n.Ne||n.qe(),n.Le(e.resumeToken);break;case 2:n.Ke(),n.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(n.We(),n.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),n.Le(e.resumeToken));break;default:iB(56790,{state:e.state})}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach((e,n)=>{this.rt(n)&&t(n)})}st(e){let t=e.targetId,n=e.Ce.count,r=this.ot(t);if(r){let i=r.target;if(oT(i))if(0===n){let e=new se(i.path);this.et(t,e,ot.newNoDocument(e,su.min()))}else iq(1===n,20013,{expectedCount:n});else{let r=this._t(t);if(r!==n){let n=this.ut(e),i=n?this.ct(n,e,r):1;0!==i&&(this.it(t),this.Ye=this.Ye.insert(t,2===i?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch"))}}}}ut(e){let t,n,r=e.Ce.unchangedNames;if(!r||!r.bits)return null;let{bits:{bitmap:i="",padding:s=0},hashCount:o=0}=r;try{t=sD(i).toUint8Array()}catch(e){if(e instanceof sk)return iF("Decoding the base64 bloom filter in existence filter failed ("+e.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw e}try{n=new ay(t,s,o)}catch(e){return iF(e instanceof a_?"BloomFilter error: ":"Applying bloom filter failed: ",e),null}return 0===n.ge?null:n}ct(e,t,n){return 2*(t.Ce.count!==n-this.Pt(e,t.targetId))}Pt(e,t){let n=this.Ge.getRemoteKeysForTarget(t),r=0;return n.forEach(n=>{let i=this.Ge.ht(),s=`projects/${i.projectId}/databases/${i.database}/documents/${n.path.canonicalString()}`;e.mightContain(s)||(this.et(t,n,null),r++)}),r}Tt(e){let t=new Map;this.ze.forEach((n,r)=>{let i=this.ot(r);if(i){if(n.current&&oT(i.target)){let t=new se(i.target.path);this.It(t).has(r)||this.Et(r,t)||this.et(r,t,ot.newNoDocument(t,e))}n.Be&&(t.set(r,n.ke()),n.qe())}});let n=oH();this.He.forEach((e,t)=>{let r=!0;t.forEachWhile(e=>{let t=this.ot(e);return!t||"TargetPurposeLimboResolution"===t.purpose||(r=!1,!1)}),r&&(n=n.add(e))}),this.je.forEach((t,n)=>n.setReadTime(e));let r=new av(e,t,this.Ye,this.je,n);return this.je=oF,this.Je=aS(),this.He=aS(),this.Ye=new sb(i1),r}Xe(e,t){if(!this.rt(e))return;let n=2*!!this.Et(e,t.key);this.nt(e).Qe(t.key,n),this.je=this.je.insert(t.key,t),this.Je=this.Je.insert(t.key,this.It(t.key).add(e)),this.He=this.He.insert(t.key,this.dt(t.key).add(e))}et(e,t,n){if(!this.rt(e))return;let r=this.nt(e);this.Et(e,t)?r.Qe(t,1):r.$e(t),this.He=this.He.insert(t,this.dt(t).delete(e)),this.He=this.He.insert(t,this.dt(t).add(e)),n&&(this.je=this.je.insert(t,n))}removeTarget(e){this.ze.delete(e)}_t(e){let t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ue(e){this.nt(e).Ue()}nt(e){let t=this.ze.get(e);return t||(t=new aI,this.ze.set(e,t)),t}dt(e){let t=this.He.get(e);return t||(t=new sI(i1),this.He=this.He.insert(e,t)),t}It(e){let t=this.Je.get(e);return t||(t=new sI(i1),this.Je=this.Je.insert(e,t)),t}rt(e){let t=null!==this.ot(e);return t||iM("WatchChangeAggregator","Detected inactive target",e),t}ot(e){let t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new aI),this.Ge.getRemoteKeysForTarget(e).forEach(t=>{this.et(e,t,null)})}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}}function aS(){return new sb(se.comparator)}function ak(){return new sb(se.comparator)}let aA={asc:"ASCENDING",desc:"DESCENDING"},aR={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},aN={and:"AND",or:"OR"};class aP{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function aD(e,t){return e.useProto3Json||null==t?t:{value:t}}function aO(e,t){return e.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function ax(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function aL(e){let t;return iq(!!e,49232),su.fromTimestamp(new sh((t=sN(e)).seconds,t.nanos))}function aM(e,t){return aU(e,t).canonicalString()}function aU(e,t){let n=new i8(["projects",e.projectId,"databases",e.database]).child("documents");return void 0===t?n:n.child(t)}function aF(e){let t=i8.fromString(e);return iq(aK(t),10190,{key:t.toString()}),t}function aV(e,t){return aM(e.databaseId,t.path)}function aB(e,t){let n=aF(t);if(n.get(1)!==e.databaseId.projectId)throw new i$(iz.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new i$(iz.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new se(az(n))}function aj(e,t){return aM(e.databaseId,t)}function aq(e){return new i8(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function az(e){return iq(e.length>4&&"documents"===e.get(4),29091,{key:e.toString()}),e.popFirst(5)}function a$(e,t,n){return{name:aV(e,t),fields:n.value.mapValue.fields}}function aH(e){return{fieldPath:e.canonicalString()}}function aW(e){return i9.fromServerFormat(e.fieldPath)}function aK(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}class aG{constructor(e,t,n,r,i=su.min(),s=su.min(),o=sA.EMPTY_BYTE_STRING,a=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=o,this.expectedCount=a}withSequenceNumber(e){return new aG(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new aG(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new aG(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new aG(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class aQ{constructor(e){this.yt=e}}class aY{Dt(e,t){this.Ct(e,t),t.vt()}Ct(e,t){if("nullValue"in e)this.Ft(t,5);else if("booleanValue"in e)this.Ft(t,10),t.Mt(+!!e.booleanValue);else if("integerValue"in e)this.Ft(t,15),t.Mt(sP(e.integerValue));else if("doubleValue"in e){let n=sP(e.doubleValue);isNaN(n)?this.Ft(t,13):(this.Ft(t,15),sy(n)?t.Mt(0):t.Mt(n))}else if("timestampValue"in e){let n=e.timestampValue;this.Ft(t,20),"string"==typeof n&&(n=sN(n)),t.xt(`${n.seconds||""}`),t.Mt(n.nanos||0)}else if("stringValue"in e)this.Ot(e.stringValue,t),this.Nt(t);else if("bytesValue"in e)this.Ft(t,30),t.Bt(sD(e.bytesValue)),this.Nt(t);else if("referenceValue"in e)this.Lt(e.referenceValue,t);else if("geoPointValue"in e){let n=e.geoPointValue;this.Ft(t,45),t.Mt(n.latitude||0),t.Mt(n.longitude||0)}else"mapValue"in e?s9(e)?this.Ft(t,Number.MAX_SAFE_INTEGER):s8(e)?this.kt(e.mapValue,t):(this.qt(e.mapValue,t),this.Nt(t)):"arrayValue"in e?(this.Qt(e.arrayValue,t),this.Nt(t)):iB(19022,{$t:e})}Ot(e,t){this.Ft(t,25),this.Ut(e,t)}Ut(e,t){t.xt(e)}qt(e,t){let n=e.fields||{};for(let e of(this.Ft(t,55),Object.keys(n)))this.Ot(e,t),this.Ct(n[e],t)}kt(e,t){let n=e.fields||{};this.Ft(t,53);let r=n[sK].arrayValue?.values?.length||0;this.Ft(t,15),t.Mt(sP(r)),this.Ot(sK,t),this.Ct(n[sK],t)}Qt(e,t){let n=e.values||[];for(let e of(this.Ft(t,50),n))this.Ct(e,t)}Lt(e,t){this.Ft(t,37),se.fromName(e).path.forEach(e=>{this.Ft(t,60),this.Ut(e,t)})}Ft(e,t){e.Mt(t)}Nt(e){e.Mt(2)}}aY.Kt=new aY;class aX{constructor(){this.Cn=new aJ}addToCollectionParentIndex(e,t){return this.Cn.add(t),sp.resolve()}getCollectionParents(e,t){return sp.resolve(this.Cn.getEntries(t))}addFieldIndex(e,t){return sp.resolve()}deleteFieldIndex(e,t){return sp.resolve()}deleteAllFieldIndexes(e){return sp.resolve()}createTargetIndexes(e,t){return sp.resolve()}getDocumentsMatchingTarget(e,t){return sp.resolve(null)}getIndexType(e,t){return sp.resolve(0)}getFieldIndexes(e,t){return sp.resolve([])}getNextCollectionGroupToUpdate(e){return sp.resolve(null)}getMinOffset(e,t){return sp.resolve(sc.min())}getMinOffsetFromCollectionGroup(e,t){return sp.resolve(sc.min())}updateCollectionGroup(e,t,n){return sp.resolve()}updateIndexEntries(e,t){return sp.resolve()}}class aJ{constructor(){this.index={}}add(e){let t=e.lastSegment(),n=e.popLast(),r=this.index[t]||new sI(i8.comparator),i=!r.has(n);return this.index[t]=r.add(n),i}has(e){let t=e.lastSegment(),n=e.popLast(),r=this.index[t];return r&&r.has(n)}getEntries(e){return(this.index[e]||new sI(i8.comparator)).toArray()}}new Uint8Array(0);let aZ={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class a0{static withCacheSize(e){return new a0(e,a0.DEFAULT_COLLECTION_PERCENTILE,a0.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}}a0.DEFAULT_COLLECTION_PERCENTILE=10,a0.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,a0.DEFAULT=new a0(0x2800000,a0.DEFAULT_COLLECTION_PERCENTILE,a0.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),a0.DISABLED=new a0(-1,0,0);class a1{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new a1(0)}static cr(){return new a1(-1)}}let a2="LruGarbageCollector";function a6([e,t],[n,r]){let i=i1(e,n);return 0===i?i1(t,r):i}class a3{constructor(e){this.Ir=e,this.buffer=new sI(a6),this.Er=0}dr(){return++this.Er}Ar(e){let t=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(t);else{let e=this.buffer.last();0>a6(t,e)&&(this.buffer=this.buffer.delete(e).add(t))}}get maxValue(){return this.buffer.last()[0]}}class a4{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.Rr=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return null!==this.Rr}Vr(e){iM(a2,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){sg(e)?iM(a2,"Ignoring IndexedDB error during garbage collection: ",e):await sf(e)}await this.Vr(3e5)})}}class a5{constructor(e,t){this.mr=e,this.params=t}calculateTargetCount(e,t){return this.mr.gr(e).next(e=>Math.floor(t/100*e))}nthSequenceNumber(e,t){if(0===t)return sp.resolve(sm.ce);let n=new a3(t);return this.mr.forEachTarget(e,e=>n.Ar(e.sequenceNumber)).next(()=>this.mr.pr(e,e=>n.Ar(e))).next(()=>n.maxValue)}removeTargets(e,t,n){return this.mr.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.mr.removeOrphanedDocuments(e,t)}collect(e,t){return -1===this.params.cacheSizeCollectionThreshold?(iM("LruGarbageCollector","Garbage collection skipped; disabled"),sp.resolve(aZ)):this.getCacheSize(e).next(n=>n<this.params.cacheSizeCollectionThreshold?(iM("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),aZ):this.yr(e,t))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,t){let n,r,i,s,o,a,l,h=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(t=>(t>this.params.maximumSequenceNumbersToCollect?(iM("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${t}`),r=this.params.maximumSequenceNumbersToCollect):r=t,s=Date.now(),this.nthSequenceNumber(e,r))).next(r=>(n=r,o=Date.now(),this.removeTargets(e,n,t))).next(t=>(i=t,a=Date.now(),this.removeOrphanedDocuments(e,n))).next(e=>(l=Date.now(),iL()<=w.DEBUG&&iM("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${s-h}ms
	Determined least recently used ${r} in `+(o-s)+"ms\n"+`	Removed ${i} targets in `+(a-o)+"ms\n"+`	Removed ${e} documents in `+(l-a)+"ms\n"+`Total Duration: ${l-h}ms`),sp.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:e})))}}class a8{constructor(){this.changes=new oU(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,ot.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let n=this.changes.get(t);return void 0!==n?sp.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class a7{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class a9{constructor(e,t,n,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=r}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next(r=>(n=r,this.remoteDocumentCache.getEntry(e,t))).next(e=>(null!==n&&ae(n.mutation,e,sS.empty(),sh.now()),e))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.getLocalViewOfDocuments(e,t,oH()).next(()=>t))}getLocalViewOfDocuments(e,t,n=oH()){let r=oq();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,n).next(e=>{let t=oB();return e.forEach((e,n)=>{t=t.insert(e,n.overlayedDocument)}),t}))}getOverlayedDocuments(e,t){let n=oq();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,oH()))}populateOverlays(e,t,n){let r=[];return n.forEach(e=>{t.has(e)||r.push(e)}),this.documentOverlayCache.getOverlays(e,r).next(e=>{e.forEach((e,n)=>{t.set(e,n)})})}computeViews(e,t,n,r){let i=oF,s=oq(),o=oq();return t.forEach((e,t)=>{let o=n.get(t.key);r.has(t.key)&&(void 0===o||o.mutation instanceof ar)?i=i.insert(t.key,t):void 0!==o?(s.set(t.key,o.mutation.getFieldMask()),ae(o.mutation,t,o.mutation.getFieldMask(),sh.now())):s.set(t.key,sS.empty())}),this.recalculateAndSaveOverlays(e,i).next(e=>(e.forEach((e,t)=>s.set(e,t)),t.forEach((e,t)=>o.set(e,new a7(t,s.get(e)??null))),o))}recalculateAndSaveOverlays(e,t){let n=oq(),r=new sb((e,t)=>e-t),i=oH();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(e=>{for(let i of e)i.keys().forEach(e=>{let s=t.get(e);if(null===s)return;let o=n.get(e)||sS.empty();o=i.applyToLocalView(s,o),n.set(e,o);let a=(r.get(i.batchId)||oH()).add(e);r=r.insert(i.batchId,a)})}).next(()=>{let s=[],o=r.getReverseIterator();for(;o.hasNext();){let r=o.getNext(),a=r.key,l=r.value,h=oq();l.forEach(e=>{if(!i.has(e)){let r=o9(t.get(e),n.get(e));null!==r&&h.set(e,r),i=i.add(e)}}),s.push(this.documentOverlayCache.saveOverlays(e,a,h))}return sp.waitFor(s)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.recalculateAndSaveOverlays(e,t))}getDocumentsMatchingQuery(e,t,n,r){return se.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length?this.getDocumentsMatchingDocumentQuery(e,t.path):ok(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,r):this.getDocumentsMatchingCollectionQuery(e,t,n,r)}getNextDocuments(e,t,n,r){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,r).next(i=>{let s=r-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,r-i.size):sp.resolve(oq()),o=-1,a=i;return s.next(t=>sp.forEach(t,(t,n)=>(o<n.largestBatchId&&(o=n.largestBatchId),i.get(t)?sp.resolve():this.remoteDocumentCache.getEntry(e,t).next(e=>{a=a.insert(t,e)}))).next(()=>this.populateOverlays(e,t,i)).next(()=>this.computeViews(e,a,t,oH())).next(e=>({batchId:o,changes:oj(e)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new se(t)).next(e=>{let t=oB();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t})}getDocumentsMatchingCollectionGroupQuery(e,t,n,r){let i=t.collectionGroup,s=oB();return this.indexManager.getCollectionParents(e,i).next(o=>sp.forEach(o,o=>{let a=new oI(o.child(i),null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt);return this.getDocumentsMatchingCollectionQuery(e,a,n,r).next(e=>{e.forEach((e,t)=>{s=s.insert(e,t)})})}).next(()=>s))}getDocumentsMatchingCollectionQuery(e,t,n,r){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next(s=>(i=s,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,i,r))).next(e=>{i.forEach((t,n)=>{let r=n.getKey();null===e.get(r)&&(e=e.insert(r,ot.newInvalidDocument(r)))});let n=oB();return e.forEach((e,r)=>{let s=i.get(e);void 0!==s&&ae(s.mutation,r,sS.empty(),sh.now()),oL(t,r)&&(n=n.insert(e,r))}),n})}}class le{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,t){return sp.resolve(this.Lr.get(t))}saveBundleMetadata(e,t){return this.Lr.set(t.id,{id:t.id,version:t.version,createTime:aL(t.createTime)}),sp.resolve()}getNamedQuery(e,t){return sp.resolve(this.kr.get(t))}saveNamedQuery(e,t){var n;let r;return this.kr.set(t.name,{name:t.name,query:(r=function(e){var t,n,r,i;let s,o,a,l,h,u=4===(s=aF(e.parent)).length?i8.emptyPath():az(s),c=e.structuredQuery,d=c.from?c.from.length:0,f=null;if(d>0){iq(1===d,65062);let e=c.from[0];e.allDescendants?f=e.collectionId:u=u.child(e.collectionId)}let p=[];c.where&&(p=(o=function e(t){return void 0!==t.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":let t=aW(e.unaryFilter.field);return oa.create(t,"==",{doubleValue:NaN});case"IS_NULL":let n=aW(e.unaryFilter.field);return oa.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let r=aW(e.unaryFilter.field);return oa.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let i=aW(e.unaryFilter.field);return oa.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return iB(61313);default:return iB(60726)}}(t):void 0!==t.fieldFilter?oa.create(aW(t.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return iB(58110);default:return iB(50506)}}(t.fieldFilter.op),t.fieldFilter.value):void 0!==t.compositeFilter?ol.create(t.compositeFilter.filters.map(t=>e(t)),function(e){switch(e){case"AND":return"and";case"OR":return"or";default:return iB(1026)}}(t.compositeFilter.op)):iB(30097,{filter:t})}(c.where))instanceof ol&&ou(t=o)&&oh(t)?o.getFilters():[o]);let g=[];c.orderBy&&(g=c.orderBy.map(e=>new os(aW(e.field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))));let m=null;c.limit&&(m=null==(a="object"==typeof(n=c.limit)?n.value:n)?null:a);let y=null;c.startAt&&(l=!!(r=c.startAt).before,y=new on(r.values||[],l));let _=null;return c.endAt&&(h=!(i=c.endAt).before,_=new on(i.values||[],h)),new oI(u,f,g,p,m,"F",y,_)}({parent:(n=t.bundledQuery).parent,structuredQuery:n.structuredQuery}),"LAST"===n.limitType?oP(r,r.limit,"L"):r),readTime:aL(t.readTime)}),sp.resolve()}}class lt{constructor(){this.overlays=new sb(se.comparator),this.qr=new Map}getOverlay(e,t){return sp.resolve(this.overlays.get(t))}getOverlays(e,t){let n=oq();return sp.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&n.set(t,e)})).next(()=>n)}saveOverlays(e,t,n){return n.forEach((n,r)=>{this.St(e,t,r)}),sp.resolve()}removeOverlaysForBatchId(e,t,n){let r=this.qr.get(n);return void 0!==r&&(r.forEach(e=>this.overlays=this.overlays.remove(e)),this.qr.delete(n)),sp.resolve()}getOverlaysForCollection(e,t,n){let r=oq(),i=t.length+1,s=new se(t.child("")),o=this.overlays.getIteratorFrom(s);for(;o.hasNext();){let e=o.getNext().value,s=e.getKey();if(!t.isPrefixOf(s.path))break;s.path.length===i&&e.largestBatchId>n&&r.set(e.getKey(),e)}return sp.resolve(r)}getOverlaysForCollectionGroup(e,t,n,r){let i=new sb((e,t)=>e-t),s=this.overlays.getIterator();for(;s.hasNext();){let e=s.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>n){let t=i.get(e.largestBatchId);null===t&&(t=oq(),i=i.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}let o=oq(),a=i.getIterator();for(;a.hasNext()&&(a.getNext().value.forEach((e,t)=>o.set(e,t)),!(o.size()>=r)););return sp.resolve(o)}St(e,t,n){let r=this.overlays.get(n.key);if(null!==r){let e=this.qr.get(r.largestBatchId).delete(n.key);this.qr.set(r.largestBatchId,e)}this.overlays=this.overlays.insert(n.key,new ac(t,n));let i=this.qr.get(t);void 0===i&&(i=oH(),this.qr.set(t,i)),this.qr.set(t,i.add(n.key))}}class ln{constructor(){this.sessionToken=sA.EMPTY_BYTE_STRING}getSessionToken(e){return sp.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,sp.resolve()}}class lr{constructor(){this.Qr=new sI(li.$r),this.Ur=new sI(li.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,t){let n=new li(e,t);this.Qr=this.Qr.add(n),this.Ur=this.Ur.add(n)}Wr(e,t){e.forEach(e=>this.addReference(e,t))}removeReference(e,t){this.Gr(new li(e,t))}zr(e,t){e.forEach(e=>this.removeReference(e,t))}jr(e){let t=new se(new i8([])),n=new li(t,e),r=new li(t,e+1),i=[];return this.Ur.forEachInRange([n,r],e=>{this.Gr(e),i.push(e.key)}),i}Jr(){this.Qr.forEach(e=>this.Gr(e))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){let t=new se(new i8([])),n=new li(t,e),r=new li(t,e+1),i=oH();return this.Ur.forEachInRange([n,r],e=>{i=i.add(e.key)}),i}containsKey(e){let t=new li(e,0),n=this.Qr.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}class li{constructor(e,t){this.key=e,this.Yr=t}static $r(e,t){return se.comparator(e.key,t.key)||i1(e.Yr,t.Yr)}static Kr(e,t){return i1(e.Yr,t.Yr)||se.comparator(e.key,t.key)}}class ls{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.tr=1,this.Zr=new sI(li.$r)}checkEmpty(e){return sp.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,r){let i=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let s=new ah(i,t,n,r);for(let t of(this.mutationQueue.push(s),r))this.Zr=this.Zr.add(new li(t.key,i)),this.indexManager.addToCollectionParentIndex(e,t.key.path.popLast());return sp.resolve(s)}lookupMutationBatch(e,t){return sp.resolve(this.Xr(t))}getNextMutationBatchAfterBatchId(e,t){let n=this.ei(t+1),r=n<0?0:n;return sp.resolve(this.mutationQueue.length>r?this.mutationQueue[r]:null)}getHighestUnacknowledgedBatchId(){return sp.resolve(0===this.mutationQueue.length?-1:this.tr-1)}getAllMutationBatches(e){return sp.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let n=new li(t,0),r=new li(t,1/0),i=[];return this.Zr.forEachInRange([n,r],e=>{let t=this.Xr(e.Yr);i.push(t)}),sp.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new sI(i1);return t.forEach(e=>{let t=new li(e,0),r=new li(e,1/0);this.Zr.forEachInRange([t,r],e=>{n=n.add(e.Yr)})}),sp.resolve(this.ti(n))}getAllMutationBatchesAffectingQuery(e,t){let n=t.path,r=n.length+1,i=n;se.isDocumentKey(i)||(i=i.child(""));let s=new li(new se(i),0),o=new sI(i1);return this.Zr.forEachWhile(e=>{let t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===r&&(o=o.add(e.Yr)),!0)},s),sp.resolve(this.ti(o))}ti(e){let t=[];return e.forEach(e=>{let n=this.Xr(e);null!==n&&t.push(n)}),t}removeMutationBatch(e,t){iq(0===this.ni(t.batchId,"removed"),55003),this.mutationQueue.shift();let n=this.Zr;return sp.forEach(t.mutations,r=>{let i=new li(r.key,t.batchId);return n=n.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)}).next(()=>{this.Zr=n})}ir(e){}containsKey(e,t){let n=new li(t,0),r=this.Zr.firstAfterOrEqual(n);return sp.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return this.mutationQueue.length,sp.resolve()}ni(e,t){return this.ei(e)}ei(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}Xr(e){let t=this.ei(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class lo{constructor(e){this.ri=e,this.docs=new sb(se.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let n=t.key,r=this.docs.get(n),i=r?r.size:0,s=this.ri(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:s}),this.size+=s-i,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let n=this.docs.get(t);return sp.resolve(n?n.document.mutableCopy():ot.newInvalidDocument(t))}getEntries(e,t){let n=oF;return t.forEach(e=>{let t=this.docs.get(e);n=n.insert(e,t?t.document.mutableCopy():ot.newInvalidDocument(e))}),sp.resolve(n)}getDocumentsMatchingQuery(e,t,n,r){let i=oF,s=t.path,o=new se(s.child("__id-9223372036854775808__")),a=this.docs.getIteratorFrom(o);for(;a.hasNext();){let{key:e,value:{document:o}}=a.getNext();if(!s.isPrefixOf(e.path))break;e.path.length>s.length+1||0>=function(e,t){let n=e.readTime.compareTo(t.readTime);return 0!==n||0!==(n=se.comparator(e.documentKey,t.documentKey))?n:i1(e.largestBatchId,t.largestBatchId)}(new sc(o.readTime,o.key,-1),n)||(r.has(o.key)||oL(t,o))&&(i=i.insert(o.key,o.mutableCopy()))}return sp.resolve(i)}getAllFromCollectionGroup(e,t,n,r){iB(9500)}ii(e,t){return sp.forEach(this.docs,e=>t(e))}newChangeBuffer(e){return new la(this)}getSize(e){return sp.resolve(this.size)}}class la extends a8{constructor(e){super(),this.Nr=e}applyChanges(e){let t=[];return this.changes.forEach((n,r)=>{r.isValidDocument()?t.push(this.Nr.addEntry(e,r)):this.Nr.removeEntry(n)}),sp.waitFor(t)}getFromCache(e,t){return this.Nr.getEntry(e,t)}getAllFromCache(e,t){return this.Nr.getEntries(e,t)}}class ll{constructor(e){this.persistence=e,this.si=new oU(e=>ob(e),oE),this.lastRemoteSnapshotVersion=su.min(),this.highestTargetId=0,this.oi=0,this._i=new lr,this.targetCount=0,this.ai=a1.ur()}forEachTarget(e,t){return this.si.forEach((e,n)=>t(n)),sp.resolve()}getLastRemoteSnapshotVersion(e){return sp.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return sp.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),sp.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.oi&&(this.oi=t),sp.resolve()}Pr(e){this.si.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.ai=new a1(t),this.highestTargetId=t),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,t){return this.Pr(t),this.targetCount+=1,sp.resolve()}updateTargetData(e,t){return this.Pr(t),sp.resolve()}removeTargetData(e,t){return this.si.delete(t.target),this._i.jr(t.targetId),this.targetCount-=1,sp.resolve()}removeTargets(e,t,n){let r=0,i=[];return this.si.forEach((s,o)=>{o.sequenceNumber<=t&&null===n.get(o.targetId)&&(this.si.delete(s),i.push(this.removeMatchingKeysForTargetId(e,o.targetId)),r++)}),sp.waitFor(i).next(()=>r)}getTargetCount(e){return sp.resolve(this.targetCount)}getTargetData(e,t){let n=this.si.get(t)||null;return sp.resolve(n)}addMatchingKeys(e,t,n){return this._i.Wr(t,n),sp.resolve()}removeMatchingKeys(e,t,n){this._i.zr(t,n);let r=this.persistence.referenceDelegate,i=[];return r&&t.forEach(t=>{i.push(r.markPotentiallyOrphaned(e,t))}),sp.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this._i.jr(t),sp.resolve()}getMatchingKeysForTargetId(e,t){let n=this._i.Hr(t);return sp.resolve(n)}containsKey(e,t){return sp.resolve(this._i.containsKey(t))}}class lh{constructor(e,t){this.ui={},this.overlays={},this.ci=new sm(0),this.li=!1,this.li=!0,this.hi=new ln,this.referenceDelegate=e(this),this.Pi=new ll(this),this.indexManager=new aX,this.remoteDocumentCache=new lo(e=>this.referenceDelegate.Ti(e)),this.serializer=new aQ(t),this.Ii=new le(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new lt,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.ui[e.toKey()];return n||(n=new ls(t,this.referenceDelegate),this.ui[e.toKey()]=n),n}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,t,n){iM("MemoryPersistence","Starting transaction:",e);let r=new lu(this.ci.next());return this.referenceDelegate.Ei(),n(r).next(e=>this.referenceDelegate.di(r).next(()=>e)).toPromise().then(e=>(r.raiseOnCommittedEvent(),e))}Ai(e,t){return sp.or(Object.values(this.ui).map(n=>()=>n.containsKey(e,t)))}}class lu extends sd{constructor(e){super(),this.currentSequenceNumber=e}}class lc{constructor(e){this.persistence=e,this.Ri=new lr,this.Vi=null}static mi(e){return new lc(e)}get fi(){if(this.Vi)return this.Vi;throw iB(60996)}addReference(e,t,n){return this.Ri.addReference(n,t),this.fi.delete(n.toString()),sp.resolve()}removeReference(e,t,n){return this.Ri.removeReference(n,t),this.fi.add(n.toString()),sp.resolve()}markPotentiallyOrphaned(e,t){return this.fi.add(t.toString()),sp.resolve()}removeTarget(e,t){this.Ri.jr(t.targetId).forEach(e=>this.fi.add(e.toString()));let n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(e=>{e.forEach(e=>this.fi.add(e.toString()))}).next(()=>n.removeTargetData(e,t))}Ei(){this.Vi=new Set}di(e){let t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return sp.forEach(this.fi,n=>{let r=se.fromPath(n);return this.gi(e,r).next(e=>{e||t.removeEntry(r,su.min())})}).next(()=>(this.Vi=null,t.apply(e)))}updateLimboDocument(e,t){return this.gi(e,t).next(e=>{e?this.fi.delete(t.toString()):this.fi.add(t.toString())})}Ti(e){return 0}gi(e,t){return sp.or([()=>sp.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ai(e,t)])}}class ld{constructor(e,t){this.persistence=e,this.pi=new oU(e=>(function(e){let t="";for(let n=0;n<e.length;n++)t.length>0&&(t+="\x01\x01"),t=function(e,t){let n=t,r=e.length;for(let t=0;t<r;t++){let r=e.charAt(t);switch(r){case"\0":n+="\x01\x10";break;case"\x01":n+="\x01\x11";break;default:n+=r}}return n}(e.get(n),t);return t+"\x01\x01"})(e.path),(e,t)=>e.isEqual(t)),this.garbageCollector=new a5(this,t)}static mi(e,t){return new ld(e,t)}Ei(){}di(e){return sp.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}gr(e){let t=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next(e=>t.next(t=>e+t))}wr(e){let t=0;return this.pr(e,e=>{t++}).next(()=>t)}pr(e,t){return sp.forEach(this.pi,(n,r)=>this.br(e,n,r).next(e=>e?sp.resolve():t(r)))}removeTargets(e,t,n){return this.persistence.getTargetCache().removeTargets(e,t,n)}removeOrphanedDocuments(e,t){let n=0,r=this.persistence.getRemoteDocumentCache(),i=r.newChangeBuffer();return r.ii(e,r=>this.br(e,r,t).next(e=>{e||(n++,i.removeEntry(r,su.min()))})).next(()=>i.apply(e)).next(()=>n)}markPotentiallyOrphaned(e,t){return this.pi.set(t,e.currentSequenceNumber),sp.resolve()}removeTarget(e,t){let n=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,n)}addReference(e,t,n){return this.pi.set(n,e.currentSequenceNumber),sp.resolve()}removeReference(e,t,n){return this.pi.set(n,e.currentSequenceNumber),sp.resolve()}updateLimboDocument(e,t){return this.pi.set(t,e.currentSequenceNumber),sp.resolve()}Ti(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=function e(t){switch(sG(t)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:let n=sF(t);return n?16+e(n):16;case 5:return 2*t.stringValue.length;case 6:return sD(t.bytesValue).approximateByteSize();case 7:return t.referenceValue.length;case 9:return(t.arrayValue.values||[]).reduce((t,n)=>t+e(n),0);case 10:case 11:var r;let i;return r=t.mapValue,i=0,sv(r.fields,(t,n)=>{i+=t.length+e(n)}),i;default:throw iB(13486,{value:t})}}(e.data.value)),t}br(e,t,n){return sp.or([()=>this.persistence.Ai(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{let e=this.pi.get(t);return sp.resolve(void 0!==e&&e>n)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class lf{constructor(e,t,n,r){this.targetId=e,this.fromCache=t,this.Es=n,this.ds=r}static As(e,t){let n=oH(),r=oH();for(let e of t.docChanges)switch(e.type){case 0:n=n.add(e.doc.key);break;case 1:r=r.add(e.doc.key)}return new lf(e,t.fromCache,n,r)}}class lp{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class lg{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=function(){let t;return!function(){let t=Y()?.forceEnvironment;if("node"===t)return!0;if("browser"===t)return!1;try{return"[object process]"===Object.prototype.toString.call(e.g.process)}catch(e){return!1}}()&&navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")?8:Number((t=el().match(/Android ([\d.]+)/i))?t[1].split(".").slice(0,2).join("."):"-1")>0?6:4}()}initialize(e,t){this.ps=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,n,r){let i={result:null};return this.ys(e,t).next(e=>{i.result=e}).next(()=>{if(!i.result)return this.ws(e,t,r,n).next(e=>{i.result=e})}).next(()=>{if(i.result)return;let n=new lp;return this.Ss(e,t,n).next(r=>{if(i.result=r,this.Vs)return this.bs(e,t,n,r.size)})}).next(()=>i.result)}bs(e,t,n,r){return n.documentReadCount<this.fs?(iL()<=w.DEBUG&&iM("QueryEngine","SDK will not create cache indexes for query:",ox(t),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),sp.resolve()):(iL()<=w.DEBUG&&iM("QueryEngine","Query:",ox(t),"scans",n.documentReadCount,"local documents and returns",r,"documents as results."),n.documentReadCount>this.gs*r?(iL()<=w.DEBUG&&iM("QueryEngine","The SDK decides to create cache indexes for query:",ox(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,oR(t))):sp.resolve())}ys(e,t){if(oS(t))return sp.resolve(null);let n=oR(t);return this.indexManager.getIndexType(e,n).next(r=>0===r?null:(null!==t.limit&&1===r&&(n=oR(t=oP(t,null,"F"))),this.indexManager.getDocumentsMatchingTarget(e,n).next(r=>{let i=oH(...r);return this.ps.getDocuments(e,i).next(r=>this.indexManager.getMinOffset(e,n).next(n=>{let s=this.Ds(t,r);return this.Cs(t,s,i,n.readTime)?this.ys(e,oP(t,null,"F")):this.vs(e,s,t,n)}))})))}ws(e,t,n,r){return oS(t)||r.isEqual(su.min())?sp.resolve(null):this.ps.getDocuments(e,n).next(i=>{let s,o,a=this.Ds(t,i);return this.Cs(t,a,n,r)?sp.resolve(null):(iL()<=w.DEBUG&&iM("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),ox(t)),this.vs(e,a,t,(s=r.toTimestamp().seconds,o=r.toTimestamp().nanoseconds+1,new sc(su.fromTimestamp(1e9===o?new sh(s+1,0):new sh(s,o)),se.empty(),-1))).next(e=>e))})}Ds(e,t){let n=new sI(oM(e));return t.forEach((t,r)=>{oL(e,r)&&(n=n.add(r))}),n}Cs(e,t,n,r){if(null===e.limit)return!1;if(n.size!==t.size)return!0;let i="F"===e.limitType?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)}Ss(e,t,n){return iL()<=w.DEBUG&&iM("QueryEngine","Using full collection scan to execute query:",ox(t)),this.ps.getDocumentsMatchingQuery(e,t,sc.min(),n)}vs(e,t,n,r){return this.ps.getDocumentsMatchingQuery(e,n,r).next(e=>(t.forEach(t=>{e=e.insert(t.key,t)}),e))}}let lm="LocalStore";class ly{constructor(e,t,n,r){this.persistence=e,this.Fs=t,this.serializer=r,this.Ms=new sb(i1),this.xs=new oU(e=>ob(e),oE),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(n)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new a9(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.Ms))}}async function l_(e,t){return await e.persistence.runTransaction("Handle user change","readonly",n=>{let r;return e.mutationQueue.getAllMutationBatches(n).next(i=>(r=i,e.Bs(t),e.mutationQueue.getAllMutationBatches(n))).next(t=>{let i=[],s=[],o=oH();for(let e of r)for(let t of(i.push(e.batchId),e.mutations))o=o.add(t.key);for(let e of t)for(let t of(s.push(e.batchId),e.mutations))o=o.add(t.key);return e.localDocuments.getDocuments(n,o).next(e=>({Ls:e,removedBatchIds:i,addedBatchIds:s}))})})}function lv(e){return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Pi.getLastRemoteSnapshotVersion(t))}async function lw(e,t,n){let r=e.Ms.get(t);try{n||await e.persistence.runTransaction("Release target",n?"readwrite":"readwrite-primary",t=>e.persistence.referenceDelegate.removeTarget(t,r))}catch(e){if(!sg(e))throw e;iM(lm,`Failed to update sequence numbers for target ${t}: ${e}`)}e.Ms=e.Ms.remove(t),e.xs.delete(r.target)}function lb(e,t,n){let r=su.min(),i=oH();return e.persistence.runTransaction("Execute query","readwrite",s=>{var o;let a;return(o=oR(t),void 0!==(a=e.xs.get(o))?sp.resolve(e.Ms.get(a)):e.Pi.getTargetData(s,o)).next(t=>{if(t)return r=t.lastLimboFreeSnapshotVersion,e.Pi.getMatchingKeysForTargetId(s,t.targetId).next(e=>{i=e})}).next(()=>e.Fs.getDocumentsMatchingQuery(s,t,n?r:su.min(),n?i:oH())).next(n=>{var r,s,o;let a;return r=e,s=t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2)),o=n,a=r.Os.get(s)||su.min(),o.forEach((e,t)=>{t.readTime.compareTo(a)>0&&(a=t.readTime)}),r.Os.set(s,a),{documents:n,Qs:i}})})}class lE{constructor(){this.activeTargetIds=oW}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){return JSON.stringify({activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()})}}class lT{constructor(){this.Mo=new lE,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e,t=!0){return t&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,t,n){this.xo[e]=t}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new lE,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class lI{Oo(e){}shutdown(){}}let lC="ConnectivityMonitor";class lS{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){for(let e of(iM(lC,"Network connectivity changed: AVAILABLE"),this.qo))e(0)}ko(){for(let e of(iM(lC,"Network connectivity changed: UNAVAILABLE"),this.qo))e(1)}static v(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let lk=null;function lA(){return null===lk?lk=0x10000000+Math.round(0x80000000*Math.random()):lk++,"0x"+lk.toString(16)}let lR="RestConnection",lN={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class lP{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),r=encodeURIComponent(this.databaseId.database);this.Uo=t+"://"+e.host,this.Ko=`projects/${n}/databases/${r}`,this.Wo=this.databaseId.database===sj?`project_id=${n}`:`project_id=${n}&database_id=${r}`}Go(e,t,n,r,i){let s=lA(),o=this.zo(e,t.toUriEncodedString());iM(lR,`Sending RPC '${e}' ${s}:`,o,n);let a={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(a,r,i);let{host:l}=new URL(o),h=en(l);return this.Jo(e,o,a,n,h).then(t=>(iM(lR,`Received RPC '${e}' ${s}: `,t),t),t=>{throw iF(lR,`RPC '${e}' ${s} failed with error: `,t,"url: ",o,"request:",n),t})}Ho(e,t,n,r,i,s){return this.Go(e,t,n,r,i)}jo(e,t,n){e["X-Goog-Api-Client"]="gl-js/ fire/"+iO,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((t,n)=>e[n]=t),n&&n.headers.forEach((t,n)=>e[n]=t)}zo(e,t){let n=lN[e];return`${this.Uo}/v1/${t}:${n}`}terminate(){}}class lD{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}}let lO="WebChannelConnection";class lx extends lP{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,t,n,r,i){let s=lA();return new Promise((i,o)=>{let a=new T;a.setWithCredentials(!0),a.listenOnce(C.COMPLETE,()=>{try{switch(a.getLastErrorCode()){case S.NO_ERROR:let t=a.getResponseJson();iM(lO,`XHR for RPC '${e}' ${s} received:`,JSON.stringify(t)),i(t);break;case S.TIMEOUT:iM(lO,`RPC '${e}' ${s} timed out`),o(new i$(iz.DEADLINE_EXCEEDED,"Request time out"));break;case S.HTTP_ERROR:let n=a.getStatus();if(iM(lO,`RPC '${e}' ${s} failed with status:`,n,"response text:",a.getResponseText()),n>0){let e=a.getResponseJson();Array.isArray(e)&&(e=e[0]);let t=e?.error;if(t&&t.status&&t.message){let e,n=(e=t.status.toLowerCase().replace(/_/g,"-"),Object.values(iz).indexOf(e)>=0?e:iz.UNKNOWN);o(new i$(n,t.message))}else o(new i$(iz.UNKNOWN,"Server responded with status "+a.getStatus()))}else o(new i$(iz.UNAVAILABLE,"Connection failed."));break;default:iB(9055,{l_:e,streamId:s,h_:a.getLastErrorCode(),P_:a.getLastError()})}}finally{iM(lO,`RPC '${e}' ${s} completed.`)}});let l=JSON.stringify(r);iM(lO,`RPC '${e}' ${s} sending request:`,r),a.send(t,"POST",l,n,15)})}T_(e,t,n){let r=lA(),i=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],s=N(),o=R(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},l=this.longPollingOptions.timeoutSeconds;void 0!==l&&(a.longPollingTimeout=Math.round(1e3*l)),this.useFetchStreams&&(a.useFetchStreams=!0),this.jo(a.initMessageHeaders,t,n),a.encodeInitMessageHeaders=!0;let h=i.join("");iM(lO,`Creating RPC '${e}' stream ${r}: ${h}`,a);let u=s.createWebChannel(h,a);this.I_(u);let c=!1,d=!1,f=new lD({Yo:t=>{d?iM(lO,`Not sending because RPC '${e}' stream ${r} is closed:`,t):(c||(iM(lO,`Opening RPC '${e}' stream ${r} transport.`),u.open(),c=!0),iM(lO,`RPC '${e}' stream ${r} sending:`,t),u.send(t))},Zo:()=>u.close()}),p=(e,t,n)=>{e.listen(t,e=>{try{n(e)}catch(e){setTimeout(()=>{throw e},0)}})};return p(u,I.EventType.OPEN,()=>{d||(iM(lO,`RPC '${e}' stream ${r} transport opened.`),f.o_())}),p(u,I.EventType.CLOSE,()=>{d||(d=!0,iM(lO,`RPC '${e}' stream ${r} transport closed`),f.a_(),this.E_(u))}),p(u,I.EventType.ERROR,t=>{d||(d=!0,iF(lO,`RPC '${e}' stream ${r} transport errored. Name:`,t.name,"Message:",t.message),f.a_(new i$(iz.UNAVAILABLE,"The operation could not be completed")))}),p(u,I.EventType.MESSAGE,t=>{if(!d){let n=t.data[0];iq(!!n,16349);let i=n?.error||n[0]?.error;if(i){iM(lO,`RPC '${e}' stream ${r} received error:`,i);let t=i.status,n=function(e){let t=P[e];if(void 0!==t)return af(t)}(t),s=i.message;void 0===n&&(n=iz.INTERNAL,s="Unknown error status: "+t+" with message "+i.message),d=!0,f.a_(new i$(n,s)),u.close()}else iM(lO,`RPC '${e}' stream ${r} received:`,n),f.u_(n)}}),p(o,A.STAT_EVENT,t=>{t.stat===k.PROXY?iM(lO,`RPC '${e}' stream ${r} detected buffering proxy`):t.stat===k.NOPROXY&&iM(lO,`RPC '${e}' stream ${r} detected no buffering proxy`)}),setTimeout(()=>{f.__()},0),f}terminate(){this.c_.forEach(e=>e.close()),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter(t=>t===e)}}function lL(){return"undefined"!=typeof document?document:null}function lM(e){return new aP(e,!0)}class lU{constructor(e,t,n=1e3,r=1.5,i=6e4){this.Mi=e,this.timerId=t,this.d_=n,this.A_=r,this.R_=i,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();let t=Math.floor(this.V_+this.y_()),n=Math.max(0,Date.now()-this.f_),r=Math.max(0,t-n);r>0&&iM("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.V_} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,r,()=>(this.f_=Date.now(),e())),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){null!==this.m_&&(this.m_.skipDelay(),this.m_=null)}cancel(){null!==this.m_&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}let lF="PersistentStream";class lV{constructor(e,t,n,r,i,s,o,a){this.Mi=e,this.S_=n,this.b_=r,this.connection=i,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=o,this.listener=a,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new lU(e,t)}x_(){return 1===this.state||5===this.state||this.O_()}O_(){return 2===this.state||3===this.state}start(){this.F_=0,4!==this.state?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&null===this.C_&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,()=>this.k_()))}q_(e){this.Q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,4!==e?this.M_.reset():t&&t.code===iz.RESOURCE_EXHAUSTED?(iU(t.toString()),iU("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===iz.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.r_(t)}K_(){}auth(){this.state=1;let e=this.W_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([e,n])=>{this.D_===t&&this.G_(e,n)},t=>{e(()=>{let e=new i$(iz.UNKNOWN,"Fetching auth token failed: "+t.message);return this.z_(e)})})}G_(e,t){let n=this.W_(this.D_);this.stream=this.j_(e,t),this.stream.Xo(()=>{n(()=>this.listener.Xo())}),this.stream.t_(()=>{n(()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,()=>(this.O_()&&(this.state=3),Promise.resolve())),this.listener.t_()))}),this.stream.r_(e=>{n(()=>this.z_(e))}),this.stream.onMessage(e=>{n(()=>1==++this.F_?this.J_(e):this.onNext(e))})}N_(){this.state=5,this.M_.p_(async()=>{this.state=0,this.start()})}z_(e){return iM(lF,`close with error: ${e}`),this.stream=null,this.close(4,e)}W_(e){return t=>{this.Mi.enqueueAndForget(()=>this.D_===e?t():(iM(lF,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class lB extends lV{constructor(e,t,n,r,i,s){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,r,s),this.serializer=i}j_(e,t){return this.connection.T_("Listen",e,t)}J_(e){return this.onNext(e)}onNext(e){this.M_.reset();let t=function(e,t){let n;if("targetChange"in t){var r,i;t.targetChange;let s="NO_CHANGE"===(r=t.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===r?1:"REMOVE"===r?2:"CURRENT"===r?3:"RESET"===r?4:iB(39313,{state:r}),o=t.targetChange.targetIds||[],a=(i=t.targetChange.resumeToken,e.useProto3Json?(iq(void 0===i||"string"==typeof i,58123),sA.fromBase64String(i||"")):(iq(void 0===i||i instanceof iC.Buffer||i instanceof Uint8Array,16193),sA.fromUint8Array(i||new Uint8Array))),l=t.targetChange.cause;n=new aT(s,o,a,l&&new i$(void 0===l.code?iz.UNKNOWN:af(l.code),l.message||"")||null)}else if("documentChange"in t){t.documentChange;let r=t.documentChange;r.document,r.document.name,r.document.updateTime;let i=aB(e,r.document.name),s=aL(r.document.updateTime),o=r.document.createTime?aL(r.document.createTime):su.min(),a=new oe({mapValue:{fields:r.document.fields}}),l=ot.newFoundDocument(i,s,o,a);n=new ab(r.targetIds||[],r.removedTargetIds||[],l.key,l)}else if("documentDelete"in t){t.documentDelete;let r=t.documentDelete;r.document;let i=aB(e,r.document),s=r.readTime?aL(r.readTime):su.min(),o=ot.newNoDocument(i,s);n=new ab([],r.removedTargetIds||[],o.key,o)}else if("documentRemove"in t){t.documentRemove;let r=t.documentRemove;r.document;let i=aB(e,r.document);n=new ab([],r.removedTargetIds||[],i,null)}else{if(!("filter"in t))return iB(11601,{Rt:t});{t.filter;let e=t.filter;e.targetId;let{count:r=0,unchangedNames:i}=e,s=new ad(r,i);n=new aE(e.targetId,s)}}return n}(this.serializer,e),n=function(e){if(!("targetChange"in e))return su.min();let t=e.targetChange;return t.targetIds&&t.targetIds.length?su.min():t.readTime?aL(t.readTime):su.min()}(e);return this.listener.H_(t,n)}Y_(e){let t,n={};n.database=aq(this.serializer),n.addTarget=function(e,t){var n,r;let i,s,o,a,l,h,u,c=t.target;if((i=oT(c)?{documents:{documents:[aj(e,c.path)]}}:{query:(o={structuredQuery:{}},a=c.path,null!==c.collectionGroup?(s=a,o.structuredQuery.from=[{collectionId:c.collectionGroup,allDescendants:!0}]):(s=a.popLast(),o.structuredQuery.from=[{collectionId:a.lastSegment()}]),o.parent=aj(e,s),(l=function(e){if(0!==e.length)return function e(t){var n;let r;return t instanceof oa?function(e){if("=="===e.op){if(s4(e.value))return{unaryFilter:{field:aH(e.field),op:"IS_NAN"}};if(s3(e.value))return{unaryFilter:{field:aH(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(s4(e.value))return{unaryFilter:{field:aH(e.field),op:"IS_NOT_NAN"}};if(s3(e.value))return{unaryFilter:{field:aH(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:aH(e.field),op:aR[e.op],value:e.value}}}(t):t instanceof ol?1===(r=(n=t).getFilters().map(t=>e(t))).length?r[0]:{compositeFilter:{op:aN[n.op],filters:r}}:iB(54877,{filter:t})}(ol.create(e,"and"))}(c.filters))&&(o.structuredQuery.where=l),(h=function(e){if(0!==e.length)return e.map(e=>({field:aH(e.field),direction:aA[e.dir]}))}(c.orderBy))&&(o.structuredQuery.orderBy=h),null!==(u=aD(e,c.limit))&&(o.structuredQuery.limit=u),c.startAt&&(o.structuredQuery.startAt={before:(n=c.startAt).inclusive,values:n.position}),c.endAt&&(o.structuredQuery.endAt={before:!(r=c.endAt).inclusive,values:r.position}),{ft:o,parent:s}).ft}).targetId=t.targetId,t.resumeToken.approximateByteSize()>0){i.resumeToken=ax(e,t.resumeToken);let n=aD(e,t.expectedCount);null!==n&&(i.expectedCount=n)}else if(t.snapshotVersion.compareTo(su.min())>0){i.readTime=aO(e,t.snapshotVersion.toTimestamp());let n=aD(e,t.expectedCount);null!==n&&(i.expectedCount=n)}return i}(this.serializer,e);let r=(this.serializer,null==(t=function(e){switch(e){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return iB(28987,{purpose:e})}}(e.purpose))?null:{"goog-listen-tags":t});r&&(n.labels=r),this.q_(n)}Z_(e){let t={};t.database=aq(this.serializer),t.removeTarget=e,this.q_(t)}}class lj extends lV{constructor(e,t,n,r,i,s){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,r,s),this.serializer=i}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,t){return this.connection.T_("Write",e,t)}J_(e){return iq(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,iq(!e.writeResults||0===e.writeResults.length,55816),this.listener.ta()}onNext(e){var t,n;iq(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();let r=(t=e.writeResults,n=e.commitTime,t&&t.length>0?(iq(void 0!==n,14353),t.map(e=>{let t;return(t=e.updateTime?aL(e.updateTime):aL(n)).isEqual(su.min())&&(t=aL(n)),new o4(t,e.transformResults||[])})):[]),i=aL(e.commitTime);return this.listener.na(i,r)}ra(){let e={};e.database=aq(this.serializer),this.q_(e)}ea(e){let t={streamToken:this.lastStreamToken,writes:e.map(e=>(function(e,t){var n,r;let i;if(t instanceof an)i={update:a$(e,t.key,t.value)};else if(t instanceof aa)i={delete:aV(e,t.key)};else if(t instanceof ar){let n;i={update:a$(e,t.key,t.data),updateMask:(r=t.fieldMask,n=[],r.fields.forEach(e=>n.push(e.canonicalString())),{fieldPaths:n})}}else{if(!(t instanceof al))return iB(16599,{Vt:t.type});i={verify:aV(e,t.key)}}return t.fieldTransforms.length>0&&(i.updateTransforms=t.fieldTransforms.map(e=>(function(e,t){let n=t.transform;if(n instanceof oX)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof oJ)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof o0)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof o2)return{fieldPath:t.field.canonicalString(),increment:n.Ae};throw iB(20930,{transform:t.transform})})(0,e))),t.precondition.isNone||(i.currentDocument=void 0!==(n=t.precondition).updateTime?{updateTime:aO(e,n.updateTime.toTimestamp())}:void 0!==n.exists?{exists:n.exists}:iB(27497)),i})(this.serializer,e))};this.q_(t)}}class lq{}class lz extends lq{constructor(e,t,n,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=r,this.ia=!1}sa(){if(this.ia)throw new i$(iz.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,t,n,r){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,s])=>this.connection.Go(e,aU(t,n),r,i,s)).catch(e=>{throw"FirebaseError"===e.name?(e.code===iz.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new i$(iz.UNKNOWN,e.toString())})}Ho(e,t,n,r,i){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,o])=>this.connection.Ho(e,aU(t,n),r,s,o,i)).catch(e=>{throw"FirebaseError"===e.name?(e.code===iz.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new i$(iz.UNKNOWN,e.toString())})}terminate(){this.ia=!0,this.connection.terminate()}}class l${constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){0===this.oa&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve())))}ha(e){"Online"===this.state?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,"Online"===e&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(iU(t),this.aa=!1):iM("OnlineStateTracker",t)}Pa(){null!==this._a&&(this._a.cancel(),this._a=null)}}let lH="RemoteStore";class lW{constructor(e,t,n,r,i){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=i,this.Aa.Oo(e=>{n.enqueueAndForget(async()=>{l1(this)&&(iM(lH,"Restarting streams for network reachability change."),await async function(e){e.Ea.add(4),await lG(e),e.Ra.set("Unknown"),e.Ea.delete(4),await lK(e)}(this))})}),this.Ra=new l$(n,r)}}async function lK(e){if(l1(e))for(let t of e.da)await t(!0)}async function lG(e){for(let t of e.da)await t(!1)}function lQ(e,t){e.Ia.has(t.targetId)||(e.Ia.set(t.targetId,t),l0(e)?lZ(e):ha(e).O_()&&lX(e,t))}function lY(e,t){let n=ha(e);e.Ia.delete(t),n.O_()&&lJ(e,t),0===e.Ia.size&&(n.O_()?n.L_():l1(e)&&e.Ra.set("Unknown"))}function lX(e,t){if(e.Va.Ue(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(su.min())>0){let n=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(n)}ha(e).Y_(t)}function lJ(e,t){e.Va.Ue(t),ha(e).Z_(t)}function lZ(e){e.Va=new aC({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),At:t=>e.Ia.get(t)||null,ht:()=>e.datastore.serializer.databaseId}),ha(e).start(),e.Ra.ua()}function l0(e){return l1(e)&&!ha(e).x_()&&e.Ia.size>0}function l1(e){return 0===e.Ea.size}async function l2(e){e.Ra.set("Online")}async function l6(e){e.Ia.forEach((t,n)=>{lX(e,t)})}async function l3(e,t){e.Va=void 0,l0(e)?(e.Ra.ha(t),lZ(e)):e.Ra.set("Unknown")}async function l4(e,t,n){if(e.Ra.set("Online"),t instanceof aT&&2===t.state&&t.cause)try{await async function(e,t){let n=t.cause;for(let r of t.targetIds)e.Ia.has(r)&&(await e.remoteSyncer.rejectListen(r,n),e.Ia.delete(r),e.Va.removeTarget(r))}(e,t)}catch(n){iM(lH,"Failed to remove targets %s: %s ",t.targetIds.join(","),n),await l5(e,n)}else if(t instanceof ab?e.Va.Ze(t):t instanceof aE?e.Va.st(t):e.Va.tt(t),!n.isEqual(su.min()))try{let t,r=await lv(e.localStore);n.compareTo(r)>=0&&await ((t=e.Va.Tt(n)).targetChanges.forEach((t,r)=>{if(t.resumeToken.approximateByteSize()>0){let i=e.Ia.get(r);i&&e.Ia.set(r,i.withResumeToken(t.resumeToken,n))}}),t.targetMismatches.forEach((t,n)=>{let r=e.Ia.get(t);if(!r)return;e.Ia.set(t,r.withResumeToken(sA.EMPTY_BYTE_STRING,r.snapshotVersion)),lJ(e,t);let i=new aG(r.target,t,n,r.sequenceNumber);lX(e,i)}),e.remoteSyncer.applyRemoteEvent(t))}catch(t){iM(lH,"Failed to raise snapshot:",t),await l5(e,t)}}async function l5(e,t,n){if(!sg(t))throw t;e.Ea.add(1),await lG(e),e.Ra.set("Offline"),n||(n=()=>lv(e.localStore)),e.asyncQueue.enqueueRetryable(async()=>{iM(lH,"Retrying IndexedDB access"),await n(),e.Ea.delete(1),await lK(e)})}function l8(e,t){return t().catch(n=>l5(e,n,t))}async function l7(e){var t;let n=hl(e),r=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:-1;for(;l1(t=e)&&t.Ta.length<10;)try{let t=await function(e,t){return e.persistence.runTransaction("Get next mutation batch","readonly",n=>(void 0===t&&(t=-1),e.mutationQueue.getNextMutationBatchAfterBatchId(n,t)))}(e.localStore,r);if(null===t){0===e.Ta.length&&n.L_();break}r=t.batchId,function(e,t){e.Ta.push(t);let n=hl(e);n.O_()&&n.X_&&n.ea(t.mutations)}(e,t)}catch(t){await l5(e,t)}l9(e)&&he(e)}function l9(e){return l1(e)&&!hl(e).x_()&&e.Ta.length>0}function he(e){hl(e).start()}async function ht(e){hl(e).ra()}async function hn(e){let t=hl(e);for(let n of e.Ta)t.ea(n.mutations)}async function hr(e,t,n){let r=e.Ta.shift(),i=au.from(r,t,n);await l8(e,()=>e.remoteSyncer.applySuccessfulWrite(i)),await l7(e)}async function hi(e,t){t&&hl(e).X_&&await async function(e,t){var n;if(function(e){switch(e){case iz.OK:return iB(64938);case iz.CANCELLED:case iz.UNKNOWN:case iz.DEADLINE_EXCEEDED:case iz.RESOURCE_EXHAUSTED:case iz.INTERNAL:case iz.UNAVAILABLE:case iz.UNAUTHENTICATED:return!1;case iz.INVALID_ARGUMENT:case iz.NOT_FOUND:case iz.ALREADY_EXISTS:case iz.PERMISSION_DENIED:case iz.FAILED_PRECONDITION:case iz.ABORTED:case iz.OUT_OF_RANGE:case iz.UNIMPLEMENTED:case iz.DATA_LOSS:return!0;default:return iB(15467,{code:e})}}(n=t.code)&&n!==iz.ABORTED){let n=e.Ta.shift();hl(e).B_(),await l8(e,()=>e.remoteSyncer.rejectFailedWrite(n.batchId,t)),await l7(e)}}(e,t),l9(e)&&he(e)}async function hs(e,t){e.asyncQueue.verifyOperationInProgress(),iM(lH,"RemoteStore received new credentials");let n=l1(e);e.Ea.add(3),await lG(e),n&&e.Ra.set("Unknown"),await e.remoteSyncer.handleCredentialChange(t),e.Ea.delete(3),await lK(e)}async function ho(e,t){t?(e.Ea.delete(2),await lK(e)):t||(e.Ea.add(2),await lG(e),e.Ra.set("Unknown"))}function ha(e){var t,n,r;return e.ma||(t=e.datastore,n=e.asyncQueue,r={Xo:l2.bind(null,e),t_:l6.bind(null,e),r_:l3.bind(null,e),H_:l4.bind(null,e)},t.sa(),e.ma=new lB(n,t.connection,t.authCredentials,t.appCheckCredentials,t.serializer,r),e.da.push(async t=>{t?(e.ma.B_(),l0(e)?lZ(e):e.Ra.set("Unknown")):(await e.ma.stop(),e.Va=void 0)})),e.ma}function hl(e){var t,n,r;return e.fa||(t=e.datastore,n=e.asyncQueue,r={Xo:()=>Promise.resolve(),t_:ht.bind(null,e),r_:hi.bind(null,e),ta:hn.bind(null,e),na:hr.bind(null,e)},t.sa(),e.fa=new lj(n,t.connection,t.authCredentials,t.appCheckCredentials,t.serializer,r),e.da.push(async t=>{t?(e.fa.B_(),await l7(e)):(await e.fa.stop(),e.Ta.length>0&&(iM(lH,`Stopping write stream with ${e.Ta.length} pending writes`),e.Ta=[]))})),e.fa}class hh{constructor(e,t,n,r,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new iH,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(e=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,r,i){let s=new hh(e,t,Date.now()+n,r,i);return s.start(n),s}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new i$(iz.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function hu(e,t){if(iU("AsyncQueue",`${t}: ${e}`),sg(e))return new i$(iz.UNAVAILABLE,`${t}: ${e}`);throw e}class hc{static emptySet(e){return new hc(e.comparator)}constructor(e){this.comparator=e?(t,n)=>e(t,n)||se.comparator(t.key,n.key):(e,t)=>se.comparator(e.key,t.key),this.keyedMap=oB(),this.sortedSet=new sb(this.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,n)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof hc)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){let e=t.getNext().key,r=n.getNext().key;if(!e.isEqual(r))return!1}return!0}toString(){let e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){let n=new hc;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class hd{constructor(){this.ga=new sb(se.comparator)}track(e){let t=e.doc.key,n=this.ga.get(t);n?0!==e.type&&3===n.type?this.ga=this.ga.insert(t,e):3===e.type&&1!==n.type?this.ga=this.ga.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.ga=this.ga.remove(t):1===e.type&&2===n.type?this.ga=this.ga.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):iB(63341,{Rt:e,pa:n}):this.ga=this.ga.insert(t,e)}ya(){let e=[];return this.ga.inorderTraversal((t,n)=>{e.push(n)}),e}}class hf{constructor(e,t,n,r,i,s,o,a,l){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=s,this.syncStateChanged=o,this.excludesMetadataChanges=a,this.hasCachedResults=l}static fromInitialDocuments(e,t,n,r,i){let s=[];return t.forEach(e=>{s.push({type:0,doc:e})}),new hf(e,t,hc.emptySet(t),s,n,r,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&oD(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;let t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let e=0;e<t.length;e++)if(t[e].type!==n[e].type||!t[e].doc.isEqual(n[e].doc))return!1;return!0}}class hp{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some(e=>e.Da())}}class hg{constructor(){this.queries=hm(),this.onlineState="Unknown",this.Ca=new Set}terminate(){var e;let t;e=new i$(iz.ABORTED,"Firestore shutting down"),t=this.queries,this.queries=hm(),t.forEach((t,n)=>{for(let t of n.Sa)t.onError(e)})}}function hm(){return new oU(e=>oO(e),oD)}async function hy(e,t){let n=3,r=t.query,i=e.queries.get(r);i?!i.ba()&&t.Da()&&(n=2):(i=new hp,n=+!t.Da());try{switch(n){case 0:i.wa=await e.onListen(r,!0);break;case 1:i.wa=await e.onListen(r,!1);break;case 2:await e.onFirstRemoteStoreListen(r)}}catch(n){let e=hu(n,`Initialization of query '${ox(t.query)}' failed`);return void t.onError(e)}e.queries.set(r,i),i.Sa.push(t),t.va(e.onlineState),i.wa&&t.Fa(i.wa)&&hb(e)}async function h_(e,t){let n=t.query,r=3,i=e.queries.get(n);if(i){let e=i.Sa.indexOf(t);e>=0&&(i.Sa.splice(e,1),0===i.Sa.length?r=+!t.Da():!i.ba()&&t.Da()&&(r=2))}switch(r){case 0:return e.queries.delete(n),e.onUnlisten(n,!0);case 1:return e.queries.delete(n),e.onUnlisten(n,!1);case 2:return e.onLastRemoteStoreUnlisten(n);default:return}}function hv(e,t){let n=!1;for(let r of t){let t=r.query,i=e.queries.get(t);if(i){for(let e of i.Sa)e.Fa(r)&&(n=!0);i.wa=r}}n&&hb(e)}function hw(e,t,n){let r=e.queries.get(t);if(r)for(let e of r.Sa)e.onError(n);e.queries.delete(t)}function hb(e){e.Ca.forEach(e=>{e.next()})}(x=O||(O={})).Ma="default",x.Cache="cache";class hE{constructor(e,t,n){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=n||{}}Fa(e){if(!this.options.includeMetadataChanges){let t=[];for(let n of e.docChanges)3!==n.type&&t.push(n);e=new hf(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){return!(e.fromCache&&this.Da())||(!this.options.qa||"Offline"===t)&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}Ba(e){if(e.docChanges.length>0)return!0;let t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}ka(e){e=hf.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==O.Cache}}class hT{constructor(e){this.key=e}}class hI{constructor(e){this.key=e}}class hC{constructor(e,t){this.query=e,this.Ya=t,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=oH(),this.mutatedKeys=oH(),this.eu=oM(e),this.tu=new hc(this.eu)}get nu(){return this.Ya}ru(e,t){let n=t?t.iu:new hd,r=t?t.tu:this.tu,i=t?t.mutatedKeys:this.mutatedKeys,s=r,o=!1,a="F"===this.query.limitType&&r.size===this.query.limit?r.last():null,l="L"===this.query.limitType&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal((e,t)=>{let h=r.get(e),u=oL(this.query,t)?t:null,c=!!h&&this.mutatedKeys.has(h.key),d=!!u&&(u.hasLocalMutations||this.mutatedKeys.has(u.key)&&u.hasCommittedMutations),f=!1;h&&u?h.data.isEqual(u.data)?c!==d&&(n.track({type:3,doc:u}),f=!0):this.su(h,u)||(n.track({type:2,doc:u}),f=!0,(a&&this.eu(u,a)>0||l&&0>this.eu(u,l))&&(o=!0)):!h&&u?(n.track({type:0,doc:u}),f=!0):h&&!u&&(n.track({type:1,doc:h}),f=!0,(a||l)&&(o=!0)),f&&(u?(s=s.add(u),i=d?i.add(e):i.delete(e)):(s=s.delete(e),i=i.delete(e)))}),null!==this.query.limit)for(;s.size>this.query.limit;){let e="F"===this.query.limitType?s.last():s.first();s=s.delete(e.key),i=i.delete(e.key),n.track({type:1,doc:e})}return{tu:s,iu:n,Cs:o,mutatedKeys:i}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n,r){let i=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;let s=e.iu.ya();s.sort((e,t)=>{var n,r;let i;return n=e.type,r=t.type,(i=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return iB(20277,{Rt:e})}})(n)-i(r)||this.eu(e.doc,t.doc)}),this.ou(n),r=r??!1;let o=t&&!r?this._u():[],a=0===this.Xa.size&&this.current&&!r?1:0,l=a!==this.Za;return(this.Za=a,0!==s.length||l)?{snapshot:new hf(this.query,e.tu,i,s,e.mutatedKeys,0===a,l,!1,!!n&&n.resumeToken.approximateByteSize()>0),au:o}:{au:o}}va(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({tu:this.tu,iu:new hd,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(e){return!this.Ya.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach(e=>this.Ya=this.Ya.add(e)),e.modifiedDocuments.forEach(e=>{}),e.removedDocuments.forEach(e=>this.Ya=this.Ya.delete(e)),this.current=e.current)}_u(){if(!this.current)return[];let e=this.Xa;this.Xa=oH(),this.tu.forEach(e=>{this.uu(e.key)&&(this.Xa=this.Xa.add(e.key))});let t=[];return e.forEach(e=>{this.Xa.has(e)||t.push(new hI(e))}),this.Xa.forEach(n=>{e.has(n)||t.push(new hT(n))}),t}cu(e){this.Ya=e.Qs,this.Xa=oH();let t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return hf.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,0===this.Za,this.hasCachedResults)}}let hS="SyncEngine";class hk{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class hA{constructor(e){this.key=e,this.hu=!1}}class hR{constructor(e,t,n,r,i,s){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=s,this.Pu={},this.Tu=new oU(e=>oO(e),oD),this.Iu=new Map,this.Eu=new Set,this.du=new sb(se.comparator),this.Au=new Map,this.Ru=new lr,this.Vu={},this.mu=new Map,this.fu=a1.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return!0===this.gu}}async function hN(e,t,n=!0){let r,i=hX(e),s=i.Tu.get(t);return s?(i.sharedClientState.addLocalQueryTarget(s.targetId),r=s.view.lu()):r=await hD(i,t,n,!0),r}async function hP(e,t){let n=hX(e);await hD(n,t,!0,!1)}async function hD(e,t,n,r){var i,s;let o,a=await (i=e.localStore,s=oR(t),i.persistence.runTransaction("Allocate target","readwrite",e=>{let t;return i.Pi.getTargetData(e,s).next(n=>n?(t=n,sp.resolve(t)):i.Pi.allocateTargetId(e).next(n=>(t=new aG(s,n,"TargetPurposeListen",e.currentSequenceNumber),i.Pi.addTargetData(e,t).next(()=>t))))}).then(e=>{let t=i.Ms.get(e.targetId);return(null===t||e.snapshotVersion.compareTo(t.snapshotVersion)>0)&&(i.Ms=i.Ms.insert(e.targetId,e),i.xs.set(s,e.targetId)),e})),l=a.targetId,h=e.sharedClientState.addLocalQueryTarget(l,n);return r&&(o=await hO(e,t,l,"current"===h,a.resumeToken)),e.isPrimaryClient&&n&&lQ(e.remoteStore,a),o}async function hO(e,t,n,r,i){e.pu=(t,n,r)=>(async function(e,t,n,r){let i=t.view.ru(n);i.Cs&&(i=await lb(e.localStore,t.query,!1).then(({documents:e})=>t.view.ru(e,i)));let s=r&&r.targetChanges.get(t.targetId),o=r&&null!=r.targetMismatches.get(t.targetId),a=t.view.applyChanges(i,e.isPrimaryClient,s,o);return hW(e,t.targetId,a.au),a.snapshot})(e,t,n,r);let s=await lb(e.localStore,t,!0),o=new hC(t,s.Qs),a=o.ru(s.documents),l=aw.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==e.onlineState,i),h=o.applyChanges(a,e.isPrimaryClient,l);hW(e,n,h.au);let u=new hk(t,n,o);return e.Tu.set(t,u),e.Iu.has(n)?e.Iu.get(n).push(t):e.Iu.set(n,[t]),h.snapshot}async function hx(e,t,n){let r=e.Tu.get(t),i=e.Iu.get(r.targetId);i.length>1?(e.Iu.set(r.targetId,i.filter(e=>!oD(e,t))),e.Tu.delete(t)):e.isPrimaryClient?(e.sharedClientState.removeLocalQueryTarget(r.targetId),e.sharedClientState.isActiveQueryTarget(r.targetId)||await lw(e.localStore,r.targetId,!1).then(()=>{e.sharedClientState.clearQueryState(r.targetId),n&&lY(e.remoteStore,r.targetId),h$(e,r.targetId)}).catch(sf)):(h$(e,r.targetId),await lw(e.localStore,r.targetId,!0))}async function hL(e,t){let n=e.Tu.get(t),r=e.Iu.get(n.targetId);e.isPrimaryClient&&1===r.length&&(e.sharedClientState.removeLocalQueryTarget(n.targetId),lY(e.remoteStore,n.targetId))}async function hM(e,t,n){var r,i,s;let o=((r=e).remoteStore.remoteSyncer.applySuccessfulWrite=hB.bind(null,r),r.remoteStore.remoteSyncer.rejectFailedWrite=hj.bind(null,r),r);try{let e,r,a,l,h,u=await (i=o.localStore,a=sh.now(),l=t.reduce((e,t)=>e.add(t.key),oH()),i.persistence.runTransaction("Locally write mutations","readwrite",n=>{let s=oF,o=oH();return i.Ns.getEntries(n,l).next(e=>{(s=e).forEach((e,t)=>{t.isValidDocument()||(o=o.add(e))})}).next(()=>i.localDocuments.getOverlayedDocuments(n,s)).next(r=>{e=r;let s=[];for(let n of t){let t=function(e,t){let n=null;for(let r of e.fieldTransforms){let e=t.data.field(r.field),i=oY(r.transform,e||null);null!=i&&(null===n&&(n=oe.empty()),n.set(r.field,i))}return n||null}(n,e.get(n.key).overlayedDocument);null!=t&&s.push(new ar(n.key,t,function e(t){let n=[];return sv(t.fields,(t,r)=>{let i=new i9([t]);if(s5(r)){let t=e(r.mapValue).fields;if(0===t.length)n.push(i);else for(let e of t)n.push(i.child(e))}else n.push(i)}),new sS(n)}(t.value.mapValue),o5.exists(!0)))}return i.mutationQueue.addMutationBatch(n,a,s,t)}).next(t=>{r=t;let s=t.applyToLocalDocumentSet(e,o);return i.documentOverlayCache.saveOverlays(n,t.batchId,s)})}).then(()=>({batchId:r.batchId,changes:oj(e)})));o.sharedClientState.addPendingMutation(u.batchId),s=u.batchId,(h=o.Vu[o.currentUser.toKey()])||(h=new sb(i1)),h=h.insert(s,n),o.Vu[o.currentUser.toKey()]=h,await hG(o,u.changes),await l7(o.remoteStore)}catch(t){let e=hu(t,"Failed to persist write");n.reject(e)}}async function hU(e,t){var n;try{let r,i,s=await (n=e.localStore,r=t.snapshotVersion,i=n.Ms,n.persistence.runTransaction("Apply remote event","readwrite-primary",e=>{var s,o,a;let l,h,u=n.Ns.newChangeBuffer({trackRemovals:!0});i=n.Ms;let c=[];t.targetChanges.forEach((s,o)=>{var a;let l=i.get(o);if(!l)return;c.push(n.Pi.removeMatchingKeys(e,s.removedDocuments,o).next(()=>n.Pi.addMatchingKeys(e,s.addedDocuments,o)));let h=l.withSequenceNumber(e.currentSequenceNumber);null!==t.targetMismatches.get(o)?h=h.withResumeToken(sA.EMPTY_BYTE_STRING,su.min()).withLastLimboFreeSnapshotVersion(su.min()):s.resumeToken.approximateByteSize()>0&&(h=h.withResumeToken(s.resumeToken,r)),i=i.insert(o,h),a=h,(0===l.resumeToken.approximateByteSize()||a.snapshotVersion.toMicroseconds()-l.snapshotVersion.toMicroseconds()>=3e8||s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size>0)&&c.push(n.Pi.updateTargetData(e,h))});let d=oF,f=oH();if(t.documentUpdates.forEach(r=>{t.resolvedLimboDocuments.has(r)&&c.push(n.persistence.referenceDelegate.updateLimboDocument(e,r))}),c.push((s=e,o=u,a=t.documentUpdates,l=oH(),h=oH(),a.forEach(e=>l=l.add(e)),o.getEntries(s,l).next(e=>{let t=oF;return a.forEach((n,r)=>{let i=e.get(n);r.isFoundDocument()!==i.isFoundDocument()&&(h=h.add(n)),r.isNoDocument()&&r.version.isEqual(su.min())?(o.removeEntry(n,r.readTime),t=t.insert(n,r)):!i.isValidDocument()||r.version.compareTo(i.version)>0||0===r.version.compareTo(i.version)&&i.hasPendingWrites?(o.addEntry(r),t=t.insert(n,r)):iM(lm,"Ignoring outdated watch update for ",n,". Current version:",i.version," Watch version:",r.version)}),{ks:t,qs:h}})).next(e=>{d=e.ks,f=e.qs})),!r.isEqual(su.min())){let t=n.Pi.getLastRemoteSnapshotVersion(e).next(t=>n.Pi.setTargetsMetadata(e,e.currentSequenceNumber,r));c.push(t)}return sp.waitFor(c).next(()=>u.apply(e)).next(()=>n.localDocuments.getLocalViewOfDocuments(e,d,f)).next(()=>d)}).then(e=>(n.Ms=i,e)));t.targetChanges.forEach((t,n)=>{let r=e.Au.get(n);r&&(iq(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1,22616),t.addedDocuments.size>0?r.hu=!0:t.modifiedDocuments.size>0?iq(r.hu,14607):t.removedDocuments.size>0&&(iq(r.hu,42227),r.hu=!1))}),await hG(e,s,t)}catch(e){await sf(e)}}function hF(e,t,n){var r;if(e.isPrimaryClient&&0===n||!e.isPrimaryClient&&1===n){let n,i=[];e.Tu.forEach((e,n)=>{let r=n.view.va(t);r.snapshot&&i.push(r.snapshot)}),(r=e.eventManager).onlineState=t,n=!1,r.queries.forEach((e,r)=>{for(let e of r.Sa)e.va(t)&&(n=!0)}),n&&hb(r),i.length&&e.Pu.H_(i),e.onlineState=t,e.isPrimaryClient&&e.sharedClientState.setOnlineState(t)}}async function hV(e,t,n){e.sharedClientState.updateQueryState(t,"rejected",n);let r=e.Au.get(t),i=r&&r.key;if(i){let n=new sb(se.comparator);n=n.insert(i,ot.newNoDocument(i,su.min()));let r=oH().add(i),s=new av(su.min(),new Map,new sb(i1),n,r);await hU(e,s),e.du=e.du.remove(i),e.Au.delete(t),hK(e)}else await lw(e.localStore,t,!1).then(()=>h$(e,t,n)).catch(sf)}async function hB(e,t){var n;let r=t.batch.batchId;try{let i=await (n=e.localStore,n.persistence.runTransaction("Acknowledge batch","readwrite-primary",e=>{let r,i,s,o=t.batch.keys(),a=n.Ns.newChangeBuffer({trackRemovals:!0});return(i=(r=t.batch).keys(),s=sp.resolve(),i.forEach(n=>{s=s.next(()=>a.getEntry(e,n)).next(e=>{let i=t.docVersions.get(n);iq(null!==i,48541),0>e.version.compareTo(i)&&(r.applyToRemoteDocument(e,t),e.isValidDocument()&&(e.setReadTime(t.commitVersion),a.addEntry(e)))})}),s.next(()=>n.mutationQueue.removeMutationBatch(e,r))).next(()=>a.apply(e)).next(()=>n.mutationQueue.performConsistencyCheck(e)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(e,o,t.batch.batchId)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,function(e){let t=oH();for(let n=0;n<e.mutationResults.length;++n)e.mutationResults[n].transformResults.length>0&&(t=t.add(e.batch.mutations[n].key));return t}(t))).next(()=>n.localDocuments.getDocuments(e,o))}));hz(e,r,null),hq(e,r),e.sharedClientState.updateMutationState(r,"acknowledged"),await hG(e,i)}catch(e){await sf(e)}}async function hj(e,t,n){var r;try{let i=await (r=e.localStore,r.persistence.runTransaction("Reject batch","readwrite-primary",e=>{let n;return r.mutationQueue.lookupMutationBatch(e,t).next(t=>(iq(null!==t,37113),n=t.keys(),r.mutationQueue.removeMutationBatch(e,t))).next(()=>r.mutationQueue.performConsistencyCheck(e)).next(()=>r.documentOverlayCache.removeOverlaysForBatchId(e,n,t)).next(()=>r.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,n)).next(()=>r.localDocuments.getDocuments(e,n))}));hz(e,t,n),hq(e,t),e.sharedClientState.updateMutationState(t,"rejected",n),await hG(e,i)}catch(e){await sf(e)}}function hq(e,t){(e.mu.get(t)||[]).forEach(e=>{e.resolve()}),e.mu.delete(t)}function hz(e,t,n){let r=e.Vu[e.currentUser.toKey()];if(r){let i=r.get(t);i&&(n?i.reject(n):i.resolve(),r=r.remove(t)),e.Vu[e.currentUser.toKey()]=r}}function h$(e,t,n=null){for(let r of(e.sharedClientState.removeLocalQueryTarget(t),e.Iu.get(t)))e.Tu.delete(r),n&&e.Pu.yu(r,n);e.Iu.delete(t),e.isPrimaryClient&&e.Ru.jr(t).forEach(t=>{e.Ru.containsKey(t)||hH(e,t)})}function hH(e,t){e.Eu.delete(t.path.canonicalString());let n=e.du.get(t);null!==n&&(lY(e.remoteStore,n),e.du=e.du.remove(t),e.Au.delete(n),hK(e))}function hW(e,t,n){for(let r of n)r instanceof hT?(e.Ru.addReference(r.key,t),function(e,t){let n=t.key,r=n.path.canonicalString();e.du.get(n)||e.Eu.has(r)||(iM(hS,"New document in limbo: "+n),e.Eu.add(r),hK(e))}(e,r)):r instanceof hI?(iM(hS,"Document no longer in limbo: "+r.key),e.Ru.removeReference(r.key,t),e.Ru.containsKey(r.key)||hH(e,r.key)):iB(19791,{wu:r})}function hK(e){for(;e.Eu.size>0&&e.du.size<e.maxConcurrentLimboResolutions;){let t=e.Eu.values().next().value;e.Eu.delete(t);let n=new se(i8.fromString(t)),r=e.fu.next();e.Au.set(r,new hA(n)),e.du=e.du.insert(n,r),lQ(e.remoteStore,new aG(oR(oC(n.path)),r,"TargetPurposeLimboResolution",sm.ce))}}async function hG(e,t,n){let r=[],i=[],s=[];e.Tu.isEmpty()||(e.Tu.forEach((o,a)=>{s.push(e.pu(a,t,n).then(t=>{if((t||n)&&e.isPrimaryClient){let r=t?!t.fromCache:n?.targetChanges.get(a.targetId)?.current;e.sharedClientState.updateQueryState(a.targetId,r?"current":"not-current")}if(t){r.push(t);let e=lf.As(a.targetId,t);i.push(e)}}))}),await Promise.all(s),e.Pu.H_(r),await async function(e,t){try{await e.persistence.runTransaction("notifyLocalViewChanges","readwrite",n=>sp.forEach(t,t=>sp.forEach(t.Es,r=>e.persistence.referenceDelegate.addReference(n,t.targetId,r)).next(()=>sp.forEach(t.ds,r=>e.persistence.referenceDelegate.removeReference(n,t.targetId,r)))))}catch(e){if(!sg(e))throw e;iM(lm,"Failed to update sequence numbers: "+e)}for(let n of t){let t=n.targetId;if(!n.fromCache){let n=e.Ms.get(t),r=n.snapshotVersion,i=n.withLastLimboFreeSnapshotVersion(r);e.Ms=e.Ms.insert(t,i)}}}(e.localStore,i))}async function hQ(e,t){if(!e.currentUser.isEqual(t)){iM(hS,"User change. New user:",t.toKey());let n=await l_(e.localStore,t);e.currentUser=t,e.mu.forEach(e=>{e.forEach(e=>{e.reject(new i$(iz.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),e.mu.clear(),e.sharedClientState.handleUserChange(t,n.removedBatchIds,n.addedBatchIds),await hG(e,n.Ls)}}function hY(e,t){let n=e.Au.get(t);if(n&&n.hu)return oH().add(n.key);{let n=oH(),r=e.Iu.get(t);if(!r)return n;for(let t of r){let r=e.Tu.get(t);n=n.unionWith(r.view.nu)}return n}}function hX(e){return e.remoteStore.remoteSyncer.applyRemoteEvent=hU.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=hY.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=hV.bind(null,e),e.Pu.H_=hv.bind(null,e.eventManager),e.Pu.yu=hw.bind(null,e.eventManager),e}class hJ{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=lM(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,t){return null}Mu(e,t){return null}vu(e){var t,n;return t=this.persistence,n=new lg,new ly(t,n,e.initialUser,this.serializer)}Cu(e){return new lh(lc.mi,this.serializer)}Du(e){return new lT}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}hJ.provider={build:()=>new hJ};class hZ extends hJ{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){return iq(this.persistence.referenceDelegate instanceof ld,46915),new a4(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,t)}Cu(e){let t=void 0!==this.cacheSizeBytes?a0.withCacheSize(this.cacheSizeBytes):a0.DEFAULT;return new lh(e=>ld.mi(e,t),this.serializer)}}class h0{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>hF(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=hQ.bind(null,this.syncEngine),await ho(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new hg}createDatastore(e){var t;let n=lM(e.databaseInfo.databaseId),r=new lx(e.databaseInfo);return t=e.authCredentials,new lz(t,e.appCheckCredentials,r,n)}createRemoteStore(e){var t,n;return t=this.localStore,n=this.datastore,new lW(t,n,e.asyncQueue,e=>hF(this.syncEngine,e,0),lS.v()?new lS:new lI)}createSyncEngine(e,t){var n,r,i,s,o,a;let l;return n=this.localStore,r=this.remoteStore,i=this.eventManager,s=this.sharedClientState,o=e.initialUser,a=e.maxConcurrentLimboResolutions,l=new hR(n,r,i,s,o,a),t&&(l.gu=!0),l}async terminate(){await async function(e){iM(lH,"RemoteStore shutting down."),e.Ea.add(5),await lG(e),e.Aa.shutdown(),e.Ra.set("Unknown")}(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}h0.provider={build:()=>new h0};class h1{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):iU("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout(()=>{this.muted||e(t)},0)}}let h2="FirestoreClient";class h6{constructor(e,t,n,r,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=r,this.user=iD.UNAUTHENTICATED,this.clientId=i0.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(n,async e=>{iM(h2,"Received user=",e.uid),await this.authCredentialListener(e),this.user=e}),this.appCheckCredentials.start(n,e=>(iM(h2,"Received new app check token=",e),this.appCheckCredentialListener(e,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();let e=new iH;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(n){let t=hu(n,"Failed to shutdown persistence");e.reject(t)}}),e.promise}}async function h3(e,t){e.asyncQueue.verifyOperationInProgress(),iM(h2,"Initializing OfflineComponentProvider");let n=e.configuration;await t.initialize(n);let r=n.initialUser;e.setCredentialChangeListener(async e=>{r.isEqual(e)||(await l_(t.localStore,e),r=e)}),t.persistence.setDatabaseDeletedListener(()=>e.terminate()),e._offlineComponents=t}async function h4(e,t){e.asyncQueue.verifyOperationInProgress();let n=await h5(e);iM(h2,"Initializing OnlineComponentProvider"),await t.initialize(n,e.configuration),e.setCredentialChangeListener(e=>hs(t.remoteStore,e)),e.setAppCheckTokenChangeListener((e,n)=>hs(t.remoteStore,n)),e._onlineComponents=t}async function h5(e){if(!e._offlineComponents)if(e._uninitializedComponentsProvider){iM(h2,"Using user provided OfflineComponentProvider");try{await h3(e,e._uninitializedComponentsProvider._offline)}catch(t){if(!("FirebaseError"===t.name?t.code===iz.FAILED_PRECONDITION||t.code===iz.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code))throw t;iF("Error using user provided cache. Falling back to memory cache: "+t),await h3(e,new hJ)}}else iM(h2,"Using default OfflineComponentProvider"),await h3(e,new hZ(void 0));return e._offlineComponents}async function h8(e){return e._onlineComponents||(e._uninitializedComponentsProvider?(iM(h2,"Using user provided OnlineComponentProvider"),await h4(e,e._uninitializedComponentsProvider._online)):(iM(h2,"Using default OnlineComponentProvider"),await h4(e,new h0))),e._onlineComponents}async function h7(e){let t=await h8(e),n=t.eventManager;return n.onListen=hN.bind(null,t.syncEngine),n.onUnlisten=hx.bind(null,t.syncEngine),n.onFirstRemoteStoreListen=hP.bind(null,t.syncEngine),n.onLastRemoteStoreUnlisten=hL.bind(null,t.syncEngine),n}function h9(e){let t={};return void 0!==e.timeoutSeconds&&(t.timeoutSeconds=e.timeoutSeconds),t}let ue=new Map,ut="firestore.googleapis.com";class un{constructor(e){if(void 0===e.host){if(void 0!==e.ssl)throw new i$(iz.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=ut,this.ssl=!0}else this.host=e.host,this.ssl=e.ssl??!0;if(this.isUsingEmulator=void 0!==e.emulatorOptions,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=0x2800000;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new i$(iz.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}(function(e,t,n,r){if(!0===t&&!0===r)throw new i$(iz.INVALID_ARGUMENT,`${e} and ${n} cannot be used together.`)})("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===e.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=h9(e.experimentalLongPollingOptions??{}),function(e){if(void 0!==e.timeoutSeconds){if(isNaN(e.timeoutSeconds))throw new i$(iz.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (must not be NaN)`);if(e.timeoutSeconds<5)throw new i$(iz.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (minimum allowed value is 5)`);if(e.timeoutSeconds>30)throw new i$(iz.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){var t,n;return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(t=this.experimentalLongPollingOptions,n=e.experimentalLongPollingOptions,t.timeoutSeconds===n.timeoutSeconds)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class ur{constructor(e,t,n,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new un({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new i$(iz.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return"notTerminated"!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new i$(iz.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new un(e),this._emulatorOptions=e.emulatorOptions||{},void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new iK;switch(e.type){case"firstParty":return new iX(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new i$(iz.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return"notTerminated"===this._terminateTask&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){"notTerminated"===this._terminateTask?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){let e;return(e=ue.get(this))&&(iM("ComponentProvider","Removing Datastore"),ue.delete(this),e.terminate()),Promise.resolve()}}class ui{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new ui(this.firestore,e,this._query)}}class us{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new uo(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new us(this.firestore,e,this._key)}toJSON(){return{type:us._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,n){if(sl(t,us._jsonSchema))return new us(e,n||null,new se(i8.fromString(t.referencePath)))}}us._jsonSchemaVersion="firestore/documentReference/1.0",us._jsonSchema={type:sa("string",us._jsonSchemaVersion),referencePath:sa("string")};class uo extends ui{constructor(e,t,n){super(e,t,oC(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new us(this.firestore,null,new se(e))}withConverter(e){return new uo(this.firestore,e,this._path)}}function ua(e,t,...n){if(e=eL(e),st("collection","path",t),e instanceof ur){let r=i8.fromString(t,...n);return sr(r),new uo(e,null,r)}{if(!(e instanceof us||e instanceof uo))throw new i$(iz.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=e._path.child(i8.fromString(t,...n));return sr(r),new uo(e.firestore,null,r)}}function ul(e,t,...n){if(e=eL(e),1==arguments.length&&(t=i0.newId()),st("doc","path",t),e instanceof ur){let r=i8.fromString(t,...n);return sn(r),new us(e,null,new se(r))}{if(!(e instanceof us||e instanceof uo))throw new i$(iz.INVALID_ARGUMENT,"Expected first argument to doc() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=e._path.child(i8.fromString(t,...n));return sn(r),new us(e.firestore,e instanceof uo?e.converter:null,new se(r))}}let uh="AsyncQueue";class uu{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new lU(this,"async_queue_retry"),this._c=()=>{let e=lL();e&&iM(uh,"Visibility state changed to "+e.visibilityState),this.M_.w_()},this.ac=e;const t=lL();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;let t=lL();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise(()=>{});let t=new iH;return this.cc(()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Xu.push(e),this.lc()))}async lc(){if(0!==this.Xu.length){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!sg(e))throw e;iM(uh,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_(()=>this.lc())}}cc(e){let t=this.ac.then(()=>(this.rc=!0,e().catch(e=>{throw this.nc=e,this.rc=!1,iU("INTERNAL UNHANDLED ERROR: ",uc(e)),e}).then(e=>(this.rc=!1,e))));return this.ac=t,t}enqueueAfterDelay(e,t,n){this.uc(),this.oc.indexOf(e)>-1&&(t=0);let r=hh.createAndSchedule(this,e,t,n,e=>this.hc(e));return this.tc.push(r),r}uc(){this.nc&&iB(47125,{Pc:uc(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(let t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then(()=>{for(let t of(this.tc.sort((e,t)=>e.targetTimeMs-t.targetTimeMs),this.tc))if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.Tc()})}dc(e){this.oc.push(e)}hc(e){let t=this.tc.indexOf(e);this.tc.splice(t,1)}}function uc(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}function ud(e){if("object"!=typeof e||null===e)return!1;for(let t of["next","error","complete"])if(t in e&&"function"==typeof e[t])return!0;return!1}class uf extends ur{constructor(e,t,n,r){super(e,t,n,r),this.type="firestore",this._queue=new uu,this._persistenceKey=r?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){let e=this._firestoreClient.terminate();this._queue=new uu(e),this._firestoreClient=void 0,await e}}}function up(e,t){let n=to("object"==typeof e?e:tv(),"firestore").getImmediate({identifier:"string"==typeof e?e:t||sj});if(!n._initialized){let e=J("firestore");e&&function(e,t,n,r={}){e=so(e,ur);let i=en(t),s=e._getSettings(),o={...s,emulatorOptions:e._getEmulatorOptions()},a=`${t}:${n}`;i&&(er(`https://${a}`),ea("Firestore",!0)),s.host!==ut&&s.host!==a&&iF("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");let l={...s,host:a,ssl:i,emulatorOptions:r};if(!eC(l,o)&&(e._setSettings(l),r.mockUserToken)){let t,n;if("string"==typeof r.mockUserToken)t=r.mockUserToken,n=iD.MOCK_USER;else{t=ei(r.mockUserToken,e._app?.options.projectId);let i=r.mockUserToken.sub||r.mockUserToken.user_id;if(!i)throw new i$(iz.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new iD(i)}e._authCredentials=new iG(new iW(t,n))}}(n,...e)}return n}function ug(e){if(e._terminated)throw new i$(iz.FAILED_PRECONDITION,"The client has already been terminated.");return e._firestoreClient||function(e){var t,n,r;let i,s=e._freezeSettings(),o=(t=e._databaseId,n=e._app?.options.appId||"",new sB(t,n,e._persistenceKey,s.host,s.ssl,s.experimentalForceLongPolling,s.experimentalAutoDetectLongPolling,h9(s.experimentalLongPollingOptions),s.useFetchStreams,s.isUsingEmulator));e._componentsProvider||s.localCache?._offlineComponentProvider&&s.localCache?._onlineComponentProvider&&(e._componentsProvider={_offline:s.localCache._offlineComponentProvider,_online:s.localCache._onlineComponentProvider}),e._firestoreClient=new h6(e._authCredentials,e._appCheckCredentials,e._queue,o,e._componentsProvider&&(r=e._componentsProvider,i=r?._online.build(),{_offline:r?._offline.build(i),_online:i}))}(e),e._firestoreClient}class um{constructor(e){this._byteString=e}static fromBase64String(e){try{return new um(sA.fromBase64String(e))}catch(e){throw new i$(iz.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new um(sA.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:um._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(sl(e,um._jsonSchema))return um.fromBase64String(e.bytes)}}um._jsonSchemaVersion="firestore/bytes/1.0",um._jsonSchema={type:sa("string",um._jsonSchemaVersion),bytes:sa("string")};class uy{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new i$(iz.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new i9(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class u_{constructor(e){this._methodName=e}}class uv{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new i$(iz.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new i$(iz.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return i1(this._lat,e._lat)||i1(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:uv._jsonSchemaVersion}}static fromJSON(e){if(sl(e,uv._jsonSchema))return new uv(e.latitude,e.longitude)}}uv._jsonSchemaVersion="firestore/geoPoint/1.0",uv._jsonSchema={type:sa("string",uv._jsonSchemaVersion),latitude:sa("number"),longitude:sa("number")};class uw{constructor(e){this._values=(e||[]).map(e=>e)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0}(this._values,e._values)}toJSON(){return{type:uw._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(sl(e,uw._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every(e=>"number"==typeof e))return new uw(e.vectorValues);throw new i$(iz.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}uw._jsonSchemaVersion="firestore/vectorValue/1.0",uw._jsonSchema={type:sa("string",uw._jsonSchemaVersion),vectorValues:sa("object")};let ub=/^__.*__$/;class uE{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new ar(e,this.data,this.fieldMask,t,this.fieldTransforms):new an(e,this.data,t,this.fieldTransforms)}}class uT{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new ar(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function uI(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw iB(40011,{Ac:e})}}class uC{constructor(e,t,n,r,i,s){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=r,void 0===i&&this.Rc(),this.fieldTransforms=i||[],this.fieldMask=s||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(e){return new uC({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){let t=this.path?.child(e),n=this.Vc({path:t,fc:!1});return n.gc(e),n}yc(e){let t=this.path?.child(e),n=this.Vc({path:t,fc:!1});return n.Rc(),n}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return uU(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(0===e.length)throw this.Sc("Document fields must not be empty");if(uI(this.Ac)&&ub.test(e))throw this.Sc('Document fields cannot begin and end with "__"')}}class uS{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||lM(e)}Cc(e,t,n,r=!1){return new uC({Ac:e,methodName:t,Dc:n,path:i9.emptyPath(),fc:!1,bc:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function uk(e){let t=e._freezeSettings(),n=lM(e._databaseId);return new uS(e._databaseId,!!t.ignoreUndefinedProperties,n)}function uA(e,t,n,r,i,s={}){let o,a,l=e.Cc(s.merge||s.mergeFields?2:0,t,n,i);uO("Data must be an object, but it was:",l,r);let h=uP(r,l);if(s.merge)o=new sS(l.fieldMask),a=l.fieldTransforms;else if(s.mergeFields){let e=[];for(let r of s.mergeFields){let i=ux(t,r,n);if(!l.contains(i))throw new i$(iz.INVALID_ARGUMENT,`Field '${i}' is specified in your field mask but missing from your input data.`);uF(e,i)||e.push(i)}o=new sS(e),a=l.fieldTransforms.filter(e=>o.covers(e.field))}else o=null,a=l.fieldTransforms;return new uE(new oe(h),o,a)}class uR extends u_{_toFieldTransform(e){if(2!==e.Ac)throw 1===e.Ac?e.Sc(`${this._methodName}() can only appear at the top level of your update data`):e.Sc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof uR}}function uN(e,t){if(uD(e=eL(e)))return uO("Unsupported field value:",t,e),uP(e,t);if(e instanceof u_)return function(e,t){if(!uI(t.Ac))throw t.Sc(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t.Sc(`${e._methodName}() is not currently supported inside arrays`);let n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.fc&&4!==t.Ac)throw t.Sc("Nested arrays are not supported");let n=[],r=0;for(let i of e){let e=uN(i,t.wc(r));null==e&&(e={nullValue:"NULL_VALUE"}),n.push(e),r++}return{arrayValue:{values:n}}}return function(e,t){var n,r,i;if(null===(e=eL(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return n=t.serializer,"number"==typeof(i=r=e)&&Number.isInteger(i)&&!sy(i)&&i<=Number.MAX_SAFE_INTEGER&&i>=Number.MIN_SAFE_INTEGER?oG(r):oK(n,r);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){let n=sh.fromDate(e);return{timestampValue:aO(t.serializer,n)}}if(e instanceof sh){let n=new sh(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:aO(t.serializer,n)}}if(e instanceof uv)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof um)return{bytesValue:ax(t.serializer,e._byteString)};if(e instanceof us){let n=t.databaseId,r=e.firestore._databaseId;if(!r.isEqual(n))throw t.Sc(`Document reference is for database ${r.projectId}/${r.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:aM(e.firestore._databaseId||t.databaseId,e._key.path)}}if(e instanceof uw)return{mapValue:{fields:{[sz]:{stringValue:sW},[sK]:{arrayValue:{values:e.toArray().map(e=>{if("number"!=typeof e)throw t.Sc("VectorValues must only contain numeric values.");return oK(t.serializer,e)})}}}}};throw t.Sc(`Unsupported field value: ${ss(e)}`)}(e,t)}function uP(e,t){let n={};return sw(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):sv(e,(e,r)=>{let i=uN(r,t.mc(e));null!=i&&(n[e]=i)}),{mapValue:{fields:n}}}function uD(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof sh||e instanceof uv||e instanceof um||e instanceof us||e instanceof u_||e instanceof uw)}function uO(e,t,n){if(!uD(n)||!si(n)){let r=ss(n);throw"an object"===r?t.Sc(e+" a custom object"):t.Sc(e+" "+r)}}function ux(e,t,n){if((t=eL(t))instanceof uy)return t._internalPath;if("string"==typeof t)return uM(e,t);throw uU("Field path arguments must be of type string or ",e,!1,void 0,n)}let uL=RegExp("[~\\*/\\[\\]]");function uM(e,t,n){if(t.search(uL)>=0)throw uU(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,n);try{return new uy(...t.split("."))._internalPath}catch(r){throw uU(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,n)}}function uU(e,t,n,r,i){let s=r&&!r.isEmpty(),o=void 0!==i,a=`Function ${t}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let l="";return(s||o)&&(l+=" (found",s&&(l+=` in field ${r}`),o&&(l+=` in document ${i}`),l+=")"),new i$(iz.INVALID_ARGUMENT,a+e+l)}function uF(e,t){return e.some(e=>e.isEqual(t))}class uV{constructor(e,t,n,r,i){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=r,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new us(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){let e=new uB(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){let t=this._document.data.field(uj("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class uB extends uV{data(){return super.data()}}function uj(e,t){return"string"==typeof t?uM(e,t):t instanceof uy?t._internalPath:t._delegate._internalPath}function uq(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new i$(iz.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class uz{}class u$ extends uz{}function uH(e,t,...n){let r=[];for(let i of(t instanceof uz&&r.push(t),function(e){let t=e.filter(e=>e instanceof uG).length,n=e.filter(e=>e instanceof uW).length;if(t>1||t>0&&n>0)throw new i$(iz.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r=r.concat(n)),r))e=i._apply(e);return e}class uW extends u${constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new uW(e,t,n)}_apply(e){let t=this._parse(e);return uX(e._query,t),new ui(e.firestore,e.converter,oN(e._query,t))}_parse(e){let t=uk(e.firestore);return function(e,t,n,r,i,s,o){let a;if(i.isKeyField()){if("array-contains"===s||"array-contains-any"===s)throw new i$(iz.INVALID_ARGUMENT,`Invalid Query. You can't perform '${s}' queries on documentId().`);if("in"===s||"not-in"===s){uY(o,s);let t=[];for(let n of o)t.push(uQ(r,e,n));a={arrayValue:{values:t}}}else a=uQ(r,e,o)}else"in"!==s&&"not-in"!==s&&"array-contains-any"!==s||uY(o,s),a=function(e,t,n,r=!1){return uN(n,e.Cc(r?4:3,t))}(n,t,o,"in"===s||"not-in"===s);return oa.create(i,s,a)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function uK(e,t,n){let r=uj("where",e);return uW._create(r,t,n)}class uG extends uz{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new uG(e,t)}_parse(e){let t=this._queryConstraints.map(t=>t._parse(e)).filter(e=>e.getFilters().length>0);return 1===t.length?t[0]:ol.create(t,this._getOperator())}_apply(e){let t=this._parse(e);return 0===t.getFilters().length?e:(function(e,t){let n=e;for(let e of t.getFlattenedFilters())uX(n,e),n=oN(n,e)}(e._query,t),new ui(e.firestore,e.converter,oN(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}function uQ(e,t,n){if("string"==typeof(n=eL(n))){if(""===n)throw new i$(iz.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!ok(t)&&-1!==n.indexOf("/"))throw new i$(iz.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);let r=t.path.child(i8.fromString(n));if(!se.isDocumentKey(r))throw new i$(iz.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return s1(e,new se(r))}if(n instanceof us)return s1(e,n._key);throw new i$(iz.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${ss(n)}.`)}function uY(e,t){if(!Array.isArray(e)||0===e.length)throw new i$(iz.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function uX(e,t){let n=function(e,t){for(let n of e)for(let e of n.getFlattenedFilters())if(t.indexOf(e.op)>=0)return e.op;return null}(e.filters,function(e){switch(e){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(null!==n)throw n===t.op?new i$(iz.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new i$(iz.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${n.toString()}' filters.`)}class uJ{convertValue(e,t="none"){switch(sG(e)){case 0:return null;case 1:return e.booleanValue;case 2:return sP(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(sD(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw iB(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let n={};return sv(e,(e,r)=>{n[e]=this.convertValue(r,t)}),n}convertVectorValue(e){return new uw(e.fields?.[sK].arrayValue?.values?.map(e=>sP(e.doubleValue)))}convertGeoPoint(e){return new uv(sP(e.latitude),sP(e.longitude))}convertArray(e,t){return(e.values||[]).map(e=>this.convertValue(e,t))}convertServerTimestamp(e,t){switch(t){case"previous":let n=sF(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(sV(e));default:return null}}convertTimestamp(e){let t=sN(e);return new sh(t.seconds,t.nanos)}convertDocumentKey(e,t){let n=i8.fromString(e);iq(aK(n),9688,{name:e});let r=new sq(n.get(1),n.get(3)),i=new se(n.popFirst(5));return r.isEqual(t)||iU(`Document ${i} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}function uZ(e,t,n){return e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t}class u0{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class u1 extends uV{constructor(e,t,n,r,i,s){super(e,t,n,r,s),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){let t=new u2(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){let n=this._document.data.field(uj("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new i$(iz.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let e=this._document,t={};return t.type=u1._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),e&&e.isValidDocument()&&e.isFoundDocument()&&(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),this._firestore,this.ref.path,t.bundle="NOT SUPPORTED"),t}}u1._jsonSchemaVersion="firestore/documentSnapshot/1.0",u1._jsonSchema={type:sa("string",u1._jsonSchemaVersion),bundleSource:sa("string","DocumentSnapshot"),bundleName:sa("string"),bundle:sa("string")};class u2 extends u1{data(e={}){return super.data(e)}}class u6{constructor(e,t,n,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new u0(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(n=>{e.call(t,new u2(this._firestore,this._userDataWriter,n.key,n,new u0(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new i$(iz.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map(n=>{let r=new u2(e._firestore,e._userDataWriter,n.doc.key,n.doc,new u0(e._snapshot.mutatedKeys.has(n.doc.key),e._snapshot.fromCache),e.query.converter);return n.doc,{type:"added",doc:r,oldIndex:-1,newIndex:t++}})}{let n=e._snapshot.oldDocs;return e._snapshot.docChanges.filter(e=>t||3!==e.type).map(t=>{let r=new u2(e._firestore,e._userDataWriter,t.doc.key,t.doc,new u0(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter),i=-1,s=-1;return 0!==t.type&&(i=n.indexOf(t.doc.key),n=n.delete(t.doc.key)),1!==t.type&&(s=(n=n.add(t.doc)).indexOf(t.doc.key)),{type:function(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return iB(61501,{type:e})}}(t.type),doc:r,oldIndex:i,newIndex:s}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new i$(iz.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let e={};e.type=u6._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=i0.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;let t=[],n=[],r=[];return this.docs.forEach(e=>{null!==e._document&&(t.push(e._document),n.push(this._userDataWriter.convertObjectMap(e._document.data.value.mapValue.fields,"previous")),r.push(e.ref.path))}),this._firestore,this.query._query,e.bundleName,e.bundle="NOT SUPPORTED",e}}function u3(e){e=so(e,us);let t=so(e.firestore,uf);return(function(e,t,n={}){let r=new iH;return e.asyncQueue.enqueueAndForget(async()=>{var i,s;let o,a;return i=await h7(e),s=e.asyncQueue,o=new h1({next:e=>{o.Nu(),s.enqueueAndForget(()=>h_(i,a));let l=e.docs.has(t);!l&&e.fromCache?r.reject(new i$(iz.UNAVAILABLE,"Failed to get document because the client is offline.")):l&&e.fromCache&&n&&"server"===n.source?r.reject(new i$(iz.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):r.resolve(e)},error:e=>r.reject(e)}),hy(i,a=new hE(oC(t.path),o,{includeMetadataChanges:!0,qa:!0}))}),r.promise})(ug(t),e._key).then(n=>cr(t,e,n))}u6._jsonSchemaVersion="firestore/querySnapshot/1.0",u6._jsonSchema={type:sa("string",u6._jsonSchemaVersion),bundleSource:sa("string","QuerySnapshot"),bundleName:sa("string"),bundle:sa("string")};class u4 extends uJ{constructor(e){super(),this.firestore=e}convertBytes(e){return new um(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new us(this.firestore,null,t)}}function u5(e){e=so(e,ui);let t=so(e.firestore,uf),n=ug(t),r=new u4(t);return uq(e._query),(function(e,t,n={}){let r=new iH;return e.asyncQueue.enqueueAndForget(async()=>{var i,s;let o,a;return i=await h7(e),s=e.asyncQueue,a=new hE(t,o=new h1({next:e=>{o.Nu(),s.enqueueAndForget(()=>h_(i,a)),e.fromCache&&"server"===n.source?r.reject(new i$(iz.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):r.resolve(e)},error:e=>r.reject(e)}),{includeMetadataChanges:!0,qa:!0}),hy(i,a)}),r.promise})(n,e._query).then(n=>new u6(t,r,e,n))}function u8(e,t,n){e=so(e,us);let r=so(e.firestore,uf),i=uZ(e.converter,t,n);return cn(r,[uA(uk(r),"setDoc",e._key,i,null!==e.converter,n).toMutation(e._key,o5.none())])}function u7(e,t,n,...r){var i,s,o;let a,l,h;e=so(e,us);let u=so(e.firestore,uf),c=uk(u);return cn(u,[("string"==typeof(t=eL(t))||t instanceof uy?function(e,t,n,r,i,s){let o=e.Cc(1,t,n),a=[ux(t,r,n)],l=[i];if(s.length%2!=0)throw new i$(iz.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let e=0;e<s.length;e+=2)a.push(ux(t,s[e])),l.push(s[e+1]);let h=[],u=oe.empty();for(let e=a.length-1;e>=0;--e)if(!uF(h,a[e])){let t=a[e],n=l[e];n=eL(n);let r=o.yc(t);if(n instanceof uR)h.push(t);else{let e=uN(n,r);null!=e&&(h.push(t),u.set(t,e))}}return new uT(u,new sS(h),o.fieldTransforms)}(c,"updateDoc",e._key,t,n,r):(i="updateDoc",s=e._key,o=t,uO("Data must be an object, but it was:",a=c.Cc(1,i,s),o),l=[],h=oe.empty(),sv(o,(e,t)=>{let n=uM(i,e,s);t=eL(t);let r=a.yc(n);if(t instanceof uR)l.push(n);else{let e=uN(t,r);null!=e&&(l.push(n),h.set(n,e))}}),new uT(h,new sS(l),a.fieldTransforms))).toMutation(e._key,o5.exists(!0))])}function u9(e){return cn(so(e.firestore,uf),[new aa(e._key,o5.none())])}function ce(e,t){let n=so(e.firestore,uf),r=ul(e),i=uZ(e.converter,t);return cn(n,[uA(uk(e.firestore),"addDoc",r._key,i,null!==e.converter,{}).toMutation(r._key,o5.exists(!1))]).then(()=>r)}function ct(e,...t){var n;let r,i,s,o,a;e=eL(e);let l={includeMetadataChanges:!1,source:"default"},h=0;"object"!=typeof t[0]||ud(t[h])||(l=t[h++]);let u={includeMetadataChanges:l.includeMetadataChanges,source:l.source};if(ud(t[h])){let e=t[h];t[h]=e.next?.bind(e),t[h+1]=e.error?.bind(e),t[h+2]=e.complete?.bind(e)}if(e instanceof us)i=so(e.firestore,uf),s=oC(e._key.path),r={next:n=>{t[h]&&t[h](cr(i,e,n))},error:t[h+1],complete:t[h+2]};else{let n=so(e,ui);i=so(n.firestore,uf),s=n._query;let o=new u4(i);r={next:e=>{t[h]&&t[h](new u6(i,o,n,e))},error:t[h+1],complete:t[h+2]},uq(e._query)}return n=ug(i),a=new hE(s,o=new h1(r),u),n.asyncQueue.enqueueAndForget(async()=>hy(await h7(n),a)),()=>{o.Nu(),n.asyncQueue.enqueueAndForget(async()=>h_(await h7(n),a))}}function cn(e,t){var n;let r;return n=ug(e),r=new iH,n.asyncQueue.enqueueAndForget(async()=>hM(await h8(n).then(e=>e.syncEngine),t,r)),r.promise}function cr(e,t,n){let r=n.docs.get(t._key),i=new u4(e);return new u1(e,i,t._key,r,new u0(n.hasPendingWrites,n.fromCache),t.converter)}new WeakMap,function(e=!0){iO=tm,ts(new eM("firestore",(t,{instanceIdentifier:n,options:r})=>{let i=t.getProvider("app").getImmediate(),s=new uf(new iQ(t.getProvider("auth-internal")),new iZ(i,t.getProvider("app-check-internal")),function(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new i$(iz.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new sq(e.options.projectId,t)}(i,n),i);return r={useFetchStreams:e,...r},s._setSettings(r),s},"PUBLIC").setMultipleInstances(!0)),tE(iN,iP,void 0),tE(iN,iP,"esm2020")}(),e.s(["addDoc",()=>ce,"collection",()=>ua,"deleteDoc",()=>u9,"doc",()=>ul,"getDoc",()=>u3,"getDocs",()=>u5,"getFirestore",()=>up,"onSnapshot",()=>ct,"query",()=>uH,"setDoc",()=>u8,"updateDoc",()=>u7,"where",()=>uK],98925),e.s([],36180);let ci="firebasestorage.googleapis.com",cs="storageBucket";class co extends ef{constructor(e,t,n=0){super(ca(e),`Firebase Storage: ${t} (${ca(e)})`),this.status_=n,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,co.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return ca(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}function ca(e){return"storage/"+e}function cl(){return new co(L.UNKNOWN,"An unknown error occurred, please check the error payload for server response.")}function ch(e){return new co(L.INVALID_ARGUMENT,e)}function cu(){return new co(L.APP_DELETED,"The Firebase app was deleted.")}function cc(e,t){return new co(L.INVALID_FORMAT,"String does not match format '"+e+"': "+t)}function cd(e){throw new co(L.INTERNAL_ERROR,"Internal error: "+e)}(y=L||(L={})).UNKNOWN="unknown",y.OBJECT_NOT_FOUND="object-not-found",y.BUCKET_NOT_FOUND="bucket-not-found",y.PROJECT_NOT_FOUND="project-not-found",y.QUOTA_EXCEEDED="quota-exceeded",y.UNAUTHENTICATED="unauthenticated",y.UNAUTHORIZED="unauthorized",y.UNAUTHORIZED_APP="unauthorized-app",y.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",y.INVALID_CHECKSUM="invalid-checksum",y.CANCELED="canceled",y.INVALID_EVENT_NAME="invalid-event-name",y.INVALID_URL="invalid-url",y.INVALID_DEFAULT_BUCKET="invalid-default-bucket",y.NO_DEFAULT_BUCKET="no-default-bucket",y.CANNOT_SLICE_BLOB="cannot-slice-blob",y.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",y.NO_DOWNLOAD_URL="no-download-url",y.INVALID_ARGUMENT="invalid-argument",y.INVALID_ARGUMENT_COUNT="invalid-argument-count",y.APP_DELETED="app-deleted",y.INVALID_ROOT_OPERATION="invalid-root-operation",y.INVALID_FORMAT="invalid-format",y.INTERNAL_ERROR="internal-error",y.UNSUPPORTED_ENVIRONMENT="unsupported-environment";class cf{constructor(e,t){this.bucket=e,this.path_=t}get path(){return this.path_}get isRoot(){return 0===this.path.length}fullServerUrl(){let e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,t){let n;try{n=cf.makeFromUrl(e,t)}catch(t){return new cf(e,"")}if(""===n.path)return n;throw new co(L.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+e+"'.")}static makeFromUrl(e,t){let n=null,r="([A-Za-z0-9.\\-_]+)",i=RegExp("^gs://"+r+"(/(.*))?$","i");function s(e){e.path_=decodeURIComponent(e.path)}let o=t.replace(/[.]/g,"\\."),a=RegExp(`^https?://${o}/v[A-Za-z0-9_]+/b/${r}/o(/([^?#]*).*)?$`,"i"),l=t===ci?"(?:storage.googleapis.com|storage.cloud.google.com)":t,h=[{regex:i,indices:{bucket:1,path:3},postModify:function(e){"/"===e.path.charAt(e.path.length-1)&&(e.path_=e.path_.slice(0,-1))}},{regex:a,indices:{bucket:1,path:3},postModify:s},{regex:RegExp(`^https?://${l}/${r}/([^?#]*)`,"i"),indices:{bucket:1,path:2},postModify:s}];for(let t=0;t<h.length;t++){let r=h[t],i=r.regex.exec(e);if(i){let e=i[r.indices.bucket],t=i[r.indices.path];t||(t=""),n=new cf(e,t),r.postModify(n);break}}if(null==n)throw new co(L.INVALID_URL,"Invalid URL '"+e+"'.");return n}}class cp{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}function cg(e){return"string"==typeof e||e instanceof String}function cm(e){return cy()&&e instanceof Blob}function cy(){return"undefined"!=typeof Blob}function c_(e,t,n,r){if(r<t)throw ch(`Invalid value for '${e}'. Expected ${t} or greater.`);if(r>n)throw ch(`Invalid value for '${e}'. Expected ${n} or less.`)}function cv(e,t,n){let r=t;return null==n&&(r=`https://${t}`),`${n}://${r}/v0${e}`}function cw(e){let t=encodeURIComponent,n="?";for(let r in e)e.hasOwnProperty(r)&&(n=n+(t(r)+"=")+t(e[r])+"&");return n.slice(0,-1)}(_=M||(M={}))[_.NO_ERROR=0]="NO_ERROR",_[_.NETWORK_ERROR=1]="NETWORK_ERROR",_[_.ABORT=2]="ABORT";class cb{constructor(e,t,n,r,i,s,o,a,l,h,u,c=!0,d=!1){this.url_=e,this.method_=t,this.headers_=n,this.body_=r,this.successCodes_=i,this.additionalRetryCodes_=s,this.callback_=o,this.errorCallback_=a,this.timeout_=l,this.progressCallback_=h,this.connectionFactory_=u,this.retry=c,this.isUsingEmulator=d,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((e,t)=>{this.resolve_=e,this.reject_=t,this.start_()})}start_(){let e=(e,t)=>{if(t)return void e(!1,new cE(!1,null,!0));let n=this.connectionFactory_();this.pendingConnection_=n;let r=e=>{let t=e.loaded,n=e.lengthComputable?e.total:-1;null!==this.progressCallback_&&this.progressCallback_(t,n)};null!==this.progressCallback_&&n.addUploadProgressListener(r),n.send(this.url_,this.method_,this.isUsingEmulator,this.body_,this.headers_).then(()=>{var t;let i,s,o;null!==this.progressCallback_&&n.removeUploadProgressListener(r),this.pendingConnection_=null;let a=n.getErrorCode()===M.NO_ERROR,l=n.getStatus();!a||(t=this.additionalRetryCodes_,i=l>=500&&l<600,s=-1!==[408,429].indexOf(l),o=-1!==t.indexOf(l),(i||s||o)&&this.retry)?e(!1,new cE(!1,null,n.getErrorCode()===M.ABORT)):e(!0,new cE(-1!==this.successCodes_.indexOf(l),n))})},t=(e,t)=>{let n=this.resolve_,r=this.reject_,i=t.connection;if(t.wasSuccessCode)try{let e=this.callback_(i,i.getResponse());void 0!==e?n(e):n()}catch(e){r(e)}else if(null!==i){let e=cl();e.serverResponse=i.getErrorText(),r(this.errorCallback_?this.errorCallback_(i,e):e)}else r(t.canceled?this.appDelete_?cu():new co(L.CANCELED,"User canceled the upload/download."):new co(L.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again."))};this.canceled_?t(!1,new cE(!1,null,!0)):this.backoffId_=function(e,t,n){let r=1,i=null,s=null,o=!1,a=0,l=!1;function h(...e){l||(l=!0,t.apply(null,e))}function u(t){i=setTimeout(()=>{i=null,e(d,2===a)},t)}function c(){s&&clearTimeout(s)}function d(e,...t){let n;if(l)return void c();if(e||2===a||o){c(),h.call(null,e,...t);return}r<64&&(r*=2),1===a?(a=2,n=0):n=(r+Math.random())*1e3,u(n)}let f=!1;function p(e){f||(f=!0,c(),!l&&(null!==i?(e||(a=2),clearTimeout(i),u(0)):e||(a=1)))}return u(0),s=setTimeout(()=>{o=!0,p(!0)},n),p}(e,t,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,null!==this.backoffId_&&(0,this.backoffId_)(!1),null!==this.pendingConnection_&&this.pendingConnection_.abort()}}class cE{constructor(e,t,n){this.wasSuccessCode=e,this.connection=t,this.canceled=!!n}}function cT(...e){let t="undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof WebKitBlobBuilder?WebKitBlobBuilder:void 0;if(void 0!==t){let n=new t;for(let t=0;t<e.length;t++)n.append(e[t]);return n.getBlob()}if(cy())return new Blob(e);throw new co(L.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}let cI="base64",cC="base64url",cS="data_url";class ck{constructor(e,t){this.data=e,this.contentType=t||null}}function cA(e){let t=[];for(let n=0;n<e.length;n++){let r=e.charCodeAt(n);r<=127?t.push(r):r<=2047?t.push(192|r>>6,128|63&r):(64512&r)==55296?n<e.length-1&&(64512&e.charCodeAt(n+1))==56320?(r=65536|(1023&r)<<10|1023&e.charCodeAt(++n),t.push(240|r>>18,128|r>>12&63,128|r>>6&63,128|63&r)):t.push(239,191,189):(64512&r)==56320?t.push(239,191,189):t.push(224|r>>12,128|r>>6&63,128|63&r)}return new Uint8Array(t)}function cR(e,t){let n;switch(e){case cI:{let n=-1!==t.indexOf("-"),r=-1!==t.indexOf("_");if(n||r)throw cc(e,"Invalid character '"+(n?"-":"_")+"' found: is it base64url encoded?");break}case cC:{let n=-1!==t.indexOf("+"),r=-1!==t.indexOf("/");if(n||r)throw cc(e,"Invalid character '"+(n?"+":"/")+"' found: is it base64 encoded?");t=t.replace(/-/g,"+").replace(/_/g,"/")}}try{n=function(e){if("undefined"==typeof atob)throw new co(L.UNSUPPORTED_ENVIRONMENT,"base-64 is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information.");return atob(e)}(t)}catch(t){if(t.message.includes("polyfill"))throw t;throw cc(e,"Invalid character found")}let r=new Uint8Array(n.length);for(let e=0;e<n.length;e++)r[e]=n.charCodeAt(e);return r}class cN{constructor(e){this.base64=!1,this.contentType=null;const t=e.match(/^data:([^,]+)?,/);if(null===t)throw cc(cS,"Must be formatted 'data:[<mediatype>][;base64],<data>");const n=t[1]||null;null!=n&&(this.base64=function(e,t){return e.length>=t.length&&e.substring(e.length-t.length)===t}(n,";base64"),this.contentType=this.base64?n.substring(0,n.length-7):n),this.rest=e.substring(e.indexOf(",")+1)}}class cP{constructor(e,t){let n=0,r="";cm(e)?(this.data_=e,n=e.size,r=e.type):e instanceof ArrayBuffer?(t?this.data_=new Uint8Array(e):(this.data_=new Uint8Array(e.byteLength),this.data_.set(new Uint8Array(e))),n=this.data_.length):e instanceof Uint8Array&&(t?this.data_=e:(this.data_=new Uint8Array(e.length),this.data_.set(e)),n=e.length),this.size_=n,this.type_=r}size(){return this.size_}type(){return this.type_}slice(e,t){if(!cm(this.data_))return new cP(new Uint8Array(this.data_.buffer,e,t-e),!0);{var n,r,i;let s=(n=this.data_,r=e,i=t,n.webkitSlice?n.webkitSlice(r,i):n.mozSlice?n.mozSlice(r,i):n.slice?n.slice(r,i):null);return null===s?null:new cP(s)}}static getBlob(...e){if(cy()){let t=e.map(e=>e instanceof cP?e.data_:e);return new cP(cT.apply(null,t))}{let t=e.map(e=>cg(e)?function(e,t){return new ck(cA(t))}("raw",e).data:e.data_),n=0;t.forEach(e=>{n+=e.byteLength});let r=new Uint8Array(n),i=0;return t.forEach(e=>{for(let t=0;t<e.length;t++)r[i++]=e[t]}),new cP(r,!0)}}uploadData(){return this.data_}}function cD(e){var t;let n;try{n=JSON.parse(e)}catch(e){return null}return"object"!=typeof(t=n)||Array.isArray(t)?null:n}function cO(e){let t=e.lastIndexOf("/",e.length-2);return -1===t?e:e.slice(t+1)}function cx(e,t){return t}class cL{constructor(e,t,n,r){this.server=e,this.local=t||e,this.writable=!!n,this.xform=r||cx}}let cM=null;function cU(){if(cM)return cM;let e=[];e.push(new cL("bucket")),e.push(new cL("generation")),e.push(new cL("metageneration")),e.push(new cL("name","fullPath",!0));let t=new cL("name");t.xform=function(e,t){return!cg(t)||t.length<2?t:cO(t)},e.push(t);let n=new cL("size");return n.xform=function(e,t){return void 0!==t?Number(t):t},e.push(n),e.push(new cL("timeCreated")),e.push(new cL("updated")),e.push(new cL("md5Hash",null,!0)),e.push(new cL("cacheControl",null,!0)),e.push(new cL("contentDisposition",null,!0)),e.push(new cL("contentEncoding",null,!0)),e.push(new cL("contentLanguage",null,!0)),e.push(new cL("contentType",null,!0)),e.push(new cL("metadata","customMetadata",!0)),cM=e}function cF(e,t,n){let r=cD(t);return null===r?null:function(e,t,n){let r={};r.type="file";let i=n.length;for(let e=0;e<i;e++){let i=n[e];r[i.local]=i.xform(r,t[i.server])}return Object.defineProperty(r,"ref",{get:function(){let t=new cf(r.bucket,r.fullPath);return e._makeStorageReference(t)}}),r}(e,r,n)}class cV{constructor(e,t,n,r){this.url=e,this.method=t,this.handler=n,this.timeout=r,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}function cB(e){if(!e)throw cl()}function cj(e){return function(t,n){var r,i;let s;return 401===t.getStatus()?s=t.getErrorText().includes("Firebase App Check token is invalid")?new co(L.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project."):new co(L.UNAUTHENTICATED,"User is not authenticated, please authenticate using Firebase Authentication and try again."):402===t.getStatus()?(r=e.bucket,s=new co(L.QUOTA_EXCEEDED,"Quota for bucket '"+r+"' exceeded, please view quota on https://firebase.google.com/pricing/.")):403===t.getStatus()?(i=e.path,s=new co(L.UNAUTHORIZED,"User does not have permission to access '"+i+"'.")):s=n,s.status=t.getStatus(),s.serverResponse=n.serverResponse,s}}class cq{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=M.NO_ERROR,this.sendPromise_=new Promise(e=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=M.ABORT,e()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=M.NETWORK_ERROR,e()}),this.xhr_.addEventListener("load",()=>{e()})})}send(e,t,n,r,i){if(this.sent_)throw cd("cannot .send() more than once");if(en(e)&&n&&(this.xhr_.withCredentials=!0),this.sent_=!0,this.xhr_.open(t,e,!0),void 0!==i)for(let e in i)i.hasOwnProperty(e)&&this.xhr_.setRequestHeader(e,i[e].toString());return void 0!==r?this.xhr_.send(r):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw cd("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw cd("cannot .getStatus() before sending");try{return this.xhr_.status}catch(e){return -1}}getResponse(){if(!this.sent_)throw cd("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw cd("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(e){return this.xhr_.getResponseHeader(e)}addUploadProgressListener(e){null!=this.xhr_.upload&&this.xhr_.upload.addEventListener("progress",e)}removeUploadProgressListener(e){null!=this.xhr_.upload&&this.xhr_.upload.removeEventListener("progress",e)}}class cz extends cq{initXhr(){this.xhr_.responseType="text"}}function c$(){return new cz}class cH{constructor(e,t){this._service=e,t instanceof cf?this._location=t:this._location=cf.makeFromUrl(t,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,t){return new cH(e,t)}get root(){let e=new cf(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return cO(this._location.path)}get storage(){return this._service}get parent(){let e=function(e){if(0===e.length)return null;let t=e.lastIndexOf("/");return -1===t?"":e.slice(0,t)}(this._location.path);if(null===e)return null;let t=new cf(this._location.bucket,e);return new cH(this._service,t)}_throwIfRoot(e){if(""===this._location.path)throw new co(L.INVALID_ROOT_OPERATION,"The operation '"+e+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}}function cW(e,t){let n=t?.[cs];return null==n?null:cf.makeFromBucketSpec(n,e)}class cK{constructor(e,t,n,r,i,s=!1){this.app=e,this._authProvider=t,this._appCheckProvider=n,this._url=r,this._firebaseVersion=i,this._isUsingEmulator=s,this._bucket=null,this._host=ci,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=12e4,this._maxUploadRetryTime=6e5,this._requests=new Set,null!=r?this._bucket=cf.makeFromBucketSpec(r,this._host):this._bucket=cW(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,null!=this._url?this._bucket=cf.makeFromBucketSpec(this._url,e):this._bucket=cW(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){c_("time",0,1/0,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){c_("time",0,1/0,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;let e=this._authProvider.getImmediate({optional:!0});if(e){let t=await e.getToken();if(null!==t)return t.accessToken}return null}async _getAppCheckToken(){if(tu(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;let e=this._appCheckProvider.getImmediate({optional:!0});return e?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new cH(this,e)}_makeRequest(e,t,n,r,i=!0){if(this._deleted)return new cp(cu());{let s=function(e,t,n,r,i,s,o=!0,a=!1){let l=cw(e.urlParams),h=e.url+l,u=Object.assign({},e.headers);return t&&(u["X-Firebase-GMPID"]=t),null!==n&&n.length>0&&(u.Authorization="Firebase "+n),u["X-Firebase-Storage-Version"]="webjs/"+(s??"AppManager"),null!==r&&(u["X-Firebase-AppCheck"]=r),new cb(h,e.method,u,e.body,e.successCodes,e.additionalRetryCodes,e.handler,e.errorHandler,e.timeout,e.progressCallback,i,o,a)}(e,this._appId,n,r,t,this._firebaseVersion,i,this._isUsingEmulator);return this._requests.add(s),s.getPromise().then(()=>this._requests.delete(s),()=>this._requests.delete(s)),s}}async makeRequestWithTokens(e,t){let[n,r]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,t,n,r).getPromise()}}let cG="@firebase/storage",cQ="0.14.0",cY="storage";function cX(e,t,n){var r;let i;return r=e=eL(e),r._throwIfRoot("uploadBytes"),i=function(e,t,n,r,i){let s,o=t.bucketOnlyServerUrl(),a={"X-Goog-Upload-Protocol":"multipart"},l=function(){let e="";for(let t=0;t<2;t++)e+=Math.random().toString().slice(2);return e}();a["Content-Type"]="multipart/related; boundary="+l;let h=((s=Object.assign({},i)).fullPath=t.path,s.size=r.size(),s.contentType||(s.contentType=r&&r.type()||"application/octet-stream"),s),u="--"+l+"\r\nContent-Type: application/json; charset=utf-8\r\n\r\n"+function(e,t){let n={},r=t.length;for(let i=0;i<r;i++){let r=t[i];r.writable&&(n[r.server]=e[r.local])}return JSON.stringify(n)}(h,n)+"\r\n--"+l+"\r\nContent-Type: "+h.contentType+"\r\n\r\n",c=cP.getBlob(u,r,"\r\n--"+l+"--");if(null===c)throw new co(L.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.");let d={name:h.fullPath},f=cv(o,e.host,e._protocol),p=e.maxUploadRetryTime,g=new cV(f,"POST",function(t,r){let i=cF(e,r,n);return cB(null!==i),i},p);return g.urlParams=d,g.headers=a,g.body=c.uploadData(),g.errorHandler=cj(t),g}(r.storage,r._location,cU(),new cP(t,!0),n),r.storage.makeRequestWithTokens(i,c$).then(e=>({metadata:e,ref:r}))}function cJ(e){var t,n,r,i;let s,o,a,l,h;return(t=e=eL(e))._throwIfRoot("getDownloadURL"),n=t.storage,r=t._location,i=cU(),s=cv(r.fullServerUrl(),n.host,n._protocol),o=n.maxOperationRetryTime,a=new cV(s,"GET",function(e,t){let r=cF(n,t,i);return cB(null!==r),function(e,t,n,r){let i=cD(t);if(null===i||!cg(i.downloadTokens))return null;let s=i.downloadTokens;if(0===s.length)return null;let o=encodeURIComponent;return s.split(",").map(t=>{let i=e.bucket,s=e.fullPath;return cv("/b/"+o(i)+"/o/"+o(s),n,r)+cw({alt:"media",token:t})})[0]}(r,t,n.host,n._protocol)},o),l=cj(r),a.errorHandler=function(e,t){var n;let i=l(e,t);return 404===e.getStatus()&&(n=r.path,i=new co(L.OBJECT_NOT_FOUND,"Object '"+n+"' does not exist.")),i.serverResponse=t.serverResponse,i},h=a,t.storage.makeRequestWithTokens(h,c$).then(e=>{if(null===e)throw new co(L.NO_DOWNLOAD_URL,"The given file does not have any download URLs.");return e})}function cZ(e,t){var n=e=eL(e);if(!(t&&/^[A-Za-z]+:\/\//.test(t)))return function e(t,n){var r;let i,s,o;if(t instanceof cK){if(null==t._bucket)throw new co(L.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+cs+"' property when initializing the app?");let r=new cH(t,t._bucket);return null!=n?e(r,n):r}if(void 0===n)return t;return r=t._location.path,i=n.split("/").filter(e=>e.length>0).join("/"),s=0===r.length?i:r+"/"+i,o=new cf(t._location.bucket,s),new cH(t.storage,o)}(n,t);if(n instanceof cK)return new cH(n,t);throw ch("To use ref(service, url), the first argument must be a Storage instance.")}function c0(e=tv(),t){let n=to(e=eL(e),cY).getImmediate({identifier:t}),r=J("storage");return r&&function(e,t,n,r={}){!function(e,t,n,r={}){e.host=`${t}:${n}`;let i=en(t);i&&(er(`https://${e.host}/b`),ea("Storage",!0)),e._isUsingEmulator=!0,e._protocol=i?"https":"http";let{mockUserToken:s}=r;s&&(e._overrideAuthToken="string"==typeof s?s:ei(s,e.app.options.projectId))}(e,t,n,r)}(n,...r),n}ts(new eM(cY,function(e,{instanceIdentifier:t}){return new cK(e.getProvider("app").getImmediate(),e.getProvider("auth-internal"),e.getProvider("app-check-internal"),t,tm)},"PUBLIC").setMultipleInstances(!0)),tE(cG,cQ,""),tE(cG,cQ,"esm2020"),e.s(["getDownloadURL",()=>cJ,"getStorage",()=>c0,"ref",()=>cZ,"uploadBytes",()=>cX],27215),e.s([],61086),tE("firebase","12.7.0","app"),e.i(92953);let c1="@firebase/database",c2="1.1.0",c6="";class c3{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){null==t?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),ey(t))}get(e){let t=this.domStorage_.getItem(this.prefixedName_(e));return null==t?null:em(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}class c4{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){null==t?delete this.cache_[e]:this.cache_[e]=t}get(e){return eb(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}let c5=function(e){try{if("undefined"!=typeof window&&void 0!==window[e]){let t=window[e];return t.setItem("firebase:sentinel","cache"),t.removeItem("firebase:sentinel"),new c3(t)}}catch(e){}return new c4},c8=c5("localStorage"),c7=c5("sessionStorage"),c9=new eH("@firebase/database"),de=(f=1,function(){return f++}),dt=function(e){let t=eO(e),n=new eN;n.update(t);let r=n.digest();return H.encodeByteArray(r)},dn=function(...e){let t="";for(let n=0;n<e.length;n++){let r=e[n];Array.isArray(r)||r&&"object"==typeof r&&"number"==typeof r.length?t+=dn.apply(null,r):"object"==typeof r?t+=ey(r):t+=r,t+=" "}return t},dr=null,di=!0,ds=function(e,t){j(!t||!0===e||!1===e,"Can't turn on custom loggers persistently."),!0===e?(c9.logLevel=w.VERBOSE,dr=c9.log.bind(c9),t&&c7.set("logging_enabled",!0)):"function"==typeof e?dr=e:(dr=null,c7.remove("logging_enabled"))},da=function(...e){if(!0===di&&(di=!1,null===dr&&!0===c7.get("logging_enabled")&&ds(!0)),dr){let t=dn.apply(null,e);dr(t)}},dl=function(e){return function(...t){da(e,...t)}},dh=function(...e){let t="FIREBASE INTERNAL ERROR: "+dn(...e);c9.error(t)},du=function(...e){let t=`FIREBASE FATAL ERROR: ${dn(...e)}`;throw c9.error(t),Error(t)},dc=function(...e){let t="FIREBASE WARNING: "+dn(...e);c9.warn(t)},dd=function(){"undefined"!=typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&dc("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},df=function(e){return"number"==typeof e&&(e!=e||e===1/0||e===-1/0)},dp=function(e){if(ed()||"complete"===document.readyState)e();else{let t=!1,n=function(){document.body?t||(t=!0,e()):setTimeout(n,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{"complete"===document.readyState&&n()}),window.attachEvent("onload",n))}},dg="[MIN_NAME]",dm="[MAX_NAME]",dy=function(e,t){if(e===t)return 0;{if(e===dg||t===dm)return -1;if(t===dg||e===dm)return 1;let n=dC(e),r=dC(t);if(null!==n)if(null!==r)return n-r==0?e.length-t.length:n-r;else return -1;return null!==r?1:e<t?-1:1}},d_=function(e,t){return e===t?0:e<t?-1:1},dv=function(e,t){if(t&&e in t)return t[e];throw Error("Missing required key ("+e+") in object: "+ey(t))},dw=function(e){if("object"!=typeof e||null===e)return ey(e);let t=[];for(let n in e)t.push(n);t.sort();let n="{";for(let r=0;r<t.length;r++)0!==r&&(n+=","),n+=ey(t[r]),n+=":",n+=dw(e[t[r]]);return n+"}"},db=function(e,t){let n=e.length;if(n<=t)return[e];let r=[];for(let i=0;i<n;i+=t)i+t>n?r.push(e.substring(i,n)):r.push(e.substring(i,i+t));return r};function dE(e,t){for(let n in e)e.hasOwnProperty(n)&&t(n,e[n])}let dT=function(e){let t,n,r,i,s;j(!df(e),"Invalid JSON number");0===e?(n=0,r=0,t=+(1/e==-1/0)):(t=e<0,(e=Math.abs(e))>=22250738585072014e-324?(n=(i=Math.min(Math.floor(Math.log(e)/Math.LN2),1023))+1023,r=Math.round(e*Math.pow(2,52-i)-0x10000000000000)):(n=0,r=Math.round(e/5e-324)));let o=[];for(s=52;s;s-=1)o.push(r%2?1:0),r=Math.floor(r/2);for(s=11;s;s-=1)o.push(n%2?1:0),n=Math.floor(n/2);o.push(+!!t),o.reverse();let a=o.join(""),l="";for(s=0;s<64;s+=8){let e=parseInt(a.substr(s,8),2).toString(16);1===e.length&&(e="0"+e),l+=e}return l.toLowerCase()},dI=RegExp("^-?(0*)\\d{1,10}$"),dC=function(e){if(dI.test(e)){let t=Number(e);if(t>=-0x80000000&&t<=0x7fffffff)return t}return null},dS=function(e){try{e()}catch(e){setTimeout(()=>{throw dc("Exception was thrown by user callback.",e.stack||""),e},Math.floor(0))}},dk=function(e,t){let n=setTimeout(e,t);return"number"==typeof n&&"undefined"!=typeof Deno&&Deno.unrefTimer?Deno.unrefTimer(n):"object"==typeof n&&n.unref&&n.unref(),n};class dA{constructor(e,t){this.appCheckProvider=t,this.appName=e.name,tu(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.appCheck=t?.getImmediate({optional:!0}),this.appCheck||t?.get().then(e=>this.appCheck=e)}getToken(e){if(this.serverAppAppCheckToken){if(e)throw Error("Attempted reuse of `FirebaseServerApp.appCheckToken` after previous usage failed.");return Promise.resolve({token:this.serverAppAppCheckToken})}return this.appCheck?this.appCheck.getToken(e):new Promise((t,n)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(t,n):t(null)},0)})}addTokenChangeListener(e){this.appCheckProvider?.get().then(t=>t.addTokenListener(e))}notifyForInvalidToken(){dc(`Provided AppCheck credentials for the app named "${this.appName}" are invalid. This usually indicates your app was not initialized correctly.`)}}class dR{constructor(e,t,n){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=n,this.auth_=null,this.auth_=n.getImmediate({optional:!0}),this.auth_||n.onInit(e=>this.auth_=e)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(e=>e&&"auth/token-not-initialized"===e.code?(da("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(e)):new Promise((t,n)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(t,n):t(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(t=>t.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(t=>t.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',dc(e)}}class dN{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}dN.OWNER="owner";let dP=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,dD="websocket",dO="long_polling";class dx{constructor(e,t,n,r,i=!1,s="",o=!1,a=!1,l=null){this.secure=t,this.namespace=n,this.webSocketOnly=r,this.nodeAdmin=i,this.persistenceKey=s,this.includeNamespaceInQueryParams=o,this.isUsingEmulator=a,this.emulatorOptions=l,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=c8.get("host:"+e)||this._host}isCacheableHost(){return"s-"===this.internalHost.substr(0,2)}isCustomHost(){return"firebaseio.com"!==this._domain&&"firebaseio-demo.com"!==this._domain}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&c8.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){let e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}}function dL(e,t,n){let r;if(j("string"==typeof t,"typeof type must == string"),j("object"==typeof n,"typeof params must == object"),t===dD)r=(e.secure?"wss://":"ws://")+e.internalHost+"/.ws?";else if(t===dO)r=(e.secure?"https://":"http://")+e.internalHost+"/.lp?";else throw Error("Unknown connection type: "+t);(e.host!==e.internalHost||e.isCustomHost()||e.includeNamespaceInQueryParams)&&(n.ns=e.namespace);let i=[];return dE(n,(e,t)=>{i.push(e+"="+t)}),r+i.join("&")}class dM{constructor(){this.counters_={}}incrementCounter(e,t=1){eb(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return function e(t,n){if(!(n instanceof Object))return n;switch(n.constructor){case Date:return new Date(n.getTime());case Object:void 0===t&&(t={});break;case Array:t=[];break;default:return n}for(let r in n)n.hasOwnProperty(r)&&"__proto__"!==r&&(t[r]=e(t[r],n[r]));return t}(void 0,this.counters_)}}let dU={},dF={};function dV(e){let t=e.toString();return dU[t]||(dU[t]=new dM),dU[t]}class dB{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){let e=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let t=0;t<e.length;++t)e[t]&&dS(()=>{this.onMessage_(e[t])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}let dj="start";class dq{constructor(e,t,n,r,i,s,o){this.connId=e,this.repoInfo=t,this.applicationId=n,this.appCheckToken=r,this.authToken=i,this.transportSessionId=s,this.lastSessionId=o,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=dl(e),this.stats_=dV(t),this.urlFn=e=>(this.appCheckToken&&(e.ac=this.appCheckToken),dL(t,dO,e))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new dB(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(3e4)),dp(()=>{if(this.isClosed_)return;this.scriptTagHolder=new dz((...e)=>{let[t,n,r,i,s]=e;if(this.incrementIncomingBytes_(e),this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,t===dj)this.id=n,this.password=r;else if("close"===t)n?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(n,()=>{this.onClosed_()})):this.onClosed_();else throw Error("Unrecognized command received: "+t)},(...e)=>{let[t,n]=e;this.incrementIncomingBytes_(e),this.myPacketOrderer.handleResponse(t,n)},()=>{this.onClosed_()},this.urlFn);let e={};e[dj]="t",e.ser=Math.floor(1e8*Math.random()),this.scriptTagHolder.uniqueCallbackIdentifier&&(e.cb=this.scriptTagHolder.uniqueCallbackIdentifier),e.v="5",this.transportSessionId&&(e.s=this.transportSessionId),this.lastSessionId&&(e.ls=this.lastSessionId),this.applicationId&&(e.p=this.applicationId),this.appCheckToken&&(e.ac=this.appCheckToken),"undefined"!=typeof location&&location.hostname&&dP.test(location.hostname)&&(e.r="f");let t=this.urlFn(e);this.log_("Connecting via long-poll to "+t),this.scriptTagHolder.addTag(t,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){dq.forceAllow_=!0}static forceDisallow(){dq.forceDisallow_=!0}static isAvailable(){return!ed()&&(!!dq.forceAllow_||!dq.forceDisallow_&&"undefined"!=typeof document&&null!=document.createElement&&!("object"==typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))&&("object"!=typeof Windows||"object"!=typeof Windows.UI))}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){!this.isClosed_&&(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){let t=ey(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);let n=db(K(t),1840);for(let e=0;e<n.length;e++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,n.length,n[e]),this.curSegmentNum++}addDisconnectPingFrame(e,t){if(ed())return;this.myDisconnFrame=document.createElement("iframe");let n={};n.dframe="t",n.id=e,n.pw=t,this.myDisconnFrame.src=this.urlFn(n),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){let t=ey(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}}class dz{constructor(e,t,n,r){if(this.onDisconnect=n,this.urlFn=r,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0,ed())this.commandCB=e,this.onMessageCB=t;else{this.uniqueCallbackIdentifier=de(),window["pLPCommand"+this.uniqueCallbackIdentifier]=e,window["pRTLPCB"+this.uniqueCallbackIdentifier]=t,this.myIFrame=dz.createIFrame_();let n="";this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,11)&&(n='<script>document.domain="'+document.domain+'";</script>');const r="<html><body>"+n+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(r),this.myIFrame.doc.close()}catch(e){da("frame writing exception"),e.stack&&da(e.stack),da(e)}}}static createIFrame_(){let e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||da("No IE domain setting required")}catch(t){e.src="javascript:void((function(){document.open();document.domain='"+document.domain+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{null!==this.myIFrame&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));let e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(!this.alive||!this.sendNewPolls||!(this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)))return!1;{this.currentSerial++;let e={};e.id=this.myID,e.pw=this.myPW,e.ser=this.currentSerial;let t=this.urlFn(e),n="",r=0;for(;this.pendingSegs.length>0;)if(this.pendingSegs[0].d.length+30+n.length<=1870){let e=this.pendingSegs.shift();n=n+"&seg"+r+"="+e.seg+"&ts"+r+"="+e.ts+"&d"+r+"="+e.d,r++}else break;return t+=n,this.addLongPollTag_(t,this.currentSerial),!0}}enqueueSegment(e,t,n){this.pendingSegs.push({seg:e,ts:t,d:n}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);let n=()=>{this.outstandingRequests.delete(t),this.newRequest_()},r=setTimeout(n,Math.floor(25e3));this.addTag(e,()=>{clearTimeout(r),n()})}addTag(e,t){ed()?this.doNodeLongPoll(e,t):setTimeout(()=>{try{if(!this.sendNewPolls)return;let n=this.myIFrame.doc.createElement("script");n.type="text/javascript",n.async=!0,n.src=e,n.onload=n.onreadystatechange=function(){let e=n.readyState;e&&"loaded"!==e&&"complete"!==e||(n.onload=n.onreadystatechange=null,n.parentNode&&n.parentNode.removeChild(n),t())},n.onerror=()=>{da("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(n)}catch(e){}},Math.floor(1))}}let d$=null;"undefined"!=typeof MozWebSocket?d$=MozWebSocket:"undefined"!=typeof WebSocket&&(d$=WebSocket);class dH{constructor(e,t,n,r,i,s,o){this.connId=e,this.applicationId=n,this.appCheckToken=r,this.authToken=i,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=dl(this.connId),this.stats_=dV(t),this.connURL=dH.connectionURL_(t,s,o,r,n),this.nodeAdmin=t.nodeAdmin}static connectionURL_(e,t,n,r,i){let s={};return s.v="5",!ed()&&"undefined"!=typeof location&&location.hostname&&dP.test(location.hostname)&&(s.r="f"),t&&(s.s=t),n&&(s.ls=n),r&&(s.ac=r),i&&(s.p=i),dL(e,dD,s)}open(e,t){this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,c8.set("previous_websocket_failure",!0);try{let e;if(ed()){let t=this.nodeAdmin?"AdminNode":"Node";e={headers:{"User-Agent":`Firebase/5/${c6}/${F.default.platform}/${t}`,"X-Firebase-GMPID":this.applicationId||""}},this.authToken&&(e.headers.Authorization=`Bearer ${this.authToken}`),this.appCheckToken&&(e.headers["X-Firebase-AppCheck"]=this.appCheckToken);let n=F.default.env,r=0===this.connURL.indexOf("wss://")?n.HTTPS_PROXY||n.https_proxy:n.HTTP_PROXY||n.http_proxy;r&&(e.proxy={origin:r})}this.mySock=new d$(this.connURL,[],e)}catch(t){this.log_("Error instantiating WebSocket.");let e=t.message||t.data;e&&this.log_(e),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=e=>{this.handleIncomingFrame(e)},this.mySock.onerror=e=>{this.log_("WebSocket error.  Closing connection.");let t=e.message||e.data;t&&this.log_(t),this.onClosed_()}}start(){}static forceDisallow(){dH.forceDisallow_=!0}static isAvailable(){let e=!1;if("undefined"!=typeof navigator&&navigator.userAgent){let t=navigator.userAgent.match(/Android ([0-9]{0,}\.[0-9]{0,})/);t&&t.length>1&&4.4>parseFloat(t[1])&&(e=!0)}return!e&&null!==d$&&!dH.forceDisallow_}static previouslyFailed(){return c8.isInMemoryStorage||!0===c8.get("previous_websocket_failure")}markConnectionHealthy(){c8.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){let e=this.frames.join("");this.frames=null;let t=em(e);this.onMessage(t)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(j(null===this.frames,"We already have a frame buffer"),e.length<=6){let t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(null===this.mySock)return;let t=e.data;if(this.bytesReceived+=t.length,this.stats_.incrementCounter("bytes_received",t.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(t);else{let e=this.extractFrameCount_(t);null!==e&&this.appendFrame_(e)}}send(e){this.resetKeepAlive();let t=ey(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);let n=db(t,16384);n.length>1&&this.sendString_(String(n.length));for(let e=0;e<n.length;e++)this.sendString_(n[e])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){!this.isClosed_&&(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(45e3))}sendString_(e){try{this.mySock.send(e)}catch(e){this.log_("Exception thrown from WebSocket.send():",e.message||e.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}dH.responsesRequiredToBeHealthy=2,dH.healthyTimeout=3e4;class dW{static get ALL_TRANSPORTS(){return[dq,dH]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}constructor(e){this.initTransports_(e)}initTransports_(e){let t=dH&&dH.isAvailable(),n=t&&!dH.previouslyFailed();if(e.webSocketOnly&&(t||dc("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),n=!0),n)this.transports_=[dH];else{let e=this.transports_=[];for(let t of dW.ALL_TRANSPORTS)t&&t.isAvailable()&&e.push(t);dW.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}dW.globalTransportInitialized_=!1;class dK{constructor(e,t,n,r,i,s,o,a,l,h){this.id=e,this.repoInfo_=t,this.applicationId_=n,this.appCheckToken_=r,this.authToken_=i,this.onMessage_=s,this.onReady_=o,this.onDisconnect_=a,this.onKill_=l,this.lastSessionId=h,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=dl("c:"+this.id+":"),this.transportManager_=new dW(t),this.log_("Connection created"),this.start_()}start_(){let e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;let t=this.connReceiver_(this.conn_),n=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,n)},Math.floor(0));let r=e.healthyTimeout||0;r>0&&(this.healthyTimeout_=dk(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>102400?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>10240?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(r)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{2!==this.state_&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){this.sendData_({t:"d",d:e})}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if("t"in e){let t=e.t;"a"===t?this.upgradeIfSecondaryHealthy_():"r"===t?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):"o"===t&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){let t=dv("t",e),n=dv("d",e);if("c"===t)this.onSecondaryControl_(n);else if("d"===t)this.pendingDataMessages.push(n);else throw Error("Unknown protocol layer: "+t)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){let t=dv("t",e),n=dv("d",e);"c"===t?this.onControl_(n):"d"===t&&this.onDataMessage_(n)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){!this.isHealthy_&&(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){let t=dv("t",e);if("d"in e){let n=e.d;if("h"===t){let e={...n};this.repoInfo_.isUsingEmulator&&(e.h=this.repoInfo_.host),this.onHandshake_(e)}else if("n"===t){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let e=0;e<this.pendingDataMessages.length;++e)this.onDataMessage_(this.pendingDataMessages[e]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===t?this.onConnectionShutdown_(n):"r"===t?this.onReset_(n):"e"===t?dh("Server Error: "+n):"o"===t?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):dh("Unknown control packet command: "+t)}}onHandshake_(e){let t=e.ts,n=e.v,r=e.h;this.sessionId=e.s,this.repoInfo_.host=r,0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),"5"!==n&&dc("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){let e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;let t=this.connReceiver_(this.secondaryConn_),n=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,n),dk(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(6e4))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,1===this.state_?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):dk(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(5e3))}sendPingOnPrimaryIfNecessary_(){this.isHealthy_||1!==this.state_||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))}onSecondaryConnectionLost_(){let e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,e||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(c8.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(e)}close(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}class dG{put(e,t,n,r){}merge(e,t,n,r){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,n){}onDisconnectMerge(e,t,n){}onDisconnectCancel(e,t){}reportStats(e){}}class dQ{constructor(e){this.allowedEvents_=e,this.listeners_={},j(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){let n=[...this.listeners_[e]];for(let e=0;e<n.length;e++)n[e].callback.apply(n[e].context,t)}}on(e,t,n){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:n});let r=this.getInitialEvent(e);r&&t.apply(n,r)}off(e,t,n){this.validateEventType_(e);let r=this.listeners_[e]||[];for(let e=0;e<r.length;e++)if(r[e].callback===t&&(!n||n===r[e].context))return void r.splice(e,1)}validateEventType_(e){j(this.allowedEvents_.find(t=>t===e),"Unknown event: "+e)}}class dY extends dQ{static getInstance(){return new dY}constructor(){super(["online"]),this.online_=!0,"undefined"==typeof window||void 0===window.addEventListener||eh()||(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}getInitialEvent(e){return j("online"===e,"Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}class dX{constructor(e,t){if(void 0===t){this.pieces_=e.split("/");let t=0;for(let e=0;e<this.pieces_.length;e++)this.pieces_[e].length>0&&(this.pieces_[t]=this.pieces_[e],t++);this.pieces_.length=t,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)""!==this.pieces_[t]&&(e+="/"+this.pieces_[t]);return e||"/"}}function dJ(){return new dX("")}function dZ(e){return e.pieceNum_>=e.pieces_.length?null:e.pieces_[e.pieceNum_]}function d0(e){return e.pieces_.length-e.pieceNum_}function d1(e){let t=e.pieceNum_;return t<e.pieces_.length&&t++,new dX(e.pieces_,t)}function d2(e){return e.pieceNum_<e.pieces_.length?e.pieces_[e.pieces_.length-1]:null}function d6(e,t=0){return e.pieces_.slice(e.pieceNum_+t)}function d3(e){if(e.pieceNum_>=e.pieces_.length)return null;let t=[];for(let n=e.pieceNum_;n<e.pieces_.length-1;n++)t.push(e.pieces_[n]);return new dX(t,0)}function d4(e,t){let n=[];for(let t=e.pieceNum_;t<e.pieces_.length;t++)n.push(e.pieces_[t]);if(t instanceof dX)for(let e=t.pieceNum_;e<t.pieces_.length;e++)n.push(t.pieces_[e]);else{let e=t.split("/");for(let t=0;t<e.length;t++)e[t].length>0&&n.push(e[t])}return new dX(n,0)}function d5(e){return e.pieceNum_>=e.pieces_.length}function d8(e,t){let n=dZ(e),r=dZ(t);if(null===n)return t;if(n===r)return d8(d1(e),d1(t));throw Error("INTERNAL ERROR: innerPath ("+t+") is not within outerPath ("+e+")")}function d7(e,t){if(d0(e)!==d0(t))return!1;for(let n=e.pieceNum_,r=t.pieceNum_;n<=e.pieces_.length;n++,r++)if(e.pieces_[n]!==t.pieces_[r])return!1;return!0}function d9(e,t){let n=e.pieceNum_,r=t.pieceNum_;if(d0(e)>d0(t))return!1;for(;n<e.pieces_.length;){if(e.pieces_[n]!==t.pieces_[r])return!1;++n,++r}return!0}class fe{constructor(e,t){this.errorPrefix_=t,this.parts_=d6(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let e=0;e<this.parts_.length;e++)this.byteLength_+=ex(this.parts_[e]);ft(this)}}function ft(e){if(e.byteLength_>768)throw Error(e.errorPrefix_+"has a key path longer than 768 bytes ("+e.byteLength_+").");if(e.parts_.length>32)throw Error(e.errorPrefix_+"path specified exceeds the maximum depth that can be written (32) or object contains a cycle "+fn(e))}function fn(e){return 0===e.parts_.length?"":"in property '"+e.parts_.join(".")+"'"}class fr extends dQ{static getInstance(){return new fr}constructor(){let e,t;super(["visible"]),"undefined"!=typeof document&&void 0!==document.addEventListener&&(void 0!==document.hidden?(t="visibilitychange",e="hidden"):void 0!==document.mozHidden?(t="mozvisibilitychange",e="mozHidden"):void 0!==document.msHidden?(t="msvisibilitychange",e="msHidden"):void 0!==document.webkitHidden&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,()=>{let t=!document[e];t!==this.visible_&&(this.visible_=t,this.trigger("visible",t))},!1)}getInitialEvent(e){return j("visible"===e,"Unknown event type: "+e),[this.visible_]}}class fi extends dG{constructor(e,t,n,r,i,s,o,a){if(super(),this.repoInfo_=e,this.applicationId_=t,this.onDataUpdate_=n,this.onConnectStatus_=r,this.onServerInfoUpdate_=i,this.authTokenProvider_=s,this.appCheckTokenProvider_=o,this.authOverride_=a,this.id=fi.nextPersistentConnectionId_++,this.log_=dl("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=1e3,this.maxReconnectDelay_=3e5,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,a&&!ed())throw Error("Auth override specified in options, but not supported on non Node.js platforms");fr.getInstance().on("visible",this.onVisible_,this),-1===e.host.indexOf("fblocal")&&dY.getInstance().on("online",this.onOnline_,this)}sendRequest(e,t,n){let r=++this.requestNumber_,i={r:r,a:e,b:t};this.log_(ey(i)),j(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(i),n&&(this.requestCBHash_[r]=n)}get(e){this.initConnection_();let t=new et,n={p:e._path.toString(),q:e._queryObject};this.outstandingGets_.push({action:"g",request:n,onComplete:e=>{let n=e.d;"ok"===e.s?t.resolve(n):t.reject(n)}}),this.outstandingGetCount_++;let r=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(r),t.promise}listen(e,t,n,r){this.initConnection_();let i=e._queryIdentifier,s=e._path.toString();this.log_("Listen called for "+s+" "+i),this.listens.has(s)||this.listens.set(s,new Map),j(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),j(!this.listens.get(s).has(i),"listen() called twice for same path/queryId.");let o={onComplete:r,hashFn:t,query:e,tag:n};this.listens.get(s).set(i,o),this.connected_&&this.sendListen_(o)}sendGet_(e){let t=this.outstandingGets_[e];this.sendRequest("g",t.request,n=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,0===this.outstandingGetCount_&&(this.outstandingGets_=[]),t.onComplete&&t.onComplete(n)})}sendListen_(e){let t=e.query,n=t._path.toString(),r=t._queryIdentifier;this.log_("Listen on "+n+" for "+r);let i={p:n};e.tag&&(i.q=t._queryObject,i.t=e.tag),i.h=e.hashFn(),this.sendRequest("q",i,i=>{let s=i.d,o=i.s;fi.warnOnListenWarnings_(s,t),(this.listens.get(n)&&this.listens.get(n).get(r))===e&&(this.log_("listen response",i),"ok"!==o&&this.removeListen_(n,r),e.onComplete&&e.onComplete(o,s))})}static warnOnListenWarnings_(e,t){if(e&&"object"==typeof e&&eb(e,"w")){let n=eE(e,"w");if(Array.isArray(n)&&~n.indexOf("no_index")){let e='".indexOn": "'+t._queryParams.getIndex().toString()+'"',n=t._path.toString();dc(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${e} at ${n} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&40===e.length||ew(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){let e=this.authToken_,t=ev(e)?"auth":"gauth",n={cred:e};null===this.authOverride_?n.noauth=!0:"object"==typeof this.authOverride_&&(n.authvar=this.authOverride_),this.sendRequest(t,n,t=>{let n=t.s,r=t.d||"error";this.authToken_===e&&("ok"===n?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(n,r))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{let t=e.s,n=e.d||"error";"ok"===t?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(t,n)})}unlisten(e,t){let n=e._path.toString(),r=e._queryIdentifier;this.log_("Unlisten called for "+n+" "+r),j(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(n,r)&&this.connected_&&this.sendUnlisten_(n,r,e._queryObject,t)}sendUnlisten_(e,t,n,r){this.log_("Unlisten on "+e+" for "+t);let i={p:e};r&&(i.q=n,i.t=r),this.sendRequest("n",i)}onDisconnectPut(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:n})}onDisconnectMerge(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:n})}onDisconnectCancel(e,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})}sendOnDisconnect_(e,t,n,r){let i={p:t,d:n};this.log_("onDisconnect "+e,i),this.sendRequest(e,i,e=>{r&&setTimeout(()=>{r(e.s,e.d)},Math.floor(0))})}put(e,t,n,r){this.putInternal("p",e,t,n,r)}merge(e,t,n,r){this.putInternal("m",e,t,n,r)}putInternal(e,t,n,r,i){this.initConnection_();let s={p:t,d:n};void 0!==i&&(s.h=i),this.outstandingPuts_.push({action:e,request:s,onComplete:r}),this.outstandingPutCount_++;let o=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(o):this.log_("Buffering put: "+t)}sendPut_(e){let t=this.outstandingPuts_[e].action,n=this.outstandingPuts_[e].request,r=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(t,n,n=>{this.log_(t+" response",n),delete this.outstandingPuts_[e],this.outstandingPutCount_--,0===this.outstandingPutCount_&&(this.outstandingPuts_=[]),r&&r(n.s,n.d)})}reportStats(e){if(this.connected_){let t={c:e};this.log_("reportStats",t),this.sendRequest("s",t,e=>{if("ok"!==e.s){let t=e.d;this.log_("reportStats","Error sending stats: "+t)}})}}onDataMessage_(e){if("r"in e){this.log_("from server: "+ey(e));let t=e.r,n=this.requestCBHash_[t];n&&(delete this.requestCBHash_[t],n(e.b))}else if("error"in e)throw"A server-side error has occurred: "+e.error;else"a"in e&&this.onDataPush_(e.a,e.b)}onDataPush_(e,t){this.log_("handleServerMessage",e,t),"d"===e?this.onDataUpdate_(t.p,t.d,!1,t.t):"m"===e?this.onDataUpdate_(t.p,t.d,!0,t.t):"c"===e?this.onListenRevoked_(t.p,t.q):"ac"===e?this.onAuthRevoked_(t.s,t.d):"apc"===e?this.onAppCheckRevoked_(t.s,t.d):"sd"===e?this.onSecurityDebugPacket_(t):dh("Unrecognized action received from server: "+ey(e)+"\nAre you using the latest client?")}onReady_(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){j(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>3e4&&(this.reconnectDelay_=1e3),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());let e=Math.max(0,new Date().getTime()-this.lastConnectionAttemptTime_),t=Math.max(0,this.reconnectDelay_-e);t=Math.random()*t,this.log_("Trying to reconnect in "+t+"ms"),this.scheduleConnect_(t),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;let e=this.onDataMessage_.bind(this),t=this.onReady_.bind(this),n=this.onRealtimeDisconnect_.bind(this),r=this.id+":"+fi.nextConnectionId_++,i=this.lastSessionId,s=!1,o=null,a=function(){o?o.close():(s=!0,n())};this.realtime_={close:a,sendRequest:function(e){j(o,"sendRequest call when we're not connected not allowed."),o.sendRequest(e)}};let l=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{let[a,h]=await Promise.all([this.authTokenProvider_.getToken(l),this.appCheckTokenProvider_.getToken(l)]);s?da("getToken() completed but was canceled"):(da("getToken() completed. Creating connection."),this.authToken_=a&&a.accessToken,this.appCheckToken_=h&&h.token,o=new dK(r,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,t,n,e=>{dc(e+" ("+this.repoInfo_.toString()+")"),this.interrupt("server_kill")},i))}catch(e){this.log_("Failed to get token: "+e),s||(this.repoInfo_.nodeAdmin&&dc(e),a())}}}interrupt(e){da("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){da("Resuming connection for reason: "+e),delete this.interruptReasons_[e],eT(this.interruptReasons_)&&(this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){let t=e-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:t})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){let t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])}onListenRevoked_(e,t){let n;n=t?t.map(e=>dw(e)).join("$"):"default";let r=this.removeListen_(e,n);r&&r.onComplete&&r.onComplete("permission_denied")}removeListen_(e,t){let n,r=new dX(e).toString();if(this.listens.has(r)){let e=this.listens.get(r);n=e.get(t),e.delete(t),0===e.size&&this.listens.delete(r)}else n=void 0;return n}onAuthRevoked_(e,t){da("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),("invalid_token"===e||"permission_denied"===e)&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=3&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,t){da("App check token revoked: "+e+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,("invalid_token"===e||"permission_denied"===e)&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=3&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace("\n","\nFIREBASE: "))}restoreState_(){for(let e of(this.tryAuth(),this.tryAppCheck(),this.listens.values()))for(let t of e.values())this.sendListen_(t);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){let e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){let e={},t="js";ed()&&(t=this.repoInfo_.nodeAdmin?"admin_node":"node"),e["sdk."+t+"."+c6.replace(/\./g,"-")]=1,eh()?e["framework.cordova"]=1:ec()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){let e=dY.getInstance().currentlyOnline();return eT(this.interruptReasons_)&&e}}fi.nextPersistentConnectionId_=0,fi.nextConnectionId_=0;class fs{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new fs(e,t)}}class fo{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){let n=new fs(dg,e),r=new fs(dg,t);return 0!==this.compare(n,r)}minPost(){return fs.MIN}}class fa extends fo{static get __EMPTY_NODE(){return r}static set __EMPTY_NODE(e){r=e}compare(e,t){return dy(e.name,t.name)}isDefinedOn(e){throw q("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return fs.MIN}maxPost(){return new fs(dm,r)}makePost(e,t){return j("string"==typeof e,"KeyIndex indexValue must always be a string."),new fs(e,r)}toString(){return".key"}}let fl=new fa;class fh{constructor(e,t,n,r,i=null){this.isReverse_=r,this.resultGenerator_=i,this.nodeStack_=[];let s=1;for(;!e.isEmpty();)if(s=t?n(e.key,t):1,r&&(s*=-1),s<0)e=this.isReverse_?e.left:e.right;else if(0===s){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),e=this.isReverse_?e.right:e.left}getNext(){let e;if(0===this.nodeStack_.length)return null;let t=this.nodeStack_.pop();if(e=this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value},this.isReverse_)for(t=t.left;!t.isEmpty();)this.nodeStack_.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack_.push(t),t=t.left;return e}hasNext(){return this.nodeStack_.length>0}peek(){if(0===this.nodeStack_.length)return null;let e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}class fu{constructor(e,t,n,r,i){this.key=e,this.value=t,this.color=null!=n?n:fu.RED,this.left=null!=r?r:fc.EMPTY_NODE,this.right=null!=i?i:fc.EMPTY_NODE}copy(e,t,n,r,i){return new fu(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this,i=n(e,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n))).fixUp_()}removeMin_(){if(this.left.isEmpty())return fc.EMPTY_NODE;let e=this;return e.left.isRed_()||e.left.left.isRed_()||(e=e.moveRedLeft_()),(e=e.copy(null,null,null,e.left.removeMin_(),null)).fixUp_()}remove(e,t){let n,r;if(n=this,0>t(e,n.key))n.left.isEmpty()||n.left.isRed_()||n.left.left.isRed_()||(n=n.moveRedLeft_()),n=n.copy(null,null,null,n.left.remove(e,t),null);else{if(n.left.isRed_()&&(n=n.rotateRight_()),n.right.isEmpty()||n.right.isRed_()||n.right.left.isRed_()||(n=n.moveRedRight_()),0===t(e,n.key))if(n.right.isEmpty())return fc.EMPTY_NODE;else r=n.right.min_(),n=n.copy(r.key,r.value,null,null,n.right.removeMin_());n=n.copy(null,null,null,null,n.right.remove(e,t))}return n.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=(e=(e=e.copy(null,null,null,null,e.right.rotateRight_())).rotateLeft_()).colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=(e=e.rotateRight_()).colorFlip_()),e}rotateLeft_(){let e=this.copy(null,null,fu.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){let e=this.copy(null,null,fu.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth_(){return Math.pow(2,this.check_())<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw Error("Right child of ("+this.key+","+this.value+") is red");let e=this.left.check_();if(e===this.right.check_())return e+ +!this.isRed_();throw Error("Black depths differ")}}fu.RED=!0,fu.BLACK=!1;class fc{constructor(e,t=fc.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new fc(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,fu.BLACK,null,null))}remove(e){return new fc(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,fu.BLACK,null,null))}get(e){let t,n=this.root_;for(;!n.isEmpty();){if(0===(t=this.comparator_(e,n.key)))return n.value;t<0?n=n.left:t>0&&(n=n.right)}return null}getPredecessorKey(e){let t,n=this.root_,r=null;for(;!n.isEmpty();){if(0===(t=this.comparator_(e,n.key)))if(n.left.isEmpty())if(r)return r.key;else return null;else{for(n=n.left;!n.right.isEmpty();)n=n.right;return n.key}t<0?n=n.left:t>0&&(r=n,n=n.right)}throw Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new fh(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new fh(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new fh(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new fh(this.root_,null,this.comparator_,!0,e)}}function fd(e,t){return dy(e.name,t.name)}function ff(e,t){return dy(e,t)}fc.EMPTY_NODE=new class{copy(e,t,n,r,i){return this}insert(e,t,n){return new fu(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}};let fp=function(e){return"number"==typeof e?"number:"+dT(e):"string:"+e},fg=function(e){if(e.isLeafNode()){let t=e.val();j("string"==typeof t||"number"==typeof t||"object"==typeof t&&eb(t,".sv"),"Priority must be a string or number.")}else j(e===i||e.isEmpty(),"priority of unexpected type.");j(e===i||e.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};class fm{static set __childrenNodeConstructor(e){s=e}static get __childrenNodeConstructor(){return s}constructor(e,t=fm.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=t,this.lazyHash_=null,j(void 0!==this.value_&&null!==this.value_,"LeafNode shouldn't be created with null/undefined value."),fg(this.priorityNode_)}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new fm(this.value_,e)}getImmediateChild(e){return".priority"===e?this.priorityNode_:fm.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return d5(e)?this:".priority"===dZ(e)?this.priorityNode_:fm.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,t){return null}updateImmediateChild(e,t){return".priority"===e?this.updatePriority(t):t.isEmpty()&&".priority"!==e?this:fm.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,t).updatePriority(this.priorityNode_)}updateChild(e,t){let n=dZ(e);return null===n?t:t.isEmpty()&&".priority"!==n?this:(j(".priority"!==n||1===d0(e),".priority must be the last token in a path"),this.updateImmediateChild(n,fm.__childrenNodeConstructor.EMPTY_NODE.updateChild(d1(e),t)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,t){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(null===this.lazyHash_){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+fp(this.priorityNode_.val())+":");let t=typeof this.value_;e+=t+":","number"===t?e+=dT(this.value_):e+=this.value_,this.lazyHash_=dt(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===fm.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof fm.__childrenNodeConstructor?-1:(j(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){let t=typeof e.value_,n=typeof this.value_,r=fm.VALUE_TYPE_ORDER.indexOf(t),i=fm.VALUE_TYPE_ORDER.indexOf(n);return(j(r>=0,"Unknown leaf type: "+t),j(i>=0,"Unknown leaf type: "+n),r!==i)?i-r:"object"===n?0:this.value_<e.value_?-1:1*(this.value_!==e.value_)}withIndex(){return this}isIndexed(){return!0}equals(e){return e===this||!!e.isLeafNode()&&this.value_===e.value_&&this.priorityNode_.equals(e.priorityNode_)}}fm.VALUE_TYPE_ORDER=["object","boolean","number","string"];let fy=new class extends fo{compare(e,t){let n=e.node.getPriority(),r=t.node.getPriority(),i=n.compareTo(r);return 0===i?dy(e.name,t.name):i}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return fs.MIN}maxPost(){return new fs(dm,new fm("[PRIORITY-POST]",a))}makePost(e,t){return new fs(t,new fm("[PRIORITY-POST]",o(e)))}toString(){return".priority"}},f_=Math.log(2);class fv{constructor(e){this.count=parseInt(Math.log(e+1)/f_,10),this.current_=this.count-1;const t=parseInt(Array(this.count+1).join("1"),2);this.bits_=e+1&t}nextBitIsOne(){let e=!(this.bits_&1<<this.current_);return this.current_--,e}}let fw=function(e,t,n,r){e.sort(t);let i=function(t,r){let s,o=r-t;if(0===o)return null;if(1===o)return s=e[t],new fu(n?n(s):s,s.node,fu.BLACK,null,null);{let a=parseInt(o/2,10)+t,l=i(t,a),h=i(a+1,r);return s=e[a],new fu(n?n(s):s,s.node,fu.BLACK,l,h)}};return new fc(r||t,function(t){let r=null,s=null,o=e.length,a=function(t,r){let s=o-t,a=o;o-=t;let h=i(s+1,a),u=e[s];l(new fu(n?n(u):u,u.node,r,null,h))},l=function(e){r?r.left=e:s=e,r=e};for(let e=0;e<t.count;++e){let n=t.nextBitIsOne(),r=Math.pow(2,t.count-(e+1));n?a(r,fu.BLACK):(a(r,fu.BLACK),a(r,fu.RED))}return s}(new fv(e.length)))},fb={};class fE{static get Default(){return j(fb&&fy,"ChildrenNode.ts has not been loaded"),l=l||new fE({".priority":fb},{".priority":fy})}constructor(e,t){this.indexes_=e,this.indexSet_=t}get(e){let t=eE(this.indexes_,e);if(!t)throw Error("No index defined for "+e);return t instanceof fc?t:null}hasIndex(e){return eb(this.indexSet_,e.toString())}addIndex(e,t){let n;j(e!==fl,"KeyIndex always exists and isn't meant to be added to the IndexMap.");let r=[],i=!1,s=t.getIterator(fs.Wrap),o=s.getNext();for(;o;)i=i||e.isDefinedOn(o.node),r.push(o),o=s.getNext();n=i?fw(r,e.getCompare()):fb;let a=e.toString(),l={...this.indexSet_};l[a]=e;let h={...this.indexes_};return h[a]=n,new fE(h,l)}addToIndexes(e,t){return new fE(eI(this.indexes_,(n,r)=>{let i=eE(this.indexSet_,r);if(j(i,"Missing index implementation for "+r),n===fb)if(!i.isDefinedOn(e.node))return fb;else{let n=[],r=t.getIterator(fs.Wrap),s=r.getNext();for(;s;)s.name!==e.name&&n.push(s),s=r.getNext();return n.push(e),fw(n,i.getCompare())}{let r=t.get(e.name),i=n;return r&&(i=i.remove(new fs(e.name,r))),i.insert(e,e.node)}}),this.indexSet_)}removeFromIndexes(e,t){return new fE(eI(this.indexes_,n=>{if(n===fb)return n;{let r=t.get(e.name);return r?n.remove(new fs(e.name,r)):n}}),this.indexSet_)}}class fT{static get EMPTY_NODE(){return h||(h=new fT(new fc(ff),null,fE.Default))}constructor(e,t,n){this.children_=e,this.priorityNode_=t,this.indexMap_=n,this.lazyHash_=null,this.priorityNode_&&fg(this.priorityNode_),this.children_.isEmpty()&&j(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}isLeafNode(){return!1}getPriority(){return this.priorityNode_||h}updatePriority(e){return this.children_.isEmpty()?this:new fT(this.children_,e,this.indexMap_)}getImmediateChild(e){if(".priority"===e)return this.getPriority();{let t=this.children_.get(e);return null===t?h:t}}getChild(e){let t=dZ(e);return null===t?this:this.getImmediateChild(t).getChild(d1(e))}hasChild(e){return null!==this.children_.get(e)}updateImmediateChild(e,t){if(j(t,"We should always be passing snapshot nodes"),".priority"===e)return this.updatePriority(t);{let n,r,i=new fs(e,t);t.isEmpty()?(n=this.children_.remove(e),r=this.indexMap_.removeFromIndexes(i,this.children_)):(n=this.children_.insert(e,t),r=this.indexMap_.addToIndexes(i,this.children_));let s=n.isEmpty()?h:this.priorityNode_;return new fT(n,s,r)}}updateChild(e,t){let n=dZ(e);if(null===n)return t;{j(".priority"!==dZ(e)||1===d0(e),".priority must be the last token in a path");let r=this.getImmediateChild(n).updateChild(d1(e),t);return this.updateImmediateChild(n,r)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;let t={},n=0,r=0,i=!0;if(this.forEachChild(fy,(s,o)=>{t[s]=o.val(e),n++,i&&fT.INTEGER_REGEXP_.test(s)?r=Math.max(r,Number(s)):i=!1}),e||!i||!(r<2*n))return e&&!this.getPriority().isEmpty()&&(t[".priority"]=this.getPriority().val()),t;{let e=[];for(let n in t)e[n]=t[n];return e}}hash(){if(null===this.lazyHash_){let e="";this.getPriority().isEmpty()||(e+="priority:"+fp(this.getPriority().val())+":"),this.forEachChild(fy,(t,n)=>{let r=n.hash();""!==r&&(e+=":"+t+":"+r)}),this.lazyHash_=""===e?"":dt(e)}return this.lazyHash_}getPredecessorChildName(e,t,n){let r=this.resolveIndex_(n);if(!r)return this.children_.getPredecessorKey(e);{let n=r.getPredecessorKey(new fs(e,t));return n?n.name:null}}getFirstChildName(e){let t=this.resolveIndex_(e);if(!t)return this.children_.minKey();{let e=t.minKey();return e&&e.name}}getFirstChild(e){let t=this.getFirstChildName(e);return t?new fs(t,this.children_.get(t)):null}getLastChildName(e){let t=this.resolveIndex_(e);if(!t)return this.children_.maxKey();{let e=t.maxKey();return e&&e.name}}getLastChild(e){let t=this.getLastChildName(e);return t?new fs(t,this.children_.get(t)):null}forEachChild(e,t){let n=this.resolveIndex_(e);return n?n.inorderTraversal(e=>t(e.name,e.node)):this.children_.inorderTraversal(t)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,t){let n=this.resolveIndex_(t);if(n)return n.getIteratorFrom(e,e=>e);{let n=this.children_.getIteratorFrom(e.name,fs.Wrap),r=n.peek();for(;null!=r&&0>t.compare(r,e);)n.getNext(),r=n.peek();return n}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,t){let n=this.resolveIndex_(t);if(n)return n.getReverseIteratorFrom(e,e=>e);{let n=this.children_.getReverseIteratorFrom(e.name,fs.Wrap),r=n.peek();for(;null!=r&&t.compare(r,e)>0;)n.getNext(),r=n.peek();return n}}compareTo(e){if(this.isEmpty())if(e.isEmpty())return 0;else return -1;return e.isLeafNode()||e.isEmpty()?1:e===fI?-1:0}withIndex(e){if(e===fl||this.indexMap_.hasIndex(e))return this;{let t=this.indexMap_.addIndex(e,this.children_);return new fT(this.children_,this.priorityNode_,t)}}isIndexed(e){return e===fl||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode()||!this.getPriority().equals(e.getPriority()))return!1;if(this.children_.count()!==e.children_.count())return!1;{let t=this.getIterator(fy),n=e.getIterator(fy),r=t.getNext(),i=n.getNext();for(;r&&i;){if(r.name!==i.name||!r.node.equals(i.node))return!1;r=t.getNext(),i=n.getNext()}return null===r&&null===i}}resolveIndex_(e){return e===fl?null:this.indexMap_.get(e.toString())}}fT.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;let fI=new class extends fT{constructor(){super(new fc(ff),fT.EMPTY_NODE,fE.Default)}compareTo(e){return+(e!==this)}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return fT.EMPTY_NODE}isEmpty(){return!1}};function fC(e,t=null){if(null===e)return fT.EMPTY_NODE;if("object"==typeof e&&".priority"in e&&(t=e[".priority"]),j(null===t||"string"==typeof t||"number"==typeof t||"object"==typeof t&&".sv"in t,"Invalid priority type found: "+typeof t),"object"==typeof e&&".value"in e&&null!==e[".value"]&&(e=e[".value"]),"object"!=typeof e||".sv"in e)return new fm(e,fC(t));if(e instanceof Array){let n=fT.EMPTY_NODE;return dE(e,(t,r)=>{if(eb(e,t)&&"."!==t.substring(0,1)){let e=fC(r);(e.isLeafNode()||!e.isEmpty())&&(n=n.updateImmediateChild(t,e))}}),n.updatePriority(fC(t))}{let n=[],r=!1;if(dE(e,(e,t)=>{if("."!==e.substring(0,1)){let i=fC(t);i.isEmpty()||(r=r||!i.getPriority().isEmpty(),n.push(new fs(e,i)))}}),0===n.length)return fT.EMPTY_NODE;let i=fw(n,fd,e=>e.name,ff);if(!r)return new fT(i,fC(t),fE.Default);{let e=fw(n,fy.getCompare());return new fT(i,fC(t),new fE({".priority":e},{".priority":fy}))}}}Object.defineProperties(fs,{MIN:{value:new fs(dg,fT.EMPTY_NODE)},MAX:{value:new fs(dm,fI)}}),fa.__EMPTY_NODE=fT.EMPTY_NODE,fm.__childrenNodeConstructor=fT,i=fI,a=fI,o=fC;class fS extends fo{constructor(e){super(),this.indexPath_=e,j(!d5(e)&&".priority"!==dZ(e),"Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){let n=this.extractChild(e.node),r=this.extractChild(t.node),i=n.compareTo(r);return 0===i?dy(e.name,t.name):i}makePost(e,t){let n=fC(e);return new fs(t,fT.EMPTY_NODE.updateChild(this.indexPath_,n))}maxPost(){return new fs(dm,fT.EMPTY_NODE.updateChild(this.indexPath_,fI))}toString(){return d6(this.indexPath_,0).join("/")}}let fk=new class extends fo{compare(e,t){let n=e.node.compareTo(t.node);return 0===n?dy(e.name,t.name):n}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return fs.MIN}maxPost(){return fs.MAX}makePost(e,t){return new fs(t,fC(e))}toString(){return".value"}};function fA(e,t,n){return{type:"child_changed",snapshotNode:t,childName:e,oldSnap:n}}class fR{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=fy}hasStart(){return this.startSet_}isViewFromLeft(){return""===this.viewFrom_?this.startSet_:"l"===this.viewFrom_}getIndexStartValue(){return j(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return(j(this.startSet_,"Only valid if start has been set"),this.startNameSet_)?this.indexStartName_:dg}hasEnd(){return this.endSet_}getIndexEndValue(){return j(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return(j(this.endSet_,"Only valid if end has been set"),this.endNameSet_)?this.indexEndName_:dm}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&""!==this.viewFrom_}getLimit(){return j(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===fy}copy(){let e=new fR;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function fN(e){let t,n={};if(e.isDefault())return n;if(e.index_===fy?t="$priority":e.index_===fk?t="$value":e.index_===fl?t="$key":(j(e.index_ instanceof fS,"Unrecognized index type!"),t=e.index_.toString()),n.orderBy=ey(t),e.startSet_){let t=e.startAfterSet_?"startAfter":"startAt";n[t]=ey(e.indexStartValue_),e.startNameSet_&&(n[t]+=","+ey(e.indexStartName_))}if(e.endSet_){let t=e.endBeforeSet_?"endBefore":"endAt";n[t]=ey(e.indexEndValue_),e.endNameSet_&&(n[t]+=","+ey(e.indexEndName_))}return e.limitSet_&&(e.isViewFromLeft()?n.limitToFirst=e.limit_:n.limitToLast=e.limit_),n}function fP(e){let t={};if(e.startSet_&&(t.sp=e.indexStartValue_,e.startNameSet_&&(t.sn=e.indexStartName_),t.sin=!e.startAfterSet_),e.endSet_&&(t.ep=e.indexEndValue_,e.endNameSet_&&(t.en=e.indexEndName_),t.ein=!e.endBeforeSet_),e.limitSet_){t.l=e.limit_;let n=e.viewFrom_;""===n&&(n=e.isViewFromLeft()?"l":"r"),t.vf=n}return e.index_!==fy&&(t.i=e.index_.toString()),t}class fD extends dG{reportStats(e){throw Error("Method not implemented.")}static getListenId_(e,t){return void 0!==t?"tag$"+t:(j(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}constructor(e,t,n,r){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=n,this.appCheckTokenProvider_=r,this.log_=dl("p:rest:"),this.listens_={}}listen(e,t,n,r){let i=e._path.toString();this.log_("Listen called for "+i+" "+e._queryIdentifier);let s=fD.getListenId_(e,n),o={};this.listens_[s]=o;let a=fN(e._queryParams);this.restRequest_(i+".json",a,(e,t)=>{let a=t;(404===e&&(a=null,e=null),null===e&&this.onDataUpdate_(i,a,!1,n),eE(this.listens_,s)===o)&&r(e?401===e?"permission_denied":"rest_error:"+e:"ok",null)})}unlisten(e,t){let n=fD.getListenId_(e,t);delete this.listens_[n]}get(e){let t=fN(e._queryParams),n=e._path.toString(),r=new et;return this.restRequest_(n+".json",t,(e,t)=>{let i=t;404===e&&(i=null,e=null),null===e?(this.onDataUpdate_(n,i,!1,null),r.resolve(i)):r.reject(Error(i))}),r.promise}refreshAuthToken(e){}restRequest_(e,t={},n){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([r,i])=>{r&&r.accessToken&&(t.auth=r.accessToken),i&&i.token&&(t.ac=i.token);let s=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+ek(t);this.log_("Sending REST request for "+s);let o=new XMLHttpRequest;o.onreadystatechange=()=>{if(n&&4===o.readyState){this.log_("REST Response for "+s+" received. status:",o.status,"response:",o.responseText);let e=null;if(o.status>=200&&o.status<300){try{e=em(o.responseText)}catch(e){dc("Failed to parse JSON response for "+s+": "+o.responseText)}n(null,e)}else 401!==o.status&&404!==o.status&&dc("Got unsuccessful REST response for "+s+" Status: "+o.status),n(o.status);n=null}},o.open("GET",s,!0),o.send()})}}class fO{constructor(){this.rootNode_=fT.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}}function fx(){return{value:null,children:new Map}}function fL(e,t,n){var r,i;null!==e.value?n(t,e.value):(r=e,i=(e,r)=>{fL(r,new dX(t.toString()+"/"+e),n)},r.children.forEach((e,t)=>{i(t,e)}))}class fM{constructor(e){this.collection_=e,this.last_=null}get(){let e=this.collection_.get(),t={...e};return this.last_&&dE(this.last_,(e,n)=>{t[e]=t[e]-n}),this.last_=e,t}}class fU{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new fM(e);const n=1e4+2e4*Math.random();dk(this.reportStats_.bind(this),Math.floor(n))}reportStats_(){let e=this.statsListener_.get(),t={},n=!1;dE(e,(e,r)=>{r>0&&eb(this.statsToReport_,e)&&(t[e]=r,n=!0)}),n&&this.server_.reportStats(t),dk(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))}}function fF(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function fV(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function fB(e){return{fromUser:!1,fromServer:!0,queryId:e,tagged:!0}}(v=U||(U={}))[v.OVERWRITE=0]="OVERWRITE",v[v.MERGE=1]="MERGE",v[v.ACK_USER_WRITE=2]="ACK_USER_WRITE",v[v.LISTEN_COMPLETE=3]="LISTEN_COMPLETE";class fj{constructor(e,t,n){this.path=e,this.affectedTree=t,this.revert=n,this.type=U.ACK_USER_WRITE,this.source=fF()}operationForChild(e){if(!d5(this.path))return j(dZ(this.path)===e,"operationForChild called for unrelated child."),new fj(d1(this.path),this.affectedTree,this.revert);if(null!=this.affectedTree.value)return j(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{let t=this.affectedTree.subtree(new dX(e));return new fj(dJ(),t,this.revert)}}}class fq{constructor(e,t,n){this.source=e,this.path=t,this.snap=n,this.type=U.OVERWRITE}operationForChild(e){return d5(this.path)?new fq(this.source,dJ(),this.snap.getImmediateChild(e)):new fq(this.source,d1(this.path),this.snap)}}class fz{constructor(e,t,n){this.source=e,this.path=t,this.children=n,this.type=U.MERGE}operationForChild(e){if(!d5(this.path))return j(dZ(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new fz(this.source,d1(this.path),this.children);{let t=this.children.subtree(new dX(e));return t.isEmpty()?null:t.value?new fq(this.source,dJ(),t.value):new fz(this.source,dJ(),t)}}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}class f${constructor(e,t,n){this.node_=e,this.fullyInitialized_=t,this.filtered_=n}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(d5(e))return this.isFullyInitialized()&&!this.filtered_;let t=dZ(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}function fH(e,t,n,r,i,s){let o=r.filter(e=>e.type===n);o.sort((t,n)=>(function(e,t,n){if(null==t.childName||null==n.childName)throw q("Should only compare child_ events.");let r=new fs(t.childName,t.snapshotNode),i=new fs(n.childName,n.snapshotNode);return e.index_.compare(r,i)})(e,t,n)),o.forEach(n=>{var r,o,a;let l=(r=e,o=n,a=s,"value"===o.type||"child_removed"===o.type||(o.prevName=a.getPredecessorChildName(o.childName,o.snapshotNode,r.index_)),o);i.forEach(r=>{r.respondsTo(n.type)&&t.push(r.createEvent(l,e.query_))})})}function fW(e,t){return{eventCache:e,serverCache:t}}function fK(e,t,n,r){return fW(new f$(t,n,r),e.serverCache)}function fG(e,t,n,r){return fW(e.eventCache,new f$(t,n,r))}function fQ(e){return e.eventCache.isFullyInitialized()?e.eventCache.getNode():null}function fY(e){return e.serverCache.isFullyInitialized()?e.serverCache.getNode():null}class fX{static fromObject(e){let t=new fX(null);return dE(e,(e,n)=>{t=t.set(new dX(e),n)}),t}constructor(e,t=(!u&&(u=new fc(d_)),u)){this.value=e,this.children=t}isEmpty(){return null===this.value&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(null!=this.value&&t(this.value))return{path:dJ(),value:this.value};{if(d5(e))return null;let n=dZ(e),r=this.children.get(n);if(null===r)return null;{let i=r.findRootMostMatchingPathAndValue(d1(e),t);return null!=i?{path:d4(new dX(n),i.path),value:i.value}:null}}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(d5(e))return this;{let t=dZ(e),n=this.children.get(t);return null!==n?n.subtree(d1(e)):new fX(null)}}set(e,t){if(d5(e))return new fX(t,this.children);{let n=dZ(e),r=(this.children.get(n)||new fX(null)).set(d1(e),t),i=this.children.insert(n,r);return new fX(this.value,i)}}remove(e){if(d5(e))if(this.children.isEmpty())return new fX(null);else return new fX(null,this.children);{let t=dZ(e),n=this.children.get(t);if(!n)return this;{let r,i=n.remove(d1(e));return(r=i.isEmpty()?this.children.remove(t):this.children.insert(t,i),null===this.value&&r.isEmpty())?new fX(null):new fX(this.value,r)}}}get(e){if(d5(e))return this.value;{let t=dZ(e),n=this.children.get(t);return n?n.get(d1(e)):null}}setTree(e,t){if(d5(e))return t;{let n,r=dZ(e),i=(this.children.get(r)||new fX(null)).setTree(d1(e),t);return n=i.isEmpty()?this.children.remove(r):this.children.insert(r,i),new fX(this.value,n)}}fold(e){return this.fold_(dJ(),e)}fold_(e,t){let n={};return this.children.inorderTraversal((r,i)=>{n[r]=i.fold_(d4(e,r),t)}),t(e,this.value,n)}findOnPath(e,t){return this.findOnPath_(e,dJ(),t)}findOnPath_(e,t,n){let r=!!this.value&&n(t,this.value);if(r)return r;{if(d5(e))return null;let r=dZ(e),i=this.children.get(r);return i?i.findOnPath_(d1(e),d4(t,r),n):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,dJ(),t)}foreachOnPath_(e,t,n){if(d5(e))return this;{this.value&&n(t,this.value);let r=dZ(e),i=this.children.get(r);return i?i.foreachOnPath_(d1(e),d4(t,r),n):new fX(null)}}foreach(e){this.foreach_(dJ(),e)}foreach_(e,t){this.children.inorderTraversal((n,r)=>{r.foreach_(d4(e,n),t)}),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal((t,n)=>{n.value&&e(t,n.value)})}}class fJ{constructor(e){this.writeTree_=e}static empty(){return new fJ(new fX(null))}}function fZ(e,t,n){if(d5(t))return new fJ(new fX(n));{let r=e.writeTree_.findRootMostValueAndPath(t);if(null!=r){let i=r.path,s=r.value,o=d8(i,t);return s=s.updateChild(o,n),new fJ(e.writeTree_.set(i,s))}{let r=new fX(n);return new fJ(e.writeTree_.setTree(t,r))}}}function f0(e,t,n){let r=e;return dE(n,(e,n)=>{r=fZ(r,d4(t,e),n)}),r}function f1(e,t){return d5(t)?fJ.empty():new fJ(e.writeTree_.setTree(t,new fX(null)))}function f2(e,t){return null!=f6(e,t)}function f6(e,t){let n=e.writeTree_.findRootMostValueAndPath(t);return null!=n?e.writeTree_.get(n.path).getChild(d8(n.path,t)):null}function f3(e){let t=[],n=e.writeTree_.value;return null!=n?n.isLeafNode()||n.forEachChild(fy,(e,n)=>{t.push(new fs(e,n))}):e.writeTree_.children.inorderTraversal((e,n)=>{null!=n.value&&t.push(new fs(e,n.value))}),t}function f4(e,t){if(d5(t))return e;{let n=f6(e,t);return new fJ(null!=n?new fX(n):e.writeTree_.subtree(t))}}function f5(e){return e.writeTree_.isEmpty()}function f8(e,t){return function e(t,n,r){if(null!=n.value)return r.updateChild(t,n.value);{let i=null;return n.children.inorderTraversal((n,s)=>{".priority"===n?(j(null!==s.value,"Priority writes must always be leaf nodes"),i=s.value):r=e(d4(t,n),s,r)}),r.getChild(t).isEmpty()||null===i||(r=r.updateChild(d4(t,".priority"),i)),r}}(dJ(),e.writeTree_,t)}function f7(e){return e.visible}function f9(e,t,n){let r=fJ.empty();for(let i=0;i<e.length;++i){let s=e[i];if(t(s)){let e,t=s.path;if(s.snap)d9(n,t)?r=fZ(r,e=d8(n,t),s.snap):d9(t,n)&&(e=d8(t,n),r=fZ(r,dJ(),s.snap.getChild(e)));else if(s.children){if(d9(n,t))r=f0(r,e=d8(n,t),s.children);else if(d9(t,n))if(d5(e=d8(t,n)))r=f0(r,dJ(),s.children);else{let t=eE(s.children,dZ(e));if(t){let n=t.getChild(d1(e));r=fZ(r,dJ(),n)}}}else throw q("WriteRecord should have .snap or .children")}}return r}function pe(e,t,n,r,i){if(r||i){let s=f4(e.visibleWrites,t);return!i&&f5(s)?n:i||null!=n||f2(s,dJ())?f8(f9(e.allWrites,function(e){return(e.visible||i)&&(!r||!~r.indexOf(e.writeId))&&(d9(e.path,t)||d9(t,e.path))},t),n||fT.EMPTY_NODE):null}{let r=f6(e.visibleWrites,t);if(null!=r)return r;{let r=f4(e.visibleWrites,t);return f5(r)?n:null!=n||f2(r,dJ())?f8(r,n||fT.EMPTY_NODE):null}}}function pt(e,t,n,r){return pe(e.writeTree,e.treePath,t,n,r)}function pn(e,t){return function(e,t,n){let r=fT.EMPTY_NODE,i=f6(e.visibleWrites,t);if(i)return i.isLeafNode()||i.forEachChild(fy,(e,t)=>{r=r.updateImmediateChild(e,t)}),r;if(!n)return f3(f4(e.visibleWrites,t)).forEach(e=>{r=r.updateImmediateChild(e.name,e.node)}),r;{let i=f4(e.visibleWrites,t);return n.forEachChild(fy,(e,t)=>{let n=f8(f4(i,new dX(e)),t);r=r.updateImmediateChild(e,n)}),f3(i).forEach(e=>{r=r.updateImmediateChild(e.name,e.node)}),r}}(e.writeTree,e.treePath,t)}function pr(e,t,n,r){return function(e,t,n,r,i){j(r||i,"Either existingEventSnap or existingServerSnap must exist");let s=d4(t,n);if(f2(e.visibleWrites,s))return null;{let t=f4(e.visibleWrites,s);return f5(t)?i.getChild(n):f8(t,i.getChild(n))}}(e.writeTree,e.treePath,t,n,r)}function pi(e,t){var n,r;return n=e.writeTree,r=d4(e.treePath,t),f6(n.visibleWrites,r)}function ps(e,t,n){var r,i;let s,o;return r=e.writeTree,i=e.treePath,s=d4(i,t),null!=(o=f6(r.visibleWrites,s))?o:n.isCompleteForChild(t)?f8(f4(r.visibleWrites,s),n.getNode().getImmediateChild(t)):null}function po(e,t){return pa(d4(e.treePath,t),e.writeTree)}function pa(e,t){return{treePath:e,writeTree:t}}class pl{constructor(){this.changeMap=new Map}trackChildChange(e){let t=e.type,n=e.childName;j("child_added"===t||"child_changed"===t||"child_removed"===t,"Only child changes supported for tracking"),j(".priority"!==n,"Only non-priority child changes can be tracked.");let r=this.changeMap.get(n);if(r){let i=r.type;if("child_added"===t&&"child_removed"===i)this.changeMap.set(n,fA(n,e.snapshotNode,r.snapshotNode));else if("child_removed"===t&&"child_added"===i)this.changeMap.delete(n);else if("child_removed"===t&&"child_changed"===i)this.changeMap.set(n,{type:"child_removed",snapshotNode:r.oldSnap,childName:n});else if("child_changed"===t&&"child_added"===i)this.changeMap.set(n,{type:"child_added",snapshotNode:e.snapshotNode,childName:n});else if("child_changed"===t&&"child_changed"===i)this.changeMap.set(n,fA(n,e.snapshotNode,r.oldSnap));else throw q("Illegal combination of changes: "+e+" occurred after "+r)}else this.changeMap.set(n,e)}getChanges(){return Array.from(this.changeMap.values())}}let ph=new class{getCompleteChild(e){return null}getChildAfterChild(e,t,n){return null}};class pu{constructor(e,t,n=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=n}getCompleteChild(e){let t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{let t=null!=this.optCompleteServerCache_?new f$(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return ps(this.writes_,e,t)}}getChildAfterChild(e,t,n){var r;let i=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:fY(this.viewCache_),s=(r=this.writes_,function(e,t,n,r,i,s,o){let a,l=f4(e.visibleWrites,t),h=f6(l,dJ());if(null!=h)a=h;else{if(null==n)return[];a=f8(l,n)}if((a=a.withIndex(o)).isEmpty()||a.isLeafNode())return[];{let e=[],t=o.getCompare(),n=s?a.getReverseIteratorFrom(r,o):a.getIteratorFrom(r,o),i=n.getNext();for(;i&&e.length<1;)0!==t(i,r)&&e.push(i),i=n.getNext();return e}}(r.writeTree,r.treePath,i,t,1,n,e));return 0===s.length?null:s[0]}}function pc(e,t,n,r,i,s){let o=t.eventCache;if(null!=pi(r,n))return t;{let a,l;if(d5(n))if(j(t.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),t.serverCache.isFiltered()){let n=fY(t),i=pn(r,n instanceof fT?n:fT.EMPTY_NODE);a=e.filter.updateFullNode(t.eventCache.getNode(),i,s)}else{let n=pt(r,fY(t));a=e.filter.updateFullNode(t.eventCache.getNode(),n,s)}else{let h=dZ(n);if(".priority"===h){j(1===d0(n),"Can't have a priority with additional path components");let i=o.getNode(),s=pr(r,n,i,l=t.serverCache.getNode());a=null!=s?e.filter.updatePriority(i,s):o.getNode()}else{let u,c=d1(n);if(o.isCompleteForChild(h)){l=t.serverCache.getNode();let e=pr(r,n,o.getNode(),l);u=null!=e?o.getNode().getImmediateChild(h).updateChild(c,e):o.getNode().getImmediateChild(h)}else u=ps(r,h,t.serverCache);a=null!=u?e.filter.updateChild(o.getNode(),h,u,c,i,s):o.getNode()}}return fK(t,a,o.isFullyInitialized()||d5(n),e.filter.filtersNodes())}}function pd(e,t,n,r,i,s,o,a){let l,h=t.serverCache,u=o?e.filter:e.filter.getIndexedFilter();if(d5(n))l=u.updateFullNode(h.getNode(),r,null);else if(u.filtersNodes()&&!h.isFiltered()){let e=h.getNode().updateChild(n,r);l=u.updateFullNode(h.getNode(),e,null)}else{let e=dZ(n);if(!h.isCompleteForPath(n)&&d0(n)>1)return t;let i=d1(n),s=h.getNode().getImmediateChild(e).updateChild(i,r);l=".priority"===e?u.updatePriority(h.getNode(),s):u.updateChild(h.getNode(),e,s,i,ph,null)}let c=fG(t,l,h.isFullyInitialized()||d5(n),u.filtersNodes()),d=new pu(i,c,s);return pc(e,c,n,i,d,a)}function pf(e,t,n,r,i,s,o){let a,l,h=t.eventCache,u=new pu(i,t,s);if(d5(n))l=e.filter.updateFullNode(t.eventCache.getNode(),r,o),a=fK(t,l,!0,e.filter.filtersNodes());else{let i=dZ(n);if(".priority"===i)l=e.filter.updatePriority(t.eventCache.getNode(),r),a=fK(t,l,h.isFullyInitialized(),h.isFiltered());else{let s,l=d1(n),c=h.getNode().getImmediateChild(i);if(d5(l))s=r;else{let e=u.getCompleteChild(i);s=null!=e?".priority"===d2(l)&&e.getChild(d3(l)).isEmpty()?e:e.updateChild(l,r):fT.EMPTY_NODE}a=c.equals(s)?t:fK(t,e.filter.updateChild(h.getNode(),i,s,l,u,o),h.isFullyInitialized(),e.filter.filtersNodes())}}return a}function pp(e,t){return e.eventCache.isCompleteForChild(t)}function pg(e,t,n){return n.foreach((e,n)=>{t=t.updateChild(e,n)}),t}function pm(e,t,n,r,i,s,o,a){let l;if(t.serverCache.getNode().isEmpty()&&!t.serverCache.isFullyInitialized())return t;let h=t;l=d5(n)?r:new fX(null).setTree(n,r);let u=t.serverCache.getNode();return l.children.inorderTraversal((n,r)=>{if(u.hasChild(n)){let l=pg(e,t.serverCache.getNode().getImmediateChild(n),r);h=pd(e,h,new dX(n),l,i,s,o,a)}}),l.children.inorderTraversal((n,r)=>{let l=!t.serverCache.isCompleteForChild(n)&&null===r.value;if(!u.hasChild(n)&&!l){let l=pg(e,t.serverCache.getNode().getImmediateChild(n),r);h=pd(e,h,new dX(n),l,i,s,o,a)}}),h}function py(e,t,n,r){var i,s;t.type===U.MERGE&&null!==t.source.queryId&&(j(fY(e.viewCache_),"We should always have a full cache before handling merges"),j(fQ(e.viewCache_),"Missing event cache, even though we have a server cache"));let o=e.viewCache_,a=function(e,t,n,r,i){var s,o,a,l,h,u,c,d,f,p,g,m;let y,_,v=new pl;if(n.type===U.OVERWRITE)n.source.fromUser?y=pf(e,t,n.path,n.snap,r,i,v):(j(n.source.fromServer,"Unknown source."),_=n.source.tagged||t.serverCache.isFiltered()&&!d5(n.path),y=pd(e,t,n.path,n.snap,r,i,_,v));else if(n.type===U.MERGE){let d;n.source.fromUser?(s=e,o=t,a=n.path,l=n.children,h=r,u=i,c=v,d=o,l.foreach((e,t)=>{let n=d4(a,e);pp(o,dZ(n))&&(d=pf(s,d,n,t,h,u,c))}),l.foreach((e,t)=>{let n=d4(a,e);pp(o,dZ(n))||(d=pf(s,d,n,t,h,u,c))}),y=d):(j(n.source.fromServer,"Unknown source."),_=n.source.tagged||t.serverCache.isFiltered(),y=pm(e,t,n.path,n.children,r,i,_,v))}else if(n.type===U.ACK_USER_WRITE)y=n.revert?function(e,t,n,r,i,s){let o;if(null!=pi(r,n))return t;{let a,l=new pu(r,t,i),h=t.eventCache.getNode();if(d5(n)||".priority"===dZ(n)){let n;if(t.serverCache.isFullyInitialized())n=pt(r,fY(t));else{let e=t.serverCache.getNode();j(e instanceof fT,"serverChildren would be complete if leaf node"),n=pn(r,e)}a=e.filter.updateFullNode(h,n,s)}else{let i=dZ(n),u=ps(r,i,t.serverCache);null==u&&t.serverCache.isCompleteForChild(i)&&(u=h.getImmediateChild(i)),(a=null!=u?e.filter.updateChild(h,i,u,d1(n),l,s):t.eventCache.getNode().hasChild(i)?e.filter.updateChild(h,i,fT.EMPTY_NODE,d1(n),l,s):h).isEmpty()&&t.serverCache.isFullyInitialized()&&(o=pt(r,fY(t))).isLeafNode()&&(a=e.filter.updateFullNode(a,o,s))}return o=t.serverCache.isFullyInitialized()||null!=pi(r,dJ()),fK(t,a,o,e.filter.filtersNodes())}}(e,t,n.path,r,i,v):function(e,t,n,r,i,s,o){if(null!=pi(i,n))return t;let a=t.serverCache.isFiltered(),l=t.serverCache;if(null!=r.value)if(d5(n)&&l.isFullyInitialized()||l.isCompleteForPath(n))return pd(e,t,n,l.getNode().getChild(n),i,s,a,o);else{if(!d5(n))return t;let r=new fX(null);return l.getNode().forEachChild(fl,(e,t)=>{r=r.set(new dX(e),t)}),pm(e,t,n,r,i,s,a,o)}{let h=new fX(null);return r.foreach((e,t)=>{let r=d4(n,e);l.isCompleteForPath(r)&&(h=h.set(e,l.getNode().getChild(r)))}),pm(e,t,n,h,i,s,a,o)}}(e,t,n.path,n.affectedTree,r,i,v);else if(n.type===U.LISTEN_COMPLETE){let i;d=e,f=t,p=n.path,g=r,m=v,i=f.serverCache,y=pc(d,fG(f,i.getNode(),i.isFullyInitialized()||d5(p),i.isFiltered()),p,g,ph,m)}else throw q("Unknown operation type: "+n.type);let w=v.getChanges();return function(e,t,n){let r=t.eventCache;if(r.isFullyInitialized()){let i=r.getNode().isLeafNode()||r.getNode().isEmpty(),s=fQ(e);!(n.length>0)&&e.eventCache.isFullyInitialized()&&(!i||r.getNode().equals(s))&&r.getNode().getPriority().equals(s.getPriority())||n.push({type:"value",snapshotNode:fQ(t)})}}(t,y,w),{viewCache:y,changes:w}}(e.processor_,o,t,n,r);return i=e.processor_,j((s=a.viewCache).eventCache.getNode().isIndexed(i.filter.getIndex()),"Event snap not indexed"),j(s.serverCache.getNode().isIndexed(i.filter.getIndex()),"Server snap not indexed"),j(a.viewCache.serverCache.isFullyInitialized()||!o.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),e.viewCache_=a.viewCache,function(e,t,n,r){var i;let s,o,a=(0,e.eventRegistrations_);return i=e.eventGenerator_,s=[],o=[],t.forEach(e=>{var t;"child_changed"===e.type&&i.index_.indexedValueChanged(e.oldSnap,e.snapshotNode)&&o.push((t=e.childName,{type:"child_moved",snapshotNode:e.snapshotNode,childName:t}))}),fH(i,s,"child_removed",t,a,n),fH(i,s,"child_added",t,a,n),fH(i,s,"child_moved",o,a,n),fH(i,s,"child_changed",t,a,n),fH(i,s,"value",t,a,n),s}(e,a.changes,a.viewCache.eventCache.getNode(),null)}function p_(e,t,n,r){let i=t.source.queryId;if(null!==i){let s=e.views.get(i);return j(null!=s,"SyncTree gave us an op for an invalid query."),py(s,t,n,r)}{let i=[];for(let s of e.views.values())i=i.concat(py(s,t,n,r));return i}}function pv(e,t){let n=null;for(let r of e.views.values())n=n||function(e,t){let n=fY(e.viewCache_);return n&&(e.query._queryParams.loadsAllData()||!d5(t)&&!n.getImmediateChild(dZ(t)).isEmpty())?n.getChild(t):null}(r,t);return n}class pw{constructor(e){this.listenProvider_=e,this.syncPointTree_=new fX(null),this.pendingWriteTree_={visibleWrites:fJ.empty(),allWrites:[],lastWriteId:-1},this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function pb(e,t,n=!1){let r=function(e,t){for(let n=0;n<e.allWrites.length;n++){let r=e.allWrites[n];if(r.writeId===t)return r}return null}(e.pendingWriteTree_,t);if(!function(e,t){var n;let r=e.allWrites.findIndex(e=>e.writeId===t);j(r>=0,"removeWrite called with nonexistent writeId.");let i=e.allWrites[r];e.allWrites.splice(r,1);let s=i.visible,o=!1,a=e.allWrites.length-1;for(;s&&a>=0;){let t=e.allWrites[a];t.visible&&(a>=r&&function(e,t){if(e.snap)return d9(e.path,t);for(let n in e.children)if(e.children.hasOwnProperty(n)&&d9(d4(e.path,n),t))return!0;return!1}(t,i.path)?s=!1:d9(i.path,t.path)&&(o=!0)),a--}return!!s&&(o?((n=e).visibleWrites=f9(n.allWrites,f7,dJ()),n.allWrites.length>0?n.lastWriteId=n.allWrites[n.allWrites.length-1].writeId:n.lastWriteId=-1):i.snap?e.visibleWrites=f1(e.visibleWrites,i.path):dE(i.children,t=>{e.visibleWrites=f1(e.visibleWrites,d4(i.path,t))}),!0)}(e.pendingWriteTree_,t))return[];{let t=new fX(null);return null!=r.snap?t=t.set(dJ(),!0):dE(r.children,e=>{t=t.set(new dX(e),!0)}),pI(e,new fj(r.path,t,n))}}function pE(e,t,n){return pI(e,new fq(fV(),t,n))}function pT(e,t,n){let r=e.pendingWriteTree_,i=e.syncPointTree_.findOnPath(t,(e,n)=>{let r=pv(n,d8(e,t));if(r)return r});return pe(r,t,i,n,!0)}function pI(e,t){var n;return function e(t,n,r,i){if(d5(t.path))return function e(t,n,r,i){let s=n.get(dJ());null==r&&null!=s&&(r=pv(s,dJ()));let o=[];return n.children.inorderTraversal((n,s)=>{let a=r?r.getImmediateChild(n):null,l=po(i,n),h=t.operationForChild(n);h&&(o=o.concat(e(h,s,a,l)))}),s&&(o=o.concat(p_(s,t,i,r))),o}(t,n,r,i);{let s=n.get(dJ());null==r&&null!=s&&(r=pv(s,dJ()));let o=[],a=dZ(t.path),l=t.operationForChild(a),h=n.children.get(a);if(h&&l){let t=r?r.getImmediateChild(a):null,n=po(i,a);o=o.concat(e(l,h,t,n))}return s&&(o=o.concat(p_(s,t,i,r))),o}}(t,e.syncPointTree_,null,(n=e.pendingWriteTree_,pa(dJ(),n)))}function pC(e,t){return e.tagToQueryMap.get(t)}function pS(e){let t=e.indexOf("$");return j(-1!==t&&t<e.length-1,"Bad queryKey."),{queryId:e.substr(t+1),path:new dX(e.substr(0,t))}}function pk(e,t,n){let r=e.syncPointTree_.get(t);return j(r,"Missing sync point for query tag that we're tracking"),p_(r,n,pa(t,e.pendingWriteTree_),null)}class pA{constructor(e){this.node_=e}getImmediateChild(e){return new pA(this.node_.getImmediateChild(e))}node(){return this.node_}}class pR{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){let t=d4(this.path_,e);return new pR(this.syncTree_,t)}node(){return pT(this.syncTree_,this.path_)}}let pN=function(e,t,n){return e&&"object"==typeof e?(j(".sv"in e,"Unexpected leaf node or priority contents"),"string"==typeof e[".sv"])?pP(e[".sv"],t,n):"object"==typeof e[".sv"]?pD(e[".sv"],t):void j(!1,"Unexpected server value: "+JSON.stringify(e,null,2)):e},pP=function(e,t,n){if("timestamp"===e)return n.timestamp;j(!1,"Unexpected server value: "+e)},pD=function(e,t,n){e.hasOwnProperty("increment")||j(!1,"Unexpected server value: "+JSON.stringify(e,null,2));let r=e.increment;"number"!=typeof r&&j(!1,"Unexpected increment value: "+r);let i=t.node();if(j(null!=i,"Expected ChildrenNode.EMPTY_NODE for nulls"),!i.isLeafNode())return r;let s=i.getValue();return"number"!=typeof s?r:s+r};function pO(e,t,n){let r,i=pN(e.getPriority().val(),t.getImmediateChild(".priority"),n);if(!e.isLeafNode())return r=e,i!==e.getPriority().val()&&(r=r.updatePriority(new fm(i))),e.forEachChild(fy,(e,i)=>{let s=pO(i,t.getImmediateChild(e),n);s!==i&&(r=r.updateImmediateChild(e,s))}),r;{let r=pN(e.getValue(),t,n);return r!==e.getValue()||i!==e.getPriority().val()?new fm(r,fC(i)):e}}class px{constructor(e="",t=null,n={children:{},childCount:0}){this.name=e,this.parent=t,this.node=n}}function pL(e,t){let n=t instanceof dX?t:new dX(t),r=e,i=dZ(n);for(;null!==i;){let e=eE(r.node.children,i)||{children:{},childCount:0};r=new px(i,r,e),i=dZ(n=d1(n))}return r}function pM(e){return e.node.value}function pU(e,t){e.node.value=t,function e(t){null!==t.parent&&function(t,n,r){let i=void 0===pM(r)&&!pF(r),s=eb(t.node.children,n);i&&s?(delete t.node.children[n],t.node.childCount--,e(t)):i||s||(t.node.children[n]=r.node,t.node.childCount++,e(t))}(t.parent,t.name,t)}(e)}function pF(e){return e.node.childCount>0}function pV(e,t){dE(e.node.children,(n,r)=>{t(new px(n,e,r))})}function pB(e){return new dX(null===e.parent?e.name:pB(e.parent)+"/"+e.name)}let pj=/[\[\].#$\/\u0000-\u001F\u007F]/,pq=/[\[\].#$\u0000-\u001F\u007F]/,pz=function(e){return"string"==typeof e&&0!==e.length&&!pj.test(e)},p$=function(e){var t;return e&&(e=e.replace(/^\/*\.info(\/|$)/,"/")),"string"==typeof(t=e)&&0!==t.length&&!pq.test(t)},pH=function(e,t,n){let r=n instanceof dX?new fe(n,e):n;if(void 0===t)throw Error(e+"contains undefined "+fn(r));if("function"==typeof t)throw Error(e+"contains a function "+fn(r)+" with contents = "+t.toString());if(df(t))throw Error(e+"contains "+t.toString()+" "+fn(r));if("string"==typeof t&&t.length>3495253.3333333335&&ex(t)>0xa00000)throw Error(e+"contains a string greater than 10485760 utf8 bytes "+fn(r)+" ('"+t.substring(0,50)+"...')");if(t&&"object"==typeof t){let n=!1,i=!1;if(dE(t,(t,s)=>{let o;if(".value"===t)n=!0;else if(".priority"!==t&&".sv"!==t&&(i=!0,!pz(t)))throw Error(e+" contains an invalid key ("+t+") "+fn(r)+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');r.parts_.length>0&&(r.byteLength_+=1),r.parts_.push(t),r.byteLength_+=ex(t),ft(r),pH(e,s,r),o=r.parts_.pop(),r.byteLength_-=ex(o),r.parts_.length>0&&(r.byteLength_-=1)}),n&&i)throw Error(e+' contains ".value" child '+fn(r)+" in addition to actual children.")}},pW=function(e,t){let n=t.path.toString();if("string"!=typeof t.repoInfo.host||0===t.repoInfo.host.length||!pz(t.repoInfo.namespace)&&"localhost"!==t.repoInfo.host.split(":")[0]||0!==n.length&&!p$(n))throw Error(`${e} failed: url argument must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};class pK{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function pG(e,t,n){let r=null;for(let t=0;t<n.length;t++){let i=n[t],s=i.getPath();null===r||d7(s,r.path)||(e.eventLists_.push(r),r=null),null===r&&(r={events:[],path:s}),r.events.push(i)}r&&e.eventLists_.push(r),function(e,t){e.recursionDepth_++;let n=!0;for(let r=0;r<e.eventLists_.length;r++){let i=e.eventLists_[r];i&&(t(i.path)?(function(e){for(let t=0;t<e.events.length;t++){let n=e.events[t];if(null!==n){e.events[t]=null;let r=n.getEventRunner();dr&&da("event: "+n.toString()),dS(r)}}}(e.eventLists_[r]),e.eventLists_[r]=null):n=!1)}n&&(e.eventLists_=[]),e.recursionDepth_--}(e,e=>d9(e,t)||d9(t,e))}class pQ{constructor(e,t,n,r){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=n,this.appCheckProvider_=r,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new pK,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=fx(),this.transactionQueueTree_=new px,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function pY(e){var t;let n;return(t=t={timestamp:(n=e.infoData_.getNode(new dX(".info/serverTimeOffset")).val()||0,new Date().getTime()+n)}).timestamp=t.timestamp||new Date().getTime(),t}function pX(e,t,n,r,i){e.dataUpdateCount++;let s=new dX(t);n=e.interceptServerDataCallback_?e.interceptServerDataCallback_(t,n):n;let o=[];if(i)if(r){let t=eI(n,e=>fC(e));o=function(e,t,n,r){let i=pC(e,r);if(!i)return[];{let r=pS(i),s=r.path,o=r.queryId,a=d8(s,t),l=fX.fromObject(n);return pk(e,s,new fz(fB(o),a,l))}}(e.serverSyncTree_,s,t,i)}else{let t=fC(n);o=function(e,t,n,r){let i=pC(e,r);if(null==i)return[];{let r=pS(i),s=r.path,o=r.queryId,a=d8(s,t);return pk(e,s,new fq(fB(o),a,n))}}(e.serverSyncTree_,s,t,i)}else if(r){var a;let t,r=eI(n,e=>fC(e));a=e.serverSyncTree_,t=fX.fromObject(r),o=pI(a,new fz(fV(),s,t))}else{let t=fC(n);o=pE(e.serverSyncTree_,s,t)}let l=s;o.length>0&&(l=p2(e,s)),pG(e.eventQueue_,l,o)}function pJ(e,t){var n;let r,i,s;pZ(e,"connected",t),!1===t&&(p0(n=e,"onDisconnectEvents"),r=pY(n),i=fx(),fL(n.onDisconnect_,dJ(),(e,t)=>{var s;let o=(s=n.serverSyncTree_,pO(t,new pR(s,e),r));!function e(t,n,r){if(d5(n))t.value=r,t.children.clear();else if(null!==t.value)t.value=t.value.updateChild(n,r);else{let i=dZ(n);t.children.has(i)||t.children.set(i,fx()),e(t.children.get(i),n=d1(n),r)}}(i,e,o)}),s=[],fL(i,dJ(),(e,t)=>{var r,i;let o,a;s=s.concat(pE(n.serverSyncTree_,e,t));let l=(o=pB(p6(r=n,i=e)),!function(e,t,n){let r=e.parent;for(;null!==r;){if(t(r))return!0;r=r.parent}}(a=pL(r.transactionQueueTree_,i),e=>{p5(r,e)}),p5(r,a),!function e(t,n,r,i){r&&!i&&n(t),pV(t,t=>{e(t,n,!0,i)}),r&&i&&n(t)}(a,e=>{p5(r,e)}),o);p2(n,l)}),n.onDisconnect_=fx(),pG(n.eventQueue_,dJ(),s))}function pZ(e,t,n){let r=new dX("/.info/"+t),i=fC(n);e.infoData_.updateSnapshot(r,i);let s=pE(e.infoSyncTree_,r,i);pG(e.eventQueue_,r,s)}function p0(e,...t){let n="";e.persistentConnection_&&(n=e.persistentConnection_.id+":"),da(n,...t)}function p1(e,t,n){return pT(e.serverSyncTree_,t,n)||fT.EMPTY_NODE}function p2(e,t){let n=p6(e,t),r=pB(n),i=p3(e,n);return function(e,t,n){if(0===t.length)return;let r=[],i=[],s=t.filter(e=>0===e.status).map(e=>e.currentWriteId);for(let o=0;o<t.length;o++){let a=t[o],l=d8(n,a.path),h=!1,u;if(j(null!==l,"rerunTransactionsUnderNode_: relativePath should not be null."),4===a.status)h=!0,u=a.abortReason,i=i.concat(pb(e.serverSyncTree_,a.currentWriteId,!0));else if(0===a.status)if(a.retryCount>=25)h=!0,u="maxretry",i=i.concat(pb(e.serverSyncTree_,a.currentWriteId,!0));else{let n=p1(e,a.path,s);a.currentInputSnapshot=n;let r=t[o].update(n.val());if(void 0!==r){pH("transaction failed: Data returned ",r,a.path);let t=fC(r);"object"==typeof r&&null!=r&&eb(r,".priority")||(t=t.updatePriority(n.getPriority()));let o=a.currentWriteId,l=pY(e),h=pO(t,new pA(n),l);a.currentOutputSnapshotRaw=t,a.currentOutputSnapshotResolved=h,a.currentWriteId=e.nextWriteId_++,s.splice(s.indexOf(o),1),i=(i=i.concat(function(e,t,n,r,i){var s,o;return(s=e.pendingWriteTree_,o=i,j(r>s.lastWriteId,"Stacking an older write on top of newer ones"),void 0===o&&(o=!0),s.allWrites.push({path:t,snap:n,writeId:r,visible:o}),o&&(s.visibleWrites=fZ(s.visibleWrites,t,n)),s.lastWriteId=r,i)?pI(e,new fq(fF(),t,n)):[]}(e.serverSyncTree_,a.path,h,a.currentWriteId,a.applyLocally))).concat(pb(e.serverSyncTree_,o,!0))}else h=!0,u="nodata",i=i.concat(pb(e.serverSyncTree_,a.currentWriteId,!0))}pG(e.eventQueue_,n,i),i=[],h&&(t[o].status=2,setTimeout(t[o].unwatcher,Math.floor(0)),t[o].onComplete&&("nodata"===u?r.push(()=>t[o].onComplete(null,!1,t[o].currentInputSnapshot)):r.push(()=>t[o].onComplete(Error(u),!1,null))))}p4(e,e.transactionQueueTree_);for(let e=0;e<r.length;e++)dS(r[e]);!function e(t,n=t.transactionQueueTree_){if(n||p4(t,n),pM(n)){let r=p3(t,n);j(r.length>0,"Sending zero length transaction queue"),r.every(e=>0===e.status)&&function(t,n,r){let i=p1(t,n,r.map(e=>e.currentWriteId)),s=i,o=i.hash();for(let e=0;e<r.length;e++){let t=r[e];j(0===t.status,"tryToSendTransactionQueue_: items in queue should all be run."),t.status=1,t.retryCount++;let i=d8(n,t.path);s=s.updateChild(i,t.currentOutputSnapshotRaw)}let a=s.val(!0);t.server_.put(n.toString(),a,i=>{p0(t,"transaction put response",{path:n.toString(),status:i});let s=[];if("ok"===i){let i=[];for(let e=0;e<r.length;e++)r[e].status=2,s=s.concat(pb(t.serverSyncTree_,r[e].currentWriteId)),r[e].onComplete&&i.push(()=>r[e].onComplete(null,!0,r[e].currentOutputSnapshotResolved)),r[e].unwatcher();p4(t,pL(t.transactionQueueTree_,n)),e(t,t.transactionQueueTree_),pG(t.eventQueue_,n,s);for(let e=0;e<i.length;e++)dS(i[e])}else{if("datastale"===i)for(let e=0;e<r.length;e++)3===r[e].status?r[e].status=4:r[e].status=0;else{dc("transaction at "+n.toString()+" failed: "+i);for(let e=0;e<r.length;e++)r[e].status=4,r[e].abortReason=i}p2(t,n)}},o)}(t,pB(n),r)}else pF(n)&&pV(n,n=>{e(t,n)})}(e,e.transactionQueueTree_)}(e,i,r),r}function p6(e,t){let n,r=e.transactionQueueTree_;for(n=dZ(t);null!==n&&void 0===pM(r);)r=pL(r,n),n=dZ(t=d1(t));return r}function p3(e,t){let n=[];return function e(t,n,r){let i=pM(n);if(i)for(let e=0;e<i.length;e++)r.push(i[e]);pV(n,n=>{e(t,n,r)})}(e,t,n),n.sort((e,t)=>e.order-t.order),n}function p4(e,t){let n=pM(t);if(n){let e=0;for(let t=0;t<n.length;t++)2!==n[t].status&&(n[e]=n[t],e++);n.length=e,pU(t,n.length>0?n:void 0)}pV(t,t=>{p4(e,t)})}function p5(e,t){let n=pM(t);if(n){let r=[],i=[],s=-1;for(let t=0;t<n.length;t++)3===n[t].status||(1===n[t].status?(j(s===t-1,"All SENT items should be at beginning of queue."),s=t,n[t].status=3,n[t].abortReason="set"):(j(0===n[t].status,"Unexpected transaction status in abort"),n[t].unwatcher(),i=i.concat(pb(e.serverSyncTree_,n[t].currentWriteId,!0)),n[t].onComplete&&r.push(n[t].onComplete.bind(null,Error("set"),!1,null))));-1===s?pU(t,void 0):n.length=s+1,pG(e.eventQueue_,pB(t),i);for(let e=0;e<r.length;e++)dS(r[e])}}let p8=function(e,t){let n=p7(e),r=n.namespace;"firebase.com"===n.domain&&du(n.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),r&&"undefined"!==r||"localhost"===n.domain||du("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),n.secure||dd();let i="ws"===n.scheme||"wss"===n.scheme;return{repoInfo:new dx(n.host,n.secure,r,i,t,"",r!==n.subdomain),path:new dX(n.pathString)}},p7=function(e){let t="",n="",r="",i="",s="",o=!0,a="https",l=443;if("string"==typeof e){let h=e.indexOf("//");h>=0&&(a=e.substring(0,h-1),e=e.substring(h+2));let u=e.indexOf("/");-1===u&&(u=e.length);let c=e.indexOf("?");-1===c&&(c=e.length),t=e.substring(0,Math.min(u,c)),u<c&&(i=function(e){let t="",n=e.split("/");for(let e=0;e<n.length;e++)if(n[e].length>0){let r=n[e];try{r=decodeURIComponent(r.replace(/\+/g," "))}catch(e){}t+="/"+r}return t}(e.substring(u,c)));let d=function(e){let t={};for(let n of("?"===e.charAt(0)&&(e=e.substring(1)),e.split("&"))){if(0===n.length)continue;let r=n.split("=");2===r.length?t[decodeURIComponent(r[0])]=decodeURIComponent(r[1]):dc(`Invalid query segment '${n}' in query '${e}'`)}return t}(e.substring(Math.min(e.length,c)));(h=t.indexOf(":"))>=0?(o="https"===a||"wss"===a,l=parseInt(t.substring(h+1),10)):h=t.length;let f=t.slice(0,h);if("localhost"===f.toLowerCase())n="localhost";else if(f.split(".").length<=2)n=f;else{let e=t.indexOf(".");r=t.substring(0,e).toLowerCase(),n=t.substring(e+1),s=r}"ns"in d&&(s=d.ns)}return{host:t,port:l,domain:n,subdomain:r,secure:o,scheme:a,pathString:i,namespace:s}};class p9{constructor(e,t,n,r){this._repo=e,this._path=t,this._queryParams=n,this._orderByCalled=r}get key(){return d5(this._path)?null:d2(this._path)}get ref(){return new ge(this._repo,this._path)}get _queryIdentifier(){let e=dw(fP(this._queryParams));return"{}"===e?"default":e}get _queryObject(){return fP(this._queryParams)}isEqual(e){if(!((e=eL(e))instanceof p9))return!1;let t=this._repo===e._repo,n=d7(this._path,e._path),r=this._queryIdentifier===e._queryIdentifier;return t&&n&&r}toJSON(){return this.toString()}toString(){return this._repo.toString()+function(e){let t="";for(let n=e.pieceNum_;n<e.pieces_.length;n++)""!==e.pieces_[n]&&(t+="/"+encodeURIComponent(String(e.pieces_[n])));return t||"/"}(this._path)}}class ge extends p9{constructor(e,t){super(e,t,new fR,!1)}get parent(){let e=d3(this._path);return null===e?null:new ge(this._repo,e)}get root(){let e=this;for(;null!==e.parent;)e=e.parent;return e}}j(!c,"__referenceConstructor has already been defined"),c=ge,j(!d,"__referenceConstructor has already been defined"),d=ge;let gt={};class gn{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(!function(e,t,n){var r;let i;if(e.stats_=dV(e.repoInfo_),e.forceRestClient_||("object"==typeof window&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0)e.server_=new fD(e.repoInfo_,(t,n,r,i)=>{pX(e,t,n,r,i)},e.authTokenProvider_,e.appCheckProvider_),setTimeout(()=>pJ(e,!0),0);else{if(null!=n){if("object"!=typeof n)throw Error("Only objects are supported for option databaseAuthVariableOverride");try{ey(n)}catch(e){throw Error("Invalid authOverride provided: "+e)}}e.persistentConnection_=new fi(e.repoInfo_,t,(t,n,r,i)=>{pX(e,t,n,r,i)},t=>{pJ(e,t)},t=>{var n;n=e,dE(t,(e,t)=>{pZ(n,e,t)})},e.authTokenProvider_,e.appCheckProvider_,n),e.server_=e.persistentConnection_}e.authTokenProvider_.addTokenChangeListener(t=>{e.server_.refreshAuthToken(t)}),e.appCheckProvider_.addTokenChangeListener(t=>{e.server_.refreshAppCheckToken(t.token)}),r=e.repoInfo_,dF[i=r.toString()]||(dF[i]=(()=>new fU(e.stats_,e.server_))()),e.statsReporter_=dF[i],e.infoData_=new fO,e.infoSyncTree_=new pw({startListening:(t,n,r,i)=>{let s=[],o=e.infoData_.getNode(t._path);return o.isEmpty()||(s=pE(e.infoSyncTree_,t._path,o),setTimeout(()=>{i("ok")},0)),s},stopListening:()=>{}}),pZ(e,"connected",!1),e.serverSyncTree_=new pw({startListening:(t,n,r,i)=>(e.server_.listen(t,r,n,(n,r)=>{let s=i(n,r);pG(e.eventQueue_,t._path,s)}),[]),stopListening:(t,n)=>{e.server_.unlisten(t,n)}})}(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new ge(this._repo,dJ())),this._rootInternal}_delete(){if(null!==this._rootInternal){var e,t;let n;e=this._repo,(n=gt[t=this.app.name])&&n[e.key]===e||du(`Database ${t}(${e.repoInfo_}) has already been deleted.`),e.persistentConnection_&&e.persistentConnection_.interrupt("repo_interrupt"),delete n[e.key],this._repoInternal=null,this._rootInternal=null}return Promise.resolve()}_checkNotDeleted(e){null===this._rootInternal&&du("Cannot call "+e+" on a deleted database.")}}fi.prototype.simpleListen=function(e,t){this.sendRequest("q",{p:e},t)},fi.prototype.echo=function(e,t){this.sendRequest("echo",{d:e},t)},c6=tm,ts(new eM("database",(e,{instanceIdentifier:t})=>{var n,r,i,s;let o,a,l,h,u,c,d,f=e.getProvider("app").getImmediate(),p=e.getProvider("auth-internal"),g=e.getProvider("app-check-internal");return void 0===(l=t||f.options.databaseURL)&&(f.options.projectId||du("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),da("Using default host for project ",f.options.projectId),l=`${f.options.projectId}-default-rtdb.firebaseio.com`),u=(h=p8(l,void 0)).repoInfo,void 0!==F.default&&F.default.env&&(c=F.default.env.FIREBASE_DATABASE_EMULATOR_HOST),c?u=(h=p8(l=`http://${c}?ns=${u.namespace}`,void 0)).repoInfo:!h.repoInfo.secure,d=new dR(f.name,f.options,p),pW("Invalid Firebase Database URL",h),d5(h.path)||du("Database URL must point to the root of a Firebase Database (not including a child path)."),new gn((n=u,r=f,i=d,s=new dA(f,g),(o=gt[r.name])||(o={},gt[r.name]=o),(a=o[n.toURLString()])&&du("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),a=new pQ(n,!1,i,s),o[n.toURLString()]=a,a),f)},"PUBLIC").setMultipleInstances(!0)),tE(c1,c2,void 0),tE(c1,c2,"esm2020");let gr=null,gi=null,gs=null,go=null,ga=null;function gl(){gr||(gr=ty({apiKey:"AIzaSyBBRmuO-xfWP-1bxiP5Ex1aSOo3dWu4Mhs",authDomain:"travel-agent-management-29c27.firebaseapp.com",databaseURL:"https://travel-agent-management-29c27-default-rtdb.firebaseio.com",projectId:"travel-agent-management-29c27",storageBucket:"travel-agent-management-29c27.firebasestorage.app",messagingSenderId:"387994411670",appId:"1:387994411670:web:5591a4bc9e4befb09f18b7"}))}let gh=()=>(!gi&&(gl(),gr&&(gi=function(e=tv()){let t=to(e,"auth");if(t.isInitialized())return t.getImmediate();let n=function(e,t){let n=to(e,"auth");if(n.isInitialized()){let e=n.getImmediate();if(eC(n.getOptions(),t??{}))return e;tV(e,"already-initialized")}return n.initialize({options:t})}(e,{popupRedirectResolver:iv,persistence:[rq,rC,rS]}),r=ee("authTokenSyncURL");if(r&&"boolean"==typeof isSecureContext&&isSecureContext){let e=new URL(r,location.origin);if(location.origin===e.origin){let t,r=(t=e.toString(),async e=>{let n=e&&await e.getIdTokenResult(),r=n&&(new Date().getTime()-Date.parse(n.issuedAtTime))/1e3;if(r&&r>iT)return;let i=n?.token;iI!==i&&(iI=i,await fetch(t,{method:i?"POST":"DELETE",headers:i?{Authorization:`Bearer ${i}`}:{}}))});eL(n).beforeAuthStateChanged(r,()=>r(n.currentUser)),eL(n).onIdTokenChanged(e=>r(e),void 0,void 0)}}let i=X("auth");return i&&function(e,t,n){let r=eL(e);t$(/^https?:\/\//.test(t),r,"invalid-emulator-scheme");let i=nG(t),{host:s,port:o}=function(e){let t=nG(e),n=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!n)return{host:"",port:null};let r=n[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(r);if(i){let e=i[1];return{host:e,port:nQ(r.substr(e.length+1))}}{let[e,t]=r.split(":");return{host:e,port:nQ(t)}}}(t),a=null===o?"":`:${o}`,l={url:`${i}//${s}${a}/`},h=Object.freeze({host:s,port:o,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:!1})});if(!r._canInitEmulator){t$(r.config.emulator&&r.emulatorConfig,r,"emulator-config-failed"),t$(eC(l,r.config.emulator)&&eC(h,r.emulatorConfig),r,"emulator-config-failed");return}r.config.emulator=l,r.emulatorConfig=h,r.settings.appVerificationDisabledForTesting=!0,en(s)?(er(`${i}//${s}${a}`),ea("Auth",!0)):function(){function e(){let e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}"undefined"!=typeof console&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),"undefined"!=typeof window&&"undefined"!=typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",e):e())}()}(n,`http://${i}`),n}(gr))),gi),gu=()=>(!gs&&(gl(),gr&&(gs=up(gr))),gs),gc=()=>(!ga&&(gl(),gr&&(ga=c0(gr))),ga);gh(),gu(),!go&&(gl(),gr&&(go=function(e=tv(),t){let n=to(e,"database").getImmediate({identifier:void 0});if(!n._instanceStarted){let e=J("database");e&&function(e,t,n,r={}){var i;let s,o,a;(e=eL(e))._checkNotDeleted("useEmulator");let l=`${t}:${n}`,h=e._repoInternal;if(e._instanceStarted){if(l===e._repoInternal.repoInfo_.host&&eC(r,h.repoInfo_.emulatorOptions))return;du("connectDatabaseEmulator() cannot initialize or alter the emulator configuration after the database instance has started.")}h.repoInfo_.nodeAdmin?(r.mockUserToken&&du('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),s=new dN(dN.OWNER)):r.mockUserToken&&(s=new dN("string"==typeof r.mockUserToken?r.mockUserToken:ei(r.mockUserToken,e.app.options.projectId))),en(t)&&(er(t),ea("Database",!0)),i=s,o=l.lastIndexOf(":"),a=en(l.substring(0,o)),h.repoInfo_=new dx(l,a,h.repoInfo_.namespace,h.repoInfo_.webSocketOnly,h.repoInfo_.nodeAdmin,h.repoInfo_.persistenceKey,h.repoInfo_.includeNamespaceInQueryParams,!0,r),i&&(h.authTokenProvider_=i)}(n,...e)}return n}(gr))),gc(),e.s(["getAuthInstance",0,gh,"getDbInstance",0,gu,"getStorageInstance",0,gc],59141);let gd=(0,B.createContext)(void 0);e.s(["AuthProvider",0,({children:e})=>{let[t,n]=(0,B.useState)(null),[r,i]=(0,B.useState)(null),[s,o]=(0,B.useState)(!0);(0,B.useEffect)(()=>{var e;let t=gh();if(!t)return;let r=(e=async e=>{if(e){n(e);let t=gu();if(t){let n=await u3(ul(t,"users",e.uid));n.exists()&&i(n.data())}}else n(null),i(null);o(!1)},eL(t).onAuthStateChanged(e,void 0,void 0));return()=>r()},[]);let a=async(e,t)=>{try{console.log(" Starting sign-in process for:",e);let n=gh();if(!n)throw console.error(" Auth instance not initialized"),Error("Authentication service not available. Please check your connection.");console.log(" Attempting Firebase authentication...");let r=await (tu(n.app)?Promise.reject(tq(n)):rm(eL(n),rt.credential(e,t)).catch(async e=>{throw"auth/password-does-not-meet-requirements"===e.code&&rw(n),e}));console.log(" Firebase auth successful for user:",r.user.uid);let s=gu();if(!s)throw console.error(" Database instance not initialized"),Error("Database service not available. Please try again later.");let o=ul(s,"users",r.user.uid);console.log(" Fetching user document:",o.path);let a=await u3(o);if(console.log(" User document exists:",a.exists()),a.exists()){let e=a.data();if(console.log(" User data retrieved:",{role:e.role,approved:e.approved,name:e.name}),!e.approved)throw console.warn(" User account not approved yet"),Error("Account not approved yet. Please wait for admin approval.");i(e),console.log(" Sign-in process completed successfully")}else throw console.error(" User document not found in database"),Error("User profile not found. Please contact support.")}catch(e){if(console.error(" Sign-in failed:",e),"auth/user-not-found"===e.code)throw Error("No account found with this email address.");if("auth/wrong-password"===e.code)throw Error("Incorrect password. Please try again.");if("auth/invalid-email"===e.code)throw Error("Please enter a valid email address.");else if("auth/user-disabled"===e.code)throw Error("This account has been disabled. Please contact support.");else if("auth/too-many-requests"===e.code)throw Error("Too many failed attempts. Please try again later.");else if("unavailable"===e.code)throw Error("Service temporarily unavailable. Please check your connection.");throw e}},l=async()=>{try{let e=gh();if(!e)throw Error("Auth not initialized");let t=new rs,n=await r1(e,t);console.log("Google User UID:",n.user.uid);let r=gu();if(!r)throw Error("Database not initialized");let s=ul(r,"users",n.user.uid);console.log("Looking for document:",s.path);let o=await u3(s);if(console.log("Document exists:",o.exists()),o.exists()){let e=o.data();if(console.log("User data:",e),!e.approved)throw Error("Account not approved yet. Please wait for admin approval.");i(e)}else{let e=n.user.email===F.default.env.NEXT_PUBLIC_ADMIN_EMAIL,t={role:e?"admin":"agency",approved:e,name:n.user.displayName||"User",...e?{}:{companyName:"Pending Setup"}};await u8(s,t),i(t)}}catch(e){if("auth/popup-blocked"===e.code||"auth/popup-closed-by-user"===e.code||"auth/cancelled-popup-request"===e.code)throw console.warn("Google sign-in popup was blocked or cancelled. Please allow popups for this site or use email/password login."),Error("Google sign-in popup was blocked. Please allow popups for this site or use email/password login instead.");throw e}},h=async()=>{let e=gh();e&&await eL(e).signOut()},u=async(e,t,n,r,i)=>{try{let s=gh();if(!s)throw Error("Auth not initialized");let o=(await rb(s,e,t)).user,a=null;if(i){let e=gc();if(e){let t=cZ(e,`proofs/${o.uid}/${i.name}`);await cX(t,i),a=await cJ(t)}}let l=gu();if(!l)throw Error("Database not initialized");await u8(ul(l,"users",o.uid),{...r,role:n,approved:"user"===n,...a&&{proofUrl:a}})}catch(e){if("auth/email-already-in-use"===e.code)throw Error("This email is already registered. Please use a different email address or try logging in instead.");if("auth/weak-password"===e.code)throw Error("Password should be at least 6 characters long.");if("auth/invalid-email"===e.code)throw Error("Please enter a valid email address.");else throw Error("Registration failed. Please try again.")}};return(0,V.jsx)(gd.Provider,{value:{user:t,userData:r,loading:s,signIn:a,signInWithGoogle:l,signOut:h,register:u},children:e})},"useAuth",0,()=>{let e=(0,B.useContext)(gd);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}],57951)}]);